"use strict";(self.webpackChunkwebsite_next=self.webpackChunkwebsite_next||[]).push([[49880],{92514:(e,o,n)=>{n.r(o),n.d(o,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>a,toc:()=>u});const a=JSON.parse('{"id":"administration-isolation-bookie","title":"Isolate bookies","description":"Get a comprehensive understanding of bookie data isolation policy in Pulsar.","source":"@site/versioned_docs/version-3.3.x/administration-isolation-bookie.md","sourceDirName":".","slug":"/administration-isolation-bookie","permalink":"/docs/3.3.x/administration-isolation-bookie","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/pulsar-site/edit/main/versioned_docs/version-3.3.x/administration-isolation-bookie.md","tags":[],"version":"3.3.x","frontMatter":{"id":"administration-isolation-bookie","title":"Isolate bookies","sidebar_label":"Isolate bookies","description":"Get a comprehensive understanding of bookie data isolation policy in Pulsar."},"sidebar":"docsSidebar","previous":{"title":"Isolate brokers","permalink":"/docs/3.3.x/administration-isolation-broker"},"next":{"title":"Statistics","permalink":"/docs/3.3.x/administration-stats"}}');var i=n(74848),r=n(28453),s=n(89089),t=n(19365);const l={id:"administration-isolation-bookie",title:"Isolate bookies",sidebar_label:"Isolate bookies",description:"Get a comprehensive understanding of bookie data isolation policy in Pulsar."},c=void 0,d={},u=[{value:"Understand bookie data isolation policy",id:"understand-bookie-data-isolation-policy",level:2},{value:"Rack-aware placement policy",id:"rack-aware-placement-policy",level:3},{value:"Qualified rack size of bookies",id:"qualified-rack-size-of-bookies",level:4},{value:"Enforced minimum rack size of bookies",id:"enforced-minimum-rack-size-of-bookies",level:4},{value:"Region-aware placement policy",id:"region-aware-placement-policy",level:3},{value:"Enable bookie data placement policy",id:"enable-bookie-data-placement-policy",level:2},{value:"Enable region-aware placement policy on broker",id:"enable-region-aware-placement-policy-on-broker",level:3},{value:"Enable region-aware placement policy on the auto-recovery instances (pods)",id:"enable-region-aware-placement-policy-on-the-auto-recovery-instances-pods",level:3},{value:"Configure data placement policy on bookie instances",id:"configure-data-placement-policy-on-bookie-instances",level:2},{value:"Example of configuring rack-aware placement policy",id:"example-of-configuring-rack-aware-placement-policy",level:4},{value:"Example of configuring region-aware placement policy",id:"example-of-configuring-region-aware-placement-policy",level:4},{value:"Configure bookie affinity groups",id:"configure-bookie-affinity-groups",level:2}];function p(e){const o={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o.p,{children:"Isolating bookies equals isolating message storage, which is a data storage mechanism that provides isolation and safety for specific topics."}),"\n",(0,i.jsx)(o.p,{children:"Bookie isolation is controlled by BookKeeper clients. For Pulsar, there are two kinds of BookKeeper clients to read and write data."}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsx)(o.li,{children:"BookKeeper clients on the broker side: Pulsar brokers use these BookKeeper clients to read and write topic messages."}),"\n",(0,i.jsxs)(o.li,{children:["BookKeeper clients on the bookie auto-recovery side:","\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsx)(o.li,{children:"The bookie auditor checks whether ledger replicas fulfill the configured isolation policy;"}),"\n",(0,i.jsx)(o.li,{children:"The bookie replication worker writes ledger replicas to target bookies according to the configured isolation policy."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(o.p,{children:"To isolate bookies, you need to complete the following tasks."}),"\n",(0,i.jsxs)(o.ol,{children:["\n",(0,i.jsxs)(o.li,{children:["Select a ",(0,i.jsx)(o.a,{href:"#understand-bookie-data-isolation-policy",children:"data isolation policy"})," based on your requirements."]}),"\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.a,{href:"#enable-bookie-data-placement-policy",children:"Enable the policy on BookKeeper clients"}),"."]}),"\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.a,{href:"#configure-data-placement-policy-on-bookie-instances",children:"Configure the policy on bookie instances"}),"."]}),"\n"]}),"\n",(0,i.jsx)(o.h2,{id:"understand-bookie-data-isolation-policy",children:"Understand bookie data isolation policy"}),"\n",(0,i.jsx)(o.p,{children:'Bookie data isolation policy is built on top of the existing BookKeeper rack-aware placement policy. The "rack" concept can be anything, for example, racks, regions, availability zones. It writes the configured isolation policy into the metadata store. Both BookKeeper clients on the broker and bookie auto-recovery side read the configured isolation policy from the metadata store and apply it when choosing bookies to store messages.'}),"\n",(0,i.jsx)(o.p,{children:"BookKeeper provides three kinds of data isolation policies for disaster tolerance."}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsx)(o.li,{children:"Rack-aware placement policy (default)"}),"\n",(0,i.jsx)(o.li,{children:"Region-aware placement policy"}),"\n",(0,i.jsx)(o.li,{children:"Zone-aware placement policy"}),"\n"]}),"\n",(0,i.jsx)(o.admonition,{type:"tip",children:(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsxs)(o.li,{children:["\n",(0,i.jsxs)(o.p,{children:["Both ",(0,i.jsx)(o.a,{href:"#rack-aware-placement-policy",children:"rack-aware placement policy"})," and ",(0,i.jsx)(o.a,{href:"#region-aware-placement-policy",children:"region-aware placement policy"})," can be used in all kinds of deployments where racks are a subset of a region. The major difference between the two policies is:"]}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsxs)(o.li,{children:["With ",(0,i.jsx)(o.code,{children:"RackawareEnsemblePlacementPolicy"})," configured, the BookKeeper client chooses bookies from different ",(0,i.jsx)(o.strong,{children:"racks"})," to reduce the single point of failure. If there is only one rack available, the policy falls back on choosing a random bookie across available ones."]}),"\n",(0,i.jsxs)(o.li,{children:["With ",(0,i.jsx)(o.code,{children:"RegionAwareEnsemblePlacementPolicy"})," configured, the BookKeeper client chooses bookies from different ",(0,i.jsx)(o.strong,{children:"regions"}),"; for the selected region, it chooses bookies from different racks if more than one ensemble falls into the same region."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(o.li,{children:["\n",(0,i.jsxs)(o.p,{children:["Zone-aware placement policy (",(0,i.jsx)(o.code,{children:"ZoneAwareEnsemblePlacementPolicy"}),") can be used in a public cloud infrastructure where Availability Zones (AZs) are isolated locations within the data center regions that public cloud services originate from and operate in."]}),"\n"]}),"\n"]})}),"\n",(0,i.jsx)(o.h3,{id:"rack-aware-placement-policy",children:"Rack-aware placement policy"}),"\n",(0,i.jsxs)(o.p,{children:["Rack-aware placement policy enforces different data replicas to be placed in different racks to guarantee the rack-level disaster tolerance for your production environment. A data center usually has a lot of racks, and each rack has many storage nodes. You can use ",(0,i.jsx)(o.code,{children:"RackAwareEnsemblePlacementPolicy"})," to configure the rack information for each bookie."]}),"\n",(0,i.jsx)(o.h4,{id:"qualified-rack-size-of-bookies",children:"Qualified rack size of bookies"}),"\n",(0,i.jsx)(o.p,{children:"When the available rack size of bookies can meet the requirements configured on a topic, the rack-aware placement policy can work well and you don't need any extra configurations."}),"\n",(0,i.jsxs)(o.p,{children:["For example, the BookKeeper cluster has 4 racks and 13 bookie instances as shown in the following diagram. When a topic is configured with ",(0,i.jsx)(o.code,{children:"EnsembleSize=3, WriteQuorum=3, AckQuorum=2"}),", the BookKeeper client chooses one bookie instance from three different racks to write data to, such as Bookie2, Bookie8, and Bookie12."]}),"\n",(0,i.jsx)(o.p,{children:(0,i.jsx)(o.img,{alt:"Rack-aware placement policy in Pulsar",src:n(77171).A+"",width:"1578",height:"278"})}),"\n",(0,i.jsx)(o.h4,{id:"enforced-minimum-rack-size-of-bookies",children:"Enforced minimum rack size of bookies"}),"\n",(0,i.jsx)(o.p,{children:"When the available rack size of bookies cannot meet the requirements configured on a topic, the strategy that the BookKeeper client chooses bookies to recover old ledgers and create new ledgers depends on whether the enforced minimum rack size of bookies is configured."}),"\n",(0,i.jsxs)(o.p,{children:["In this case, if you want to make the rack-aware placement policy work as usual, you need to configure an enforced minimum rack size of bookies (",(0,i.jsx)(o.code,{children:"MinNumRacksPerWriteQuorum"}),")."]}),"\n",(0,i.jsxs)(o.p,{children:["For example, you have the same BookKeeper cluster with the same topic requirements ",(0,i.jsx)(o.code,{children:"EnsembleSize=3, WriteQuorum=3, AckQuorum=2"})," as shown in the above diagram. When all the bookie instances in Rack3 and Rack4 fail, you only have 2 available racks and there are the following three possibilities."]}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsxs)(o.li,{children:["\n",(0,i.jsxs)(o.p,{children:["If you have configured ",(0,i.jsx)(o.code,{children:"EnforceMinNumRacksPerWriteQuorum=true"})," and ",(0,i.jsx)(o.code,{children:"MinNumRacksPerWriteQuorum=3"}),", the BookKeeper client fails to choose bookies, which means new ledgers cannot be created and old ledgers cannot be recovered. Because the requirement of ",(0,i.jsx)(o.code,{children:"MinNumRacksPerWriteQuorum=3"})," cannot be fulfilled."]}),"\n"]}),"\n",(0,i.jsxs)(o.li,{children:["\n",(0,i.jsxs)(o.p,{children:["If you have configured ",(0,i.jsx)(o.code,{children:"EnforceMinNumRacksPerWriteQuorum=true"})," and ",(0,i.jsx)(o.code,{children:"MinNumRacksPerWriteQuorum=2"}),", the BookKeeper client chooses one bookie from Rack1 and Rack2 to recover old ledgers, such as bookie1 and bookie5, to place 2 replicas for Bookie8 and Bookie12. For new ledger creation, it chooses one bookie from Rack1 and Rack2, such as Bookie4 and Bookie7, and a random bookie from either Rack1 or Rack2 to place the last replica."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(o.p,{children:(0,i.jsx)(o.img,{alt:"Rack-aware placement policy with an enforced minimum rack size of bookies",src:n(72768).A+"",width:"1578",height:"461"})}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsxs)(o.li,{children:["If you have configured ",(0,i.jsx)(o.code,{children:"EnforceMinNumRacksPerWriteQuorum=false"}),", the BookKeeper client tries its best effort to apply the placement policy depending on the available number of racks and bookies. It may still work as the above diagram or the following diagram."]}),"\n"]}),"\n",(0,i.jsx)(o.p,{children:(0,i.jsx)(o.img,{alt:"Rack-aware placement policy without an enforced minimum rack size of bookies",src:n(92369).A+"",width:"1578",height:"525"})}),"\n",(0,i.jsx)(o.h3,{id:"region-aware-placement-policy",children:"Region-aware placement policy"}),"\n",(0,i.jsxs)(o.p,{children:["Region-aware placement policy enforces different data replicas to be placed in different regions and racks to guarantee region-level disaster tolerance. To achieve datacenter level disaster tolerance, you need to write data replicas into different data centers. You can use ",(0,i.jsx)(o.code,{children:"RegionAwareEnsemblePlacementPolicy"})," to configure region and rack information for each bookie node to ensure region-level disaster tolerance."]}),"\n",(0,i.jsxs)(o.p,{children:["For example, the BookKeeper cluster has 4 regions, and each region has several racks with their bookie instances, as shown in the following diagram. If a topic is configured with ",(0,i.jsx)(o.code,{children:"EnsembleSize=3, WriteQuorum=3, and AckQuorum=2"}),", the BookKeeper client chooses three different regions, such as Region A, Region C and Region D. For each region, it chooses one bookie on a single rack, such as Bookie5 on Rack2, Bookie17 on Rack6, and Bookie21 on Rack8."]}),"\n",(0,i.jsx)(o.p,{children:(0,i.jsx)(o.img,{alt:"Region-aware placement policy in Pulsar",src:n(8072).A+"",width:"1656",height:"809"})}),"\n",(0,i.jsx)(o.p,{children:"When two regions fail, such as Region B and Region C, as shown in the following diagram, the BookKeeper client chooses one bookie from Region A or Region D to replace the failed Bookie17 for recovering old ledgers. And it also chooses Region A and Region D to write replicas for creating new ledgers. In Region A, it falls back to rack-aware placement policy and chooses one bookie from Rack1 and Rack2, such as Bookie4 and Bookie7. For Region D, it has to choose one bookie from Rack8, such as Bookie22."}),"\n",(0,i.jsx)(o.p,{children:(0,i.jsx)(o.img,{alt:"Region-aware placement policy for disaster tolerance",src:n(23611).A+"",width:"1734",height:"928"})}),"\n",(0,i.jsx)(o.h2,{id:"enable-bookie-data-placement-policy",children:"Enable bookie data placement policy"}),"\n",(0,i.jsx)(o.p,{children:"By default, the rack-aware placement policy is enabled on both broker and bookie sides. If you want to switch to the region-aware placement policy, you need to enable the region-aware placement policy on both broker and bookie sides."}),"\n",(0,i.jsx)(o.h3,{id:"enable-region-aware-placement-policy-on-broker",children:"Enable region-aware placement policy on broker"}),"\n",(0,i.jsxs)(o.p,{children:["To enable region-aware placement policy on broker, configure the following field in the ",(0,i.jsx)(o.code,{children:"conf/broker.conf"})," file."]}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-properties",children:"bookkeeperClientRegionawarePolicyEnabled=true\n"})}),"\n",(0,i.jsx)(o.p,{children:"To enforce the minimum rack size of bookies, configure the following fields:"}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-properties",children:"bookkeeperClientEnforceMinNumRacksPerWriteQuorum=true\nbookkeeperClientMinNumRacksPerWriteQuorum=2\n"})}),"\n",(0,i.jsx)(o.p,{children:"To balance the ledger disk usage of different bookies, you can enable the disk weight placement by configuring the following field:"}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-properties",children:"bookkeeperDiskWeightBasedPlacementEnabled=true\n"})}),"\n",(0,i.jsx)(o.h3,{id:"enable-region-aware-placement-policy-on-the-auto-recovery-instances-pods",children:"Enable region-aware placement policy on the auto-recovery instances (pods)"}),"\n",(0,i.jsxs)(o.p,{children:["To enable region-aware placement policy on the auto-recovery instances, configure the following fields in the ",(0,i.jsx)(o.code,{children:"conf/bookkeeper.conf"})," file."]}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-properties",children:"ensemblePlacementPolicy=org.apache.bookkeeper.client.RegionAwareEnsemblePlacementPolicy\nreppDnsResolverClass=org.apache.pulsar.zookeeper.ZkBookieRackAffinityMapping\n"})}),"\n",(0,i.jsx)(o.p,{children:"To enforce the minimum rack size of bookies, configure the following fields:"}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-properties",children:"enforceMinNumRacksPerWriteQuorum=true\nminNumRacksPerWriteQuorum=2\n"})}),"\n",(0,i.jsx)(o.p,{children:"To balance the ledger disk usage of different bookies, you can enable the disk weight placement by configuring the following field:"}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-properties",children:"diskWeightBasedPlacementEnabled=true\n"})}),"\n",(0,i.jsx)(o.h2,{id:"configure-data-placement-policy-on-bookie-instances",children:"Configure data placement policy on bookie instances"}),"\n",(0,i.jsx)(o.p,{children:"To configure a data placement policy on bookie instances, you can use one of the following methods."}),"\n",(0,i.jsxs)(s.A,{defaultValue:"Pulsar-admin CLI",values:[{label:"Pulsar-admin CLI",value:"Pulsar-admin CLI"},{label:"REST API",value:"REST API"}],children:[(0,i.jsxs)(t.A,{value:"Pulsar-admin CLI",children:[(0,i.jsx)(o.p,{children:"Specify the rack name to represent which region or rack this bookie belongs to."}),(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-bash",children:"bin/pulsar-admin bookies set-bookie-rack\nThe following options are required: [-b | --bookie], [-r | --rack]\n\nThen we need to update the rack placement information for a specific bookie in the cluster. Note that the bookie address format is `address:port`.\nUsage: set-bookie-rack [options]\n  Options:\n  * -b, --bookie\n      Bookie address (format: `address:port`)\n    -g, --group\n      Bookie group name\n      Default: default\n    --hostname\n      Bookie host name\n  * -r, --rack\n      Bookie rack name\n"})}),(0,i.jsx)(o.admonition,{type:"tip",children:(0,i.jsxs)(o.p,{children:["In addition, you can also group bookies across racks or regions to serve broker-level isolation by specifying a group name for each bookie and assigning the group name to a specific namespace. See ",(0,i.jsx)(o.a,{href:"#configure-bookie-affinity-groups",children:"configure bookie affinity groups"})," for more details."]})})]}),(0,i.jsx)(t.A,{value:"REST API",children:(0,i.jsx)(o.p,{children:(0,i.jsxs)(o.a,{href:"https://pulsar.apache.org/admin-rest-api?version=3.3.3&apiversion=v2#operation/updateBookieRackInfo",children:["POST /admin/v2/bookies/racks-info/",":bookie","/updateBookieRackInfo"]})})})]}),"\n",(0,i.jsx)(o.h4,{id:"example-of-configuring-rack-aware-placement-policy",children:"Example of configuring rack-aware placement policy"}),"\n",(0,i.jsx)(o.p,{children:"The following is an example of how to configure bookie instances with their rack properties."}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-bash",children:"bin/pulsar-admin bookies set-bookie-rack --bookie bookie1:3181 --hostname bookie1.pulsar.com:3181 --group group1 --rack rack1\nbin/pulsar-admin bookies set-bookie-rack --bookie bookie2:3181 --hostname bookie2.pulsar.com:3181 --group group1 --rack rack1\nbin/pulsar-admin bookies set-bookie-rack --bookie bookie3:3181 --hostname bookie3.pulsar.com:3181 --group group1 --rack rack1\nbin/pulsar-admin bookies set-bookie-rack --bookie bookie4:3181 --hostname bookie4.pulsar.com:3181 --group group1 --rack rack1\nbin/pulsar-admin bookies set-bookie-rack --bookie bookie5:3181 --hostname bookie5.pulsar.com:3181 --group group1 --rack rack2\n...\n"})}),"\n",(0,i.jsx)(o.h4,{id:"example-of-configuring-region-aware-placement-policy",children:"Example of configuring region-aware placement policy"}),"\n",(0,i.jsx)(o.p,{children:"The following is an example of how to configure bookie instances with their region/rack properties."}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-bash",children:"bin/pulsar-admin bookies set-bookie-rack --bookie bookie1:3181 --hostname bookie1.pulsar.com:3181 --group group1 --rack RegionA/rack1\nbin/pulsar-admin bookies set-bookie-rack --bookie bookie2:3181 --hostname bookie2.pulsar.com:3181 --group group1 --rack RegionA/rack1\nbin/pulsar-admin bookies set-bookie-rack --bookie bookie3:3181 --hostname bookie3.pulsar.com:3181 --group group1 --rack RegionA/rack1\nbin/pulsar-admin bookies set-bookie-rack --bookie bookie4:3181 --hostname bookie4.pulsar.com:3181 --group group1 --rack RegionA/rack1\nbin/pulsar-admin bookies set-bookie-rack --bookie bookie5:3181 --hostname bookie5.pulsar.com:3181 --group group1 --rack RegionA/rack2\nbin/pulsar-admin bookies set-bookie-rack --bookie bookie6:3181 --hostname bookie6.pulsar.com:3181 --group group1 --rack RegionA/rack2\nbin/pulsar-admin bookies set-bookie-rack --bookie bookie7:3181 --hostname bookie7.pulsar.com:3181 --group group1 --rack RegionA/rack2\nbin/pulsar-admin bookies set-bookie-rack --bookie bookie8:3181 --hostname bookie8.pulsar.com:3181 --group group1 --rack RegionB/rack3\n...\n"})}),"\n",(0,i.jsx)(o.h2,{id:"configure-bookie-affinity-groups",children:"Configure bookie affinity groups"}),"\n",(0,i.jsx)(o.p,{children:"The data of a namespace can be isolated into user-defined groups of bookies, as known as bookie affinity groups, which guarantee all the data that belongs to the namespace is stored in desired bookies."}),"\n",(0,i.jsxs)(o.p,{children:[(0,i.jsx)(o.strong,{children:"Prerequisites:"})," Before configuring bookie affinity groups, you need to group bookies first. See ",(0,i.jsx)(o.a,{href:"#configure-data-placement-policy-on-bookie-instances",children:"configure data placement policy on bookie instances"})," for more details."]}),"\n",(0,i.jsx)(o.p,{children:"To configure bookie affinity groups, you can use one of the following methods."}),"\n",(0,i.jsxs)(s.A,{defaultValue:"Pulsar-admin CLI",values:[{label:"Pulsar-admin CLI",value:"Pulsar-admin CLI"},{label:"REST API",value:"REST API"},{label:"Java admin API",value:"Java admin API"}],children:[(0,i.jsxs)(t.A,{value:"Pulsar-admin CLI",children:[(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-shell",children:"pulsar-admin namespaces set-bookie-affinity-group options\n"})}),(0,i.jsxs)(o.p,{children:["For more information about the command ",(0,i.jsx)(o.code,{children:"pulsar-admin namespaces set-bookie-affinity-group options"}),", see ",(0,i.jsx)(o.a,{href:"pathname:///reference/#/3.3.x/pulsar-admin/",children:"Pulsar admin docs"}),"."]}),(0,i.jsx)(o.p,{children:(0,i.jsx)(o.strong,{children:"Example"})}),(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-shell",children:"bin/pulsar-admin bookies set-bookie-rack \\\n--bookie 127.0.0.1:3181 \\\n--hostname 127.0.0.1:3181 \\\n--group group-bookie1 \\\n--rack rack1\n\nbin/pulsar-admin namespaces set-bookie-affinity-group public/default \\\n--primary-group group-bookie1\n"})}),(0,i.jsx)(o.admonition,{type:"note",children:(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsxs)(o.li,{children:["Do not set a bookie rack name to slash (",(0,i.jsx)(o.code,{children:"/"}),") or an empty string (",(0,i.jsx)(o.code,{children:'""'}),") if you use Pulsar earlier than 2.7.5, 2.8.3, and 2.9.2. If you use Pulsar 2.7.5, 2.8.3, 2.9.2 or later versions, it falls back to ",(0,i.jsx)(o.code,{children:"/default-rack"})," or ",(0,i.jsx)(o.code,{children:"/default-region/default-rack"}),"."]}),"\n",(0,i.jsxs)(o.li,{children:["When ",(0,i.jsx)(o.code,{children:"RackawareEnsemblePlacementPolicy"})," is enabled, the rack name is not allowed to contain one slash (",(0,i.jsx)(o.code,{children:"/"}),") except for the beginning and end of the rack name string. For example, a rack name like ",(0,i.jsx)(o.code,{children:"/rack0"})," is allowed, but ",(0,i.jsx)(o.code,{children:"/rack/0"})," is invalid."]}),"\n",(0,i.jsxs)(o.li,{children:["When ",(0,i.jsx)(o.code,{children:"RegionAwareEnsemblePlacementPolicy"})," is enabled, the rack name can only contain one slash (",(0,i.jsx)(o.code,{children:"/"}),") except for the beginning and end of the rack name string. For example, rack name like ",(0,i.jsx)(o.code,{children:"/region0/rack0"})," is allowed, but ",(0,i.jsx)(o.code,{children:"/region0rack0"})," and ",(0,i.jsx)(o.code,{children:"/region0/rack/0"})," are invalid.\nFor the bookie rack name restrictions, see ",(0,i.jsx)(o.a,{href:"pathname:///reference/#/3.3.x/pulsar-admin/bookies?id=set-bookie-rack",children:"pulsar-admin bookies set-bookie-rack"}),"."]}),"\n"]})})]}),(0,i.jsx)(t.A,{value:"REST API",children:(0,i.jsx)(o.p,{children:(0,i.jsxs)(o.a,{href:"https://pulsar.apache.org/admin-rest-api?version=3.3.3&apiversion=v2#operation/setBookieAffinityGroup",children:["POST /admin/v2/namespaces/",":tenant","/",":namespace","/persistence/bookieAffinity/setBookieAffinityGroup"]})})}),(0,i.jsx)(t.A,{value:"Java admin API",children:(0,i.jsxs)(o.p,{children:["For how to set bookie affinity group for a namespace using Java admin API, see ",(0,i.jsx)(o.a,{href:"https://github.com/apache/pulsar/blob/master/pulsar-client-admin/src/main/java/org/apache/pulsar/client/admin/internal/NamespacesImpl.java#L1164",children:"code"}),"."]})})]})]})}function h(e={}){const{wrapper:o}={...(0,r.R)(),...e.components};return o?(0,i.jsx)(o,{...e,children:(0,i.jsx)(p,{...e})}):p(e)}},19365:(e,o,n)=>{n.d(o,{A:()=>s});n(96540);var a=n(34164);const i={tabItem:"tabItem_Ymn6"};var r=n(74848);function s(e){let{children:o,hidden:n,className:s}=e;return(0,r.jsx)("div",{role:"tabpanel",className:(0,a.A)(i.tabItem,s),hidden:n,children:o})}},89089:(e,o,n)=>{n.d(o,{A:()=>w});var a=n(96540),i=n(34164),r=n(23104),s=n(56347),t=n(205),l=n(57485),c=n(31682),d=n(70679);function u(e){return a.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,a.isValidElement)(e)&&function(e){const{props:o}=e;return!!o&&"object"==typeof o&&"value"in o}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function p(e){const{values:o,children:n}=e;return(0,a.useMemo)((()=>{const e=o??function(e){return u(e).map((e=>{let{props:{value:o,label:n,attributes:a,default:i}}=e;return{value:o,label:n,attributes:a,default:i}}))}(n);return function(e){const o=(0,c.XI)(e,((e,o)=>e.value===o.value));if(o.length>0)throw new Error(`Docusaurus error: Duplicate values "${o.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[o,n])}function h(e){let{value:o,tabValues:n}=e;return n.some((e=>e.value===o))}function k(e){let{queryString:o=!1,groupId:n}=e;const i=(0,s.W6)(),r=function(e){let{queryString:o=!1,groupId:n}=e;if("string"==typeof o)return o;if(!1===o)return null;if(!0===o&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:o,groupId:n});return[(0,l.aZ)(r),(0,a.useCallback)((e=>{if(!r)return;const o=new URLSearchParams(i.location.search);o.set(r,e),i.replace({...i.location,search:o.toString()})}),[r,i])]}function m(e){const{defaultValue:o,queryString:n=!1,groupId:i}=e,r=p(e),[s,l]=(0,a.useState)((()=>function(e){let{defaultValue:o,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(o){if(!h({value:o,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${o}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return o}const a=n.find((e=>e.default))??n[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:o,tabValues:r}))),[c,u]=k({queryString:n,groupId:i}),[m,b]=function(e){let{groupId:o}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(o),[i,r]=(0,d.Dv)(n);return[i,(0,a.useCallback)((e=>{n&&r.set(e)}),[n,r])]}({groupId:i}),f=(()=>{const e=c??m;return h({value:e,tabValues:r})?e:null})();(0,t.A)((()=>{f&&l(f)}),[f]);return{selectedValue:s,selectValue:(0,a.useCallback)((e=>{if(!h({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);l(e),u(e),b(e)}),[u,b,r]),tabValues:r}}var b=n(92303);const f={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var g=n(74848);function x(e){let{className:o,block:n,selectedValue:a,selectValue:s,tabValues:t}=e;const l=[],{blockElementScrollPositionUntilNextRender:c}=(0,r.a_)(),d=e=>{const o=e.currentTarget,n=l.indexOf(o),i=t[n].value;i!==a&&(c(o),s(i))},u=e=>{let o=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const n=l.indexOf(e.currentTarget)+1;o=l[n]??l[0];break}case"ArrowLeft":{const n=l.indexOf(e.currentTarget)-1;o=l[n]??l[l.length-1];break}}o?.focus()};return(0,g.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.A)("tabs",{"tabs--block":n},o),children:t.map((e=>{let{value:o,label:n,attributes:r}=e;return(0,g.jsx)("li",{role:"tab",tabIndex:a===o?0:-1,"aria-selected":a===o,ref:e=>l.push(e),onKeyDown:u,onClick:d,...r,className:(0,i.A)("tabs__item",f.tabItem,r?.className,{"tabs__item--active":a===o}),children:n??o},o)}))})}function y(e){let{lazy:o,children:n,selectedValue:r}=e;const s=(Array.isArray(n)?n:[n]).filter(Boolean);if(o){const e=s.find((e=>e.props.value===r));return e?(0,a.cloneElement)(e,{className:(0,i.A)("margin-top--md",e.props.className)}):null}return(0,g.jsx)("div",{className:"margin-top--md",children:s.map(((e,o)=>(0,a.cloneElement)(e,{key:o,hidden:e.props.value!==r})))})}function j(e){const o=m(e);return(0,g.jsxs)("div",{className:(0,i.A)("tabs-container",f.tabList),children:[(0,g.jsx)(x,{...o,...e}),(0,g.jsx)(y,{...o,...e})]})}function w(e){const o=(0,b.A)();return(0,g.jsx)(j,{...e,children:u(e.children)},String(o))}},77171:(e,o,n)=>{n.d(o,{A:()=>a});const a=n.p+"assets/images/rack-aware-placement-policy-1-4f24b2896f0259416ecaac0abf7421cb.svg"},72768:(e,o,n)=>{n.d(o,{A:()=>a});const a=n.p+"assets/images/rack-aware-placement-policy-2-3864fb206aa793fa87a6556b71642968.svg"},92369:(e,o,n)=>{n.d(o,{A:()=>a});const a=n.p+"assets/images/rack-aware-placement-policy-3-d9ba58be554e438afc505386acf1d94b.svg"},8072:(e,o,n)=>{n.d(o,{A:()=>a});const a=n.p+"assets/images/region-aware-placement-policy-1-e507d707cb5e369fa91616c45db6421b.svg"},23611:(e,o,n)=>{n.d(o,{A:()=>a});const a=n.p+"assets/images/region-aware-placement-policy-2-d85209e840449079d2a46f7ad82df678.svg"},28453:(e,o,n)=>{n.d(o,{R:()=>s,x:()=>t});var a=n(96540);const i={},r=a.createContext(i);function s(e){const o=a.useContext(r);return a.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function t(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),a.createElement(r.Provider,{value:o},e.children)}}}]);