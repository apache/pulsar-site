"use strict";(self.webpackChunkwebsite_next=self.webpackChunkwebsite_next||[]).push([[60174],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>d});var r=a(67294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function s(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?s(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},s=Object.keys(e);for(r=0;r<s.length;r++)a=s[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)a=s[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var l=r.createContext({}),c=function(e){var t=r.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},p=function(e){var t=c(e.components);return r.createElement(l.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},h=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,s=e.originalType,l=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),h=c(a),d=n,u=h["".concat(l,".").concat(d)]||h[d]||m[d]||s;return a?r.createElement(u,i(i({ref:t},p),{},{components:a})):r.createElement(u,i({ref:t},p))}));function d(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var s=a.length,i=new Array(s);i[0]=h;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o.mdxType="string"==typeof e?e:n,i[1]=o;for(var c=2;c<s;c++)i[c]=a[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,a)}h.displayName="MDXCreateElement"},15263:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>m,frontMatter:()=>s,metadata:()=>o,toc:()=>c});var r=a(87462),n=(a(67294),a(3905));const s={id:"schema-overview",title:"Overview",sidebar_label:"Overview"},i=void 0,o={unversionedId:"schema-overview",id:"schema-overview",title:"Overview",description:"This section introduces the following content:",source:"@site/docs/schema-overview.md",sourceDirName:".",slug:"/schema-overview",permalink:"/docs/next/schema-overview",draft:!1,editUrl:"https://github.com/apache/pulsar/edit/master/site2/docs/schema-overview.md",tags:[],version:"current",frontMatter:{id:"schema-overview",title:"Overview",sidebar_label:"Overview"},sidebar:"docsSidebar",previous:{title:"Multiple advertised listeners",permalink:"/docs/next/concepts-multiple-advertised-listeners"},next:{title:"Understand schema",permalink:"/docs/next/schema-understand"}},l={},c=[{value:"What is Pulsar Schema",id:"what-is-pulsar-schema",level:2},{value:"Why use it",id:"why-use-it",level:2},{value:"How it works",id:"how-it-works",level:2},{value:"Producer side",id:"producer-side",level:3},{value:"Consumer side",id:"consumer-side",level:3},{value:"Use case",id:"use-case",level:2},{value:"What&#39;s next?",id:"whats-next",level:2}],p={toc:c};function m(e){let{components:t,...s}=e;return(0,n.kt)("wrapper",(0,r.Z)({},p,s,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("p",null,"This section introduces the following content:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"#what-is-pulsar-schema"},"What is Pulsar Schema")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"#why-use-it"},"Why use it")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"#how-it-works"},"How it works")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"#use-case"},"Use case")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"#whats-next"},"What's next?"))),(0,n.kt)("h2",{id:"what-is-pulsar-schema"},"What is Pulsar Schema"),(0,n.kt)("p",null,"Pulsar messages are stored as unstructured byte arrays and the data structure (as known as schema) is applied to this data only when it's read. The schema serializes the bytes before they are published to a topic and deserializes them before they are delivered to the consumers, dictating which data types are recognized as valid for a given topic."),(0,n.kt)("p",null,"Pulsar schema registry is a central repository to store the schema information, which enables producers/consumers to coordinate on the schema of a topic\u2019s data through brokers."),(0,n.kt)("admonition",{type:"note"},(0,n.kt)("p",{parentName:"admonition"},"Currently, Pulsar schema is only available for the ",(0,n.kt)("a",{parentName:"p",href:"/docs/next/client-libraries-java"},"Java client"),", ",(0,n.kt)("a",{parentName:"p",href:"/docs/next/client-libraries-go"},"Go client"),", ",(0,n.kt)("a",{parentName:"p",href:"/docs/next/client-libraries-python"},"Python client"),", and ",(0,n.kt)("a",{parentName:"p",href:"/docs/next/client-libraries-cpp"},"C++ client"),".")),(0,n.kt)("h2",{id:"why-use-it"},"Why use it"),(0,n.kt)("p",null,"Type safety is extremely important in any application built around a messaging and streaming system. Raw bytes are flexible for data transfer, but the flexibility and neutrality come with a cost: you have to overlay data type checking and serialization/deserialization to ensure that the bytes fed into the system can be read and successfully consumed. In other words, you need to make sure the data intelligible and usable to applications."),(0,n.kt)("p",null,"Pulsar schema resolves the pain points with the following capabilities:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"enforces the data type safety when a topic has a schema defined. As a result, producers/consumers are only allowed to connect if they are using a \u201ccompatible\u201d schema."),(0,n.kt)("li",{parentName:"ul"},"provides a central location for storing information about the schemas used within your organization, in turn greatly simplifies the sharing of this information across application teams."),(0,n.kt)("li",{parentName:"ul"},"serves as a single source of truth for all the message schemas used across all your services and development teams, which makes it easier for them to collaborate."),(0,n.kt)("li",{parentName:"ul"},"keeps data compatibility on-track between schema versions. When new schemas are uploaded, the new versions can be read by old consumers. "),(0,n.kt)("li",{parentName:"ul"},"stored in the existing storage layer BookKeeper, no additional system required.")),(0,n.kt)("h2",{id:"how-it-works"},"How it works"),(0,n.kt)("p",null,"Pulsar schemas are applied and enforced at the ",(0,n.kt)("strong",{parentName:"p"},"topic")," level (schemas cannot be applied at the namespace or tenant level). "),(0,n.kt)("p",null,"Producers and consumers upload schemas to brokers, so Pulsar schemas work on the producer side and the consumer side."),(0,n.kt)("h3",{id:"producer-side"},"Producer side"),(0,n.kt)("p",null,"This diagram illustrates how schema works on the Producer side."),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"Schema works at the producer side",src:a(20849).Z,width:"1278",height:"1228"})),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"The application uses a schema instance to construct a producer instance. "),(0,n.kt)("p",{parentName:"li"},"The schema instance defines the schema for the data being produced using the producer instance. "),(0,n.kt)("p",{parentName:"li"},"Take AVRO as an example, Pulsar extracts schema definition from the POJO class and constructs the ",(0,n.kt)("inlineCode",{parentName:"p"},"SchemaInfo")," that the producer needs to pass to a broker when it connects.")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"The producer connects to the broker with the ",(0,n.kt)("inlineCode",{parentName:"p"},"SchemaInfo")," extracted from the passed-in schema instance.")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"The broker looks up the schema in the schema storage to check if it is already a registered schema. ")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"If yes, the broker skips the schema validation since it is a known schema, and returns the schema version to the producer.")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"If no, the broker verifies whether a schema can be automatically created in this namespace:"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"If ",(0,n.kt)("inlineCode",{parentName:"p"},"isAllowAutoUpdateSchema")," sets to ",(0,n.kt)("strong",{parentName:"p"},"true"),", then a schema can be created, and the broker validates the schema based on the schema compatibility check strategy defined for the topic.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"If ",(0,n.kt)("inlineCode",{parentName:"p"},"isAllowAutoUpdateSchema")," sets to ",(0,n.kt)("strong",{parentName:"p"},"false"),", then a schema can not be created, and the producer is rejected to connect to the broker."))),(0,n.kt)("admonition",{parentName:"li",type:"tip"},(0,n.kt)("p",{parentName:"admonition"},(0,n.kt)("inlineCode",{parentName:"p"},"isAllowAutoUpdateSchema")," can be set via ",(0,n.kt)("strong",{parentName:"p"},"Pulsar admin API")," or ",(0,n.kt)("strong",{parentName:"p"},"REST API.")," "),(0,n.kt)("p",{parentName:"admonition"},"For how to set ",(0,n.kt)("inlineCode",{parentName:"p"},"isAllowAutoUpdateSchema")," via Pulsar admin API, see ",(0,n.kt)("a",{parentName:"p",href:"/docs/next/admin-api-schemas#manage-autoupdate-strategy"},"Manage AutoUpdate Strategy"),". "),(0,n.kt)("p",{parentName:"admonition"}," :::"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"If the schema is allowed to be updated, then the compatible strategy check is performed."),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"If the schema is compatible, the broker stores it and returns the schema version to the producer. All the messages produced by this producer are tagged with the schema version. ")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"If the schema is incompatible, the broker rejects it."))))),(0,n.kt)("h3",{id:"consumer-side"},"Consumer side"),(0,n.kt)("p",null,"This diagram illustrates how schema works on the consumer side. "),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"Schema works at the consumer side",src:a(5578).Z,width:"1404",height:"1298"})),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"The application uses a schema instance to construct a consumer instance."),(0,n.kt)("p",{parentName:"li"},"The schema instance defines the schema that the consumer uses for decoding messages received from a broker.")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"The consumer connects to the broker with the ",(0,n.kt)("inlineCode",{parentName:"p"},"SchemaInfo")," extracted from the passed-in schema instance.")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"The broker determines whether the topic has one of them (a schema/data/a local consumer and a local producer).")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"If a topic does not have all of them (a schema/data/a local consumer and a local producer):"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"If ",(0,n.kt)("inlineCode",{parentName:"li"},"isAllowAutoUpdateSchema")," sets to ",(0,n.kt)("strong",{parentName:"li"},"true"),", then the consumer registers a schema and it is connected to a broker."),(0,n.kt)("li",{parentName:"ul"},"If ",(0,n.kt)("inlineCode",{parentName:"li"},"isAllowAutoUpdateSchema")," sets to ",(0,n.kt)("strong",{parentName:"li"},"false"),", then the consumer is rejected to connect to a broker."))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"If a topic has one of them (a schema/data/a local consumer and a local producer), then the schema compatibility check is performed."),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"If the schema passes the compatibility check, then the consumer is connected to the broker."),(0,n.kt)("li",{parentName:"ul"},"If the schema does not pass the compatibility check, then the consumer is rejected to connect to the broker. "))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"The consumer receives messages from the broker. "),(0,n.kt)("p",{parentName:"li"},"If the schema used by the consumer supports schema versioning (for example, AVRO schema), the consumer fetches the ",(0,n.kt)("inlineCode",{parentName:"p"},"SchemaInfo")," of the version tagged in messages and uses the passed-in schema and the schema tagged in messages to decode the messages."))),(0,n.kt)("h2",{id:"use-case"},"Use case"),(0,n.kt)("p",null,"You can use language-specific types of data when constructing and handling messages from simple data types like ",(0,n.kt)("inlineCode",{parentName:"p"},"string")," to more complex application-specific types."),(0,n.kt)("p",null,"For example, you are using the ",(0,n.kt)("em",{parentName:"p"},"User")," class to define the messages sent to Pulsar topics."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-java"},"public class User {\n    String name;\n    int age;\n}\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"Without a schema")),(0,n.kt)("p",null,"If you construct a producer without specifying a schema, then the producer can only produce messages of type ",(0,n.kt)("inlineCode",{parentName:"p"},"byte[]"),". If you have a POJO class, you need to serialize the POJO into bytes before sending messages."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-java"},'Producer<byte[]> producer = client.newProducer()\n        .topic(topic)\n        .create();\nUser user = new User("Tom", 28);\nbyte[] message = \u2026 // serialize the `user` by yourself;\nproducer.send(message);\n')),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"With a schema")),(0,n.kt)("p",null,"This example constructs a producer with the ",(0,n.kt)("em",{parentName:"p"},"JSONSchema"),", and you can send the ",(0,n.kt)("em",{parentName:"p"},"User")," class to topics directly without worrying about how to serialize POJOs into bytes."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-java"},'Producer<User> producer = client.newProducer(JSONSchema.of(User.class))\n        .topic(topic)\n        .create();\nUser user = new User("Tom", 28);\nproducer.send(user);\n')),(0,n.kt)("h2",{id:"whats-next"},"What's next?"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/next/schema-understand"},"Understand basic concepts")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/next/schema-evolution-compatibility"},"Schema evolution and compatibility")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/next/schema-get-started"},"Get started")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/docs/next/admin-api-schemas"},"Manage schema"))))}m.isMDXComponent=!0},5578:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/schema-consumer-436361129cf2d37ee3764960fb377789.png"},20849:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/schema-producer-2682d94503cecdc1dd96dd54bbca105d.png"}}]);