"use strict";(self.webpackChunkwebsite_next=self.webpackChunkwebsite_next||[]).push([[56601],{32724:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>c,contentTitle:()=>r,default:()=>d,frontMatter:()=>l,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"functions-quickstart","title":"Getting started with Pulsar Functions","description":"This tutorial will walk you through running a standalone Pulsar cluster on your machine and then running your first Pulsar Functions using that cluster. The first function will run in local run mode (outside your Pulsar cluster), while the second will run in cluster mode (inside your cluster).","source":"@site/versioned_docs/version-2.2.0/functions-quickstart.md","sourceDirName":".","slug":"/functions-quickstart","permalink":"/docs/2.2.0/functions-quickstart","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/pulsar-site/edit/main/versioned_docs/version-2.2.0/functions-quickstart.md","tags":[],"version":"2.2.0","frontMatter":{"id":"functions-quickstart","title":"Getting started with Pulsar Functions","sidebar_label":"Getting started","original_id":"functions-quickstart"},"sidebar":"docsSidebar","previous":{"title":"Overview","permalink":"/docs/2.2.0/functions-overview"},"next":{"title":"API","permalink":"/docs/2.2.0/functions-api"}}');var a=s(74848),i=s(28453);const l={id:"functions-quickstart",title:"Getting started with Pulsar Functions",sidebar_label:"Getting started",original_id:"functions-quickstart"},r=void 0,c={},o=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Run a standalone Pulsar cluster",id:"run-a-standalone-pulsar-cluster",level:2},{value:"Run a Pulsar Function in local run mode",id:"run-a-pulsar-function-in-local-run-mode",level:2},{value:"Multiple input topics allowed",id:"multiple-input-topics-allowed",level:4},{value:"Run a Pulsar Function in cluster mode",id:"run-a-pulsar-function-in-cluster-mode",level:2},{value:"Writing and running a new function",id:"writing-and-running-a-new-function",level:2}];function u(n){const e={a:"a",blockquote:"blockquote",code:"code",em:"em",h2:"h2",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...n.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(e.p,{children:["This tutorial will walk you through running a ",(0,a.jsx)(e.a,{href:"/docs/2.2.0/reference-terminology#standalone",children:"standalone"})," Pulsar ",(0,a.jsx)(e.a,{href:"/docs/2.2.0/reference-terminology#cluster",children:"cluster"})," on your machine and then running your first Pulsar Functions using that cluster. The first function will run in local run mode (outside your Pulsar ",(0,a.jsx)(e.a,{href:"/docs/2.2.0/reference-terminology#cluster",children:"cluster"}),"), while the second will run in cluster mode (inside your cluster)."]}),"\n",(0,a.jsxs)(e.blockquote,{children:["\n",(0,a.jsx)(e.p,{children:"In local run mode, your Pulsar Function will communicate with your Pulsar cluster but will run outside of the cluster."}),"\n"]}),"\n",(0,a.jsx)(e.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,a.jsxs)(e.p,{children:["In order to follow along with this tutorial, you'll need to have ",(0,a.jsx)(e.a,{href:"https://maven.apache.org/download.cgi",children:"Maven"})," installed on your machine."]}),"\n",(0,a.jsx)(e.h2,{id:"run-a-standalone-pulsar-cluster",children:"Run a standalone Pulsar cluster"}),"\n",(0,a.jsxs)(e.p,{children:["In order to run our Pulsar Functions, we'll need to run a Pulsar cluster locally first. The easiest way to do that is to run Pulsar in ",(0,a.jsx)(e.a,{href:"/docs/2.2.0/reference-terminology#standalone",children:"standalone"})," mode. Follow these steps to start up a standalone cluster:"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"\n$ wget https://archive.apache.org/dist/pulsar/pulsar-2.2.0/apache-pulsar-2.2.0-bin.tar.gz\n$ tar xvfz apache-pulsar-2.2.0-bin.tar.gz\n$ cd apache-pulsar-2.2.0\n$ bin/pulsar standalone \\\n  --advertised-address 127.0.0.1\n\n"})}),"\n",(0,a.jsxs)(e.p,{children:["When running Pulsar in standalone mode, the ",(0,a.jsx)(e.code,{children:"public"})," tenant and ",(0,a.jsx)(e.code,{children:"default"})," namespace will be created automatically for you. That tenant and namespace will be used throughout this tutorial."]}),"\n",(0,a.jsx)(e.h2,{id:"run-a-pulsar-function-in-local-run-mode",children:"Run a Pulsar Function in local run mode"}),"\n",(0,a.jsx)(e.p,{children:"Let's start with a simple function that takes a string as input from a Pulsar topic, adds an exclamation point to the end of the string, and then publishes that new string to another Pulsar topic. Here's the code for the function:"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-java",children:'\npackage org.apache.pulsar.functions.api.examples;\n\nimport java.util.function.Function;\n\npublic class ExclamationFunction implements Function<String, String> {\n    @Override\n    public String apply(String input) {\n        return String.format("%s!", input);\n    }\n}\n\n'})}),"\n",(0,a.jsxs)(e.p,{children:["A JAR file containing this and several other functions (written in Java) is included with the binary distribution you downloaded above (in the ",(0,a.jsx)(e.code,{children:"examples"})," folder). To run the function in local mode, i.e. on our laptop but outside our Pulsar cluster:"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"\n$ bin/pulsar-admin functions localrun \\\n  --jar examples/api-examples.jar \\\n  --classname org.apache.pulsar.functions.api.examples.ExclamationFunction \\\n  --inputs persistent://public/default/exclamation-input \\\n  --output persistent://public/default/exclamation-output \\\n  --name exclamation\n\n"})}),"\n",(0,a.jsxs)(e.blockquote,{children:["\n",(0,a.jsx)(e.h4,{id:"multiple-input-topics-allowed",children:"Multiple input topics allowed"}),"\n",(0,a.jsxs)(e.p,{children:["In the example above, a single topic was specified using the ",(0,a.jsx)(e.code,{children:"--inputs"})," flag. You can also specify multiple input topics as a comma-separated list using the same flag. Here's an example:"]}),"\n"]}),"\n",(0,a.jsxs)(e.blockquote,{children:["\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"\n--inputs topic1,topic2\n\n\n"})}),"\n"]}),"\n",(0,a.jsxs)(e.p,{children:["We can open up another shell and use the ",(0,a.jsx)(e.a,{href:"/docs/2.2.0/reference-cli-tools#pulsar-client",children:(0,a.jsx)(e.code,{children:"pulsar-client"})})," tool to listen for messages on the output topic:"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"\n$ bin/pulsar-client consume persistent://public/default/exclamation-output \\\n  --subscription-name my-subscription \\\n  --num-messages 0\n\n"})}),"\n",(0,a.jsxs)(e.blockquote,{children:["\n",(0,a.jsxs)(e.p,{children:["Setting the ",(0,a.jsx)(e.code,{children:"--num-messages"})," flag to 0 means that the consumer will listen on the topic indefinitely (rather than only accepting a certain number of messages)."]}),"\n"]}),"\n",(0,a.jsx)(e.p,{children:"With a listener up and running, we can open up another shell and produce a message on the input topic that we specified:"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:'\n$ bin/pulsar-client produce persistent://public/default/exclamation-input \\\n  --num-produce 1 \\\n  --messages "Hello world"\n\n'})}),"\n",(0,a.jsx)(e.p,{children:"In the output, you should see the following:"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"\n----- got message -----\nHello world!\n\n"})}),"\n",(0,a.jsxs)(e.p,{children:["Success! As you can see, the message has been successfully processed by the exclamation function. To shut down the function, simply hit ",(0,a.jsx)(e.strong,{children:"Ctrl+C"}),"."]}),"\n",(0,a.jsx)(e.p,{children:"Here's what happened:"}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsxs)(e.li,{children:["The ",(0,a.jsx)(e.code,{children:"Hello world"})," message that we published to the input topic (",(0,a.jsx)(e.code,{children:"persistent://public/default/exclamation-input"}),") was passed to the exclamation function that we ran on our machine"]}),"\n",(0,a.jsxs)(e.li,{children:["The exclamation function processed the message (providing a result of ",(0,a.jsx)(e.code,{children:"Hello world!"}),") and published the result to the output topic (",(0,a.jsx)(e.code,{children:"persistent://public/default/exclamation-output"}),")."]}),"\n",(0,a.jsxs)(e.li,{children:["If our exclamation function ",(0,a.jsx)(e.em,{children:"hadn't"})," been running, Pulsar would have durably stored the message data published to the input topic in ",(0,a.jsx)(e.a,{href:"https://bookkeeper.apache.org",children:"Apache BookKeeper"})," until a consumer consumed and acknowledged the message"]}),"\n"]}),"\n",(0,a.jsx)(e.h2,{id:"run-a-pulsar-function-in-cluster-mode",children:"Run a Pulsar Function in cluster mode"}),"\n",(0,a.jsxs)(e.p,{children:[(0,a.jsx)(e.a,{href:"#run-a-pulsar-function-in-local-run-mode",children:"Local run mode"})," is useful for development and experimentation, but if you want to use Pulsar Functions in a real Pulsar deployment, you'll want to run them in ",(0,a.jsx)(e.strong,{children:"cluster mode"}),". In this mode, Pulsar Functions run ",(0,a.jsx)(e.em,{children:"inside"})," your Pulsar cluster and are managed using the same ",(0,a.jsx)(e.a,{href:"/docs/2.2.0/reference-pulsar-admin#functions",children:(0,a.jsx)(e.code,{children:"pulsar-admin functions"})})," interface that we've been using thus far."]}),"\n",(0,a.jsxs)(e.p,{children:["This command, for example, would deploy the same exclamation function we ran locally above ",(0,a.jsx)(e.em,{children:"in our Pulsar cluster"})," (rather than outside it):"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"\n$ bin/pulsar-admin functions create \\\n  --jar examples/api-examples.jar \\\n  --classname org.apache.pulsar.functions.api.examples.ExclamationFunction \\\n  --inputs persistent://public/default/exclamation-input \\\n  --output persistent://public/default/exclamation-output \\\n  --name exclamation\n\n"})}),"\n",(0,a.jsxs)(e.p,{children:["You should see ",(0,a.jsx)(e.code,{children:"Created successfully"})," in the output. Now, let's see a list of functions running in our cluster:"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"\n$ bin/pulsar-admin functions list \\\n  --tenant public \\\n  --namespace default\n\n"})}),"\n",(0,a.jsxs)(e.p,{children:["We should see just the ",(0,a.jsx)(e.code,{children:"exclamation"})," function listed there. We can also check the status of our deployed function using the ",(0,a.jsx)(e.code,{children:"getstatus"})," command:"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"\n$ bin/pulsar-admin functions getstatus \\\n  --tenant public \\\n  --namespace default \\\n  --name exclamation\n\n"})}),"\n",(0,a.jsx)(e.p,{children:"You should see this JSON output:"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-json",children:'\n{\n  "functionStatusList": [\n    {\n      "running": true,\n      "instanceId": "0"\n    }\n  ]\n}\n\n'})}),"\n",(0,a.jsxs)(e.p,{children:["As we can see, (a) the instance is currently running and (b) there is one instance, with an ID of 0, running. We can get other information about the function (topics, tenant, namespace, etc.) using the ",(0,a.jsx)(e.code,{children:"get"})," command instead of ",(0,a.jsx)(e.code,{children:"getstatus"}),":"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"\n$ bin/pulsar-admin functions get \\\n  --tenant public \\\n  --namespace default \\\n  --name exclamation\n\n"})}),"\n",(0,a.jsx)(e.p,{children:"You should see this JSON output:"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-json",children:'\n{\n  "tenant": "public",\n  "namespace": "default",\n  "name": "exclamation",\n  "className": "org.apache.pulsar.functions.api.examples.ExclamationFunction",\n  "output": "persistent://public/default/exclamation-output",\n  "autoAck": true,\n  "inputs": [\n    "persistent://public/default/exclamation-input"\n  ],\n  "parallelism": 1\n}\n\n'})}),"\n",(0,a.jsxs)(e.p,{children:["As we can see, the parallelism of the function is 1, meaning that only one instance of the function is running in our cluster. Let's update our function to a parallelism of 3 using the ",(0,a.jsx)(e.code,{children:"update"})," command:"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"\n$ bin/pulsar-admin functions update \\\n  --jar examples/api-examples.jar \\\n  --classname org.apache.pulsar.functions.api.examples.ExclamationFunction \\\n  --inputs persistent://public/default/exclamation-input \\\n  --output persistent://public/default/exclamation-output \\\n  --tenant public \\\n  --namespace default \\\n  --name exclamation \\\n  --parallelism 3\n\n"})}),"\n",(0,a.jsxs)(e.p,{children:["You should see ",(0,a.jsx)(e.code,{children:"Updated successfully"})," in the output. If you run the ",(0,a.jsx)(e.code,{children:"get"})," command from above for the function, you can see that the parallelism has increased to 3, meaning that there are now three instances of the function running in our cluster:"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-json",children:'\n{\n  "tenant": "public",\n  "namespace": "default",\n  "name": "exclamation",\n  "className": "org.apache.pulsar.functions.api.examples.ExclamationFunction",\n  "output": "persistent://public/default/exclamation-output",\n  "autoAck": true,\n  "inputs": [\n    "persistent://public/default/exclamation-input"\n  ],\n  "parallelism": 3\n}\n\n'})}),"\n",(0,a.jsxs)(e.p,{children:["Finally, we can shut down our running function using the ",(0,a.jsx)(e.code,{children:"delete"})," command:"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"\n$ bin/pulsar-admin functions delete \\\n  --tenant public \\\n  --namespace default \\\n  --name exclamation\n\n"})}),"\n",(0,a.jsxs)(e.p,{children:["If you see ",(0,a.jsx)(e.code,{children:"Deleted successfully"})," in the output, then you've successfully run, updated, and shut down a Pulsar Function running in cluster mode. Congrats! Now, let's go even further and run a brand new function in the next section."]}),"\n",(0,a.jsx)(e.h2,{id:"writing-and-running-a-new-function",children:"Writing and running a new function"}),"\n",(0,a.jsxs)(e.blockquote,{children:["\n",(0,a.jsxs)(e.p,{children:["In order to write and run the ",(0,a.jsx)(e.a,{href:"/docs/2.2.0/functions-api#functions-for-python",children:"Python"})," function below, you'll need to install a few dependencies:"]}),"\n"]}),"\n",(0,a.jsxs)(e.blockquote,{children:["\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"\n$ pip install pulsar-client\n\n\n"})}),"\n"]}),"\n",(0,a.jsx)(e.p,{children:"In the above examples, we ran and managed a pre-written Pulsar Function and saw how it worked. To really get our hands dirty, let's write and our own function from scratch, using the Python API. This simple function will also take a string as input but it will reverse the string and publish the resulting, reversed string to the specified topic."}),"\n",(0,a.jsx)(e.p,{children:"First, create a new Python file:"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"\n$ touch reverse.py\n\n"})}),"\n",(0,a.jsx)(e.p,{children:"In that file, add the following:"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-python",children:"\ndef process(input):\n    return input[::-1]\n\n"})}),"\n",(0,a.jsxs)(e.p,{children:["Here, the ",(0,a.jsx)(e.code,{children:"process"})," method defines the processing logic of the Pulsar Function. It simply uses some Python slice magic to reverse each incoming string. Now, we can deploy the function using ",(0,a.jsx)(e.code,{children:"create"}),":"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"\n$ bin/pulsar-admin functions create \\\n  --py reverse.py \\\n  --classname reverse \\\n  --inputs persistent://public/default/backwards \\\n  --output persistent://public/default/forwards \\\n  --tenant public \\\n  --namespace default \\\n  --name reverse\n\n"})}),"\n",(0,a.jsxs)(e.p,{children:["If you see ",(0,a.jsx)(e.code,{children:"Created successfully"}),", the function is ready to accept incoming messages. Because the function is running in cluster mode, we can ",(0,a.jsx)(e.strong,{children:"trigger"})," the function using the ",(0,a.jsx)(e.a,{href:"/docs/2.2.0/reference-pulsar-admin#trigger",children:(0,a.jsx)(e.code,{children:"trigger"})})," command. This command will send a message that we specify to the function and also give us the function's output. Here's an example:"]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:'\n$ bin/pulsar-admin functions trigger \\\n  --name reverse \\\n  --tenant public \\\n  --namespace default \\\n  --trigger-value "sdrawrof won si tub sdrawkcab saw gnirts sihT"\n\n'})}),"\n",(0,a.jsx)(e.p,{children:"You should get this output:"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"\nThis string was backwards but is now forwards\n\n"})}),"\n",(0,a.jsxs)(e.p,{children:["Once again, success! We created a brand new Pulsar Function, deployed it in our Pulsar standalone cluster in ",(0,a.jsx)(e.a,{href:"#run-a-pulsar-function-in-cluster-mode",children:"cluster mode"})," and successfully triggered the function. If you're ready for more, check out one of these docs:"]}),"\n",(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsx)(e.li,{children:(0,a.jsx)(e.a,{href:"/docs/2.2.0/functions-api",children:"The Pulsar Functions API"})}),"\n",(0,a.jsx)(e.li,{children:(0,a.jsx)(e.a,{href:"/docs/2.2.0/functions-deploying",children:"Deploying Pulsar Functions"})}),"\n"]})]})}function d(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,a.jsx)(e,{...n,children:(0,a.jsx)(u,{...n})}):u(n)}},28453:(n,e,s)=>{s.d(e,{R:()=>l,x:()=>r});var t=s(96540);const a={},i=t.createContext(a);function l(n){const e=t.useContext(i);return t.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function r(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(a):n.components||a:l(n.components),t.createElement(i.Provider,{value:e},n.children)}}}]);