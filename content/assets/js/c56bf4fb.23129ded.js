"use strict";(self.webpackChunkwebsite_next=self.webpackChunkwebsite_next||[]).push([[75269],{63216:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>n,toc:()=>o});const n=JSON.parse('{"id":"bookkeeper-metadata-serviceuri","title":"BookKeeper Metadata Configuration (metadataServiceUri)","description":"BookKeeper needs to know where to store ledger metadata so it can place data across different racks (rack-awareness).","source":"@site/docs/bookkeeper-metadata-serviceuri.md","sourceDirName":".","slug":"/bookkeeper-metadata-serviceuri","permalink":"/docs/next/bookkeeper-metadata-serviceuri","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/pulsar-site/edit/main/docs/bookkeeper-metadata-serviceuri.md","tags":[],"version":"current","frontMatter":{"id":"bookkeeper-metadata-serviceuri","title":"BookKeeper Metadata Configuration (metadataServiceUri)"}}');var s=t(74848),i=t(28453);const a={id:"bookkeeper-metadata-serviceuri",title:"BookKeeper Metadata Configuration (metadataServiceUri)"},l="BookKeeper Metadata Configuration (metadataServiceUri)",d={},o=[{value:"<strong>1. Default Behavior \u2014 When You Don\u2019t Configure Anything</strong>",id:"1-default-behavior--when-you-dont-configure-anything",level:3},{value:"<strong>2. Legacy Explicit ZooKeeper Config (Deprecated but Still Works)</strong>",id:"2-legacy-explicit-zookeeper-config-deprecated-but-still-works",level:3},{value:"<strong>3. Metadata Service URI (Preferred)</strong>",id:"3-metadata-service-uri-preferred",level:3},{value:"<strong>Avoid this format</strong>",id:"avoid-this-format",level:4},{value:"<strong>Summary :</strong>",id:"summary-",level:3}];function c(e){const r={a:"a",code:"code",em:"em",h1:"h1",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",strong:"strong",table:"table",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.header,{children:(0,s.jsx)(r.h1,{id:"bookkeeper-metadata-configuration-metadataserviceuri",children:"BookKeeper Metadata Configuration (metadataServiceUri)"})}),"\n",(0,s.jsxs)(r.p,{children:["BookKeeper needs to know where to store ledger metadata so it can place data across different racks (rack-awareness).\nThere are ",(0,s.jsx)(r.strong,{children:"three main ways"})," this is configured, and the behavior changes depending on which one you use."]}),"\n",(0,s.jsx)(r.h3,{id:"1-default-behavior--when-you-dont-configure-anything",children:(0,s.jsx)(r.strong,{children:"1. Default Behavior \u2014 When You Don\u2019t Configure Anything"})}),"\n",(0,s.jsxs)(r.p,{children:["If you leave out ",(0,s.jsx)(r.strong,{children:"metadataServiceUri"})," in ",(0,s.jsx)(r.strong,{children:"bookkeeper.conf"}),":"]}),"\n",(0,s.jsxs)(r.ol,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"BookKeeper looks for these older configs"}),":"]}),"\n"]}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsx)(r.p,{children:"zkServers \u2192 list of ZooKeeper hosts, e.g.:"}),"\n",(0,s.jsx)(r.table,{children:(0,s.jsx)(r.thead,{children:(0,s.jsx)(r.tr,{children:(0,s.jsx)(r.th,{style:{textAlign:"left"},children:"zk1:2181,zk2:2181,zk3:2181"})})})}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsxs)(r.p,{children:["zkLedgersRootPath ",(0,s.jsx)(r.code,{children:"\u2192"})," where BookKeeper\u2019s metadata is stored in ZooKeeper, e.g.:"]}),"\n",(0,s.jsx)(r.table,{children:(0,s.jsx)(r.thead,{children:(0,s.jsx)(r.tr,{children:(0,s.jsx)(r.th,{style:{textAlign:"left"},children:"/ledgers"})})})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(r.ol,{start:"2",children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"If found"}),", BookKeeper automatically ",(0,s.jsx)(r.strong,{children:"builds this old-style URI"})," internally:"]}),"\n"]}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsx)(r.p,{children:"Often"}),"\n",(0,s.jsx)(r.table,{children:(0,s.jsx)(r.thead,{children:(0,s.jsx)(r.tr,{children:(0,s.jsxs)(r.th,{style:{textAlign:"left"},children:["zk+hierarchical:",(0,s.jsx)(r.em,{children:"//zk1:2181,zk2:2181,zk3:2181/ledgers"})]})})})}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsx)(r.p,{children:"But if no layout type is set, it may be:"}),"\n",(0,s.jsx)(r.table,{children:(0,s.jsx)(r.thead,{children:(0,s.jsx)(r.tr,{children:(0,s.jsxs)(r.th,{style:{textAlign:"left"},children:["zk+null:",(0,s.jsx)(r.em,{children:"//zk1:2181,zk2:2181,zk3:2181/ledgers"})]})})})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(r.ol,{start:"3",children:["\n",(0,s.jsxs)(r.li,{children:["If layout type is missing or you explicitly use: ",(0,s.jsx)(r.strong,{children:"metadataServiceUri=zk+hierarchical://\u2026"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsx)(r.p,{children:"BookKeeper may log warnings like:\nFailed to initialize DNS Resolver org.apache.pulsar.zookeeper.ZkBookieRackAffinityMapping, used default subnet resolver because METADATA_STORE_INSTANCE failed to init BookieId list"}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsxs)(r.p,{children:["This URI format works, but it can break ",(0,s.jsx)(r.strong,{children:"rack-awareness"})," (Pulsar issue ",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/issues/24455",children:"#24455"}),")"]}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsx)(r.p,{children:"The warning occurs only if metadataServiceUri=zk+hierarchical://\u2026 is used."}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsx)(r.p,{children:"This can happen in Pulsar 3.x or 4.x."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(r.h3,{id:"2-legacy-explicit-zookeeper-config-deprecated-but-still-works",children:(0,s.jsx)(r.strong,{children:"2. Legacy Explicit ZooKeeper Config (Deprecated but Still Works)"})}),"\n",(0,s.jsxs)(r.p,{children:["Older setups didn\u2019t have ",(0,s.jsx)(r.strong,{children:"metadataServiceUri"}),".\nInstead, they used"]}),"\n",(0,s.jsx)(r.table,{children:(0,s.jsx)(r.thead,{children:(0,s.jsx)(r.tr,{children:(0,s.jsx)(r.th,{style:{textAlign:"left"},children:"zkServers=zk1:2181,zk2:2181,zk3:2181\vzkLedgersRootPath=/ledgers"})})})}),"\n",(0,s.jsxs)(r.p,{children:["BookKeeper still supports this for ",(0,s.jsx)(r.strong,{children:"backward compatibility"}),",\nbut it\u2019s basically the same as the \u201cdefault\u201d behavior above \u2014\nit ends up internally as:"]}),"\n",(0,s.jsx)(r.table,{children:(0,s.jsx)(r.thead,{children:(0,s.jsx)(r.tr,{children:(0,s.jsxs)(r.th,{style:{textAlign:"left"},children:["zk+null:",(0,s.jsx)(r.em,{children:"//zk1:2181,zk2:2181,zk3:2181/ledgers"})]})})})}),"\n",(0,s.jsx)(r.p,{children:"(Sometimes zk+hierarchical://zk1:2181,zk2:2181,zk3:2181/ledgers if a layout type is specified)"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Still works in Pulsar 3.x and 4.x."}),"\n",(0,s.jsx)(r.li,{children:"You must set zkLedgersRootPath when using this style."}),"\n",(0,s.jsx)(r.li,{children:"This is the \u201cold\u201d way \u2014 kept only for backward compatibility."}),"\n",(0,s.jsx)(r.li,{children:"New features in Pulsar might not be fully tested with this mode, so plan to migrate."}),"\n"]}),"\n",(0,s.jsx)(r.h3,{id:"3-metadata-service-uri-preferred",children:(0,s.jsx)(r.strong,{children:"3. Metadata Service URI (Preferred)"})}),"\n",(0,s.jsxs)(r.p,{children:["From our ",(0,s.jsx)(r.strong,{children:"OSS Pulsar 4.x tests"}),", the ",(0,s.jsx)(r.strong,{children:"correct and working setup"})," is:"]}),"\n",(0,s.jsx)(r.table,{children:(0,s.jsx)(r.thead,{children:(0,s.jsx)(r.tr,{children:(0,s.jsx)(r.th,{style:{textAlign:"left"},children:"metadataServiceUri=metadata-store:zk:pulsar-mini-zookeeper:2181\vzkLedgersRootPath=/ledgers\vzkServers="})})})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Works correctly with rack-awareness in Pulsar 3.x and 4.x."}),"\n",(0,s.jsx)(r.li,{children:"In most Pulsar 3.x and 4.x deployments, the correct metadata driver is already enabled, but if needed, set:"}),"\n"]}),"\n",(0,s.jsx)(r.table,{children:(0,s.jsx)(r.thead,{children:(0,s.jsx)(r.tr,{children:(0,s.jsx)(r.th,{style:{textAlign:"left"},children:"Dbookkeeper.metadata.client.drivers=org.apache.pulsar.metadata.bookkeeper.PulsarMetadataClientDriver Dbookkeeper.metadata.bookie.drivers=org.apache.pulsar.metadata.bookkeeper.PulsarMetadataBookieDriver"})})})}),"\n",(0,s.jsx)(r.h4,{id:"avoid-this-format",children:(0,s.jsx)(r.strong,{children:"Avoid this format"})}),"\n",(0,s.jsx)(r.table,{children:(0,s.jsx)(r.thead,{children:(0,s.jsx)(r.tr,{children:(0,s.jsxs)(r.th,{style:{textAlign:"left"},children:["metadataServiceUri=zk+hierarchical:",(0,s.jsx)(r.em,{children:"//zk1:2181,zk2:2181,zk3:2181/ledgers"})]})})})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"This is because, In Pulsar 3.x and 4.x, rack-awareness may fail with this format."}),"\n",(0,s.jsxs)(r.li,{children:["This is a known bug \u2014 see ",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/issues/24426",children:"Pulsar #24426"}),"."]}),"\n",(0,s.jsxs)(r.li,{children:["Use ",(0,s.jsx)(r.strong,{children:"metadata-store:zk:"})," instead."]}),"\n"]}),"\n",(0,s.jsx)(r.h3,{id:"summary-",children:(0,s.jsx)(r.strong,{children:"Summary :"})}),"\n",(0,s.jsxs)(r.p,{children:["Always set ",(0,s.jsx)(r.strong,{children:"metadataServiceUri"})," in bookkeeper.conf. Example:"]}),"\n",(0,s.jsx)(r.table,{children:(0,s.jsx)(r.thead,{children:(0,s.jsx)(r.tr,{children:(0,s.jsx)(r.th,{style:{textAlign:"left"},children:"metadataServiceUri=metadata-store:zk:zk1:2181,zk2:2181,zk3:2181/ledgers"})})})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsx)(r.p,{children:"\u2192 This is the modern, reliable method. Works well with rack-awareness in Pulsar 3.x and 4.x."}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsxs)(r.p,{children:["If you ",(0,s.jsx)(r.strong,{children:"don\u2019t set it"}),", BookKeeper will:"]}),"\n",(0,s.jsxs)(r.ol,{children:["\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsx)(r.p,{children:"Check for old configs zkServers + zkLedgersRootPath."}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsxs)(r.p,{children:["The \u201cwarning / failure\u201d only happens with metadataServiceUri=zk+hierarchical://\u2026, not with legacy zkServers.\n\u2192 This may cause ",(0,s.jsx)(r.strong,{children:"rack-awareness to break"})," in Pulsar 3.x and 4.x."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:r}={...(0,i.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},28453:(e,r,t)=>{t.d(r,{R:()=>a,x:()=>l});var n=t(96540);const s={},i=n.createContext(s);function a(e){const r=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function l(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),n.createElement(i.Provider,{value:r},e.children)}}}]);