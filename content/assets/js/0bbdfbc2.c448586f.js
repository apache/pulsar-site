"use strict";(self.webpackChunkwebsite_next=self.webpackChunkwebsite_next||[]).push([[52896],{48014:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>a});var s=r(7741),i=r(74848),t=r(28453);const l={author:"Technoboy-, Anonymitaet",title:"What\u2019s New in Apache Pulsar 2.7.4"},c="Notable bug fixes and enhancements",d={authorsImageUrls:[void 0]},a=[{value:"Upgrade Log4j to 2.17.0 - CVE-2021-45105. PR-13392",id:"upgrade-log4j-to-2170---cve-2021-45105-pr-13392",level:3},{value:"<code>ManagedLedger</code> can be referenced correctly when <code>OpAddEntry</code> is recycled. PR-12103",id:"managedledger-can-be-referenced-correctly-when-opaddentry-is-recycled-pr-12103",level:3},{value:"No potential race condition in the <code>BlobStoreBackedReadHandler</code>. PR-12123",id:"no-potential-race-condition-in-the-blobstorebackedreadhandler-pr-12123",level:3},{value:"NPE does not occur on <code>OpAddEntry</code> while ManagedLedger is closing. PR-12364",id:"npe-does-not-occur-on-opaddentry-while-managedledger-is-closing-pr-12364",level:3},{value:"Set a topic policy through the topic name of a partition correctly. PR-11294",id:"set-a-topic-policy-through-the-topic-name-of-a-partition-correctly-pr-11294",level:3},{value:"Dispatch rate limiter takes effect for consumers. PR-8611",id:"dispatch-rate-limiter-takes-effect-for-consumers-pr-8611",level:3},{value:"NPE does not occur when executing unload bundles operations. PR-11310",id:"npe-does-not-occur-when-executing-unload-bundles-operations-pr-11310",level:3},{value:"Fix inconsistent behavior for Namespace bundles cache. PR-11346",id:"fix-inconsistent-behavior-for-namespace-bundles-cache-pr-11346",level:3},{value:"Close the replicator and replication client after a cluster is deleted. PR-11342",id:"close-the-replicator-and-replication-client-after-a-cluster-is-deleted-pr-11342",level:3},{value:"Publish rate limiter takes effect as expected. PR-10384",id:"publish-rate-limiter-takes-effect-as-expected-pr-10384",level:3},{value:"Clean up newly created  ledgers if fails to update ZNode list. PR-12015",id:"clean-up-newly-created--ledgers-if-fails-to-update-znode-list-pr-12015",level:3}];function o(e){const n={a:"a",code:"code",h1:"h1",h3:"h3",li:"li",p:"p",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"The Apache Pulsar community releases version 2.7.4! 32 contributors provided improvements and bug fixes that delivered 98 commits."}),"\n",(0,i.jsx)(n.p,{children:"Highlights of this release are as below:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Upgrade Log4j to 2.17.0 - ",(0,i.jsx)(n.a,{href:"https://pulsar.apache.org/blog/2021/12/11/Log4j-CVE/",children:"CVE-2021-45105"}),". ",(0,i.jsx)(n.a,{href:"https://github.com/apache/pulsar/pull/13392",children:"PR-13392"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"ManagedLedger"})," can be referenced correctly when ",(0,i.jsx)(n.code,{children:"OpAddEntry"})," is recycled. ",(0,i.jsx)(n.a,{href:"https://github.com/apache/pulsar/pull/12103",children:"PR-12103"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["NPE does not occur on ",(0,i.jsx)(n.code,{children:"OpAddEntry"})," while ManagedLedger is closing. ",(0,i.jsx)(n.a,{href:"https://github.com/apache/pulsar/pull/12364",children:"PR-12364"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["This blog walks through the most noteworthy changes grouped by the affected functionalities. For the complete list including all enhancements and bug fixes, check out the ",(0,i.jsx)(n.a,{href:"https://pulsar.apache.org/en/release-notes/#274",children:"Pulsar 2.7.4 Release Notes"}),"."]}),"\n",(0,i.jsxs)(n.h3,{id:"upgrade-log4j-to-2170---cve-2021-45105-pr-13392",children:["Upgrade Log4j to 2.17.0 - ",(0,i.jsx)(n.a,{href:"https://pulsar.apache.org/blog/2021/12/11/Log4j-CVE/",children:"CVE-2021-45105"}),". ",(0,i.jsx)(n.a,{href:"https://github.com/apache/pulsar/pull/13392",children:"PR-13392"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Issue"})}),"\n",(0,i.jsxs)(n.p,{children:["A serious vulnerability was reported regarding Log4j that can allow remote execution for attackers. The vulnerability issue is described and tracked under ",(0,i.jsx)(n.a,{href:"https://nvd.nist.gov/vuln/detail/CVE-2021-44228",children:"CVE-2021-44228"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Resolution"})}),"\n",(0,i.jsx)(n.p,{children:"Pulsar 2.7.4 upgraded Log4j to 2.17.0."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"managedledger-can-be-referenced-correctly-when-opaddentry-is-recycled-pr-12103",children:[(0,i.jsx)(n.code,{children:"ManagedLedger"})," can be referenced correctly when ",(0,i.jsx)(n.code,{children:"OpAddEntry"})," is recycled. ",(0,i.jsx)(n.a,{href:"https://github.com/apache/pulsar/pull/12103",children:"PR-12103"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Issue"})}),"\n",(0,i.jsxs)(n.p,{children:["Previously, after a write failure, a task was scheduled in the background to force close the ledger and trigger the creation of  a new ledger. If the ",(0,i.jsx)(n.code,{children:"OpAddEntry"})," instance was already recycled, that could lead to either an NPE or undefined behavior."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Resolution"})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"ManagedLedgerImpl"})," object reference is copied to a final variable so the background task will not be dependent on the lifecycle of the ",(0,i.jsx)(n.code,{children:"OpAddEntry"})," instance."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"no-potential-race-condition-in-the-blobstorebackedreadhandler-pr-12123",children:["No potential race condition in the ",(0,i.jsx)(n.code,{children:"BlobStoreBackedReadHandler"}),". ",(0,i.jsx)(n.a,{href:"https://github.com/apache/pulsar/pull/12123",children:"PR-12123"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Issue"})}),"\n",(0,i.jsxs)(n.p,{children:["Previously, ",(0,i.jsx)(n.code,{children:"BlobStoreBackedReadHandler"})," entered an infinite loop when reading an offload ledger. There was a race condition between the operation of reading entries and closing BlobStoreBackedReadHandler."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Resolution"})}),"\n",(0,i.jsxs)(n.p,{children:["Added a state check before reading entries and made the ",(0,i.jsx)(n.code,{children:"BlobStoreBackedReadHandler"})," exit loop when the ",(0,i.jsx)(n.code,{children:"entryID"})," is bigger than the ",(0,i.jsx)(n.code,{children:"lastEntryID"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"npe-does-not-occur-on-opaddentry-while-managedledger-is-closing-pr-12364",children:["NPE does not occur on ",(0,i.jsx)(n.code,{children:"OpAddEntry"})," while ManagedLedger is closing. ",(0,i.jsx)(n.a,{href:"https://github.com/apache/pulsar/pull/12364",children:"PR-12364"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Issue"})}),"\n",(0,i.jsxs)(n.p,{children:["Previously, the test ",(0,i.jsx)(n.code,{children:"ManagedLedgerBkTest#managedLedgerClosed"})," closed ManagedLedger object on some ",(0,i.jsx)(n.code,{children:"asyncAddEntry"})," operations and failed with NPE."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Resolution"})}),"\n",(0,i.jsxs)(n.p,{children:["Closed ",(0,i.jsx)(n.code,{children:"OpAddEntry"}),"  when ",(0,i.jsx)(n.code,{children:" ManagedLedger"})," signaled  ",(0,i.jsx)(n.code,{children:"OpAddEntry"})," to fail. In this way, the ",(0,i.jsx)(n.code,{children:"OpAddEntry"})," object was correctly recycled and the failed callback was correctly triggered."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"set-a-topic-policy-through-the-topic-name-of-a-partition-correctly-pr-11294",children:["Set a topic policy through the topic name of a partition correctly. ",(0,i.jsx)(n.a,{href:"https://github.com/apache/pulsar/pull/11294",children:"PR-11294"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Issue"})}),"\n",(0,i.jsx)(n.p,{children:"Previously, the topic name of a partition could not be used to set a topic policy."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Resolution"})}),"\n",(0,i.jsxs)(n.p,{children:["Allowed setting a topic policy through a topic name of a partition by converting the topic name of a partition in ",(0,i.jsx)(n.code,{children:"SystemTopicBasedTopicPoliciesService"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"dispatch-rate-limiter-takes-effect-for-consumers-pr-8611",children:["Dispatch rate limiter takes effect for consumers. ",(0,i.jsx)(n.a,{href:"https://github.com/apache/pulsar/pull/8611",children:"PR-8611"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Issue"})}),"\n",(0,i.jsxs)(n.p,{children:["Previously, dispatch rate limiter did not take effect in cases where all consumers started reading in the next second since ",(0,i.jsx)(n.code,{children:"acquiredPermits"})," was reset to 0 every second."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Resolution"})}),"\n",(0,i.jsxs)(n.p,{children:["Changed the behaviour of ",(0,i.jsx)(n.code,{children:"DispatchRateLimiter"})," by minus ",(0,i.jsx)(n.code,{children:"permits"})," every second instead of reset ",(0,i.jsx)(n.code,{children:"acquiredPermits"})," to 0. Consumers stopped reading entries temporarily until ",(0,i.jsx)(n.code,{children:"acquiredPermits"})," returned to a value less than ",(0,i.jsx)(n.code,{children:"permits"})," ."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"npe-does-not-occur-when-executing-unload-bundles-operations-pr-11310",children:["NPE does not occur when executing unload bundles operations. ",(0,i.jsx)(n.a,{href:"https://github.com/apache/pulsar/pull/11310",children:"PR-11310"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Issue"})}),"\n",(0,i.jsx)(n.p,{children:"When performing pressure tests on persistent partitioned topics, NPE occurred when executing unload bundles operations. Concurrently, producers did not write messages."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Resolution"})}),"\n",(0,i.jsx)(n.p,{children:"Added more safety checks to fix this issue."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"fix-inconsistent-behavior-for-namespace-bundles-cache-pr-11346",children:["Fix inconsistent behavior for Namespace bundles cache. ",(0,i.jsx)(n.a,{href:"https://github.com/apache/pulsar/pull/11346",children:"PR-11346"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Issue"})}),"\n",(0,i.jsx)(n.p,{children:"Previously, namespace bundle cache was not invalidated after a namespace was deleted."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Resolution"})}),"\n",(0,i.jsx)(n.p,{children:"Invalidated namespace policy cache when bundle cache was invalidated."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"close-the-replicator-and-replication-client-after-a-cluster-is-deleted-pr-11342",children:["Close the replicator and replication client after a cluster is deleted. ",(0,i.jsx)(n.a,{href:"https://github.com/apache/pulsar/pull/11342",children:"PR-11342"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Issue"})}),"\n",(0,i.jsx)(n.p,{children:"Previously, the replicator and the replication client were not closed after a cluster was deleted. The producer of the replicator would then try to reconnect to the deleted cluster continuously."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Resolution"})}),"\n",(0,i.jsx)(n.p,{children:"Closed the relative replicator and replication client."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"publish-rate-limiter-takes-effect-as-expected-pr-10384",children:["Publish rate limiter takes effect as expected. ",(0,i.jsx)(n.a,{href:"https://github.com/apache/pulsar/pull/10384",children:"PR-10384"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Issue"})}),"\n",(0,i.jsxs)(n.p,{children:["Previously, there were various issues if ",(0,i.jsx)(n.code,{children:"preciseTopicPublishRateLimiterEnable"}),"  was set to ",(0,i.jsx)(n.code,{children:"true"})," for rate limiting:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Updating the limits did not set a boundary when changing the limits from a bounded limit to an unbounded limit."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Each topic created a scheduler thread for each limiter instance."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Topics did not release the scheduler thread when the topic was unloaded or the operation closed."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Updating the limits did not close the scheduler thread related to the replaced limiter instance"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Resolution"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Cleaned up the previous limiter instances before creating new limiter instances."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Used ",(0,i.jsx)(n.code,{children:"brokerService.pulsar().getExecutor()"})," as the scheduler for the rate limiter instances."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Added resource cleanup hooks for topic closing (unload)."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"clean-up-newly-created--ledgers-if-fails-to-update-znode-list-pr-12015",children:["Clean up newly created  ledgers if fails to update ZNode list. ",(0,i.jsx)(n.a,{href:"https://github.com/apache/pulsar/pull/12015",children:"PR-12015"})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Issue"})}),"\n",(0,i.jsxs)(n.p,{children:["When updating a ZNode list, ZooKeeper threw an exception and did not clean up the created ledger. Newly created ledgers were not  indexed to a topic ",(0,i.jsx)(n.code,{children:"managedLedger"})," list and could not be cleared up as topic retention. Also, ZNode numbers increased in ZooKeeper if the ZNode version mismatch exception was thrown out."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Resolution"})}),"\n",(0,i.jsx)(n.p,{children:"Deleted the created ledger from broker cache and BookKeeper regardless of exception type when the ZNode list failed to update."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h1,{id:"whats-next",children:"What\u2019s Next?"}),"\n",(0,i.jsxs)(n.p,{children:["If you are interested in learning more about Pulsar 2.7.4, you can ",(0,i.jsx)(n.a,{href:"https://pulsar.apache.org/en/versions/",children:"download"})," and try it out now!"]}),"\n",(0,i.jsxs)(n.p,{children:["Pulsar Summit Asia 2021 will take place on January 15-16, 2022. ",(0,i.jsx)(n.a,{href:"https://pulsar-summit.org/",children:"Register now"})," and help us make it an even bigger success by spreading the word on social media!"]}),"\n",(0,i.jsxs)(n.p,{children:["For more information about the Apache Pulsar project and current  progress, visit\nthe ",(0,i.jsx)(n.a,{href:"https://pulsar.apache.org",children:"Pulsar website"}),", follow the project on Twitter ",(0,i.jsx)(n.a,{href:"https://twitter.com/apache_pulsar",children:"@apache_pulsar"}),", and join ",(0,i.jsx)(n.a,{href:"https://apache-pulsar.herokuapp.com/",children:"Pulsar Slack"}),"!"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},28453:(e,n,r)=>{r.d(n,{R:()=>l,x:()=>c});var s=r(96540);const i={},t=s.createContext(i);function l(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),s.createElement(t.Provider,{value:n},e.children)}},7741:e=>{e.exports=JSON.parse('{"permalink":"/blog/2021/12/14/Apache-Pulsar-2-7-4","editUrl":"https://github.com/apache/pulsar-site/edit/main/blog/2021-12-14-Apache-Pulsar-2-7-4.md","source":"@site/blog/2021-12-14-Apache-Pulsar-2-7-4.md","title":"What\u2019s New in Apache Pulsar 2.7.4","description":"The Apache Pulsar community releases version 2.7.4! 32 contributors provided improvements and bug fixes that delivered 98 commits.","date":"2021-12-14T00:00:00.000Z","tags":[],"readingTime":4.39,"hasTruncateMarker":true,"authors":[{"name":"Technoboy-, Anonymitaet","key":null,"page":null}],"frontMatter":{"author":"Technoboy-, Anonymitaet","title":"What\u2019s New in Apache Pulsar 2.7.4"},"unlisted":false,"prevItem":{"title":"What\u2019s New in Apache Pulsar 2.9.2","permalink":"/blog/2022/04/08/Apache-Pulsar-2-9-2"},"nextItem":{"title":"Log4j2 Zero Day vulnerability (CVE-2021-44228)","permalink":"/blog/2021/12/11/Log4j-CVE"}}')}}]);