"use strict";(self.webpackChunkwebsite_next=self.webpackChunkwebsite_next||[]).push([[30216],{54969:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>c,contentTitle:()=>a,default:()=>d,frontMatter:()=>s,metadata:()=>i,toc:()=>u});const i=JSON.parse('{"id":"functions-develop-tutorial","title":"Tutorials","description":"Write a function for word count","source":"@site/versioned_docs/version-3.0.x/functions-develop-tutorial.md","sourceDirName":".","slug":"/functions-develop-tutorial","permalink":"/docs/3.0.x/functions-develop-tutorial","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/pulsar-site/edit/main/versioned_docs/version-3.0.x/functions-develop-tutorial.md","tags":[],"version":"3.0.x","frontMatter":{"id":"functions-develop-tutorial","title":"Tutorials","sidebar_label":"Tutorials"},"sidebar":"docsSidebar","previous":{"title":"Use SerDe","permalink":"/docs/3.0.x/functions-develop-serde"},"next":{"title":"How to debug","permalink":"/docs/3.0.x/functions-debug"}}');var o=t(74848),r=t(28453);const s={id:"functions-develop-tutorial",title:"Tutorials",sidebar_label:"Tutorials"},a=void 0,c={},u=[{value:"Write a function for word count",id:"write-a-function-for-word-count",level:2},{value:"Write a function for content-based routing",id:"write-a-function-for-content-based-routing",level:2},{value:"Write a window function for word count",id:"write-a-window-function-for-word-count",level:2}];function l(n){const e={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",...(0,r.R)(),...n.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(e.h2,{id:"write-a-function-for-word-count",children:"Write a function for word count"}),"\n",(0,o.jsx)(e.admonition,{type:"note",children:(0,o.jsxs)(e.p,{children:["The following example is a stateful function. By default, the state of a function is disabled. See ",(0,o.jsx)(e.a,{href:"/docs/3.0.x/functions-worker-stateful",children:"Enable stateful functions"})," for more instructions."]})}),"\n",(0,o.jsxs)(e.ol,{children:["\n",(0,o.jsxs)(e.li,{children:["\n",(0,o.jsxs)(e.p,{children:["Write the function in Java using the ",(0,o.jsx)(e.a,{href:"/docs/3.0.x/functions-develop-api",children:"SDK for Java"}),"."]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-java",children:' package org.example.functions;\n\n import org.apache.pulsar.functions.api.Context;\n import org.apache.pulsar.functions.api.Function;\n\n import java.util.Arrays;\n\n public class WordCountFunction implements Function<String, Void> {\n     // This function is invoked every time a message is published to the input topic\n     @Override\n     public Void process(String input, Context context) throws Exception {\n         Arrays.asList(input.split(" ")).forEach(word -> {\n             String counterKey = word.toLowerCase();\n             context.incrCounter(counterKey, 1);\n         });\n         return null;\n     }\n }\n'})}),"\n"]}),"\n",(0,o.jsxs)(e.li,{children:["\n",(0,o.jsxs)(e.p,{children:["Bundle and build the JAR file, and then deploy it in your Pulsar cluster using the ",(0,o.jsx)(e.code,{children:"pulsar-admin"})," command."]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-bash",children:"bin/pulsar-admin functions create \\\n   --jar $PWD/target/my-jar-with-dependencies.jar \\\n   --classname org.example.functions.WordCountFunction \\\n   --tenant public \\\n   --namespace default \\\n   --name word-count \\\n   --inputs persistent://public/default/sentences \\\n   --output persistent://public/default/count\n"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(e.h2,{id:"write-a-function-for-content-based-routing",children:"Write a function for content-based routing"}),"\n",(0,o.jsxs)(e.ol,{children:["\n",(0,o.jsxs)(e.li,{children:["\n",(0,o.jsxs)(e.p,{children:["Write the function in Python using the ",(0,o.jsx)(e.a,{href:"/docs/3.0.x/functions-develop-api",children:"SDK for Python"}),"."]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-python",children:' from pulsar import Function\n\n class RoutingFunction(Function):\n     def __init__(self):\n         self.fruits_topic = "persistent://public/default/fruits"\n         self.vegetables_topic = "persistent://public/default/vegetables"\n\n     def is_fruit(item):\n         return item in [b"apple", b"orange", b"pear", b"other fruits..."]\n\n     def is_vegetable(item):\n         return item in [b"carrot", b"lettuce", b"radish", b"other vegetables..."]\n\n     def process(self, item, context):\n         if self.is_fruit(item):\n             context.publish(self.fruits_topic, item)\n         elif self.is_vegetable(item):\n             context.publish(self.vegetables_topic, item)\n         else:\n             warning = "The item {0} is neither a fruit nor a vegetable".format(item)\n             context.get_logger().warn(warning)\n'})}),"\n"]}),"\n",(0,o.jsxs)(e.li,{children:["\n",(0,o.jsxs)(e.p,{children:["Suppose this code is stored in ",(0,o.jsx)(e.code,{children:"~/router.py"}),", then you can deploy it in your Pulsar cluster using the ",(0,o.jsx)(e.code,{children:"pulsar-admin"})," command."]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-bash",children:"bin/pulsar-admin functions create \\\n   --py ~/router.py \\\n   --classname router.RoutingFunction \\\n   --tenant public \\\n   --namespace default \\\n   --name route-fruit-veg \\\n   --inputs persistent://public/default/basket-items\n"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(e.h2,{id:"write-a-window-function-for-word-count",children:"Write a window function for word count"}),"\n",(0,o.jsx)(e.admonition,{type:"note",children:(0,o.jsx)(e.p,{children:"Currently, window functions are only available in Java."})}),"\n",(0,o.jsxs)(e.p,{children:["This example demonstrates how to use the ",(0,o.jsx)(e.a,{href:"/docs/3.0.x/functions-develop-api",children:"language-native interface"})," to write a window function in Java."]}),"\n",(0,o.jsx)(e.p,{children:"Each input message is a sentence that is split into words and each word is counted. The built-in counter state is used to keep track of the word count in a persistent and consistent manner."}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-java",children:'public class WordCountFunction implements Function<String, Void> {\n    @Override\n    public Void process(String input, Context context) {\n        Arrays.asList(input.split("\\\\s+")).forEach(word -> context.incrCounter(word, 1));\n        return null;\n    }\n}\n'})})]})}function d(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,o.jsx)(e,{...n,children:(0,o.jsx)(l,{...n})}):l(n)}},28453:(n,e,t)=>{t.d(e,{R:()=>s,x:()=>a});var i=t(96540);const o={},r=i.createContext(o);function s(n){const e=i.useContext(r);return i.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:s(n.components),i.createElement(r.Provider,{value:e},n.children)}}}]);