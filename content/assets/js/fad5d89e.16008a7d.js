"use strict";(self.webpackChunkwebsite_next=self.webpackChunkwebsite_next||[]).push([[72839],{90634:(e,a,r)=>{r.r(a),r.d(a,{assets:()=>c,contentTitle:()=>d,default:()=>p,frontMatter:()=>i,metadata:()=>n,toc:()=>h});const n=JSON.parse('{"id":"develop-load-manager","title":"Broker load balancer","description":"If you want to develop a broker load balancer, check out the following docs.","source":"@site/docs/develop-load-manager.md","sourceDirName":".","slug":"/develop-load-manager","permalink":"/docs/next/develop-load-manager","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/pulsar-site/edit/main/docs/develop-load-manager.md","tags":[],"version":"current","frontMatter":{"id":"develop-load-manager","title":"Broker load balancer","sidebar_label":"Broker load balancer"},"sidebar":"docsSidebar","previous":{"title":"Binary protocol","permalink":"/docs/next/developing-binary-protocol"},"next":{"title":"Plugin","permalink":"/docs/next/develop-plugin"}}');var o=r(74848),s=r(28453),t=r(11470),l=r(19365);const i={id:"develop-load-manager",title:"Broker load balancer",sidebar_label:"Broker load balancer"},d=void 0,c={},h=[{value:"Concepts",id:"concepts",level:2},{value:"Data",id:"data",level:3},{value:"Broker",id:"broker",level:3},{value:"Lead broker",id:"lead-broker",level:3},{value:"Local broker data",id:"local-broker-data",level:3},{value:"Historical broker data",id:"historical-broker-data",level:3},{value:"Bundle data",id:"bundle-data",level:3},{value:"Traffic distribution",id:"traffic-distribution",level:3},{value:"Least long term message rate strategy",id:"least-long-term-message-rate-strategy",level:3},{value:"Enablement",id:"enablement",level:2},{value:"Enable simple load manager",id:"enable-simple-load-manager",level:3},{value:"Enable modular load manager",id:"enable-modular-load-manager",level:3},{value:"Enable extensible load manager",id:"enable-extensible-load-manager",level:3},{value:"Verification",id:"verification",level:2},{value:"Step 1: check loadManagerClassName",id:"step-1-check-loadmanagerclassname",level:3},{value:"Step 2: verify load manager (optional)",id:"step-2-verify-load-manager-optional",level:3},{value:"Method 1: check load report",id:"method-1-check-load-report",level:4},{value:"Method 2: check monitor-brokers output",id:"method-2-check-monitor-brokers-output",level:4}];function u(e){const a={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(a.p,{children:"If you want to develop a broker load balancer, check out the following docs."}),"\n",(0,o.jsx)(a.p,{children:"Pulsar has the following types of load managers:"}),"\n",(0,o.jsxs)(a.ul,{children:["\n",(0,o.jsxs)(a.li,{children:["\n",(0,o.jsxs)(a.p,{children:["Simple load manager, implemented in ",(0,o.jsx)(a.a,{href:"https://github.com/apache/pulsar/blob/master/pulsar-broker/src/main/java/org/apache/pulsar/broker/loadbalance/impl/SimpleLoadManagerImpl.java",children:"SimpleLoadManagerImpl"}),", which attempts to simplify how the load is managed while also providing abstractions so that complex load management strategies may be implemented."]}),"\n"]}),"\n",(0,o.jsxs)(a.li,{children:["\n",(0,o.jsxs)(a.p,{children:["Modular load manager, implemented in ",(0,o.jsx)(a.a,{href:"https://github.com/apache/pulsar/blob/master/pulsar-broker/src/main/java/org/apache/pulsar/broker/loadbalance/impl/ModularLoadManagerImpl.java",children:"ModularLoadManagerImpl"}),", which is a flexible alternative to the ",(0,o.jsx)(a.a,{href:"https://github.com/apache/pulsar/blob/master/pulsar-broker/src/main/java/org/apache/pulsar/broker/loadbalance/impl/SimpleLoadManagerImpl.java",children:(0,o.jsx)(a.code,{children:"SimpleLoadManagerImpl"})}),"."]}),"\n"]}),"\n",(0,o.jsxs)(a.li,{children:["\n",(0,o.jsxs)(a.p,{children:["Extensible load manager, implemented in ",(0,o.jsx)(a.a,{href:"https://github.com/apache/pulsar/blob/master/pulsar-broker/src/main/java/org/apache/pulsar/broker/loadbalance/extensions/ExtensibleLoadManagerImpl.java",children:"ExtensibleLoadManagerImpl"}),", which is dependent on system topics and table views for load balance metadata store and replication."]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(a.h2,{id:"concepts",children:"Concepts"}),"\n",(0,o.jsx)(a.p,{children:"Before starting the impelemtation, make sure you understand the following basics."}),"\n",(0,o.jsx)(a.admonition,{type:"note",children:(0,o.jsx)(a.p,{children:"The following concepts are only availabe for the modular load manager."})}),"\n",(0,o.jsx)(a.h3,{id:"data",children:"Data"}),"\n",(0,o.jsxs)(a.p,{children:["The data monitored by the modular load manager is contained in the ",(0,o.jsx)(a.a,{href:"https://github.com/apache/pulsar/blob/master/pulsar-broker/src/main/java/org/apache/pulsar/broker/loadbalance/LoadData.java",children:(0,o.jsx)(a.code,{children:"LoadData"})})," class.\nHere, the available data is subdivided into the bundle data and the broker data."]}),"\n",(0,o.jsx)(a.h3,{id:"broker",children:"Broker"}),"\n",(0,o.jsxs)(a.p,{children:["The broker data is contained in the ",(0,o.jsx)(a.a,{href:"https://github.com/apache/pulsar/blob/master/pulsar-broker/src/main/java/org/apache/pulsar/broker/BrokerData.java",children:(0,o.jsx)(a.code,{children:"BrokerData"})})," class. It is further subdivided into two parts,\none being the local data that every broker individually writes to ZooKeeper, and the other being the historical broker data that is written to ZooKeeper by the leader broker."]}),"\n",(0,o.jsx)(a.h3,{id:"lead-broker",children:"Lead broker"}),"\n",(0,o.jsxs)(a.p,{children:["The module load manager is ",(0,o.jsx)(a.em,{children:"centralized"}),", meaning that all requests to assign a bundle---whether it's been seen before or whether this is the first time---only get handled by the lead broker (which can change over time). To determine the current lead broker, examine the ",(0,o.jsx)(a.code,{children:"/loadbalance/leader"})," node in ZooKeeper."]}),"\n",(0,o.jsx)(a.h3,{id:"local-broker-data",children:"Local broker data"}),"\n",(0,o.jsxs)(a.p,{children:["The local broker data is contained in the class ",(0,o.jsx)(a.a,{href:"https://github.com/apache/pulsar/blob/master/pulsar-common/src/main/java/org/apache/pulsar/policies/data/loadbalancer/LocalBrokerData.java",children:(0,o.jsx)(a.code,{children:"LocalBrokerData"})})," and provides information about the following resources:"]}),"\n",(0,o.jsxs)(a.ul,{children:["\n",(0,o.jsx)(a.li,{children:"CPU usage"}),"\n",(0,o.jsx)(a.li,{children:"JVM heap memory usage"}),"\n",(0,o.jsx)(a.li,{children:"Direct memory usage"}),"\n",(0,o.jsx)(a.li,{children:"Bandwidth in/out usage"}),"\n",(0,o.jsx)(a.li,{children:"Most recent total message rate in/out across all bundles"}),"\n",(0,o.jsx)(a.li,{children:"Total number of topics, bundles, producers, and consumers"}),"\n",(0,o.jsx)(a.li,{children:"Names of all bundles assigned to this broker"}),"\n",(0,o.jsx)(a.li,{children:"Most recent changes in bundle assignments for this broker"}),"\n"]}),"\n",(0,o.jsxs)(a.p,{children:['The local broker data is updated periodically according to the service configuration\n"loadBalancerReportUpdateMaxIntervalMinutes". After any broker updates their local broker data, the leader broker will\nreceive the update immediately via a ZooKeeper watch, where the local data is read from the ZooKeeper node\n',(0,o.jsx)(a.code,{children:"/loadbalance/brokers/<broker host/port>"})]}),"\n",(0,o.jsx)(a.h3,{id:"historical-broker-data",children:"Historical broker data"}),"\n",(0,o.jsxs)(a.p,{children:["The historical broker data is contained in the ",(0,o.jsx)(a.a,{href:"https://github.com/apache/pulsar/blob/master/pulsar-broker/src/main/java/org/apache/pulsar/broker/TimeAverageBrokerData.java",children:(0,o.jsx)(a.code,{children:"TimeAverageBrokerData"})})," class."]}),"\n",(0,o.jsx)(a.p,{children:"To reconcile the need to make good decisions in a steady-state scenario and make reactive decisions in a critical scenario, the historical data is split into two parts: the short-term data for reactive decisions, and the long-term data for steady-state decisions. Both time frames maintain the following information:"}),"\n",(0,o.jsxs)(a.ul,{children:["\n",(0,o.jsx)(a.li,{children:"Message rate in/out for the entire broker"}),"\n",(0,o.jsx)(a.li,{children:"Message throughput in/out for the entire broker"}),"\n"]}),"\n",(0,o.jsx)(a.p,{children:"Unlike the bundle data, the broker data does not maintain samples for the global broker message rates and throughputs, which is not expected to remain steady as new bundles are removed or added. Instead, this data is aggregated over the short-term and long-term data for the bundles. See the section on bundle data to understand how that data is collected and maintained."}),"\n",(0,o.jsxs)(a.p,{children:["The historical broker data is updated for each broker in memory by the leader broker whenever any broker writes their local data to ZooKeeper. Then, the historical data is written to ZooKeeper by the leader broker periodically according to the configuration ",(0,o.jsx)(a.code,{children:"loadBalancerResourceQuotaUpdateIntervalMinutes"}),"."]}),"\n",(0,o.jsx)(a.h3,{id:"bundle-data",children:"Bundle data"}),"\n",(0,o.jsxs)(a.p,{children:["The bundle data is contained in the ",(0,o.jsx)(a.a,{href:"https://github.com/apache/pulsar/blob/master/pulsar-broker/src/main/java/org/apache/pulsar/broker/BundleData.java",children:(0,o.jsx)(a.code,{children:"BundleData"})}),". Like the historical broker data, the bundle data is split into a short-term and long-term time frame. The information maintained in each time frame:"]}),"\n",(0,o.jsxs)(a.ul,{children:["\n",(0,o.jsx)(a.li,{children:"Message rate in/out for this bundle"}),"\n",(0,o.jsx)(a.li,{children:"Message Throughput In/Out for this bundle"}),"\n",(0,o.jsx)(a.li,{children:"Current number of samples for this bundle"}),"\n"]}),"\n",(0,o.jsxs)(a.p,{children:["The time frames are implemented by maintaining the average of these values over a set, a limited number of samples, where the samples are obtained through the message rate and throughput values in the local data. Thus, if the update interval for the local data is 2 minutes, the number of short samples is 10 and the number of long samples is 1000, the short-term data is maintained over a period of ",(0,o.jsx)(a.code,{children:"10 samples * 2 minutes / sample = 20 minutes"}),", while the long-term data is similarly over a period of 2000 minutes. Whenever there are not enough samples to satisfy a given time frame, the average is taken only over the existing samples. When no samples are available, default values are assumed until they are overwritten by the first sample. Currently, the default values are"]}),"\n",(0,o.jsxs)(a.ul,{children:["\n",(0,o.jsx)(a.li,{children:"Message rate in/out: 50 messages per second both ways"}),"\n",(0,o.jsx)(a.li,{children:"Message throughput in/out: 50KB per second both ways"}),"\n"]}),"\n",(0,o.jsxs)(a.p,{children:["The bundle data is updated in memory on the leader broker whenever any broker writes their local data to ZooKeeper.\nThen, the bundle data is written to ZooKeeper by the leader broker periodically at the same time as the historical broker data, according to the configuration ",(0,o.jsx)(a.code,{children:"loadBalancerResourceQuotaUpdateIntervalMinutes"}),"."]}),"\n",(0,o.jsx)(a.h3,{id:"traffic-distribution",children:"Traffic distribution"}),"\n",(0,o.jsxs)(a.p,{children:["The modular load manager uses the abstraction provided by ",(0,o.jsx)(a.a,{href:"https://github.com/apache/pulsar/blob/master/pulsar-broker/src/main/java/org/apache/pulsar/broker/loadbalance/ModularLoadManagerStrategy.java",children:(0,o.jsx)(a.code,{children:"ModularLoadManagerStrategy"})})," to make decisions about bundle assignments. The strategy makes a decision by considering the service configuration, the entire load data, and the bundle data for the bundle to be assigned. Currently, the only supported strategy is ",(0,o.jsx)(a.a,{href:"https://github.com/apache/pulsar/blob/master/pulsar-broker/src/main/java/org/apache/pulsar/broker/loadbalance/impl/LeastLongTermMessageRate.java",children:(0,o.jsx)(a.code,{children:"LeastLongTermMessageRate"})}),", though soon users will have the ability to inject their own strategies if desired."]}),"\n",(0,o.jsx)(a.h3,{id:"least-long-term-message-rate-strategy",children:"Least long term message rate strategy"}),"\n",(0,o.jsxs)(a.p,{children:["As its name suggests, the least long-term message rate strategy attempts to distribute bundles across brokers so that\nthe message rate in the long-term time window for each broker is roughly the same. However, simply balancing load based\non message rate does not handle the issue of asymmetric resource burden per message on each broker. Thus, the system\nresource usages, which are CPU, memory, direct memory, bandwidth in, and bandwidth out, are also considered in the\nassignment process. This is done by weighting the final message rate according to\n",(0,o.jsx)(a.code,{children:"1 / (overload_threshold - max_usage)"}),", where ",(0,o.jsx)(a.code,{children:"overload_threshold"})," corresponds to the configuration\n",(0,o.jsx)(a.code,{children:"loadBalancerBrokerOverloadedThresholdPercentage"})," and ",(0,o.jsx)(a.code,{children:"max_usage"})," is the maximum proportion among the system resources that are being utilized by the candidate broker. This multiplier ensures that machines with are being more heavily taxed\nby the same message rates will receive less load. In particular, it tries to ensure that if one machine is overloaded,\nthen all machines are approximately overloaded. In the case in which a broker's max usage exceeds the overload\nthreshold, that broker is not considered for bundle assignment. If all brokers are overloaded, the bundle is randomly\nassigned."]}),"\n",(0,o.jsx)(a.h2,{id:"enablement",children:"Enablement"}),"\n",(0,o.jsx)(a.p,{children:"You can enable a simple, modular, or extensible load manager by following the steps below."}),"\n",(0,o.jsxs)(a.admonition,{type:"note",children:[(0,o.jsx)(a.mdxAdmonitionTitle,{}),(0,o.jsx)(a.p,{children:"For simple and modular load managers:"}),(0,o.jsxs)(a.ul,{children:["\n",(0,o.jsxs)(a.li,{children:["\n",(0,o.jsxs)(a.p,{children:["Any mistakes in specifying the load manager will cause Pulsar to default to ",(0,o.jsx)(a.code,{children:"SimpleLoadManagerImpl"}),"."]}),"\n"]}),"\n",(0,o.jsxs)(a.li,{children:["\n",(0,o.jsxs)(a.p,{children:["If you do not specify load manager, the default load manager (",(0,o.jsx)(a.code,{children:"ModularLoadManagerImpl"}),") is used."]}),"\n"]}),"\n"]})]}),"\n",(0,o.jsx)(a.h3,{id:"enable-simple-load-manager",children:"Enable simple load manager"}),"\n",(0,o.jsx)(a.p,{children:"You can enable the simple load manager using one of the following methods:"}),"\n",(0,o.jsxs)(a.ul,{children:["\n",(0,o.jsxs)(a.li,{children:["\n",(0,o.jsx)(a.p,{children:"Method 1"}),"\n",(0,o.jsxs)(a.p,{children:["Update the value of ",(0,o.jsx)(a.a,{href:"https://github.com/apache/pulsar/blob/782e91fe327efe2c9c9107d6c679c2837d43935b/conf/broker.conf#L1309",children:"loadManagerClassName"})," to ",(0,o.jsx)(a.code,{children:"org.apache.pulsar.broker.loadbalance.impl.SimpleLoadManagerImpl"})," in ",(0,o.jsx)(a.code,{children:"conf/broker.conf"}),"."]}),"\n"]}),"\n",(0,o.jsxs)(a.li,{children:["\n",(0,o.jsx)(a.p,{children:"Method 2"}),"\n",(0,o.jsxs)(a.p,{children:["Use the ",(0,o.jsx)(a.code,{children:"pulsar-admin"})," tool."]}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-shell",children:"pulsar-admin brokers update-dynamic-config \\\n--config loadManagerClassName \\\n--value org.apache.pulsar.broker.loadbalance.impl.SimpleLoadManagerImpl\n"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(a.h3,{id:"enable-modular-load-manager",children:"Enable modular load manager"}),"\n",(0,o.jsx)(a.p,{children:"You can enable the modular load manager using one of the following methods:"}),"\n",(0,o.jsxs)(a.ul,{children:["\n",(0,o.jsxs)(a.li,{children:["\n",(0,o.jsx)(a.p,{children:"Method 1"}),"\n",(0,o.jsxs)(a.p,{children:["Update the value of ",(0,o.jsx)(a.a,{href:"https://github.com/apache/pulsar/blob/782e91fe327efe2c9c9107d6c679c2837d43935b/conf/broker.conf#L1309",children:"loadManagerClassName"})," to ",(0,o.jsx)(a.code,{children:"org.apache.pulsar.broker.loadbalance.impl.ModularLoadManagerImpl"})," in ",(0,o.jsx)(a.code,{children:"conf/broker.conf"}),"."]}),"\n"]}),"\n",(0,o.jsxs)(a.li,{children:["\n",(0,o.jsx)(a.p,{children:"Method 2"}),"\n",(0,o.jsxs)(a.p,{children:["Use the ",(0,o.jsx)(a.code,{children:"pulsar-admin"})," tool."]}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-shell",children:"pulsar-admin brokers update-dynamic-config \\\n--config loadManagerClassName \\\n--value org.apache.pulsar.broker.loadbalance.impl.ModularLoadManagerImpl\n"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(a.h3,{id:"enable-extensible-load-manager",children:"Enable extensible load manager"}),"\n",(0,o.jsxs)(a.p,{children:["You can enable the extensible load manager by updating the value of ",(0,o.jsx)(a.a,{href:"https://github.com/apache/pulsar/blob/782e91fe327efe2c9c9107d6c679c2837d43935b/conf/broker.conf#L1309",children:"loadManagerClassName"})," to ",(0,o.jsx)(a.code,{children:"org.apache.pulsar.broker.loadbalance.extensions.ExtensibleLoadManagerImpl"})," in ",(0,o.jsx)(a.code,{children:"conf/broker.conf"}),"."]}),"\n",(0,o.jsx)(a.admonition,{type:"note",children:(0,o.jsxs)(a.p,{children:["The ",(0,o.jsx)(a.a,{href:"/docs/next/reference-cli-tools",children:"pulsar-admin tool"})," is not supported for enabling the extensible load manager."]})}),"\n",(0,o.jsx)(a.h2,{id:"verification",children:"Verification"}),"\n",(0,o.jsx)(a.p,{children:"If you want to verify which load manager is used, follow the steps below."}),"\n",(0,o.jsx)(a.h3,{id:"step-1-check-loadmanagerclassname",children:"Step 1: check loadManagerClassName"}),"\n",(0,o.jsxs)(a.p,{children:["You can use the ",(0,o.jsx)(a.code,{children:"pulsar-admin"})," tool to examine the ",(0,o.jsx)(a.code,{children:"loadManagerClassName"})," element."]}),"\n",(0,o.jsx)(a.p,{children:(0,o.jsx)(a.strong,{children:"Input"})}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"bin/pulsar-admin brokers get-all-dynamic-config\n"})}),"\n",(0,o.jsx)(a.p,{children:(0,o.jsx)(a.strong,{children:"Output"})}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:'{\n"loadManagerClassName" : "org.apache.pulsar.broker.loadbalance.impl.ModularLoadManagerImpl"\n}\n'})}),"\n",(0,o.jsxs)(a.p,{children:["If there is no ",(0,o.jsx)(a.code,{children:"loadManagerClassName"})," element, then the value of ",(0,o.jsx)(a.a,{href:"https://github.com/apache/pulsar/blob/782e91fe327efe2c9c9107d6c679c2837d43935b/conf/broker.conf#L1309",children:"loadManagerClassName"})," in the ",(0,o.jsx)(a.code,{children:"conf/broker.conf"})," file is used."]}),"\n",(0,o.jsx)(a.h3,{id:"step-2-verify-load-manager-optional",children:"Step 2: verify load manager (optional)"}),"\n",(0,o.jsxs)(a.p,{children:["To double-check which load manager is used, you can ",(0,o.jsx)(a.a,{href:"#method-1-check-zookeeper-load-report",children:"check the ZooKeeper load report"})," or ",(0,o.jsx)(a.a,{href:"#method-2-check-monitor-brokers-output",children:"check monitor-brokers output"}),"."]}),"\n",(0,o.jsx)(a.h4,{id:"method-1-check-load-report",children:"Method 1: check load report"}),"\n",(0,o.jsx)(a.p,{children:"Different load managers have different load reports. You can verify which load manager is used based on the output."}),"\n",(0,o.jsxs)(t.A,{groupId:"load-manager-report",defaultValue:"Simple",values:[{label:"Simple",value:"Simple"},{label:"Modular",value:"Modular"},{label:"Extensible",value:"Extensible"}],children:[(0,o.jsxs)(l.A,{value:"Simple",children:[(0,o.jsx)(a.p,{children:"You can check ZooKeeper load reports."}),(0,o.jsxs)(a.ol,{children:["\n",(0,o.jsxs)(a.li,{children:["\n",(0,o.jsx)(a.p,{children:"Connect to ZooKeeper."}),"\n",(0,o.jsx)(a.p,{children:(0,o.jsx)(a.strong,{children:"Input"})}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"bin/pulsar zookeeper-shell -server zookeeper:2181\n"})}),"\n",(0,o.jsx)(a.p,{children:(0,o.jsx)(a.strong,{children:"Output"})}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"Connecting to zookeeper:2181\n2023-08-02T12:48:58,655+0000 [main] INFO  org.apache.zookeeper.ZooKeeper - Client environment:zookeeper.version=3.8.1-74db005175a4ec545697012f9069cb9dcc8cdda7, built on 2023-01-25 16:31 UTC\n2023-08-02T12:48:58,662+0000 [main] INFO  org.apache.zookeeper.ZooKeeper - Client environment:host.name=broker-1\n2023-08-02T12:48:58,662+0000 [main] INFO  org.apache.zookeeper.ZooKeeper - Client environment:java.version=17.0.7\n2023-08-02T12:48:58,662+0000 [main] INFO  org.apache.zookeeper.ZooKeeper - Client environment:java.vendor=Eclipse Adoptium\n2023-08-02T12:48:58,662+0000 [main] INFO  org.apache.zookeeper.ZooKeeper - Client environment:java.home=/usr/lib/jvm/temurin-17-jdk-amd64\n"})}),"\n"]}),"\n",(0,o.jsxs)(a.li,{children:["\n",(0,o.jsx)(a.p,{children:"List all brokers."}),"\n",(0,o.jsx)(a.p,{children:(0,o.jsx)(a.strong,{children:"Input"})}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"ls /loadbalance/brokers\n"})}),"\n",(0,o.jsx)(a.p,{children:(0,o.jsx)(a.strong,{children:"Output"})}),"\n",(0,o.jsx)(a.p,{children:"This output shows that there are 2 brokers."}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"[broker-1:8080, broker-2:8080]\n"})}),"\n"]}),"\n",(0,o.jsxs)(a.li,{children:["\n",(0,o.jsxs)(a.p,{children:["Check ZooKeeper load report for broker 1. The load report in ",(0,o.jsx)(a.code,{children:"/loadbalance/brokers/..."}),"."]}),"\n",(0,o.jsx)(a.p,{children:(0,o.jsx)(a.strong,{children:"Input"})}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"get /loadbalance/brokers/broker-1:8080\n"})}),"\n",(0,o.jsx)(a.p,{children:(0,o.jsx)(a.strong,{children:"Output"})}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:'{"name":"broker-1:8080","brokerVersionString":"3.1.0-SNAPSHOT","webServiceUrl":"http://broker-1:8080","pulsarServiceUrl":"pulsar://broker-1:6650","persistentTopicsEnabled":true,"nonPersistentTopicsEnabled":true,"timestamp":1691042931108,"msgRateIn":0.0,"msgRateOut":0.0,"numTopics":0,"numConsumers":0,"numProducers":0,"numBundles":0,"protocols":{},"loadManagerClassName":"org.apache.pulsar.broker.loadbalance.impl.SimpleLoadManagerImpl","startTimestamp":1691042931108,"systemResourceUsage":{"bandwidthIn":{"usage":0.595387281695773,"limit":1.0E7},"bandwidthOut":{"usage":0.5799226769764033,"limit":1.0E7},"cpu":{"usage":6.224803359552059,"limit":800.0},"memory":{"usage":152.0,"limit":2096.0},"directMemory":{"usage":0.0,"limit":256.0}},"bundleStats":{},"bundleGains":[],"bundleLosses":[],"allocatedCPU":0.0,"allocatedMemory":0.0,"allocatedBandwidthIn":0.0,"allocatedBandwidthOut":0.0,"allocatedMsgRateIn":0.0,"allocatedMsgRateOut":0.0,"preAllocatedCPU":0.0,"preAllocatedMemory":0.0,"preAllocatedBandwidthIn":0.0,"preAllocatedBandwidthOut":0.0,"preAllocatedMsgRateIn":0.0,"preAllocatedMsgRateOut":0.0,"underLoaded":true,"overLoaded":false,"loadReportType":"LoadReport","msgThroughputIn":0.0,"msgThroughputOut":0.0,"bandwidthIn":{"usage":0.595387281695773,"limit":1.0E7},"bandwidthOut":{"usage":0.5799226769764033,"limit":1.0E7},"memory":{"usage":152.0,"limit":2096.0},"cpu":{"usage":6.224803359552059,"limit":800.0},"directMemory":{"usage":0.0,"limit":256.0},"lastUpdate":1691042931108}\n'})}),"\n"]}),"\n"]})]}),(0,o.jsxs)(l.A,{value:"Modular",children:[(0,o.jsx)(a.p,{children:"You can check ZooKeeper load reports."}),(0,o.jsxs)(a.ol,{children:["\n",(0,o.jsxs)(a.li,{children:["\n",(0,o.jsx)(a.p,{children:"Connect to ZooKeeper."}),"\n",(0,o.jsx)(a.p,{children:(0,o.jsx)(a.strong,{children:"Input"})}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"bin/pulsar zookeeper-shell -server zookeeper:2181\n"})}),"\n",(0,o.jsx)(a.p,{children:(0,o.jsx)(a.strong,{children:"Output"})}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"Connecting to zookeeper:2181\n2023-08-02T12:48:58,655+0000 [main] INFO  org.apache.zookeeper.ZooKeeper - Client environment:zookeeper.version=3.8.1-74db005175a4ec545697012f9069cb9dcc8cdda7, built on 2023-01-25 16:31 UTC\n2023-08-02T12:48:58,662+0000 [main] INFO  org.apache.zookeeper.ZooKeeper - Client environment:host.name=broker-1\n2023-08-02T12:48:58,662+0000 [main] INFO  org.apache.zookeeper.ZooKeeper - Client environment:java.version=17.0.7\n2023-08-02T12:48:58,662+0000 [main] INFO  org.apache.zookeeper.ZooKeeper - Client environment:java.vendor=Eclipse Adoptium\n2023-08-02T12:48:58,662+0000 [main] INFO  org.apache.zookeeper.ZooKeeper - Client environment:java.home=/usr/lib/jvm/temurin-17-jdk-amd64\n"})}),"\n"]}),"\n",(0,o.jsxs)(a.li,{children:["\n",(0,o.jsx)(a.p,{children:"List all brokers."}),"\n",(0,o.jsx)(a.p,{children:(0,o.jsx)(a.strong,{children:"Input"})}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"ls /loadbalance/brokers\n"})}),"\n",(0,o.jsx)(a.p,{children:(0,o.jsx)(a.strong,{children:"Output"})}),"\n",(0,o.jsx)(a.p,{children:"This output shows that there are 2 brokers."}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"[broker-1:8080, broker-2:8080]\n"})}),"\n"]}),"\n",(0,o.jsxs)(a.li,{children:["\n",(0,o.jsxs)(a.p,{children:["Check ZooKeeper load report for broker 1. The load report in ",(0,o.jsx)(a.code,{children:"/loadbalance/brokers/..."}),"."]}),"\n",(0,o.jsx)(a.p,{children:(0,o.jsx)(a.strong,{children:"Input"})}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"get /loadbalance/brokers/broker-1:8080\n"})}),"\n",(0,o.jsx)(a.p,{children:(0,o.jsx)(a.strong,{children:"Output"})}),"\n",(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:'{"webServiceUrl":"http://broker-1:8080","pulsarServiceUrl":"pulsar://broker-1:6650","persistentTopicsEnabled":true,"nonPersistentTopicsEnabled":true,"cpu":{"usage":7.311714728372232,"limit":800.0},"memory":{"usage":124.0,"limit":2096.0},"directMemory":{"usage":36.0,"limit":256.0},"bandwidthIn":{"usage":0.8324254085661579,"limit":1.0E7},"bandwidthOut":{"usage":0.7155446715644209,"limit":1.0E7},"msgThroughputIn":0.0,"msgThroughputOut":0.0,"msgRateIn":0.0,"msgRateOut":0.0,"lastUpdate":1690979816792,"lastStats":{"my-tenant/my-namespace/0x4ccccccb_0x66666664":{"msgRateIn":0.0,"msgThroughputIn":0.0,"msgRateOut":0.0,"msgThroughputOut":0.0,"consumerCount":2,"producerCount":0,"topics":1,"cacheSize":0}},"numTopics":1,"numBundles":1,"numConsumers":2,"numProducers":0,"bundles":["my-tenant/my-namespace/0x4ccccccb_0x66666664"],"lastBundleGains":[],"lastBundleLosses":[],"brokerVersionString":"3.1.0-SNAPSHOT","protocols":{},"advertisedListeners":{"internal":{"brokerServiceUrl":"pulsar://broker-1:6650"}},"loadManagerClassName":"org.apache.pulsar.broker.loadbalance.impl.ModularLoadManagerImpl","startTimestamp":1690940955211,"maxResourceUsage":0.140625,"loadReportType":"LocalBrokerData"}\n'})}),"\n"]}),"\n"]})]}),(0,o.jsxs)(l.A,{value:"Extensible",children:[(0,o.jsx)(a.admonition,{type:"note",children:(0,o.jsxs)(a.p,{children:[(0,o.jsx)(a.a,{href:"/docs/next/concepts-broker-load-balancing-types",children:"Extensible load manager"})," does not have the ZooKeepr load report because its internal stats are stored in system topics rather than ZooKeeper."]})}),(0,o.jsxs)(a.p,{children:["You can check load report from system topics using the ",(0,o.jsx)(a.a,{href:"/docs/next/reference-cli-tools",children:"pulsar-client tool"}),"."]}),(0,o.jsx)(a.p,{children:(0,o.jsx)(a.strong,{children:"Input"})}),(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"bin/pulsar-client consume non-persistent://pulsar/system/loadbalancer-broker-load-data --subscription-name test\n"})}),(0,o.jsx)(a.p,{children:(0,o.jsx)(a.strong,{children:"Output"})}),(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:'2023-08-03T06:21:48,841+0000 [pulsar-client-io-1-3] INFO  org.apache.pulsar.client.impl.ConnectionPool - [[id: 0x69a65535, L:/127.0.0.1:59086 - R:localhost/127.0.0.1:6650]] Connected to server\n2023-08-03T06:21:48,926+0000 [pulsar-client-io-1-3] WARN  org.apache.pulsar.client.impl.ConsumerImpl - [non-persistent://pulsar/system/loadbalancer-broker-load-data] Cannot create a [Durable] subscription for a NonPersistentTopic, will use [NonDurable] to subscribe. Subscription name: test\n2023-08-03T06:21:49,189+0000 [pulsar-client-io-1-3] INFO  org.apache.pulsar.client.impl.ConsumerStatsRecorderImpl - Starting Pulsar consumer status recorder with config: {"topicNames":["non-persistent://pulsar/system/loadbalancer-broker-load-data"],"topicsPattern":null,"subscriptionName":"test","subscriptionType":"Exclusive","subscriptionProperties":null,"subscriptionMode":"NonDurable","receiverQueueSize":1000,"acknowledgementsGroupTimeMicros":100000,"maxAcknowledgmentGroupSize":1000,"negativeAckRedeliveryDelayMicros":60000000,"maxTotalReceiverQueueSizeAcrossPartitions":50000,"consumerName":null,"ackTimeoutMillis":0,"tickDurationMillis":1000,"priorityLevel":0,"maxPendingChunkedMessage":10,"autoAckOldestChunkedMessageOnQueueFull":false,"expireTimeOfIncompleteChunkedMessageMillis":60000,"cryptoFailureAction":"FAIL","properties":{},"readCompacted":false,"subscriptionInitialPosition":"Latest","patternAutoDiscoveryPeriod":60,"regexSubscriptionMode":"PersistentOnly","deadLetterPolicy":null,"retryEnable":false,"autoUpdatePartitions":true,"autoUpdatePartitionsIntervalSeconds":60,"replicateSubscriptionState":false,"resetIncludeHead":false,"batchIndexAckEnabled":false,"ackReceiptEnabled":false,"poolMessages":true,"startPaused":false,"autoScaledReceiverQueueSizeEnabled":false,"topicConfigurations":[],"maxPendingChuckedMessage":10}\n2023-08-03T06:21:49,214+0000 [pulsar-client-io-1-3] INFO  org.apache.pulsar.client.impl.ConsumerStatsRecorderImpl - Pulsar client config: {"serviceUrl":"pulsar://localhost:6650/","authPluginClassName":null,"authParams":null,"authParamMap":null,"operationTimeoutMs":30000,"lookupTimeoutMs":30000,"statsIntervalSeconds":60,"numIoThreads":8,"numListenerThreads":8,"connectionsPerBroker":1,"connectionMaxIdleSeconds":180,"useTcpNoDelay":true,"useTls":false,"tlsKeyFilePath":"","tlsCertificateFilePath":"","tlsTrustCertsFilePath":"","tlsAllowInsecureConnection":false,"tlsHostnameVerificationEnable":false,"concurrentLookupRequest":5000,"maxLookupRequest":50000,"maxLookupRedirects":20,"maxNumberOfRejectedRequestPerConnection":50,"keepAliveIntervalSeconds":30,"connectionTimeoutMs":10000,"requestTimeoutMs":60000,"readTimeoutMs":60000,"autoCertRefreshSeconds":300,"initialBackoffIntervalNanos":100000000,"maxBackoffIntervalNanos":60000000000,"enableBusyWait":false,"listenerName":null,"useKeyStoreTls":false,"sslProvider":null,"tlsKeyStoreType":"JKS","tlsKeyStorePath":"","tlsKeyStorePassword":"*****","tlsTrustStoreType":"JKS","tlsTrustStorePath":"","tlsTrustStorePassword":"*****","tlsCiphers":[],"tlsProtocols":[],"memoryLimitBytes":0,"proxyServiceUrl":null,"proxyProtocol":null,"enableTransaction":false,"dnsLookupBindAddress":null,"dnsLookupBindPort":0,"socks5ProxyAddress":null,"socks5ProxyUsername":null,"socks5ProxyPassword":null,"description":null}\n2023-08-03T06:21:49,236+0000 [pulsar-client-io-1-5] INFO  org.apache.pulsar.client.impl.ConnectionPool - [[id: 0xbeee21f2, L:/172.31.0.4:44850 - R:broker-1/172.31.0.4:6650]] Connected to server\n2023-08-03T06:21:49,241+0000 [pulsar-client-io-1-5] INFO  org.apache.pulsar.client.impl.ConsumerImpl - [non-persistent://pulsar/system/loadbalancer-broker-load-data][test] Subscribing to topic on cnx [id: 0xbeee21f2, L:/172.31.0.4:44850 - R:broker-1/172.31.0.4:6650], consumerId 0\n2023-08-03T06:21:49,273+0000 [pulsar-client-io-1-5] INFO  org.apache.pulsar.client.impl.ConsumerImpl - [non-persistent://pulsar/system/loadbalancer-broker-load-data][test] Subscribed to topic on broker-1/172.31.0.4:6650 -- consumer: 0\n----- got message -----\nkey:[broker-1:8080], properties:[], content:{"cpu":{"usage":14.397985201479854,"limit":800.0},"memory":{"usage":300.0,"limit":2096.0},"directMemory":{"usage":40.0,"limit":256.0},"bandwidthIn":{"usage":0.7817884878178855,"limit":1.0E7},"bandwidthOut":{"usage":0.7213945272139455,"limit":1.0E7},"msgThroughputIn":3.000538680274058,"msgThroughputOut":3.0005621893825616,"msgRateIn":0.03333931866971176,"msgRateOut":0.033339579882028465,"bundleCount":3,"topics":3,"maxResourceUsage":0.15625,"weightedMaxEMA":0.15625,"msgThroughputEMA":38.88925615962549,"updatedAt":1691043751060,"reportedAt":1691043631073}\n'})})]})]}),"\n",(0,o.jsx)(a.h4,{id:"method-2-check-monitor-brokers-output",children:"Method 2: check monitor-brokers output"}),"\n",(0,o.jsxs)(a.p,{children:["You can use the ",(0,o.jsx)(a.a,{href:"/docs/next/reference-cli-tools",children:"pulsar-perf tool"})," to start a broker monitor."]}),"\n",(0,o.jsxs)(a.p,{children:["Different load managers have different outputs. This output is the same as the output of the ",(0,o.jsx)(a.a,{href:"#method-1-check-zookeeper-load-report",children:"Method 1: check ZooKeeper load report"}),", but it is well formatted for better readability."]}),"\n",(0,o.jsxs)(t.A,{groupId:"load-manager-report",defaultValue:"Simple",values:[{label:"Simple",value:"Simple"},{label:"Modular",value:"Modular"},{label:"Extensible",value:"Extensible"}],children:[(0,o.jsxs)(l.A,{value:"Simple",children:[(0,o.jsx)(a.p,{children:(0,o.jsx)(a.strong,{children:"Input"})}),(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"pulsar-perf monitor-brokers --connect-string <zookeeper host:port>\n\n**Output**\n\n```bash\n===================================================================================================================\n||COUNT          |TOPIC          |BUNDLE         |PRODUCER       |CONSUMER       |BUNDLE +       |BUNDLE -       ||\n||               |4              |4              |0              |2              |0              |0              ||\n||RAW SYSTEM     |CPU %          |MEMORY %       |DIRECT %       |BW IN %        |BW OUT %       |MAX %          ||\n||               |0.25           |47.94          |0.01           |0.00           |0.00           |47.94          ||\n||ALLOC SYSTEM   |CPU %          |MEMORY %       |DIRECT %       |BW IN %        |BW OUT %       |MAX %          ||\n||               |0.20           |1.89           |               |1.27           |3.21           |3.21           ||\n||RAW MSG        |MSG/S IN       |MSG/S OUT      |TOTAL          |KB/S IN        |KB/S OUT       |TOTAL          ||\n||               |0.00           |0.00           |0.00           |0.01           |0.01           |0.01           ||\n||ALLOC MSG      |MSG/S IN       |MSG/S OUT      |TOTAL          |KB/S IN        |KB/S OUT       |TOTAL          ||\n||               |54.84          |134.48         |189.31         |126.54         |320.96         |447.50         ||\n===================================================================================================================\n"})})]}),(0,o.jsxs)(l.A,{value:"Modular",children:[(0,o.jsx)(a.p,{children:(0,o.jsx)(a.strong,{children:"Input"})}),(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"pulsar-perf monitor-brokers --connect-string <zookeeper host:port>\n"})}),(0,o.jsx)(a.p,{children:(0,o.jsx)(a.strong,{children:"Output"})}),(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"===================================================================================================================\n||SYSTEM         |CPU %          |MEMORY %       |DIRECT %       |BW IN %        |BW OUT %       |MAX %          ||\n||               |0.00           |48.33          |0.01           |0.00           |0.00           |48.33          ||\n||COUNT          |TOPIC          |BUNDLE         |PRODUCER       |CONSUMER       |BUNDLE +       |BUNDLE -       ||\n||               |4              |4              |0              |2              |4              |0              ||\n||LATEST         |MSG/S IN       |MSG/S OUT      |TOTAL          |KB/S IN        |KB/S OUT       |TOTAL          ||\n||               |0.00           |0.00           |0.00           |0.00           |0.00           |0.00           ||\n||SHORT          |MSG/S IN       |MSG/S OUT      |TOTAL          |KB/S IN        |KB/S OUT       |TOTAL          ||\n||               |0.00           |0.00           |0.00           |0.00           |0.00           |0.00           ||\n||LONG           |MSG/S IN       |MSG/S OUT      |TOTAL          |KB/S IN        |KB/S OUT       |TOTAL          ||\n||               |0.00           |0.00           |0.00           |0.00           |0.00           |0.00           ||\n===================================================================================================================\n"})})]}),(0,o.jsxs)(l.A,{value:"Extensible",children:[(0,o.jsx)(a.p,{children:(0,o.jsx)(a.strong,{children:"Input"})}),(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"pulsar-perf monitor-brokers --connect-string pulsar://<host:port> --extensions \n"})}),(0,o.jsx)(a.p,{children:(0,o.jsx)(a.strong,{children:"Output"})}),(0,o.jsx)(a.pre,{children:(0,o.jsx)(a.code,{className:"language-bash",children:"===================================================================================================================\n||SYSTEM         |CPU %          |MEMORY %       |DIRECT %       |BW IN %        |BW OUT %       |MAX %          ||\n||               |17.24          |12.40          |26.95          |0.00           |0.00           |26.95          ||\n||COUNT          |TOPIC          |BUNDLE         |PRODUCER       |CONSUMER       |BUNDLE +       |BUNDLE -       ||\n||               |               |4              |               |               |               |               ||\n||LATEST         |MSG/S IN       |MSG/S OUT      |TOTAL          |KB/S IN        |KB/S OUT       |TOTAL          ||\n||               |100.02         |0.02           |100.03         |103.89         |0.01           |103.90         ||\n===================================================================================================================\n"})})]})]})]})}function p(e={}){const{wrapper:a}={...(0,s.R)(),...e.components};return a?(0,o.jsx)(a,{...e,children:(0,o.jsx)(u,{...e})}):u(e)}},19365:(e,a,r)=>{r.d(a,{A:()=>t});r(96540);var n=r(34164);const o={tabItem:"tabItem_Ymn6"};var s=r(74848);function t(e){let{children:a,hidden:r,className:t}=e;return(0,s.jsx)("div",{role:"tabpanel",className:(0,n.A)(o.tabItem,t),hidden:r,children:a})}},11470:(e,a,r)=>{r.d(a,{A:()=>T});var n=r(96540),o=r(34164),s=r(23104),t=r(56347),l=r(205),i=r(57485),d=r(31682),c=r(70679);function h(e){return n.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,n.isValidElement)(e)&&function(e){const{props:a}=e;return!!a&&"object"==typeof a&&"value"in a}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function u(e){const{values:a,children:r}=e;return(0,n.useMemo)((()=>{const e=a??function(e){return h(e).map((e=>{let{props:{value:a,label:r,attributes:n,default:o}}=e;return{value:a,label:r,attributes:n,default:o}}))}(r);return function(e){const a=(0,d.XI)(e,((e,a)=>e.value===a.value));if(a.length>0)throw new Error(`Docusaurus error: Duplicate values "${a.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[a,r])}function p(e){let{value:a,tabValues:r}=e;return r.some((e=>e.value===a))}function m(e){let{queryString:a=!1,groupId:r}=e;const o=(0,t.W6)(),s=function(e){let{queryString:a=!1,groupId:r}=e;if("string"==typeof a)return a;if(!1===a)return null;if(!0===a&&!r)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return r??null}({queryString:a,groupId:r});return[(0,i.aZ)(s),(0,n.useCallback)((e=>{if(!s)return;const a=new URLSearchParams(o.location.search);a.set(s,e),o.replace({...o.location,search:a.toString()})}),[s,o])]}function b(e){const{defaultValue:a,queryString:r=!1,groupId:o}=e,s=u(e),[t,i]=(0,n.useState)((()=>function(e){let{defaultValue:a,tabValues:r}=e;if(0===r.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(a){if(!p({value:a,tabValues:r}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${a}" but none of its children has the corresponding value. Available values are: ${r.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return a}const n=r.find((e=>e.default))??r[0];if(!n)throw new Error("Unexpected error: 0 tabValues");return n.value}({defaultValue:a,tabValues:s}))),[d,h]=m({queryString:r,groupId:o}),[b,g]=function(e){let{groupId:a}=e;const r=function(e){return e?`docusaurus.tab.${e}`:null}(a),[o,s]=(0,c.Dv)(r);return[o,(0,n.useCallback)((e=>{r&&s.set(e)}),[r,s])]}({groupId:o}),x=(()=>{const e=d??b;return p({value:e,tabValues:s})?e:null})();(0,l.A)((()=>{x&&i(x)}),[x]);return{selectedValue:t,selectValue:(0,n.useCallback)((e=>{if(!p({value:e,tabValues:s}))throw new Error(`Can't select invalid tab value=${e}`);i(e),h(e),g(e)}),[h,g,s]),tabValues:s}}var g=r(92303);const x={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var j=r(74848);function f(e){let{className:a,block:r,selectedValue:n,selectValue:t,tabValues:l}=e;const i=[],{blockElementScrollPositionUntilNextRender:d}=(0,s.a_)(),c=e=>{const a=e.currentTarget,r=i.indexOf(a),o=l[r].value;o!==n&&(d(a),t(o))},h=e=>{let a=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const r=i.indexOf(e.currentTarget)+1;a=i[r]??i[0];break}case"ArrowLeft":{const r=i.indexOf(e.currentTarget)-1;a=i[r]??i[i.length-1];break}}a?.focus()};return(0,j.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.A)("tabs",{"tabs--block":r},a),children:l.map((e=>{let{value:a,label:r,attributes:s}=e;return(0,j.jsx)("li",{role:"tab",tabIndex:n===a?0:-1,"aria-selected":n===a,ref:e=>i.push(e),onKeyDown:h,onClick:c,...s,className:(0,o.A)("tabs__item",x.tabItem,s?.className,{"tabs__item--active":n===a}),children:r??a},a)}))})}function k(e){let{lazy:a,children:r,selectedValue:s}=e;const t=(Array.isArray(r)?r:[r]).filter(Boolean);if(a){const e=t.find((e=>e.props.value===s));return e?(0,n.cloneElement)(e,{className:(0,o.A)("margin-top--md",e.props.className)}):null}return(0,j.jsx)("div",{className:"margin-top--md",children:t.map(((e,a)=>(0,n.cloneElement)(e,{key:a,hidden:e.props.value!==s})))})}function v(e){const a=b(e);return(0,j.jsxs)("div",{className:(0,o.A)("tabs-container",x.tabList),children:[(0,j.jsx)(f,{...a,...e}),(0,j.jsx)(k,{...a,...e})]})}function T(e){const a=(0,g.A)();return(0,j.jsx)(v,{...e,children:h(e.children)},String(a))}},28453:(e,a,r)=>{r.d(a,{R:()=>t,x:()=>l});var n=r(96540);const o={},s=n.createContext(o);function t(e){const a=n.useContext(s);return n.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function l(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:t(e.components),n.createElement(s.Provider,{value:a},e.children)}}}]);