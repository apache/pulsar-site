"use strict";(self.webpackChunkwebsite_next=self.webpackChunkwebsite_next||[]).push([[35846],{83650:(e,r,i)=>{i.r(r),i.d(r,{assets:()=>h,contentTitle:()=>a,default:()=>o,frontMatter:()=>n,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"versioned/pulsar-4.0.4","title":"Apache Pulsar 4.0.4","description":"2025-04-09","source":"@site/release-notes/versioned/pulsar-4.0.4.md","sourceDirName":"versioned","slug":"/versioned/pulsar-4.0.4","permalink":"/release-notes/versioned/pulsar-4.0.4","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/pulsar-site/edit/main/release-notes/versioned/pulsar-4.0.4.md","tags":[],"version":"current","frontMatter":{"id":"pulsar-4.0.4","title":"Apache Pulsar 4.0.4","sidebar_label":"Apache Pulsar 4.0.4"}}');var s=i(74848),l=i(28453);const n={id:"pulsar-4.0.4",title:"Apache Pulsar 4.0.4",sidebar_label:"Apache Pulsar 4.0.4"},a=void 0,h={},c=[{value:"2025-04-09",id:"2025-04-09",level:4},{value:"Library updates",id:"library-updates",level:3},{value:"Broker",id:"broker",level:3},{value:"Client",id:"client",level:3},{value:"Pulsar IO and Pulsar Functions",id:"pulsar-io-and-pulsar-functions",level:3},{value:"Others",id:"others",level:3},{value:"Tests &amp; CI",id:"tests--ci",level:3}];function p(e){const r={a:"a",h3:"h3",h4:"h4",li:"li",p:"p",ul:"ul",...(0,l.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.h4,{id:"2025-04-09",children:"2025-04-09"}),"\n",(0,s.jsx)(r.h3,{id:"library-updates",children:"Library updates"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["[fix][sec] Upgrade jwt/v5 to 5.2.2 to address CVE-2025-30204 (",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/pull/24140",children:"#24140"}),")"]}),"\n",(0,s.jsxs)(r.li,{children:["[fix][sec] Upgrade pulsar-function-go dependencies to address CVE-2025-22870 (",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/pull/24135",children:"#24135"}),")"]}),"\n",(0,s.jsxs)(r.li,{children:["[improve] Upgrade Netty to 4.1.119.Final (",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/pull/24049",children:"#24049"}),")"]}),"\n"]}),"\n",(0,s.jsx)(r.h3,{id:"broker",children:"Broker"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["[fix] Avoid negative estimated entry count (",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/pull/24055",children:"#24055"}),")"]}),"\n",(0,s.jsxs)(r.li,{children:["[fix][broker] Add expire check for replicator (",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/pull/23975",children:"#23975"}),")"]}),"\n",(0,s.jsxs)(r.li,{children:["[fix][broker] Avoid IllegalStateException when marker_type field is not set in publishing (",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/pull/24087",children:"#24087"}),")"]}),"\n",(0,s.jsxs)(r.li,{children:["[fix][broker] fix delay queue sequence issue. (",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/pull/24035",children:"#24035"}),")"]}),"\n",(0,s.jsxs)(r.li,{children:["[fix][broker] Fix Metadata Event Synchronizer producer creation retry so that the producer gets created eventually (",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/pull/24081",children:"#24081"}),")"]}),"\n",(0,s.jsxs)(r.li,{children:["[fix][broker] Fix Metadata event synchronizer should not fail with bad version (",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/pull/24080",children:"#24080"}),")"]}),"\n",(0,s.jsxs)(r.li,{children:["[fix][broker] Fix missing validation when setting retention policy on topic level (",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/pull/24032",children:"#24032"}),")"]}),"\n",(0,s.jsxs)(r.li,{children:["[fix][broker] Fix NPE while publishing Metadata-Event with not init producer (",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/pull/24079",children:"#24079"}),")"]}),"\n",(0,s.jsxs)(r.li,{children:["[fix][broker] Fix UnsupportedOperationException while setting subscription level dispatch rate policy (",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/pull/24048",children:"#24048"}),")"]}),"\n",(0,s.jsxs)(r.li,{children:["[fix][broker] http metric endpoint get compaction latency stats always be 0 (",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/pull/24067",children:"#24067"}),")"]}),"\n",(0,s.jsxs)(r.li,{children:["[fix][broker] Pattern subscription doesn't work when the pattern excludes the topic domain. (",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/pull/24072",children:"#24072"}),")"]}),"\n",(0,s.jsxs)(r.li,{children:["[fix][broker] Restore the behavior to dispatch batch messages according to consumer permits (",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/pull/24092",children:"#24092"}),")"]}),"\n",(0,s.jsxs)(r.li,{children:["[fix][broker] topics infinitely failed to delete after remove cluster from replicated clusters modifying when using partitioned system topic (",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/pull/24097",children:"#24097"}),")"]}),"\n",(0,s.jsxs)(r.li,{children:["[fix][broker]Fix failed consumption after loaded up a terminated topic (",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/pull/24063",children:"#24063"}),")"]}),"\n",(0,s.jsxs)(r.li,{children:["[fix][ml] Corrected pulsar_storage_size metric to not multiply offloaded storage by the write quorum (",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/pull/24054",children:"#24054"}),")"]}),"\n",(0,s.jsxs)(r.li,{children:["[fix][ml] Don't estimate number of entries when ledgers are empty, return 1 instead (",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/pull/24125",children:"#24125"}),")"]}),"\n",(0,s.jsxs)(r.li,{children:["[fix][ml] Fix issues in estimateEntryCountBySize (",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/pull/24089",children:"#24089"}),")"]}),"\n",(0,s.jsxs)(r.li,{children:["[fix][ml] Return 1 when bytes size is 0 or negative for entry count estimation (",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/pull/24131",children:"#24131"}),")"]}),"\n",(0,s.jsxs)(r.li,{children:["[improve][broker] Change topic exists log to warn (",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/pull/24116",children:"#24116"}),")"]}),"\n",(0,s.jsxs)(r.li,{children:["[improve][broker] extract getMaxEntriesInThisBatch into a method and add unit test for it (",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/pull/24117",children:"#24117"}),")"]}),"\n",(0,s.jsxs)(r.li,{children:["[improve][broker] Optimize message expiration rate repeated update issues (",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/pull/24073",children:"#24073"}),")"]}),"\n",(0,s.jsxs)(r.li,{children:["[improve][broker] Optimize ThresholdShedder with improved boundary checks and parameter reuse (",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/pull/24064",children:"#24064"}),")"]}),"\n",(0,s.jsxs)(r.li,{children:["[improve][broker][branch-4.0] PIP-406: Introduce metrics related to dispatch throttled events (",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/pull/24111",children:"#24111"}),")"]}),"\n",(0,s.jsxs)(r.li,{children:["[improve][meta] Change log level from error to warn for unknown notification types in OxiaMetadataStore (",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/pull/24126",children:"#24126"}),")"]}),"\n"]}),"\n",(0,s.jsx)(r.h3,{id:"client",children:"Client"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["[fix][client] Copy eventTime to retry letter topic and DLQ messages (",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/pull/24059",children:"#24059"}),")"]}),"\n",(0,s.jsxs)(r.li,{children:["[fix][client] Fix building broken batched message when publishing (",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/pull/24061",children:"#24061"}),")"]}),"\n",(0,s.jsxs)(r.li,{children:["[fix][client] Fix consumer leak when thread is interrupted before subscribe completes (",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/pull/24100",children:"#24100"}),")"]}),"\n",(0,s.jsxs)(r.li,{children:["[fix][client] Pattern subscription regression when broker-side evaluation is disabled (",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/pull/24104",children:"#24104"}),")"]}),"\n",(0,s.jsxs)(r.li,{children:["[fix][client] PIP-409 retry/dead letter topic producer config don't take effect. (",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/pull/24071",children:"#24071"}),")"]}),"\n",(0,s.jsxs)(r.li,{children:["[improve][client] PIP-409: support producer configuration for retry/dead letter topic producer (",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/pull/24020",children:"#24020"}),")"]}),"\n",(0,s.jsxs)(r.li,{children:["[improve][client] Prevent NullPointException when closing ClientCredentialsFlow (",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/pull/24123",children:"#24123"}),")"]}),"\n",(0,s.jsxs)(r.li,{children:["[clean][client] Clean code for the construction of retry/dead letter topic name (",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/pull/24082",children:"#24082"}),")"]}),"\n"]}),"\n",(0,s.jsx)(r.h3,{id:"pulsar-io-and-pulsar-functions",children:"Pulsar IO and Pulsar Functions"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["[fix][io] Fix KinesisSink json flattening for AVRO's SchemaType.BYTES (",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/pull/24132",children:"#24132"}),")"]}),"\n",(0,s.jsxs)(r.li,{children:["[improve][fn] Introduce NewOutputMessageWithError to enable error handling (",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/pull/24122",children:"#24122"}),")"]}),"\n",(0,s.jsxs)(r.li,{children:["[improve][io] Enhance Kafka connector logging with focused bootstrap server information (",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/pull/24128",children:"#24128"}),")"]}),"\n",(0,s.jsxs)(r.li,{children:["[improve][io] Remove sleep when sourceTask.poll of kafka return null (",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/pull/24124",children:"#24124"}),")"]}),"\n"]}),"\n",(0,s.jsx)(r.h3,{id:"others",children:"Others"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["[fix][doc] fix doc related to chunk message feature. (",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/pull/24023",children:"#24023"}),")"]}),"\n",(0,s.jsxs)(r.li,{children:["[fix][doc] Workaround Go Yaml issue go-yaml/yaml#789 in docker-compose example (",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/pull/24040",children:"#24040"}),")"]}),"\n",(0,s.jsxs)(r.li,{children:["[improve][monitor] Add version=0.0.4 to /metrics content type for Prometheus 3.x compatibility (",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/pull/24060",children:"#24060"}),")"]}),"\n"]}),"\n",(0,s.jsx)(r.h3,{id:"tests--ci",children:"Tests & CI"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["[fix][ci] Bump dependency-check to 12.1.0 to fix OWASP Dependency Check job (",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/pull/24083",children:"#24083"}),")"]}),"\n",(0,s.jsxs)(r.li,{children:["[fix][test] Fix flaky NonPersistentTopicTest.testMsgDropStat (",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/pull/24134",children:"#24134"}),")"]}),"\n",(0,s.jsxs)(r.li,{children:["[fix][test] Fix flaky PrometheusMetricsTest.testBrokerMetrics (",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/pull/24042",children:"#24042"}),")"]}),"\n"]}),"\n",(0,s.jsxs)(r.p,{children:["For the complete list, check the ",(0,s.jsx)(r.a,{href:"https://github.com/apache/pulsar/compare/v4.0.3...v4.0.4",children:"full changelog"}),"."]})]})}function o(e={}){const{wrapper:r}={...(0,l.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(p,{...e})}):p(e)}},28453:(e,r,i)=>{i.d(r,{R:()=>n,x:()=>a});var t=i(96540);const s={},l=t.createContext(s);function n(e){const r=t.useContext(l);return t.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:n(e.components),t.createElement(l.Provider,{value:r},e.children)}}}]);