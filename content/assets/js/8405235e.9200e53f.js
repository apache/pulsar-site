"use strict";(self.webpackChunkwebsite_next=self.webpackChunkwebsite_next||[]).push([[51345],{20858:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"client-libraries-java-setup","title":"Set up Java client","description":"Install Java client library","source":"@site/versioned_docs/version-3.0.x/client-libraries-java-setup.md","sourceDirName":".","slug":"/client-libraries-java-setup","permalink":"/docs/3.0.x/client-libraries-java-setup","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/pulsar-site/edit/main/versioned_docs/version-3.0.x/client-libraries-java-setup.md","tags":[],"version":"3.0.x","frontMatter":{"id":"client-libraries-java-setup","title":"Set up Java client","sidebar_label":"Set up"},"sidebar":"docsSidebar","previous":{"title":"Java","permalink":"/docs/3.0.x/client-libraries-java"},"next":{"title":"Initialize","permalink":"/docs/3.0.x/client-libraries-java-initialize"}}');var l=n(74848),t=n(28453);const s={id:"client-libraries-java-setup",title:"Set up Java client",sidebar_label:"Set up"},r=void 0,c={},o=[{value:"Install Java client library",id:"install-java-client-library",level:2},{value:"Maven",id:"maven",level:3},{value:"Gradle",id:"gradle",level:3},{value:"Connect to Pulsar cluster",id:"connect-to-pulsar-cluster",level:2},{value:"Java client Performance considerations",id:"java-client-performance",level:2},{value:"Increasing the memory limit",id:"increasing-the-memory-limit",level:3},{value:"Enabling optimized Netty direct memory buffer access",id:"enabling-optimized-netty-direct-memory-buffer-access",level:3},{value:"Enabling optimized checksum calculation when native library loading fails",id:"enabling-optimized-checksum-calculation-when-native-library-loading-fails",level:3}];function d(e){const a={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(a.h2,{id:"install-java-client-library",children:"Install Java client library"}),"\n",(0,l.jsxs)(a.p,{children:["The latest version of the Pulsar Java client library is available via ",(0,l.jsx)(a.a,{href:"http://search.maven.org/#artifactdetails%7Corg.apache.pulsar%7Cpulsar-client%7C3.0.12%7Cjar",children:"Maven Central"}),". To use the latest version, add the ",(0,l.jsx)(a.code,{children:"pulsar-client"})," library to your build configuration."]}),"\n",(0,l.jsx)(a.admonition,{type:"tip",children:(0,l.jsxs)(a.ul,{children:["\n",(0,l.jsxs)(a.li,{children:[(0,l.jsx)(a.a,{href:"https://search.maven.org/artifact/org.apache.pulsar/pulsar-client",children:(0,l.jsx)(a.code,{children:"pulsar-client"})})," and ",(0,l.jsx)(a.a,{href:"https://search.maven.org/artifact/org.apache.pulsar/pulsar-client-admin",children:(0,l.jsx)(a.code,{children:"pulsar-client-admin"})})," shade dependencies via ",(0,l.jsx)(a.a,{href:"https://maven.apache.org/plugins/maven-shade-plugin/",children:"maven-shade-plugin"})," to avoid conflicts of the underlying dependency packages (such as Netty). If you do not want to manage dependency conflicts manually, you can use them."]}),"\n",(0,l.jsxs)(a.li,{children:[(0,l.jsx)(a.a,{href:"https://search.maven.org/artifact/org.apache.pulsar/pulsar-client-original",children:(0,l.jsx)(a.code,{children:"pulsar-client-original"})})," and ",(0,l.jsx)(a.a,{href:"https://search.maven.org/artifact/org.apache.pulsar/pulsar-client-admin-original",children:(0,l.jsx)(a.code,{children:"pulsar-client-admin-original"})})," ",(0,l.jsx)(a.strong,{children:"does not"})," shade dependencies. If you want to manage dependencies manually, you can use them."]}),"\n"]})}),"\n",(0,l.jsx)(a.h3,{id:"maven",children:"Maven"}),"\n",(0,l.jsxs)(a.p,{children:["If you use Maven, add the following information to the ",(0,l.jsx)(a.code,{children:"pom.xml"})," file."]}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-xml",children:"\x3c!-- in your <properties> block --\x3e\n<pulsar.version>3.0.12</pulsar.version>\n\n\x3c!-- in your <dependencies> block --\x3e\n<dependency>\n  <groupId>org.apache.pulsar</groupId>\n  <artifactId>pulsar-client</artifactId>\n  <version>${pulsar.version}</version>\n</dependency>\n"})}),"\n",(0,l.jsx)(a.h3,{id:"gradle",children:"Gradle"}),"\n",(0,l.jsxs)(a.p,{children:["If you use Gradle, add the following information to the ",(0,l.jsx)(a.code,{children:"build.gradle"})," file."]}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-groovy",children:"def pulsarVersion = '3.0.12'\n\ndependencies {\n    compile group: 'org.apache.pulsar', name: 'pulsar-client', version: pulsarVersion\n}\n"})}),"\n",(0,l.jsx)(a.h2,{id:"connect-to-pulsar-cluster",children:"Connect to Pulsar cluster"}),"\n",(0,l.jsxs)(a.p,{children:["To connect to Pulsar using client libraries, you need to specify a ",(0,l.jsx)(a.a,{href:"/docs/3.0.x/developing-binary-protocol",children:"Pulsar protocol"})," URL."]}),"\n",(0,l.jsxs)(a.p,{children:["You can assign Pulsar protocol URLs to specific clusters and use the ",(0,l.jsx)(a.code,{children:"pulsar"})," scheme. The following is an example of ",(0,l.jsx)(a.code,{children:"localhost"})," with the default port ",(0,l.jsx)(a.code,{children:"6650"}),":"]}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-http",children:"pulsar://localhost:6650\n"})}),"\n",(0,l.jsxs)(a.p,{children:["If you have multiple brokers, separate ",(0,l.jsx)(a.code,{children:"IP:port"})," by commas:"]}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-http",children:"pulsar://localhost:6550,localhost:6651,localhost:6652\n"})}),"\n",(0,l.jsxs)(a.p,{children:["If you use ",(0,l.jsx)(a.a,{href:"/docs/3.0.x/security-tls-authentication",children:"mTLS"})," authentication, add ",(0,l.jsx)(a.code,{children:"+ssl"})," in the scheme:"]}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-http",children:"pulsar+ssl://pulsar.us-west.example.com:6651\n"})}),"\n",(0,l.jsx)(a.h2,{id:"java-client-performance",children:"Java client Performance considerations"}),"\n",(0,l.jsx)(a.h3,{id:"increasing-the-memory-limit",children:"Increasing the memory limit"}),"\n",(0,l.jsxs)(a.p,{children:["For high-throughput applications, you can increase the amount of memory with the Java client builder's ",(0,l.jsxs)(a.a,{href:"https://pulsar.apache.org/api/client/4.0.x/org/apache/pulsar/client/api/ClientBuilder.html#memoryLimit(long,org.apache.pulsar.client.api.SizeUnit)",children:[(0,l.jsx)(a.code,{children:"memoryLimit"})," configuration option"]}),". The default limit is 64MB which is usually too low for high-throughput applications."]}),"\n",(0,l.jsxs)(a.p,{children:["By default Java applications have a limit for direct memory allocations. The allocations are limited by the ",(0,l.jsx)(a.code,{children:"-XX:MaxDirectMemorySize"})," JVM option. In many JVM implementations, this defaults to the maximum heap size unless explicitly set. Allocations happen outside of the Java heap."]}),"\n",(0,l.jsx)(a.h3,{id:"enabling-optimized-netty-direct-memory-buffer-access",children:"Enabling optimized Netty direct memory buffer access"}),"\n",(0,l.jsxs)(a.p,{children:["The Pulsar Java client uses ",(0,l.jsx)(a.a,{href:"https://netty.io/",children:"Netty"})," under the hood and uses Netty direct buffers for data transport."]}),"\n",(0,l.jsxs)(a.p,{children:["Netty has a feature that allows optimized direct memory buffer access. This feature enables Netty to use low level APIs such as ",(0,l.jsx)(a.code,{children:"sun.misc.Unsafe"})," for direct memory operations, which provides faster allocation and deallocation of direct buffers.\nThe faster deallocation can help avoid direct memory exhaustion and ",(0,l.jsx)(a.code,{children:"java.lang.OutOfMemoryError: Direct buffer memory"})," errors. These errors can occur when the Netty memory pool and memory allocator cannot release memory back to the operating system quickly enough."]}),"\n",(0,l.jsx)(a.p,{children:"To enable this feature in Java clients since Java 11, you need to add the following JVM options to the application that uses the Java client:"}),"\n",(0,l.jsxs)(a.ul,{children:["\n",(0,l.jsx)(a.li,{children:(0,l.jsx)(a.code,{children:"--add-opens java.base/java.nio=ALL-UNNAMED"})}),"\n",(0,l.jsx)(a.li,{children:(0,l.jsx)(a.code,{children:"--add-opens java.base/jdk.internal.misc=ALL-UNNAMED"})}),"\n"]}),"\n",(0,l.jsx)(a.p,{children:"In addition, you need to add one of the following JVM options:"}),"\n",(0,l.jsxs)(a.ul,{children:["\n",(0,l.jsxs)(a.li,{children:[(0,l.jsx)(a.code,{children:"-Dorg.apache.pulsar.shade.io.netty.tryReflectionSetAccessible=true"})," for the default shaded Pulsar client"]}),"\n",(0,l.jsxs)(a.li,{children:[(0,l.jsx)(a.code,{children:"-Dio.netty.tryReflectionSetAccessible=true"}),' for the unshaded "original" Pulsar client']}),"\n"]}),"\n",(0,l.jsx)(a.h3,{id:"enabling-optimized-checksum-calculation-when-native-library-loading-fails",children:"Enabling optimized checksum calculation when native library loading fails"}),"\n",(0,l.jsxs)(a.p,{children:["The Pulsar Java client uses ",(0,l.jsx)(a.code,{children:"com.scurrilous.circe.checksum.Crc32cIntChecksum"})," class from the BookKeeper client for checksum calculation. For optimized checksum calculation Pulsar attempts to load ",(0,l.jsx)(a.code,{children:"libcirce-checksum"})," native library. When that isn't available, ",(0,l.jsx)(a.code,{children:"com.scurrilous.circe.checksum.Java9IntHash"})," class is used.\nThis only works when ",(0,l.jsx)(a.code,{children:"--add-opens java.base/java.util.zip=ALL-UNNAMED"})," is passed in the JVM options.\nThe error message will be ",(0,l.jsx)(a.code,{children:'Unable to use reflected methods: java.lang.reflect.InaccessibleObjectException: Unable to make private static int java.util.zip.CRC32C.updateBytes(int,byte[],int,int) accessible: module java.base does not "opens java.util.zip" to unnamed module'})," when the required JVM option is missing"]})]})}function h(e={}){const{wrapper:a}={...(0,t.R)(),...e.components};return a?(0,l.jsx)(a,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}},28453:(e,a,n)=>{n.d(a,{R:()=>s,x:()=>r});var i=n(96540);const l={},t=i.createContext(l);function s(e){const a=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function r(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:s(e.components),i.createElement(t.Provider,{value:a},e.children)}}}]);