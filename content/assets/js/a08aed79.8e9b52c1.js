"use strict";(self.webpackChunkwebsite_next=self.webpackChunkwebsite_next||[]).push([[26674],{92424:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"deploy-bare-metal","title":"Deploy a cluster on bare metal","description":"Learn to deploy a Pulsar cluster on bare metal.","source":"@site/versioned_docs/version-4.1.x/deploy-bare-metal.md","sourceDirName":".","slug":"/deploy-bare-metal","permalink":"/docs/4.1.x/deploy-bare-metal","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/pulsar-site/edit/main/versioned_docs/version-4.1.x/deploy-bare-metal.md","tags":[],"version":"4.1.x","frontMatter":{"id":"deploy-bare-metal","title":"Deploy a cluster on bare metal","sidebar_label":"Bare metal","description":"Learn to deploy a Pulsar cluster on bare metal."}}');var o=n(74848),t=n(28453);const i={id:"deploy-bare-metal",title:"Deploy a cluster on bare metal",sidebar_label:"Bare metal",description:"Learn to deploy a Pulsar cluster on bare metal."},l=void 0,a={},c=[{value:"Preparation",id:"preparation",level:2},{value:"Requirements",id:"requirements",level:3},{value:"Hardware considerations",id:"hardware-considerations",level:3},{value:"ZooKeeper",id:"zookeeper",level:5},{value:"Bookies and Brokers",id:"bookies-and-brokers",level:5},{value:"Hardware recommendations",id:"hardware-recommendations",level:5},{value:"Install the Pulsar binary package",id:"install-the-pulsar-binary-package",level:3},{value:"Install Built-in Connectors (optional)",id:"install-built-in-connectors-optional",level:3},{value:"Install Tiered Storage Offloaders (optional)",id:"install-tiered-storage-offloaders-optional",level:3},{value:"Step 1: Deploy a ZooKeeper cluster",id:"step-1-deploy-a-zookeeper-cluster",level:2},{value:"Step 2: Initialize cluster metadata",id:"step-2-initialize-cluster-metadata",level:2},{value:"Step 3: Deploy a BookKeeper cluster",id:"step-3-deploy-a-bookkeeper-cluster",level:2},{value:"Step 4: Deploy Pulsar brokers",id:"step-4-deploy-pulsar-brokers",level:2},{value:"Configure Brokers",id:"configure-brokers",level:3},{value:"Enable Pulsar Functions (optional)",id:"enable-pulsar-functions-optional",level:3},{value:"Start Brokers",id:"start-brokers",level:3},{value:"Connect to the running cluster",id:"connect-to-the-running-cluster",level:2},{value:"Run Functions",id:"run-functions",level:2}];function d(e){const r={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",h5:"h5",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.admonition,{type:"tip",children:(0,o.jsxs)(r.ol,{children:["\n",(0,o.jsxs)(r.li,{children:["You can use single-cluster Pulsar installation in most use cases, such as experimenting with Pulsar or using Pulsar in a startup or in a single team. If you need to run a multi-cluster Pulsar instance, see the ",(0,o.jsx)(r.a,{href:"/docs/4.1.x/deploy-bare-metal-multi-cluster",children:"guide"}),"."]}),"\n",(0,o.jsxs)(r.li,{children:["If you want to use all built-in ",(0,o.jsx)(r.a,{href:"/docs/4.1.x/io-overview",children:"Pulsar IO"})," connectors, you need to download ",(0,o.jsx)(r.code,{children:"apache-pulsar-io-connectors"}),"package and install ",(0,o.jsx)(r.code,{children:"apache-pulsar-io-connectors"})," under ",(0,o.jsx)(r.code,{children:"connectors"})," directory in the pulsar directory on every broker node or on every function-worker node if you have run a separate cluster of function workers for ",(0,o.jsx)(r.a,{href:"/docs/4.1.x/functions-overview",children:"Pulsar Functions"}),"."]}),"\n",(0,o.jsxs)(r.li,{children:["If you want to use ",(0,o.jsx)(r.a,{href:"/docs/4.1.x/concepts-tiered-storage",children:"Tiered Storage"})," feature in your Pulsar deployment, you need to download ",(0,o.jsx)(r.code,{children:"apache-pulsar-offloaders"}),"package and install ",(0,o.jsx)(r.code,{children:"apache-pulsar-offloaders"})," under ",(0,o.jsx)(r.code,{children:"offloaders"})," directory in the Pulsar directory on every broker node. For more details of how to configure this feature, you can refer to the ",(0,o.jsx)(r.a,{href:"/docs/4.1.x/cookbooks-tiered-storage",children:"Tiered storage cookbook"}),"."]}),"\n"]})}),"\n",(0,o.jsx)(r.p,{children:"Deploying a Pulsar cluster on bare metal consists of the following steps."}),"\n",(0,o.jsx)(r.h2,{id:"preparation",children:"Preparation"}),"\n",(0,o.jsx)(r.h3,{id:"requirements",children:"Requirements"}),"\n",(0,o.jsxs)(r.p,{children:["Currently, Pulsar is available for 64-bit ",(0,o.jsx)(r.strong,{children:"macOS"})," and ",(0,o.jsx)(r.strong,{children:"Linux"}),". See ",(0,o.jsx)(r.a,{href:"/docs/4.1.x/getting-started-docker",children:"Run Pulsar In Docker"})," if you want to run Pulsar on ",(0,o.jsx)(r.strong,{children:"Windows"}),"."]}),"\n",(0,o.jsxs)(r.p,{children:["Also, you need the proper 64-bit JRE/JDK version installed. Please refer to ",(0,o.jsx)(r.a,{href:"https://github.com/apache/pulsar/blob/master/README.md#pulsar-runtime-java-version-recommendation",children:"Pulsar Runtime Java Version Recommendation"}),"."]}),"\n",(0,o.jsx)(r.admonition,{type:"tip",children:(0,o.jsx)(r.p,{children:"You can reuse existing Zookeeper clusters."})}),"\n",(0,o.jsx)(r.p,{children:"To run Pulsar on bare metal, the following configuration is recommended:"}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsxs)(r.li,{children:["At least 6 Linux machines or VMs","\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsxs)(r.li,{children:["3 for running ",(0,o.jsx)(r.a,{href:"https://zookeeper.apache.org",children:"ZooKeeper"})]}),"\n",(0,o.jsxs)(r.li,{children:["3 for running a Pulsar broker, and a ",(0,o.jsx)(r.a,{href:"https://bookkeeper.apache.org",children:"BookKeeper"})," bookie"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(r.li,{children:["A single ",(0,o.jsx)(r.a,{href:"https://en.wikipedia.org/wiki/Domain_Name_System",children:"DNS"})," name covering all of the Pulsar broker hosts (optional)"]}),"\n"]}),"\n",(0,o.jsx)(r.admonition,{type:"note",children:(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsx)(r.li,{children:"Broker is only supported on 64-bit JVM."}),"\n",(0,o.jsx)(r.li,{children:"If you do not have enough machines, or you want to test Pulsar in cluster mode (and expand the cluster later), You can fully deploy Pulsar on a node on which ZooKeeper, bookie and broker run."}),"\n",(0,o.jsx)(r.li,{children:"If you do not have a DNS server, you can use the multi-host format in the service URL instead."}),"\n",(0,o.jsxs)(r.li,{children:["Each machine in your cluster needs to have the recommended Java version installed (e.g. ",(0,o.jsx)(r.a,{href:"https://adoptium.net/?variant=openjdk17",children:"Java 17"}),"). Please refer to ",(0,o.jsx)(r.a,{href:"https://github.com/apache/pulsar/blob/master/README.md#pulsar-runtime-java-version-recommendation",children:"Pulsar Runtime Java Version Recommendation"})," according to your target Pulsar version."]}),"\n"]})}),"\n",(0,o.jsx)(r.p,{children:"The following is a diagram showing the basic setup:"}),"\n",(0,o.jsx)(r.p,{children:(0,o.jsx)(r.img,{alt:"Basic setup of Pulsar cluster",src:n(64021).A+"",width:"815",height:"899"})}),"\n",(0,o.jsxs)(r.p,{children:["In this diagram, connecting clients need to communicate with the Pulsar cluster using a single URL. In this case, ",(0,o.jsx)(r.code,{children:"pulsar-cluster.acme.com"})," abstracts over all of the message-handling brokers. Pulsar message brokers run on machines alongside BookKeeper bookies; brokers and bookies, in turn, rely on ZooKeeper."]}),"\n",(0,o.jsx)(r.h3,{id:"hardware-considerations",children:"Hardware considerations"}),"\n",(0,o.jsx)(r.p,{children:"If you deploy a Pulsar cluster, keep in mind the following basic better choices when you do the capacity planning."}),"\n",(0,o.jsx)(r.h5,{id:"zookeeper",children:"ZooKeeper"}),"\n",(0,o.jsxs)(r.p,{children:["For machines running ZooKeeper, it is recommended to use less powerful machines or VMs. Pulsar uses ZooKeeper only for periodic coordination-related and configuration-related tasks, not for basic operations. If you run Pulsar on ",(0,o.jsx)(r.a,{href:"https://aws.amazon.com/",children:"Amazon Web Services"})," (AWS), for example, a ",(0,o.jsx)(r.a,{href:"http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/t2-instances.html",children:"t2.small"})," instance might likely suffice."]}),"\n",(0,o.jsx)(r.h5,{id:"bookies-and-brokers",children:"Bookies and Brokers"}),"\n",(0,o.jsxs)(r.p,{children:["For machines running a bookie and a Pulsar broker, more powerful machines are required. For an AWS deployment, for example, ",(0,o.jsx)(r.a,{href:"https://aws.amazon.com/blogs/aws/now-available-i3-instances-for-demanding-io-intensive-applications/",children:"i3.4xlarge"})," instances may be appropriate. On those machines you can use the following:"]}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsxs)(r.li,{children:["Fast CPUs and 10Gbps ",(0,o.jsx)(r.a,{href:"https://en.wikipedia.org/wiki/Network_interface_controller",children:"NIC"})," (for Pulsar brokers)"]}),"\n",(0,o.jsxs)(r.li,{children:["Small and fast ",(0,o.jsx)(r.a,{href:"https://en.wikipedia.org/wiki/Solid-state_drive",children:"solid-state drives"})," (SSDs) or ",(0,o.jsx)(r.a,{href:"https://en.wikipedia.org/wiki/Hard_disk_drive",children:"hard disk drives"})," (HDDs) with a ",(0,o.jsx)(r.a,{href:"https://en.wikipedia.org/wiki/RAID",children:"RAID"})," controller and a battery-backed write cache (for BookKeeper bookies)"]}),"\n"]}),"\n",(0,o.jsx)(r.h5,{id:"hardware-recommendations",children:"Hardware recommendations"}),"\n",(0,o.jsx)(r.p,{children:"To start a Pulsar instance, below are the minimum and the recommended hardware settings."}),"\n",(0,o.jsx)(r.p,{children:"A cluster consists of 3 broker nodes, 3 bookie nodes, and 3 ZooKeeper nodes. The following recommendation is suitable for one node."}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsxs)(r.p,{children:["The minimum hardware settings (",(0,o.jsx)(r.strong,{children:"250 Pulsar topics"}),")"]}),"\n",(0,o.jsxs)(r.table,{children:[(0,o.jsx)(r.thead,{children:(0,o.jsxs)(r.tr,{children:[(0,o.jsx)(r.th,{children:"Component"}),(0,o.jsx)(r.th,{children:"CPU"}),(0,o.jsx)(r.th,{children:"Memory"}),(0,o.jsx)(r.th,{children:"Storage"}),(0,o.jsx)(r.th,{children:"Throughput"}),(0,o.jsx)(r.th,{children:"Rate"})]})}),(0,o.jsxs)(r.tbody,{children:[(0,o.jsxs)(r.tr,{children:[(0,o.jsx)(r.td,{children:"Broker"}),(0,o.jsx)(r.td,{children:"0.2"}),(0,o.jsx)(r.td,{children:"256 MB"}),(0,o.jsx)(r.td,{children:"/"}),(0,o.jsxs)(r.td,{children:["Write throughput: 3 MB/s",(0,o.jsx)("br",{}),(0,o.jsx)("br",{}),"Read throughput: 6 MB/s",(0,o.jsx)("br",{}),(0,o.jsx)("br",{})]}),(0,o.jsxs)(r.td,{children:["Write rate: 350 entries/s",(0,o.jsx)("br",{}),(0,o.jsx)("br",{}),"Read rate: 650 entries/s"]})]}),(0,o.jsxs)(r.tr,{children:[(0,o.jsx)(r.td,{children:"Bookie"}),(0,o.jsx)(r.td,{children:"0.2"}),(0,o.jsx)(r.td,{children:"256 MB"}),(0,o.jsxs)(r.td,{children:["Journal: 8 GB",(0,o.jsx)("br",{}),(0,o.jsx)("br",{}),"PD-SSDLedger: 16 GB, PD-STANDARD"]}),(0,o.jsxs)(r.td,{children:["Write throughput: 2 MB/s",(0,o.jsx)("br",{}),(0,o.jsx)("br",{}),"Read throughput: 2 MB/s",(0,o.jsx)("br",{}),(0,o.jsx)("br",{})]}),(0,o.jsxs)(r.td,{children:["Write rate: 200 entries/s",(0,o.jsx)("br",{}),(0,o.jsx)("br",{}),"Read rate: 200 entries/s"]})]}),(0,o.jsxs)(r.tr,{children:[(0,o.jsx)(r.td,{children:"ZooKeeper"}),(0,o.jsx)(r.td,{children:"0.05"}),(0,o.jsx)(r.td,{children:"256 MB"}),(0,o.jsxs)(r.td,{children:["Log: 8 GB, PD-SSD",(0,o.jsx)("br",{}),(0,o.jsx)("br",{}),"Data: 2 GB, PD-STANDARD"]}),(0,o.jsx)(r.td,{children:"/"}),(0,o.jsx)(r.td,{children:"/"})]})]})]}),"\n"]}),"\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsxs)(r.p,{children:["The recommended hardware settings (",(0,o.jsx)(r.strong,{children:"1000 Pulsar topics"}),")"]}),"\n",(0,o.jsxs)(r.table,{children:[(0,o.jsx)(r.thead,{children:(0,o.jsxs)(r.tr,{children:[(0,o.jsx)(r.th,{children:"Component"}),(0,o.jsx)(r.th,{children:"CPU"}),(0,o.jsx)(r.th,{children:"Memory"}),(0,o.jsx)(r.th,{children:"Storage"}),(0,o.jsx)(r.th,{children:"Throughput"}),(0,o.jsx)(r.th,{children:"Rate"})]})}),(0,o.jsxs)(r.tbody,{children:[(0,o.jsxs)(r.tr,{children:[(0,o.jsx)(r.td,{children:"Broker"}),(0,o.jsx)(r.td,{children:"8"}),(0,o.jsx)(r.td,{children:"8 GB"}),(0,o.jsx)(r.td,{children:"/"}),(0,o.jsxs)(r.td,{children:["Write throughput: 100 MB/s",(0,o.jsx)("br",{}),(0,o.jsx)("br",{}),"Read throughput: 200 MB/s",(0,o.jsx)("br",{}),(0,o.jsx)("br",{})]}),(0,o.jsxs)(r.td,{children:["Write rate: 10,000 entries/s",(0,o.jsx)("br",{}),(0,o.jsx)("br",{}),"Read rate: 20,000 entries/s"]})]}),(0,o.jsxs)(r.tr,{children:[(0,o.jsx)(r.td,{children:"Bookie"}),(0,o.jsx)(r.td,{children:"4"}),(0,o.jsx)(r.td,{children:"8GB"}),(0,o.jsxs)(r.td,{children:["Journal: 256 GB",(0,o.jsx)("br",{}),(0,o.jsx)("br",{}),"PD-SSDLedger: 2 TB, PD-STANDARD"]}),(0,o.jsxs)(r.td,{children:["Write throughput: 75 MB/s",(0,o.jsx)("br",{}),(0,o.jsx)("br",{}),"Read throughput: 75 MB/s",(0,o.jsx)("br",{}),(0,o.jsx)("br",{})]}),(0,o.jsxs)(r.td,{children:["Write rate: 7,500 entries/s",(0,o.jsx)("br",{}),(0,o.jsx)("br",{}),"Read rate: 7,500 entries/s"]})]}),(0,o.jsxs)(r.tr,{children:[(0,o.jsx)(r.td,{children:"ZooKeeper"}),(0,o.jsx)(r.td,{children:"1"}),(0,o.jsx)(r.td,{children:"2 GB"}),(0,o.jsxs)(r.td,{children:["Log: 64 GB, PD-SSD",(0,o.jsx)("br",{}),(0,o.jsx)("br",{}),"Data: 256 GB, PD-STANDARD"]}),(0,o.jsx)(r.td,{children:"/"}),(0,o.jsx)(r.td,{children:"/"})]})]})]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(r.h3,{id:"install-the-pulsar-binary-package",children:"Install the Pulsar binary package"}),"\n",(0,o.jsxs)(r.blockquote,{children:["\n",(0,o.jsx)(r.p,{children:"You need to install the Pulsar binary package on each machine in the cluster, including machines running ZooKeeper and BookKeeper."}),"\n"]}),"\n",(0,o.jsx)(r.p,{children:"To get started deploying a Pulsar cluster on bare metal, you need to download a binary tarball release in one of the following ways:"}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsxs)(r.li,{children:["By clicking on the link below directly, which automatically triggers a download:","\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsx)("a",{href:"https://archive.apache.org/dist/pulsar/pulsar-4.1.0/apache-pulsar-4.1.0-bin.tar.gz",download:!0,children:"Pulsar 4.1.0 binary release"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(r.li,{children:["From the Pulsar ",(0,o.jsx)(r.a,{href:"/download",children:"downloads page"})]}),"\n",(0,o.jsxs)(r.li,{children:["From the Pulsar ",(0,o.jsx)(r.a,{href:"https://github.com/apache/pulsar/releases/latest",children:"releases page"})," on GitHub"]}),"\n",(0,o.jsxs)(r.li,{children:["Using ",(0,o.jsx)(r.a,{href:"https://www.gnu.org/software/wget",children:"wget"}),":"]}),"\n"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-bash",children:"wget https://archive.apache.org/dist/pulsar/pulsar-4.1.0/apache-pulsar-4.1.0-bin.tar.gz\n"})}),"\n",(0,o.jsxs)(r.p,{children:["Once you download the tarball, untar it and ",(0,o.jsx)(r.code,{children:"cd"})," into the resulting directory:"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-bash",children:"tar xvzf apache-pulsar-4.1.0-bin.tar.gz\ncd apache-pulsar-4.1.0\n"})}),"\n",(0,o.jsx)(r.p,{children:"The extracted directory contains the following subdirectories:"}),"\n",(0,o.jsxs)(r.table,{children:[(0,o.jsx)(r.thead,{children:(0,o.jsxs)(r.tr,{children:[(0,o.jsx)(r.th,{style:{textAlign:"left"},children:"Directory"}),(0,o.jsx)(r.th,{style:{textAlign:"left"},children:"Contains"})]})}),(0,o.jsxs)(r.tbody,{children:[(0,o.jsxs)(r.tr,{children:[(0,o.jsx)(r.td,{style:{textAlign:"left"},children:(0,o.jsx)(r.code,{children:"bin"})}),(0,o.jsxs)(r.td,{style:{textAlign:"left"},children:[(0,o.jsx)(r.a,{href:"/docs/4.1.x/reference-cli-tools",children:"command-line tools"})," of Pulsar, such as ",(0,o.jsx)(r.a,{href:"/docs/4.1.x/reference-cli-tools",children:(0,o.jsx)(r.code,{children:"pulsar"})})," and ",(0,o.jsx)(r.a,{href:"pathname:///reference/#/4.1.x/pulsar-admin/",children:(0,o.jsx)(r.code,{children:"pulsar-admin"})})]})]}),(0,o.jsxs)(r.tr,{children:[(0,o.jsx)(r.td,{style:{textAlign:"left"},children:(0,o.jsx)(r.code,{children:"conf"})}),(0,o.jsxs)(r.td,{style:{textAlign:"left"},children:["Configuration files for Pulsar, including for ",(0,o.jsx)(r.a,{href:"/docs/4.1.x/reference-configuration#broker",children:"broker configuration"}),", ",(0,o.jsx)(r.a,{href:"/docs/4.1.x/reference-configuration#zookeeper",children:"ZooKeeper configuration"}),", and more"]})]}),(0,o.jsxs)(r.tr,{children:[(0,o.jsx)(r.td,{style:{textAlign:"left"},children:(0,o.jsx)(r.code,{children:"data"})}),(0,o.jsx)(r.td,{style:{textAlign:"left"},children:"The data storage directory that ZooKeeper and BookKeeper use"})]}),(0,o.jsxs)(r.tr,{children:[(0,o.jsx)(r.td,{style:{textAlign:"left"},children:(0,o.jsx)(r.code,{children:"lib"})}),(0,o.jsxs)(r.td,{style:{textAlign:"left"},children:["The ",(0,o.jsx)(r.a,{href:"https://en.wikipedia.org/wiki/JAR_(file_format)",children:"JAR"})," files that Pulsar uses"]})]}),(0,o.jsxs)(r.tr,{children:[(0,o.jsx)(r.td,{style:{textAlign:"left"},children:(0,o.jsx)(r.code,{children:"logs"})}),(0,o.jsx)(r.td,{style:{textAlign:"left"},children:"Logs that the installation creates"})]})]})]}),"\n",(0,o.jsx)(r.h3,{id:"install-built-in-connectors-optional",children:"Install Built-in Connectors (optional)"}),"\n",(0,o.jsxs)(r.p,{children:["To use ",(0,o.jsx)(r.code,{children:"built-in"})," connectors, you need to download the connectors tarball release on every broker node in one of the following ways :"]}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsx)(r.p,{children:"by clicking the link below and downloading the release from an Apache mirror:"}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsx)("a",{href:"https://archive.apache.org/dist/pulsar/pulsar-4.1.0/connectors",download:!0,children:"Pulsar IO Connectors 4.1.0 release"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsxs)(r.p,{children:["from the Pulsar ",(0,o.jsx)(r.a,{href:"/download",children:"downloads page"})]}),"\n"]}),"\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsxs)(r.p,{children:["from the Pulsar ",(0,o.jsx)(r.a,{href:"https://github.com/apache/pulsar/releases/latest",children:"releases page"})]}),"\n"]}),"\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsxs)(r.p,{children:["using ",(0,o.jsx)(r.a,{href:"https://www.gnu.org/software/wget",children:"wget"}),":"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-shell",children:"wget https://archive.apache.org/dist/pulsar/pulsar-4.1.0/connectors/{connector}-4.1.0.nar\n"})}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(r.p,{children:["Once you download the .nar file, copy the file to directory ",(0,o.jsx)(r.code,{children:"connectors"})," in the pulsar directory.\nFor example, if you download the connector file ",(0,o.jsx)(r.code,{children:"pulsar-io-aerospike-4.1.0.nar"}),":"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-bash",children:"mkdir connectors\nmv pulsar-io-aerospike-4.1.0.nar connectors\n\nls connectors\npulsar-io-aerospike-4.1.0.nar\n...\n"})}),"\n",(0,o.jsx)(r.h3,{id:"install-tiered-storage-offloaders-optional",children:"Install Tiered Storage Offloaders (optional)"}),"\n",(0,o.jsx)(r.p,{children:"To use tiered storage offloaders, you need to download the offloaders tarball release on every broker node in one of the following ways:"}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsx)(r.p,{children:"by clicking the link below and downloading the release from an Apache mirror:"}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsx)("a",{href:"https://archive.apache.org/dist/pulsar/pulsar-4.1.0/apache-pulsar-offloaders-4.1.0-bin.tar.gz",download:!0,children:"Pulsar Tiered Storage Offloaders 4.1.0 release"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsxs)(r.p,{children:["from the Pulsar ",(0,o.jsx)(r.a,{href:"/download",children:"downloads page"})]}),"\n"]}),"\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsxs)(r.p,{children:["from the Pulsar ",(0,o.jsx)(r.a,{href:"https://github.com/apache/pulsar/releases/latest",children:"releases page"})]}),"\n"]}),"\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsxs)(r.p,{children:["using ",(0,o.jsx)(r.a,{href:"https://www.gnu.org/software/wget",children:"wget"}),":"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-shell",children:"wget https://archive.apache.org/dist/pulsar/pulsar-4.1.0/apache-pulsar-offloaders-4.1.0-bin.tar.gz\n"})}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(r.p,{children:["Once you download the tarball, in the Pulsar directory, untar the offloaders package and copy the offloaders as ",(0,o.jsx)(r.code,{children:"offloaders"})," in the Pulsar directory:"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-bash",children:"tar xvfz apache-pulsar-offloaders-4.1.0-bin.tar.gz\n\n# you can find a directory named `apache-pulsar-offloaders-4.1.0` in the pulsar directory\n# then copy the offloaders\n\nmv apache-pulsar-offloaders-4.1.0/offloaders offloaders\n\nls offloaders\ntiered-storage-jcloud-4.1.0.nar\n"})}),"\n",(0,o.jsxs)(r.p,{children:["For more details of how to configure tiered storage feature, you can refer to the ",(0,o.jsx)(r.a,{href:"/docs/4.1.x/cookbooks-tiered-storage",children:"Tiered storage cookbook"})]}),"\n",(0,o.jsx)(r.h2,{id:"step-1-deploy-a-zookeeper-cluster",children:"Step 1: Deploy a ZooKeeper cluster"}),"\n",(0,o.jsx)(r.admonition,{type:"note",children:(0,o.jsx)(r.p,{children:"If you already have an existing zookeeper cluster and want to use it, you can skip this section."})}),"\n",(0,o.jsxs)(r.p,{children:[(0,o.jsx)(r.a,{href:"https://zookeeper.apache.org",children:"ZooKeeper"})," manages a variety of essential coordination-related and configuration-related tasks for Pulsar. To deploy a Pulsar cluster, you need to deploy ZooKeeper first. A 3-node ZooKeeper cluster is the recommended configuration. Pulsar does not make heavy use of ZooKeeper, so the lightweight machines or VMs should suffice for running ZooKeeper."]}),"\n",(0,o.jsxs)(r.p,{children:["To begin, add all ZooKeeper servers to the configuration specified in ",(0,o.jsx)(r.a,{href:"/docs/4.1.x/reference-configuration#zookeeper",children:(0,o.jsx)(r.code,{children:"conf/zookeeper.conf"})})," (in the Pulsar directory that you create ",(0,o.jsx)(r.a,{href:"#install-the-pulsar-binary-package",children:"above"}),"). The following is an example:"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-properties",children:"server.1=zk1.us-west.example.com:2888:3888\nserver.2=zk2.us-west.example.com:2888:3888\nserver.3=zk3.us-west.example.com:2888:3888\n"})}),"\n",(0,o.jsxs)(r.blockquote,{children:["\n",(0,o.jsx)(r.p,{children:"If you only have one machine on which to deploy Pulsar, you only need to add one server entry in the configuration file."}),"\n"]}),"\n",(0,o.jsxs)(r.blockquote,{children:["\n",(0,o.jsx)(r.p,{children:"If your machines are behind NAT use 0.0.0.0 as server entry for the local address. If the node use external IP in configuration for itself, behind NAT, zookeper service won't start because it tries to put a listener on an external ip that the linux box doesn't own. Using 0.0.0.0 start a listener on ALL ip, so that NAT network traffic can reach it."}),"\n"]}),"\n",(0,o.jsxs)(r.p,{children:["Example of configuration on ",(0,o.jsx)(r.em,{children:"server.3"})]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-properties",children:"server.1=zk1.us-west.example.com:2888:3888\nserver.2=zk2.us-west.example.com:2888:3888\nserver.3=0.0.0.0:2888:3888\n"})}),"\n",(0,o.jsxs)(r.p,{children:["On each host, you need to specify the ID of the node in the ",(0,o.jsx)(r.code,{children:"myid"})," file, which is in the ",(0,o.jsx)(r.code,{children:"data/zookeeper"})," folder of each server by default (you can change the file location via the ",(0,o.jsx)(r.a,{href:"/docs/4.1.x/reference-configuration#zookeeper-dataDir",children:(0,o.jsx)(r.code,{children:"dataDir"})})," parameter)."]}),"\n",(0,o.jsxs)(r.blockquote,{children:["\n",(0,o.jsxs)(r.p,{children:["See the ",(0,o.jsx)(r.a,{href:"https://zookeeper.apache.org/doc/r3.4.10/zookeeperAdmin.html#sc_zkMulitServerSetup",children:"Multi-server setup guide"})," in the ZooKeeper documentation for detailed information on ",(0,o.jsx)(r.code,{children:"myid"})," and more."]}),"\n"]}),"\n",(0,o.jsxs)(r.p,{children:["For example, on a ZooKeeper server like ",(0,o.jsx)(r.code,{children:"zk1.us-west.example.com"}),", you can set the ",(0,o.jsx)(r.code,{children:"myid"})," value as follows:"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-bash",children:"mkdir -p data/zookeeper\necho 1 > data/zookeeper/myid\n"})}),"\n",(0,o.jsxs)(r.p,{children:["On ",(0,o.jsx)(r.code,{children:"zk2.us-west.example.com"}),", the command is ",(0,o.jsx)(r.code,{children:"echo 2 > data/zookeeper/myid"})," and so on."]}),"\n",(0,o.jsxs)(r.p,{children:["Once you add each server to the ",(0,o.jsx)(r.code,{children:"zookeeper.conf"})," configuration and have the appropriate ",(0,o.jsx)(r.code,{children:"myid"})," entry, you can start ZooKeeper on all hosts (in the background, using nohup) with the ",(0,o.jsx)(r.a,{href:"/docs/4.1.x/reference-cli-tools",children:(0,o.jsx)(r.code,{children:"pulsar-daemon"})})," CLI tool:"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-bash",children:"bin/pulsar-daemon start zookeeper\n"})}),"\n",(0,o.jsxs)(r.blockquote,{children:["\n",(0,o.jsxs)(r.p,{children:["If you plan to deploy Zookeeper with the Bookie on the same node, you need to start zookeeper by using different stats\nport by configuring the ",(0,o.jsx)(r.code,{children:"metricsProvider.httpPort"})," in zookeeper.conf."]}),"\n"]}),"\n",(0,o.jsx)(r.h2,{id:"step-2-initialize-cluster-metadata",children:"Step 2: Initialize cluster metadata"}),"\n",(0,o.jsx)(r.admonition,{type:"note",children:(0,o.jsxs)(r.p,{children:["When provisioning a new cluster, you need to initialize the cluster metadata on the metadata store (e.g., ZooKeeper). You need to initialize it ",(0,o.jsx)(r.strong,{children:"only once"}),"."]})}),"\n",(0,o.jsxs)(r.p,{children:["You can initialize this metadata using the ",(0,o.jsx)(r.a,{href:"/docs/4.1.x/reference-cli-tools",children:(0,o.jsx)(r.code,{children:"initialize-cluster-metadata"})})," command of the ",(0,o.jsx)(r.a,{href:"/docs/4.1.x/reference-cli-tools",children:(0,o.jsx)(r.code,{children:"pulsar"})})," CLI tool. This command can be run on any machine in your Pulsar cluster, so the metadata can be initialized from a ZooKeeper, broker, or bookie machine. The following is an example:"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-shell",children:"bin/pulsar initialize-cluster-metadata \\\n    --cluster pulsar-cluster-1 \\\n    --metadata-store zk:zk1.us-west.example.com:2181,zk2.us-west.example.com:2181 \\\n    --configuration-metadata-store zk:zk1.us-west.example.com:2181,zk2.us-west.example.com:2181 \\\n    --web-service-url http://pulsar.us-west.example.com:8080 \\\n    --web-service-url-tls https://pulsar.us-west.example.com:8443 \\\n    --broker-service-url pulsar://pulsar.us-west.example.com:6650 \\\n    --broker-service-url-tls pulsar+ssl://pulsar.us-west.example.com:6651\n"})}),"\n",(0,o.jsxs)(r.p,{children:["As you can see from the example above, you will need to specify the following configurations. Items with * are ",(0,o.jsx)(r.strong,{children:"required"})," flags."]}),"\n",(0,o.jsxs)(r.table,{children:[(0,o.jsx)(r.thead,{children:(0,o.jsxs)(r.tr,{children:[(0,o.jsx)(r.th,{style:{textAlign:"left"},children:"Flag"}),(0,o.jsx)(r.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,o.jsxs)(r.tbody,{children:[(0,o.jsxs)(r.tr,{children:[(0,o.jsxs)(r.td,{style:{textAlign:"left"},children:[(0,o.jsx)(r.code,{children:"--cluster"}),"*"]}),(0,o.jsx)(r.td,{style:{textAlign:"left"},children:"A name for the cluster"})]}),(0,o.jsxs)(r.tr,{children:[(0,o.jsxs)(r.td,{style:{textAlign:"left"},children:[(0,o.jsx)(r.code,{children:"--metadata-store"}),"*"]}),(0,o.jsxs)(r.td,{style:{textAlign:"left"},children:['A "local" metadata store connection string for the cluster. This connection string only needs to include ',(0,o.jsx)(r.em,{children:"one"})," machine in the ZooKeeper cluster."]})]}),(0,o.jsxs)(r.tr,{children:[(0,o.jsxs)(r.td,{style:{textAlign:"left"},children:[(0,o.jsx)(r.code,{children:"--configuration-metadata-store"}),"*"]}),(0,o.jsxs)(r.td,{style:{textAlign:"left"},children:["The configuration metadata store connection string for the entire instance. As with the ",(0,o.jsx)(r.code,{children:"--metadata-store"})," flag, this connection string only needs to include ",(0,o.jsx)(r.em,{children:"one"})," machine in the ZooKeeper cluster."]})]}),(0,o.jsxs)(r.tr,{children:[(0,o.jsxs)(r.td,{style:{textAlign:"left"},children:[(0,o.jsx)(r.code,{children:"--web-service-url"}),"*"]}),(0,o.jsx)(r.td,{style:{textAlign:"left"},children:"The web service URL for the cluster, plus a port. This URL should be a standard DNS name. The default port is 8080 (you had better not use a different port)."})]}),(0,o.jsxs)(r.tr,{children:[(0,o.jsx)(r.td,{style:{textAlign:"left"},children:(0,o.jsx)(r.code,{children:"--web-service-url-tls"})}),(0,o.jsxs)(r.td,{style:{textAlign:"left"},children:["If you use ",(0,o.jsx)(r.a,{href:"/docs/4.1.x/security-tls-transport",children:"TLS"}),", you also need to specify a TLS web service URL for the cluster. The default port is 8443 (you had better not use a different port)."]})]}),(0,o.jsxs)(r.tr,{children:[(0,o.jsxs)(r.td,{style:{textAlign:"left"},children:[(0,o.jsx)(r.code,{children:"--broker-service-url"}),"*"]}),(0,o.jsxs)(r.td,{style:{textAlign:"left"},children:["A broker service URL enabling interaction with the brokers in the cluster. This URL should not use the same DNS name as the web service URL but should use the ",(0,o.jsx)(r.code,{children:"pulsar"})," scheme instead. The default port is 6650 (you had better not use a different port)."]})]}),(0,o.jsxs)(r.tr,{children:[(0,o.jsx)(r.td,{style:{textAlign:"left"},children:(0,o.jsx)(r.code,{children:"--broker-service-url-tls"})}),(0,o.jsxs)(r.td,{style:{textAlign:"left"},children:["If you use ",(0,o.jsx)(r.a,{href:"/docs/4.1.x/security-tls-transport",children:"TLS"}),", you also need to specify a TLS web service URL for the cluster as well as a TLS broker service URL for the brokers in the cluster. The default port is 6651 (you had better not use a different port)."]})]})]})]}),"\n",(0,o.jsxs)(r.admonition,{type:"note",children:[(0,o.jsx)(r.p,{children:"If you do not have a DNS server, you can use multi-host format in the service URL with the following settings:"}),(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-shell",children:"--web-service-url http://host1:8080,host2:8080,host3:8080 \\\n--web-service-url-tls https://host1:8443,host2:8443,host3:8443 \\\n--broker-service-url pulsar://host1:6650,host2:6650,host3:6650 \\\n--broker-service-url-tls pulsar+ssl://host1:6651,host2:6651,host3:6651\n"})}),(0,o.jsxs)(r.p,{children:["If you want to use an existing BookKeeper cluster, you can add the ",(0,o.jsx)(r.code,{children:"--existing-bk-metadata-service-uri"})," flag as follows:"]}),(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-shell",children:'--existing-bk-metadata-service-uri "zk+null://zk1:2181;zk2:2181/ledgers" \\\n--web-service-url http://host1:8080,host2:8080,host3:8080 \\\n--web-service-url-tls https://host1:8443,host2:8443,host3:8443 \\\n--broker-service-url pulsar://host1:6650,host2:6650,host3:6650 \\\n--broker-service-url-tls pulsar+ssl://host1:6651,host2:6651,host3:6651\n'})}),(0,o.jsxs)(r.p,{children:["You can obtain the metadata service URI of the existing BookKeeper cluster by using the ",(0,o.jsx)(r.code,{children:"bin/bookkeeper shell whatisinstanceid"})," command. You must enclose the value in double quotes since the multiple metadata service URIs are separated with semicolons."]})]}),"\n",(0,o.jsx)(r.h2,{id:"step-3-deploy-a-bookkeeper-cluster",children:"Step 3: Deploy a BookKeeper cluster"}),"\n",(0,o.jsxs)(r.p,{children:[(0,o.jsx)(r.a,{href:"https://bookkeeper.apache.org",children:"BookKeeper"})," handles all persistent data storage in Pulsar. You need to deploy a cluster of BookKeeper bookies to use Pulsar. You can choose to run a ",(0,o.jsx)(r.strong,{children:"3-bookie BookKeeper cluster"}),"."]}),"\n",(0,o.jsxs)(r.p,{children:["You can configure BookKeeper bookies using the ",(0,o.jsx)(r.a,{href:"/docs/4.1.x/reference-configuration#bookkeeper",children:(0,o.jsx)(r.code,{children:"conf/bookkeeper.conf"})})," configuration file. The most important step in configuring bookies for our purposes here is ensuring that ",(0,o.jsx)(r.code,{children:"metadataServiceUri"})," is set to the URI for the ZooKeeper cluster. The following is an example:"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-properties",children:"metadataServiceUri=zk://zk1.us-west.example.com:2181;zk2.us-west.example.com:2181;zk3.us-west.example.com:2181/ledgers\n"})}),"\n",(0,o.jsxs)(r.p,{children:["Which using ",(0,o.jsx)(r.code,{children:";"})," as separator in ",(0,o.jsx)(r.code,{children:"metadataServiceUri"})]}),"\n",(0,o.jsx)(r.p,{children:":::"}),"\n",(0,o.jsxs)(r.p,{children:["Once you appropriately modify the ",(0,o.jsx)(r.code,{children:"metadataServiceUri"})," parameter, you can make any other configuration changes that you require. You can find a full listing of the available BookKeeper configuration parameters ",(0,o.jsx)(r.a,{href:"/docs/4.1.x/reference-configuration#bookkeeper",children:"here"}),". However, consulting the ",(0,o.jsx)(r.a,{href:"https://bookkeeper.apache.org/docs/next/reference/config/",children:"BookKeeper documentation"})," for a more in-depth guide might be a better choice."]}),"\n",(0,o.jsxs)(r.p,{children:["Once you apply the desired configuration in ",(0,o.jsx)(r.code,{children:"conf/bookkeeper.conf"}),", you can start up a bookie on each of your BookKeeper hosts. You can start up each bookie either in the background, using ",(0,o.jsx)(r.a,{href:"https://en.wikipedia.org/wiki/Nohup",children:"nohup"}),", or in the foreground."]}),"\n",(0,o.jsxs)(r.p,{children:["To start the bookie in the background, use the ",(0,o.jsx)(r.a,{href:"/docs/4.1.x/reference-cli-tools",children:(0,o.jsx)(r.code,{children:"pulsar-daemon"})})," CLI tool:"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-bash",children:"bin/pulsar-daemon start bookie\n"})}),"\n",(0,o.jsx)(r.p,{children:"To start the bookie in the foreground:"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-bash",children:"bin/pulsar bookie\n"})}),"\n",(0,o.jsxs)(r.p,{children:["You can verify that a bookie works properly by running the ",(0,o.jsx)(r.code,{children:"bookiesanity"})," command on the ",(0,o.jsx)(r.a,{href:"/docs/4.1.x/reference-cli-tools",children:"BookKeeper shell"}),":"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-bash",children:"bin/bookkeeper shell bookiesanity\n"})}),"\n",(0,o.jsx)(r.p,{children:"This command creates an ephemeral BookKeeper ledger on the local bookie, writes a few entries, reads them back, and finally deletes the ledger."}),"\n",(0,o.jsxs)(r.p,{children:["After you start all the bookies, you can use ",(0,o.jsx)(r.code,{children:"simpletest"})," command for ",(0,o.jsx)(r.a,{href:"/docs/4.1.x/reference-cli-tools",children:"BookKeeper shell"})," on any bookie node, to verify all the bookies in the cluster are up running."]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-bash",children:"bin/bookkeeper shell simpletest --ensemble <num-bookies> --writeQuorum <num-bookies> --ackQuorum <num-bookies> --numEntries <num-entries>\n"})}),"\n",(0,o.jsxs)(r.p,{children:["This command creates a ",(0,o.jsx)(r.code,{children:"num-bookies"})," sized ledger on the cluster, writes a few entries, and finally deletes the ledger."]}),"\n",(0,o.jsx)(r.h2,{id:"step-4-deploy-pulsar-brokers",children:"Step 4: Deploy Pulsar brokers"}),"\n",(0,o.jsxs)(r.p,{children:["Pulsar brokers are the last thing you need to deploy in your Pulsar cluster. Brokers handle Pulsar messages and provide the administrative interface of Pulsar. A good choice is to run ",(0,o.jsx)(r.strong,{children:"3 brokers"}),", one for each machine that already runs a BookKeeper bookie."]}),"\n",(0,o.jsx)(r.h3,{id:"configure-brokers",children:"Configure Brokers"}),"\n",(0,o.jsxs)(r.p,{children:["You can configure brokers using the ",(0,o.jsx)(r.code,{children:"conf/broker.conf"})," configuration file. The most important element of broker configuration is ensuring that each broker is aware of the ZooKeeper cluster that you have deployed. Ensure that the ",(0,o.jsx)(r.a,{href:"/docs/4.1.x/reference-configuration#broker",children:(0,o.jsx)(r.code,{children:"metadataStoreUrl"})})," and ",(0,o.jsx)(r.a,{href:"/docs/4.1.x/reference-configuration#broker",children:(0,o.jsx)(r.code,{children:"configurationMetadataStoreUrl"})})," parameters are correct. In this case, since you only have 1 cluster and no configuration store setup, the ",(0,o.jsx)(r.code,{children:"configurationMetadataStoreUrl"})," point to the same ",(0,o.jsx)(r.code,{children:"metadataStoreUrl"}),"."]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-properties",children:"metadataStoreUrl=zk:zk1.us-west.example.com:2181,zk2.us-west.example.com:2181,zk3.us-west.example.com:2181\nconfigurationMetadataStoreUrl=zk:zk1.us-west.example.com:2181,zk2.us-west.example.com:2181,zk3.us-west.example.com:2181\n"})}),"\n",(0,o.jsxs)(r.p,{children:["You also need to specify the cluster name (matching the name that you provided when you ",(0,o.jsx)(r.a,{href:"#initialize-cluster-metadata",children:"initialize the metadata of the cluster"}),"):"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-properties",children:"clusterName=pulsar-cluster-1\n"})}),"\n",(0,o.jsx)(r.p,{children:"In addition, you need to match the broker and web service ports provided when you initialize the metadata of the cluster (especially when you use a different port than the default):"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-properties",children:"brokerServicePort=6650\nbrokerServicePortTls=6651\nwebServicePort=8080\nwebServicePortTls=8443\n"})}),"\n",(0,o.jsxs)(r.blockquote,{children:["\n",(0,o.jsxs)(r.p,{children:["If you deploy Pulsar in a one-node cluster, you should update the replication settings in ",(0,o.jsx)(r.code,{children:"conf/broker.conf"})," to ",(0,o.jsx)(r.code,{children:"1"}),"."]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-properties",children:"# Number of bookies to use when creating a ledger\nmanagedLedgerDefaultEnsembleSize=1\n\n# Number of copies to store for each message\nmanagedLedgerDefaultWriteQuorum=1\n\n# Number of guaranteed copies (acks to wait before write is complete)\nmanagedLedgerDefaultAckQuorum=1\n"})}),"\n"]}),"\n",(0,o.jsx)(r.h3,{id:"enable-pulsar-functions-optional",children:"Enable Pulsar Functions (optional)"}),"\n",(0,o.jsxs)(r.p,{children:["If you want to enable ",(0,o.jsx)(r.a,{href:"/docs/4.1.x/functions-overview",children:"Pulsar Functions"}),", you can follow the instructions as below:"]}),"\n",(0,o.jsxs)(r.ol,{children:["\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsxs)(r.p,{children:["Edit ",(0,o.jsx)(r.code,{children:"conf/broker.conf"})," to enable functions worker, by setting ",(0,o.jsx)(r.code,{children:"functionsWorkerEnabled"})," to ",(0,o.jsx)(r.code,{children:"true"}),"."]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-conf",children:"functionsWorkerEnabled=true\n"})}),"\n"]}),"\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsxs)(r.p,{children:["Edit ",(0,o.jsx)(r.code,{children:"conf/functions_worker.yml"})," and set ",(0,o.jsx)(r.code,{children:"pulsarFunctionsCluster"})," to the cluster name that you provide when you ",(0,o.jsx)(r.a,{href:"#initialize-cluster-metadata",children:"initialize the metadata of the cluster"}),"."]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-conf",children:"pulsarFunctionsCluster: pulsar-cluster-1\n"})}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(r.p,{children:["If you want to learn more options about deploying the functions worker, check out ",(0,o.jsx)(r.a,{href:"/docs/4.1.x/functions-worker",children:"Deploy and manage functions worker"}),"."]}),"\n",(0,o.jsx)(r.h3,{id:"start-brokers",children:"Start Brokers"}),"\n",(0,o.jsxs)(r.p,{children:["You can then provide any other configuration changes that you want in the ",(0,o.jsx)(r.a,{href:"/docs/4.1.x/reference-configuration#broker",children:(0,o.jsx)(r.code,{children:"conf/broker.conf"})})," file. Once you decide on a configuration, you can start up the brokers for your Pulsar cluster. Like ZooKeeper and BookKeeper, you can start brokers either in the foreground or in the background, using nohup."]}),"\n",(0,o.jsxs)(r.p,{children:["You can start a broker in the foreground using the ",(0,o.jsx)(r.a,{href:"/docs/4.1.x/reference-cli-tools",children:(0,o.jsx)(r.code,{children:"pulsar broker"})})," command:"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-bash",children:"bin/pulsar broker\n"})}),"\n",(0,o.jsxs)(r.p,{children:["You can start a broker in the background using the ",(0,o.jsx)(r.a,{href:"/docs/4.1.x/reference-cli-tools",children:(0,o.jsx)(r.code,{children:"pulsar-daemon"})})," CLI tool:"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-bash",children:"bin/pulsar-daemon start broker\n"})}),"\n",(0,o.jsx)(r.p,{children:"Once you successfully start up all the brokers that you intend to use, your Pulsar cluster should be ready to go!"}),"\n",(0,o.jsx)(r.h2,{id:"connect-to-the-running-cluster",children:"Connect to the running cluster"}),"\n",(0,o.jsxs)(r.p,{children:["Once your Pulsar cluster is up and running, you should be able to connect with it using Pulsar clients. One such client is the ",(0,o.jsx)(r.a,{href:"/docs/4.1.x/reference-cli-tools",children:(0,o.jsx)(r.code,{children:"pulsar-client"})})," tool, which is included with the Pulsar binary package. The ",(0,o.jsx)(r.code,{children:"pulsar-client"})," tool can publish messages to and consume messages from Pulsar topics and thus provide a simple way to make sure that your cluster runs properly."]}),"\n",(0,o.jsxs)(r.p,{children:["To use the ",(0,o.jsx)(r.code,{children:"pulsar-client"})," tool, first modify the client configuration file in ",(0,o.jsx)(r.a,{href:"/docs/4.1.x/reference-configuration#client",children:(0,o.jsx)(r.code,{children:"conf/client.conf"})})," in your binary package. You need to change the values for ",(0,o.jsx)(r.code,{children:"webServiceUrl"})," and ",(0,o.jsx)(r.code,{children:"brokerServiceUrl"}),", substituting ",(0,o.jsx)(r.code,{children:"localhost"})," (which is the default), with the DNS name that you assign to your broker/bookie hosts. The following is an example:"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-properties",children:"webServiceUrl=http://us-west.example.com:8080\nbrokerServiceurl=pulsar://us-west.example.com:6650\n"})}),"\n",(0,o.jsxs)(r.admonition,{type:"note",children:[(0,o.jsx)(r.p,{children:"If you do not have a DNS server, you can specify multi-host in service URL as follows:"}),(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-properties",children:"webServiceUrl=http://host1:8080,host2:8080,host3:8080\nbrokerServiceurl=pulsar://host1:6650,host2:6650,host3:6650\n"})})]}),"\n",(0,o.jsx)(r.p,{children:"Once that is complete, you can publish a message to the Pulsar topic:"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-bash",children:'bin/pulsar-client produce \\\n    persistent://public/default/test \\\n    -n 1 \\\n    -m "Hello Pulsar"\n'})}),"\n",(0,o.jsx)(r.p,{children:"This command publishes a single message to the Pulsar topic. In addition, you can subscribe to the Pulsar topic in a different terminal before publishing messages as below:"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-bash",children:'bin/pulsar-client consume \\\n    persistent://public/default/test \\\n    -n 100 \\\n    -s "consumer-test" \\\n    -t "Exclusive"\n'})}),"\n",(0,o.jsx)(r.p,{children:"Once you successfully publish the above message to the topic, you should see it in the standard output:"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{children:"----- got message -----\nkey:[null], properties:[], content:Hello Pulsar\n"})}),"\n",(0,o.jsx)(r.h2,{id:"run-functions",children:"Run Functions"}),"\n",(0,o.jsxs)(r.blockquote,{children:["\n",(0,o.jsxs)(r.p,{children:["If you have ",(0,o.jsx)(r.a,{href:"#enable-pulsar-functions-optional",children:"enabled"})," Pulsar Functions, you can try out the Pulsar Functions now."]}),"\n"]}),"\n",(0,o.jsxs)(r.p,{children:["Create an ExclamationFunction ",(0,o.jsx)(r.code,{children:"exclamation"}),"."]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-bash",children:"bin/pulsar-admin functions create \\\n    --jar $PWD/examples/api-examples.jar \\\n    --classname org.apache.pulsar.functions.api.examples.ExclamationFunction \\\n    --inputs persistent://public/default/exclamation-input \\\n    --output persistent://public/default/exclamation-output \\\n    --tenant public \\\n    --namespace default \\\n    --name exclamation\n"})}),"\n",(0,o.jsxs)(r.p,{children:["Check whether the function runs as expected by ",(0,o.jsx)(r.a,{href:"/docs/4.1.x/functions-deploy-trigger",children:"triggering"})," the function."]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-bash",children:'bin/pulsar-admin functions trigger --name exclamation --trigger-value "hello world"\n'})}),"\n",(0,o.jsx)(r.p,{children:"You should see the following output:"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-shell",children:"hello world!\n"})})]})}function h(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,o.jsx)(r,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},64021:(e,r,n)=>{n.d(r,{A:()=>s});const s=n.p+"assets/images/pulsar-basic-setup-18d39371fd6e67ded8a2d94f9ccfd7ec.png"},28453:(e,r,n)=>{n.d(r,{R:()=>i,x:()=>l});var s=n(96540);const o={},t=s.createContext(o);function i(e){const r=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function l(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),s.createElement(t.Provider,{value:r},e.children)}}}]);