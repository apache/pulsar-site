"use strict";(self.webpackChunkwebsite_next=self.webpackChunkwebsite_next||[]).push([[51631],{40114:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>h,frontMatter:()=>t,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"io-develop","title":"Develop Connectors","description":"This guide describes how developers can write new connectors for Pulsar IO to move data","source":"@site/versioned_docs/version-2.4.1/io-develop.md","sourceDirName":".","slug":"/io-develop","permalink":"/docs/2.4.1/io-develop","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/pulsar-site/edit/main/versioned_docs/version-2.4.1/io-develop.md","tags":[],"version":"2.4.1","frontMatter":{"id":"io-develop","title":"Develop Connectors","sidebar_label":"Developing Connectors","original_id":"io-develop"},"sidebar":"docsSidebar","previous":{"title":"Builtin Connectors","permalink":"/docs/2.4.1/io-connectors"},"next":{"title":"CDC Connector","permalink":"/docs/2.4.1/io-cdc"}}');var i=r(74848),o=r(28453);const t={id:"io-develop",title:"Develop Connectors",sidebar_label:"Developing Connectors",original_id:"io-develop"},s=void 0,c={},l=[{value:"Developing",id:"developing",level:3},{value:"Develop a source connector",id:"develop-a-source-connector",level:4},{value:"Develop a sink connector",id:"develop-a-sink-connector",level:4},{value:"Testing",id:"testing",level:3},{value:"Packaging",id:"packaging",level:3},{value:"Creating a NAR package",id:"creating-a-nar-package",level:4},{value:"Creating an Uber JAR",id:"creating-an-uber-jar",level:4}];function d(e){const n={a:"a",code:"code",em:"em",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"This guide describes how developers can write new connectors for Pulsar IO to move data\nbetween Pulsar and other systems. It describes how to create a Pulsar IO connector."}),"\n",(0,i.jsxs)(n.p,{children:["Pulsar IO connectors are specialized ",(0,i.jsx)(n.a,{href:"/docs/2.4.1/functions-overview",children:"Pulsar Functions"}),". So writing\na Pulsar IO connector is as simple as writing a Pulsar function. Pulsar IO connectors come\nin two flavors: ",(0,i.jsx)(n.a,{href:"https://github.com/apache/pulsar/tree/master//pulsar-io/core/src/main/java/org/apache/pulsar/io/core/Source.java",children:"Source"}),",\nwhich import data from another system, and ",(0,i.jsx)(n.a,{href:"https://github.com/apache/pulsar/tree/master//pulsar-io/core/src/main/java/org/apache/pulsar/io/core/Sink.java",children:"Sink"}),",\nwhich export data to another system. For example, ",(0,i.jsx)(n.a,{href:"/docs/2.4.1/io-kinesis",children:"KinesisSink"})," would export\nthe messages of a Pulsar topic to a Kinesis stream, and ",(0,i.jsx)(n.a,{href:"/docs/2.4.1/io-rabbitmq",children:"RabbitmqSource"})," would import\nthe messages of a RabbitMQ queue to a Pulsar topic."]}),"\n",(0,i.jsx)(n.h3,{id:"developing",children:"Developing"}),"\n",(0,i.jsx)(n.h4,{id:"develop-a-source-connector",children:"Develop a source connector"}),"\n",(0,i.jsxs)(n.p,{children:["What you need to develop a source connector is to implement ",(0,i.jsx)(n.a,{href:"https://github.com/apache/pulsar/tree/master//pulsar-io/core/src/main/java/org/apache/pulsar/io/core/Source.java",children:"Source"}),"\ninterface."]}),"\n",(0,i.jsxs)(n.p,{children:["First, you need to implement the ",(0,i.jsx)(n.a,{href:"https://github.com/apache/pulsar/tree/master//pulsar-io/core/src/main/java/org/apache/pulsar/io/core/Source.java#L33",children:"open"})," method. This method will be called once when the source connector\nis initialized. In this method, you can retrieve all the connector specific settings through\nthe passed ",(0,i.jsx)(n.code,{children:"config"})," parameter, and initialize all the necessary resourcess. For example, a Kafka\nconnector can create the Kafka client in this ",(0,i.jsx)(n.code,{children:"open"})," method."]}),"\n",(0,i.jsxs)(n.p,{children:["Beside the passed-in ",(0,i.jsx)(n.code,{children:"config"})," object, the Pulsar runtime also provides a ",(0,i.jsx)(n.code,{children:"SourceContext"})," for the\nconnector to access runtime resources for tasks like collecting metrics. The implementation can\nsave the ",(0,i.jsx)(n.code,{children:"SourceContext"})," for further usage."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"\n    /**\n     * Open connector with configuration\n     *\n     * @param config initialization config\n     * @param sourceContext\n     * @throws Exception IO type exceptions when opening a connector\n     */\n    void open(final Map<String, Object> config, SourceContext sourceContext) throws Exception;\n\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The main task for a Source implementor is to implement ",(0,i.jsx)(n.a,{href:"https://github.com/apache/pulsar/tree/master//pulsar-io/core/src/main/java/org/apache/pulsar/io/core/Source.java#L41",children:"read"}),"\nmethod."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"\n    /**\n     * Reads the next message from source.\n     * If source does not have any new messages, this call should block.\n     * @return next message from source.  The return result should never be null\n     * @throws Exception\n     */\n    Record<T> read() throws Exception;\n\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The implementation should be blocking on this method if nothing to return. It should never return\n",(0,i.jsx)(n.code,{children:"null"}),". The returned ",(0,i.jsx)(n.a,{href:"https://github.com/apache/pulsar/tree/master//pulsar-functions/api-java/src/main/java/org/apache/pulsar/functions/api/Record.java#L28",children:"Record"})," should encapsulates the information that is needed by\nPulsar IO runtime."]}),"\n",(0,i.jsx)(n.p,{children:"These information includes:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.em,{children:"Topic Name"}),": ",(0,i.jsx)(n.em,{children:"Optional"}),". If the record is originated from a Pulsar topic, it should be the Pulsar topic name."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.em,{children:"Key"}),": ",(0,i.jsx)(n.em,{children:"Optional"}),". If the record has a key associated with it."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.em,{children:"Value"}),": ",(0,i.jsx)(n.em,{children:"Required"}),". The actual data of this record."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.em,{children:"Partition Id"}),": ",(0,i.jsx)(n.em,{children:"Optional"}),". If the record is originated from a partitioned source,\nreturn its partition id. The partition id will be used as part of the unique identifier\nby Pulsar IO runtime to do message deduplication and achieve exactly-once processing guarantee."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.em,{children:"Record Sequence"}),": ",(0,i.jsx)(n.em,{children:"Optional"}),". If the record is originated from a sequential source,\nreturn its record sequence. The record sequence will be used as part of the unique identifier\nby Pulsar IO runtime to do message deduplication and achieve exactly-once processing guarantee."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.em,{children:"Properties"}),": ",(0,i.jsx)(n.em,{children:"Optional"}),". If the record carries user-defined properties, return those properties."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Additionally, the implementation of the record should provide two methods: ",(0,i.jsx)(n.code,{children:"ack"})," and ",(0,i.jsx)(n.code,{children:"fail"}),". These\ntwo methods will be used by Pulsar IO connector to acknowledge the records that it has done\nprocessing and fail the records that it has failed to process."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"https://github.com/apache/pulsar/tree/master//pulsar-io/kafka/src/main/java/org/apache/pulsar/io/kafka/KafkaAbstractSource.java",children:"KafkaSource"})," is a good example to follow."]}),"\n",(0,i.jsx)(n.h4,{id:"develop-a-sink-connector",children:"Develop a sink connector"}),"\n",(0,i.jsxs)(n.p,{children:["Developing a sink connector is as easy as developing a source connector. You just need to\nimplement ",(0,i.jsx)(n.a,{href:"https://github.com/apache/pulsar/tree/master//pulsar-io/core/src/main/java/org/apache/pulsar/io/core/Sink.java",children:"Sink"})," interface."]}),"\n",(0,i.jsxs)(n.p,{children:["Similarly, you first need to implement the ",(0,i.jsx)(n.a,{href:"https://github.com/apache/pulsar/tree/master//pulsar-io/core/src/main/java/org/apache/pulsar/io/core/Sink.java#L36",children:"open"})," method to initialize all the necessary resources\nbefore implementing the ",(0,i.jsx)(n.a,{href:"https://github.com/apache/pulsar/tree/master//pulsar-io/core/src/main/java/org/apache/pulsar/io/core/Sink.java#L44",children:"write"})," method."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"\n    /**\n     * Open connector with configuration\n     *\n     * @param config initialization config\n     * @param sinkContext\n     * @throws Exception IO type exceptions when opening a connector\n     */\n    void open(final Map<String, Object> config, SinkContext sinkContext) throws Exception;\n\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The main task for a Sink implementor is to implement ",(0,i.jsx)(n.a,{href:"https://github.com/apache/pulsar/tree/master//pulsar-io/core/src/main/java/org/apache/pulsar/io/core/Sink.java#L44",children:"write"})," method."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"\n    /**\n     * Write a message to Sink\n     * @param record record to write to sink\n     * @throws Exception\n     */\n    void write(Record<T> record) throws Exception;\n\n"})}),"\n",(0,i.jsxs)(n.p,{children:["In the implementation of ",(0,i.jsx)(n.code,{children:"write"})," method, the implementor can decide how to write the value and\nthe optional key to the actual source, and leverage all the provided information such as\n",(0,i.jsx)(n.code,{children:"Partition Id"}),", ",(0,i.jsx)(n.code,{children:"Record Sequence"})," for achieving different processing guarantees. The implementor\nis also responsible for acknowledging records if it has successfully written them or failing\nrecords if has failed to write them."]}),"\n",(0,i.jsx)(n.h3,{id:"testing",children:"Testing"}),"\n",(0,i.jsx)(n.p,{children:"Testing connectors can be challenging because Pulsar IO connectors interact with two systems\nthat may be difficult to mock - Pulsar and the system the connector is connecting to. It is\nrecommended to write very specifically test the functionalities of the connector classes\nwhile mocking the external services."}),"\n",(0,i.jsxs)(n.p,{children:["Once you have written sufficient unit tests for your connector, we also recommend adding\nseparate integration tests to verify end-to-end functionality. In Pulsar, we are using ",(0,i.jsx)(n.a,{href:"https://www.testcontainers.org/",children:"testcontainers"})," for all Pulsar integration tests. Pulsar IO\n",(0,i.jsx)(n.a,{href:"https://github.com/apache/pulsar/tree/master//tests/integration/src/test/java/org/apache/pulsar/tests/integration/io",children:"IntegrationTests"})," are good examples to follow on integration testing your connectors."]}),"\n",(0,i.jsx)(n.h3,{id:"packaging",children:"Packaging"}),"\n",(0,i.jsxs)(n.p,{children:["Once you've developed and tested your connector, you must package it so that it can be submitted\nto a ",(0,i.jsx)(n.a,{href:"/docs/2.4.1/functions-overview",children:"Pulsar Functions"})," cluster. There are two approaches described\nhere work with Pulsar Functions' runtime."]}),"\n",(0,i.jsxs)(n.p,{children:["If you plan to package and distribute your connector for others to use, you are obligated to\nproperly license and copyright your own code and to adhere to the licensing and copyrights of\nall libraries your code uses and that you include in your distribution. If you are using the\napproach described in ",(0,i.jsx)(n.a,{href:"#creating-a-nar-package",children:'"Creating a NAR package"'}),", the NAR plugin will\nautomatically create a ",(0,i.jsx)(n.code,{children:"DEPENDENCIES"})," file in the generated NAR package, including the proper\nlicensing and copyrights of all libraries of your connector."]}),"\n",(0,i.jsx)(n.h4,{id:"creating-a-nar-package",children:"Creating a NAR package"}),"\n",(0,i.jsxs)(n.p,{children:["The easiest approach to packaging a Pulsar IO connector is to create a NAR package using ",(0,i.jsx)(n.a,{href:"https://mvnrepository.com/artifact/org.apache.nifi/nifi-nar-maven-plugin",children:"nifi-nar-maven-plugin"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["NAR stands for NiFi Archive. It is a custom packaging mechanism used by Apache NiFi, to provide\na bit of Java ClassLoader isolation. For more details, you can read this ",(0,i.jsx)(n.a,{href:"https://medium.com/hashmapinc/nifi-nar-files-explained-14113f7796fd",children:"blog post"})," to understand\nhow NAR works. Pulsar uses the same mechanism for packaging all the ",(0,i.jsx)(n.a,{href:"/docs/2.4.1/io-connectors",children:"builtin connectors"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["All what you need is to include this ",(0,i.jsx)(n.a,{href:"https://mvnrepository.com/artifact/org.apache.nifi/nifi-nar-maven-plugin",children:"nifi-nar-maven-plugin"})," in your maven project for your connector. For example:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:"\n<plugins>\n  <plugin>\n    <groupId>org.apache.nifi</groupId>\n    <artifactId>nifi-nar-maven-plugin</artifactId>\n    <version>1.2.0</version>\n  </plugin>\n</plugins>\n\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.a,{href:"https://github.com/apache/pulsar/tree/master//pulsar-io/twitter",children:"TwitterFirehose"})," connector is a good example to follow."]}),"\n",(0,i.jsx)(n.h4,{id:"creating-an-uber-jar",children:"Creating an Uber JAR"}),"\n",(0,i.jsxs)(n.p,{children:["An alternative approach is to create an ",(0,i.jsx)(n.em,{children:"uber JAR"})," that contains all of the connector's JAR files\nand other resource files. No directory internal structure is necessary."]}),"\n",(0,i.jsxs)(n.p,{children:["You can use ",(0,i.jsx)(n.a,{href:"https://maven.apache.org/plugins/maven-shade-plugin/examples/includes-excludes.html",children:"maven-shade-plugin"})," to create a Uber JAR. For example:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:"\n<plugin>\n  <groupId>org.apache.maven.plugins</groupId>\n  <artifactId>maven-shade-plugin</artifactId>\n  <version>3.1.1</version>\n  <executions>\n    <execution>\n      <phase>package</phase>\n      <goals>\n        <goal>shade</goal>\n      </goals>\n      <configuration>\n        <filters>\n          <filter>\n            <artifact>*:*</artifact>\n          </filter>\n        </filters>\n      </configuration>\n    </execution>\n  </executions>\n</plugin>\n\n"})})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},28453:(e,n,r)=>{r.d(n,{R:()=>t,x:()=>s});var a=r(96540);const i={},o=a.createContext(i);function t(e){const n=a.useContext(o);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),a.createElement(o.Provider,{value:n},e.children)}}}]);