"use strict";(self.webpackChunkwebsite_next=self.webpackChunkwebsite_next||[]).push([[71597],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>d});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var i=n.createContext({}),p=function(e){var t=n.useContext(i),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},c=function(e){var t=p(e.components);return n.createElement(i.Provider,{value:t},e.children)},h={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,l=e.originalType,i=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),u=p(a),d=r,m=u["".concat(i,".").concat(d)]||u[d]||h[d]||l;return a?n.createElement(m,s(s({ref:t},c),{},{components:a})):n.createElement(m,s({ref:t},c))}));function d(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=a.length,s=new Array(l);s[0]=u;var o={};for(var i in t)hasOwnProperty.call(t,i)&&(o[i]=t[i]);o.originalType=e,o.mdxType="string"==typeof e?e:r,s[1]=o;for(var p=2;p<l;p++)s[p]=a[p];return n.createElement.apply(null,s)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},14656:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>i,contentTitle:()=>s,default:()=>h,frontMatter:()=>l,metadata:()=>o,toc:()=>p});var n=a(87462),r=(a(67294),a(3905));const l={id:"release-process",title:"Release Process"},s=void 0,o={unversionedId:"release-process",id:"release-process",title:"Release Process",description:"This page contains instructions for Pulsar committers on how to perform a release.",source:"@site/contribute/release-process.md",sourceDirName:".",slug:"/release-process",permalink:"/contribute/release-process",draft:!1,editUrl:"https://github.com/apache/pulsar-site/tree/main/site2/website-next/contribute/release-process.md",tags:[],version:"current",lastUpdatedBy:"Pulsar Site Updater",lastUpdatedAt:1668794508,formattedLastUpdatedAt:"Nov 18, 2022",frontMatter:{id:"release-process",title:"Release Process"},sidebar:"sidebarDevelopment",previous:{title:"Validate Release Candidate",permalink:"/contribute/validate-release-candidate"},next:{title:"Release Note Guide",permalink:"/contribute/release-note-guide"}},i={},p=[{value:"Preparation",id:"preparation",level:2},{value:"Requirements",id:"requirements",level:2},{value:"Create the release branch",id:"create-the-release-branch",level:2},{value:"Update project version and tag",id:"update-project-version-and-tag",level:2},{value:"Build and inspect the artifacts",id:"build-and-inspect-the-artifacts",level:2},{value:"Build RPM and DEB packages",id:"build-rpm-and-deb-packages",level:3},{value:"Sign and stage the artifacts",id:"sign-and-stage-the-artifacts",level:2},{value:"Stage artifacts in maven",id:"stage-artifacts-in-maven",level:2},{value:"Publish release candidate docker images",id:"publish-release-candidate-docker-images",level:2},{value:"Run the vote",id:"run-the-vote",level:2},{value:"Move master branch to next version",id:"move-master-branch-to-next-version",level:2},{value:"Promote the release",id:"promote-the-release",level:2},{value:"Publish Docker Images",id:"publish-docker-images",level:2},{value:"Release Helm Chart",id:"release-helm-chart",level:2},{value:"Publish Python Clients",id:"publish-python-clients",level:2},{value:"Linux",id:"linux",level:3},{value:"MacOS",id:"macos",level:3},{value:"Update Python Client docs",id:"update-python-client-docs",level:2},{value:"Publish Homebrew libpulsar package",id:"publish-homebrew-libpulsar-package",level:2},{value:"Update swagger file",id:"update-swagger-file",level:2},{value:"Write release notes",id:"write-release-notes",level:2},{value:"Update the site",id:"update-the-site",level:2},{value:"Announce the release",id:"announce-the-release",level:2},{value:"Write a blog post for the release (optional)",id:"write-a-blog-post-for-the-release-optional",level:2},{value:"Remove old releases",id:"remove-old-releases",level:2},{value:"Move release branch to next version",id:"move-release-branch-to-next-version",level:2}],c={toc:p};function h(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"This page contains instructions for Pulsar committers on how to perform a release."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"The term ",(0,r.kt)("inlineCode",{parentName:"p"},"major/minor releases")," used throughout this document is defined as follows:"),(0,r.kt)("ul",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ul"},"Major releases refer to feature releases, such as 2.10.0, 2.11.0, and so on."),(0,r.kt)("li",{parentName:"ul"},"Minor releases refer to bug-fix releases, such as 2.10.1, 2.10.2, and so on."))),(0,r.kt)("h2",{id:"preparation"},"Preparation"),(0,r.kt)("p",null,"Open a discussion in ",(0,r.kt)("a",{parentName:"p",href:"mailto:dev@apache.org"},"dev@apache.org")," to notify others that you volunteer to be the release manager of a specific release. If there are no disagreements, you can start the release process."),(0,r.kt)("p",null,"For major releases, you should create a new branch named ",(0,r.kt)("inlineCode",{parentName:"p"},"branch-2.X.0")," once all PRs with the 2.X.0 milestone are merged. If some PRs with the 2.X.0 milestone are still working in progress and might take much time to complete, you can move them to the next milestone if they are not important. In this case, you'd better notify the author in the PR."),(0,r.kt)("p",null,"For minor releases, if there are no disagreements, you should cherry-pick all merged PRs with the ",(0,r.kt)("inlineCode",{parentName:"p"},"release/X.Y.Z")," labels into ",(0,r.kt)("inlineCode",{parentName:"p"},"branch-X.Y"),". After these PRs are cherry-picked, you should add the ",(0,r.kt)("inlineCode",{parentName:"p"},"cherry-picked/branch-X.Y")," labels."),(0,r.kt)("p",null,"Sometimes some PRs cannot be cherry-picked cleanly, you might need to create a separate PR and move the ",(0,r.kt)("inlineCode",{parentName:"p"},"release/X.Y.Z")," label from the original PR to it. In this case, you can ask the author to help create the new PR."),(0,r.kt)("p",null,"For PRs that are still open, you can choose to delay them to the next release or ping others to review so that they can be merged."),(0,r.kt)("p",null,"To verify the release branch is not broken, you can synchronize the branch in your private repo and open a PR to trigger the CI. Example: ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/BewareMyPower/pulsar/pull/3"},"https://github.com/BewareMyPower/pulsar/pull/3")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"You can use the following command to catch basic compilation or checkstyle errors in your local env before cherry-picking."),(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"mvn -Pcore-modules,-main -T 1C clean install -DskipTests -Dspotbugs.skip=true\n"))),(0,r.kt)("h2",{id:"requirements"},"Requirements"),(0,r.kt)("p",null,"If you haven't already done it, ",(0,r.kt)("a",{parentName:"p",href:"/contribute/create-gpg-keys"},"create and publish the GPG key")," to sign the release artifacts."),(0,r.kt)("p",null,"Before you start the next release steps, make sure you have installed the ",(0,r.kt)("strong",{parentName:"p"},"JDK8")," and maven ",(0,r.kt)("strong",{parentName:"p"},"3.6.1")," for Pulsar 2.6 and Pulsar 2.7, and ",(0,r.kt)("strong",{parentName:"p"},"JDK11")," and Maven ",(0,r.kt)("strong",{parentName:"p"},"3.6.1")," for Pulsar 2.8 onwards. And ",(0,r.kt)("strong",{parentName:"p"},"clean up the bookkeeper's local compiled")," to make sure the bookkeeper dependency is fetched from the Maven repo, details to see ",(0,r.kt)("a",{parentName:"p",href:"https://lists.apache.org/thread/gsbh95b2d9xtcg5fmtxpm9k9q6w68gd2"},"https://lists.apache.org/thread/gsbh95b2d9xtcg5fmtxpm9k9q6w68gd2")),(0,r.kt)("h2",{id:"create-the-release-branch"},"Create the release branch"),(0,r.kt)("p",null,"We are going to create a branch from ",(0,r.kt)("inlineCode",{parentName:"p"},"master")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"branch-v2.X"),"\nwhere the tag will be generated and where new fixes will be\napplied as part of the maintenance for the release."),(0,r.kt)("p",null,"The branch needs only to be created when creating major releases,\nand not for minor releases like ",(0,r.kt)("inlineCode",{parentName:"p"},"2.3.1"),". For minor releases, go to the next step."),(0,r.kt)("p",null,"For example, when you create the ",(0,r.kt)("inlineCode",{parentName:"p"},"v2.3.0")," release, the branch ",(0,r.kt)("inlineCode",{parentName:"p"},"branch-2.3")," will be created; but for ",(0,r.kt)("inlineCode",{parentName:"p"},"v2.3.1"),", we\nkeep using the old ",(0,r.kt)("inlineCode",{parentName:"p"},"branch-2.3"),"."),(0,r.kt)("p",null,"In these instructions, I'm referring to a fictitious release ",(0,r.kt)("inlineCode",{parentName:"p"},"2.X.0"),". Change the release version in the examples accordingly with the real version."),(0,r.kt)("p",null,"It is recommended to create a fresh clone of the repository to avoid any local files interfering in the process:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"git clone git@github.com:apache/pulsar.git\ncd pulsar\ngit checkout -b branch-2.X origin/master\n")),(0,r.kt)("p",null,"Alternatively, you can use a git workspace to create a new, clean directory on your machine without needing to re-download the project."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"git worktree add ../pulsar.branch-2.X branch-2.X\n")),(0,r.kt)("p",null,"If you created a new branch, update the ",(0,r.kt)("inlineCode",{parentName:"p"},"CI - OWASP Dependency Check")," workflow so that it will run on the new branch. At the time of writing, here is the file that should be updated: ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/pulsar/blob/master/.github/workflows/ci-owasp-dependency-check.yaml"},"https://github.com/apache/pulsar/blob/master/.github/workflows/ci-owasp-dependency-check.yaml"),"."),(0,r.kt)("p",null,"Note also that you should stop the GitHub action for Pulsar versions that are EOL."),(0,r.kt)("p",null,"Also, if you created a new branch, please update the ",(0,r.kt)("inlineCode",{parentName:"p"},"Security Policy and Supported Versions")," page on the website. This page has a table for support timelines based on when minor releases take place."),(0,r.kt)("h2",{id:"update-project-version-and-tag"},"Update project version and tag"),(0,r.kt)("p",null,'During the release process, you are going to initially create\n"candidate" tags, that after verification and approval will\nget promoted to the "real" final tag.'),(0,r.kt)("p",null,"In this process, the maven version of the project will always\nbe the final one."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"# Bump to the release version\n./src/set-project-version.sh 2.X.0\n\n# Some version may not update the right parent version of `protobuf-shaded/pom.xml`, please double check it.\n\n# Commit\ngit commit -m 'Release 2.X.0' -a\n\n# Create a \"candidate\" tag\n# If you don't sign your commits already, use the following\nexport GPG_TTY=$(tty)\ngit tag -u $USER@apache.org v2.X.0-candidate-1 -m 'Release v2.X.0-candidate-1'\n# If you already sign your commits using your apache.org email, use the following\ngit tag -s v2.X.0-candidate-1 -m 'Release v2.X.0-candidate-1'\n\n# Verify that you signed your tag before pushing it:\ngit tag -v v2.X.0-candidate-1\n\n# Push both the branch and the tag to Github repo\ngit push origin branch-2.X\ngit push origin v2.X.0-candidate-1\n")),(0,r.kt)("p",null,"For minor releases, the tag is like ",(0,r.kt)("inlineCode",{parentName:"p"},"2.3.1"),"."),(0,r.kt)("h2",{id:"build-and-inspect-the-artifacts"},"Build and inspect the artifacts"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"mvn clean install -DskipTests\n")),(0,r.kt)("p",null,"After the build, there will be 4 generated artifacts:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"distribution/server/target/apache-pulsar-2.X.0-bin.tar.gz")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"target/apache-pulsar-2.X.0-src.tar.gz")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"distribution/offloaders/target/apache-pulsar-offloaders-2.X.0-bin.tar.gz")),(0,r.kt)("li",{parentName:"ul"},"directory ",(0,r.kt)("inlineCode",{parentName:"li"},"distribution/io/target/apache-pulsar-io-connectors-2.x.0-bin")," contains all io connect nars")),(0,r.kt)("p",null,"Inspect the artifacts:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Check that the ",(0,r.kt)("inlineCode",{parentName:"p"},"LICENSE")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"NOTICE")," files cover all included jars for the -bin package)"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Use script to cross-validate ",(0,r.kt)("inlineCode",{parentName:"li"},"LICENSE")," file with included jars:",(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"src/check-binary-license distribution/server/target/apache-pulsar-2.x.0-bin.tar.gz\n"))))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Unpack src package: ",(0,r.kt)("inlineCode",{parentName:"p"},"target/apache-pulsar-2.X.0-src.tar.gz")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Run Apache RAT to verify the license headers in the ",(0,r.kt)("inlineCode",{parentName:"li"},"src")," package:",(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"cd apache-pulsar-2.X.0\nmvn apache-rat:check\n"))))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Unpack bin package: ",(0,r.kt)("inlineCode",{parentName:"p"},"distribution/server/target/apache-pulsar-2.X.0-bin.tar.gz"),", Check that the standalone Pulsar service starts correctly:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"cd apache-pulsar-2.X.0\ncp -r ../../../io/target/apache-pulsar-io-connectors-2.X.0-bin connectors\nbin/pulsar standalone\n"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Use instructions in ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/pulsar/blob/master/wiki/release/release-candidate-validation.md"},"Release-Candidate-Validation")," to do some sanity checks on the produced binary distributions."))),(0,r.kt)("h3",{id:"build-rpm-and-deb-packages"},"Build RPM and DEB packages"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"pulsar-client-cpp/pkg/rpm/docker-build-rpm.sh\n\npulsar-client-cpp/pkg/deb/docker-build-deb.sh\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"For 2.11.0 or higher, you can set the environment variable ",(0,r.kt)("inlineCode",{parentName:"p"},"BUILD_IMAGE")," to build the base image locally instead of pulling from the DockerHub.\nSince only a few members have the permission to push the image to DockerHub, the image might not be the latest, if you failed to build the RPM and DEB packages, you can run ",(0,r.kt)("inlineCode",{parentName:"p"},"export BUILD_IMAGE=1")," before running these commands.")),(0,r.kt)("p",null,"This will leave the RPM/YUM and DEB repo files in ",(0,r.kt)("inlineCode",{parentName:"p"},"pulsar-client-cpp/pkg/rpm/RPMS/x86_64")," and\n",(0,r.kt)("inlineCode",{parentName:"p"},"pulsar-client-cpp/pkg/deb/BUILD/DEB")," directory."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"NOTE"),": If you get error ",(0,r.kt)("inlineCode",{parentName:"p"},"c++: internal compiler error: Killed (program cc1plus)")," when run ",(0,r.kt)("inlineCode",{parentName:"p"},"pulsar-client-cpp/pkg/deb/docker-build-deb.sh"),". You may need to expand your docker memory greater than 2GB.")),(0,r.kt)("h2",{id:"sign-and-stage-the-artifacts"},"Sign and stage the artifacts"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"src")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"bin")," artifacts need to be signed and uploaded to the dist SVN\nrepository for staging."),(0,r.kt)("p",null,"Before running the script, make sure that the ",(0,r.kt)("inlineCode",{parentName:"p"},"user@apache.org")," code signing key is the default gpg signing key.\nOne way to ensure this is to create/edit file ",(0,r.kt)("inlineCode",{parentName:"p"},"~/.gnupg/gpg.conf")," and add a line"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"default-key <key fingerprint>\n")),(0,r.kt)("p",null,"where ",(0,r.kt)("inlineCode",{parentName:"p"},"<key fingerprint>")," should be replaced with the private key fingerprint for the ",(0,r.kt)("inlineCode",{parentName:"p"},"user@apache.org")," key. The key fingerprint can be found in ",(0,r.kt)("inlineCode",{parentName:"p"},"gpg -K")," output."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"svn co https://dist.apache.org/repos/dist/dev/pulsar pulsar-dist-dev\ncd pulsar-dist-dev\n\n# '-candidate-1' needs to be incremented in case of multiple iteration in getting\n#    to the final release)\nsvn mkdir pulsar-2.X.0-candidate-1\n\ncd pulsar-2.X.0-candidate-1\n$PULSAR_PATH/src/stage-release.sh .\n\nsvn add *\nsvn ci -m 'Staging artifacts and signature for Pulsar release 2.X.0'\n")),(0,r.kt)("h2",{id:"stage-artifacts-in-maven"},"Stage artifacts in maven"),(0,r.kt)("p",null,"Upload the artifacts to ASF Nexus:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"# remove CPP client binaries (they would file the license/RAT check in \"deploy\")\ncd pulsar-client-cpp\ngit clean -xfd\ncd ..\n\nexport APACHE_USER=$USER\nexport APACHE_PASSWORD=$MY_PASSWORD\nexport GPG_TTY=$(tty)\n# src/settings.xml from master branch to /tmp/mvn-apache-settings.xml since it's missing in some branches\ncurl -s -o /tmp/mvn-apache-settings.xml https://raw.githubusercontent.com/apache/pulsar/master/src/settings.xml\n# publish artifacts\nmvn deploy -DskipTests -Papache-release --settings /tmp/mvn-apache-settings.xml\n# publish org.apache.pulsar.tests:integration and it's parent pom org.apache.pulsar.tests:tests-parent\nmvn deploy -DskipTests -Papache-release --settings /tmp/mvn-apache-settings.xml -f tests/pom.xml -pl org.apache.pulsar.tests:tests-parent,org.apache.pulsar.tests:integration\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"NOTE"),": The ",(0,r.kt)("inlineCode",{parentName:"p"},"GPG_TTY")," environment variable must be set for all the following steps. Otherwise, some operations might fail by ",(0,r.kt)("inlineCode",{parentName:"p"},"gpg failed to sign the data"),".")),(0,r.kt)("p",null,"This will ask for the GPG key passphrase and then upload it to the staging repository."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"If you have deployed before, re-deploying might fail on pulsar-presto-connector-original."),(0,r.kt)("p",{parentName:"blockquote"},"See ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/pulsar/issues/17047"},"https://github.com/apache/pulsar/issues/17047"),"."),(0,r.kt)("p",{parentName:"blockquote"},"You can run ",(0,r.kt)("inlineCode",{parentName:"p"},"mvn clean deploy")," instead of ",(0,r.kt)("inlineCode",{parentName:"p"},"mvn deploy")," as a workaround.")),(0,r.kt)("p",null,"Log in to the ASF Nexus repository at ",(0,r.kt)("a",{parentName:"p",href:"https://repository.apache.org"},"https://repository.apache.org")),(0,r.kt)("p",null,'Click on "Staging Repositories" on the left sidebar and then select the current\nPulsar staging repo. This should be called something like ',(0,r.kt)("inlineCode",{parentName:"p"},"orgapachepulsar-XYZ"),"."),(0,r.kt)("p",null,'Use the "Close" button to close the repository. This operation will take few\nminutes. Once complete click "Refresh" and now a link to the staging repository\nshould be available, something like\n',(0,r.kt)("a",{parentName:"p",href:"https://repository.apache.org/content/repositories/orgapachepulsar-XYZ"},"https://repository.apache.org/content/repositories/orgapachepulsar-XYZ")),(0,r.kt)("h2",{id:"publish-release-candidate-docker-images"},"Publish release candidate docker images"),(0,r.kt)("p",null,"Run the following commands:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"cd $PULSAR_HOME/docker\n./build.sh\nDOCKER_USER=<your-username> DOCKER_PASSWORD=<your-password> DOCKER_ORG=<your-username> ./publish.sh\n")),(0,r.kt)("p",null,"After that, the following images will be built and pushed to your own DockerHub account."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"pulsar"),(0,r.kt)("li",{parentName:"ul"},"pulsar-all"),(0,r.kt)("li",{parentName:"ul"},"pulsar-grafana"),(0,r.kt)("li",{parentName:"ul"},"pulsar-standalone")),(0,r.kt)("h2",{id:"run-the-vote"},"Run the vote"),(0,r.kt)("p",null,"Send an email to the Pulsar Dev mailing list:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"To: dev@pulsar.apache.org\nSubject: [VOTE] Pulsar Release 2.X.0 Candidate 1\n\nThis is the first release candidate for Apache Pulsar, version 2.X.0.\n\nIt fixes the following issues:\nhttps://github.com/apache/pulsar/milestone/8?closed=1\n\n*** Please download, test and vote on this release. This vote will stay open\nfor at least 72 hours ***\n\nNote that we are voting upon the source (tag), binaries are provided for\nconvenience.\n\nSource and binary files:\nhttps://dist.apache.org/repos/dist/dev/pulsar/pulsar-2.X.0-candidate-1/\n\nSHA-512 checksums:\n028313cbbb24c5647e85a6df58a48d3c560aacc9  apache-pulsar-2.X.0-SNAPSHOT-bin.tar.gz\nf7cc55137281d5257e3c8127e1bc7016408834b1  apache-pulsar-2.x.0-SNAPSHOT-src.tar.gz\n\nMaven staging repo:\nhttps://repository.apache.org/content/repositories/orgapachepulsar-169/\n\nThe tag to be voted upon:\nv2.X.0-candidate-1 (21f4a4cffefaa9391b79d79a7849da9c539af834)\nhttps://github.com/apache/pulsar/releases/tag/v2.X.0-candidate-1\n\nPulsar's KEYS file containing PGP keys you use to sign the release:\nhttps://dist.apache.org/repos/dist/dev/pulsar/KEYS\n\nDocker images:\n\n<link of the pulsar images>\n\n<link of the pulsar-all image>\n\nPlease download the source package, and follow the README to build\nand run the Pulsar standalone service.\n")),(0,r.kt)("p",null,"The vote should be open for at least 72 hours (3 days). Votes from Pulsar PMC members\nwill be considered binding, while anyone else is encouraged to verify the release and\nvote as well."),(0,r.kt)("p",null,"If the release is approved here, you can then proceed to the next step. Otherwise, you should repeat the previous steps and prepare another candidate release to vote."),(0,r.kt)("h2",{id:"move-master-branch-to-next-version"},"Move master branch to next version"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"NOTE"),": This step is for major releases only.")),(0,r.kt)("p",null,"You need to move the master version to the next iteration ",(0,r.kt)("inlineCode",{parentName:"p"},"Y")," (",(0,r.kt)("inlineCode",{parentName:"p"},"X + 1"),")."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"git checkout master\n./src/set-project-version.sh 2.Y.0-SNAPSHOT\n\ngit commit -m 'Bumped version to 2.Y.0-SNAPSHOT' -a\n")),(0,r.kt)("p",null,"Since this needs to be merged into ",(0,r.kt)("inlineCode",{parentName:"p"},"master"),", you need to follow the regular process\nand create a Pull Request on GitHub."),(0,r.kt)("h2",{id:"promote-the-release"},"Promote the release"),(0,r.kt)("p",null,"Create the final git tag:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"git tag -u $USER@apache.org v2.X.0 -m 'Release v2.X.0'\ngit push origin v2.X.0\n")),(0,r.kt)("p",null,"Promote the artifacts on the release location(repo ",(0,r.kt)("a",{parentName:"p",href:"https://dist.apache.org/repos/dist/release"},"https://dist.apache.org/repos/dist/release")," limited to PMC, You may need a PMC member's help if you are not one):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'svn move -m "Release Apache Pulsar 2.X.Y" https://dist.apache.org/repos/dist/dev/pulsar/pulsar-2.X.0-candidate-1 \\\n         https://dist.apache.org/repos/dist/release/pulsar/pulsar-2.X.0\n')),(0,r.kt)("p",null,"Promote the Maven staging repository for release. Login to ",(0,r.kt)("inlineCode",{parentName:"p"},"https://repository.apache.org")," and\nselect the staging repository associated with the RC candidate that was approved. The naming\nwill be like ",(0,r.kt)("inlineCode",{parentName:"p"},"orgapachepulsar-XYZ"),'. Select the repository and click on "Release". Artifacts\nwill now be made available on Maven central.'),(0,r.kt)("h2",{id:"publish-docker-images"},"Publish Docker Images"),(0,r.kt)("p",null,"Copy the approved candidate docker images from your personal account to apachepulsar org."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'PULSAR_VERSION=2.x.x\nOTHER_DOCKER_USER=otheruser\nfor image in pulsar pulsar-all pulsar-grafana pulsar-standalone; do\n    docker pull "${OTHER_DOCKER_USER}/$image:${PULSAR_VERSION}" && {\n      docker tag "${OTHER_DOCKER_USER}/$image:${PULSAR_VERSION}" "apachepulsar/$image:${PULSAR_VERSION}"\n      echo "Pushing apachepulsar/$image:${PULSAR_VERSION}"\n      docker push "apachepulsar/$image:${PULSAR_VERSION}"\n    }\ndone\n')),(0,r.kt)("p",null,"If you don't have the permission, you can ask someone with access to apachepulsar org to do that."),(0,r.kt)("h2",{id:"release-helm-chart"},"Release Helm Chart"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"This step can be skipped if the major version number is not the latest.")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Bump the image version in the Helm Chart: ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/pulsar-helm-chart/blob/master/charts/pulsar/values.yaml"},"charts/pulsar/values.yaml"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Bump the chart version and ",(0,r.kt)("inlineCode",{parentName:"p"},"appVersion")," in the Helm Chart to the released version: ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/pulsar-helm-chart/blob/master/charts/pulsar/Chart.yaml"},"charts/pulsar/Chart.yaml"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Send a pull request for reviews and get it merged.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Once it is merged, the chart will be automatically released to Github releases at ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/pulsar-helm-chart"},"https://github.com/apache/pulsar-helm-chart")," and updated to ",(0,r.kt)("a",{parentName:"p",href:"https://pulsar.apache.org/charts"},"https://pulsar.apache.org/charts"),"."))),(0,r.kt)("h2",{id:"publish-python-clients"},"Publish Python Clients"),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("ol",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ol"},"You need to create an account on PyPI: ",(0,r.kt)("a",{parentName:"li",href:"https://pypi.org/account/register/"},"https://pypi.org/account/register/")),(0,r.kt)("li",{parentName:"ol"},"Ask anyone that has been a release manager before to add you as a maintainer for pulsar-docker on PyPI"),(0,r.kt)("li",{parentName:"ol"},"Once you have completed the following steps in this section, you can check if the wheels are uploaded successfully in ",(0,r.kt)("a",{parentName:"li",href:"https://pypi.org/project/pulsar-client/#files"},"Download files"),". Remember to switch to the correct version in ",(0,r.kt)("a",{parentName:"li",href:"https://pypi.org/project/pulsar-client/#history"},"Release history"),")."))),(0,r.kt)("h3",{id:"linux"},"Linux"),(0,r.kt)("p",null,"There is a script that builds and packages the Python client inside Docker images."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Make sure you run following command at the release tag!")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"pulsar-client-cpp/docker/build-wheels.sh\n")),(0,r.kt)("p",null,"The wheel files will be left under ",(0,r.kt)("inlineCode",{parentName:"p"},"pulsar-client-cpp/python/wheelhouse"),". Make sure all the files have ",(0,r.kt)("inlineCode",{parentName:"p"},"manylinux")," in the filenames. Otherwise, those files will not be able to upload to PyPI."),(0,r.kt)("p",null,"Run the following command to push the built wheel files."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"cd pulsar-client-cpp/python/wheelhouse\npip install twine\ntwine upload pulsar_client-*.whl\n")),(0,r.kt)("h3",{id:"macos"},"MacOS"),(0,r.kt)("p",null,"There is a script that builds and packages the Python client inside Docker images."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"pulsar-client-cpp/python/build-mac-wheels.sh\n")),(0,r.kt)("p",null,"The wheel files will be generated at each platform directory under ",(0,r.kt)("inlineCode",{parentName:"p"},"pulsar-client-cpp/python/pkg/osx/"),".\nThen you can run ",(0,r.kt)("inlineCode",{parentName:"p"},"twin upload")," to upload those wheel files."),(0,r.kt)("h2",{id:"update-python-client-docs"},"Update Python Client docs"),(0,r.kt)("p",null,"After publishing the python client docs, run the following script from the apache/pulsar-site ",(0,r.kt)("inlineCode",{parentName:"p"},"main")," branch:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"PULSAR_VERSION=2.X.Y ./site2/tools/apidoc/python/pdoc-generator.sh\n")),(0,r.kt)("p",null,"Note that it builds the docs within a docker image, so you'll need to have docker running."),(0,r.kt)("p",null,"Once the docs are generated, you can add them and submit them in a PR. The expected doc output is ",(0,r.kt)("inlineCode",{parentName:"p"},"site2/website/static/api/python"),"."),(0,r.kt)("h2",{id:"publish-homebrew-libpulsar-package"},"Publish Homebrew libpulsar package"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"This step can be skipped if the major version number is not the latest.")),(0,r.kt)("p",null,"Release a new version of libpulsar for Homebrew, You can follow the example ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/Homebrew/homebrew-core/pull/53514"},"here"),"."),(0,r.kt)("h2",{id:"update-swagger-file"},"Update swagger file"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"For major releases, the swagger file update happen under ",(0,r.kt)("inlineCode",{parentName:"p"},"master")," branch.\nwhile for minor releases, swagger file is created from branch-2.x, and need copy to a new branch based on master.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"git checkout branch-2.X\nmvn -am -pl pulsar-broker install -DskipTests -Pswagger\ngit checkout master\ngit checkout -b fix/swagger-file\nmkdir -p site2/website/static/swagger/2.X.0\ncp pulsar-broker/target/docs/*.json site2/website/static/swagger/2.X.0\n")),(0,r.kt)("p",null,"Send out a PR request for review."),(0,r.kt)("h2",{id:"write-release-notes"},"Write release notes"),(0,r.kt)("p",null,"See ",(0,r.kt)("a",{parentName:"p",href:"/contribute/release-note-guide"},"Pulsar Release Notes Guide"),"."),(0,r.kt)("h2",{id:"update-the-site"},"Update the site"),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"This step is for major releases only.")),(0,r.kt)("p",null,"For major releases, such as 2.10.0, the website is updated based on the ",(0,r.kt)("inlineCode",{parentName:"p"},"master")," branch."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Create a new branch off master.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"git checkout -b doc_release_<release-version>\n")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"Go to the website directory.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"cd site2/website\n")),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"Generate a new version of the documentation.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"yarn install\nyarn run version <release-version>\n")),(0,r.kt)("p",null,"After you run this command, a new folder ",(0,r.kt)("inlineCode",{parentName:"p"},"version-<release-version>")," is added in the ",(0,r.kt)("inlineCode",{parentName:"p"},"site2/website/versioned_docs")," directory, a new sidebar file ",(0,r.kt)("inlineCode",{parentName:"p"},"version-<release-version>-sidebars.json")," is added in the ",(0,r.kt)("inlineCode",{parentName:"p"},"site2/website/versioned_sidebars")," directory, and the new version is added in the ",(0,r.kt)("inlineCode",{parentName:"p"},"versions.json")," file, shown as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"versioned_docs/version-<release-version>\nversioned_sidebars/version-<release-version>-sidebars.json\n")),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"You can move the latest version under the old version in the ",(0,r.kt)("inlineCode",{parentName:"p"},"versions.json")," file. Make sure the Algolia index works before moving 2.X.0 as the current stable.")),(0,r.kt)("ol",{start:4},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Update the ",(0,r.kt)("inlineCode",{parentName:"p"},"releases.json")," file by adding ",(0,r.kt)("inlineCode",{parentName:"p"},"<release-version>")," to the second of the list (this is to make the search work. After your PR is merged, the Pulsar website is built and tagged for search, you can change it to the first list).")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Send out a PR request for review."),(0,r.kt)("p",{parentName:"li"},"After your PR is approved and merged to master, the website is published automatically after the new website is built. The website is built every 6 hours.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Check the new website after the website is built. Open ",(0,r.kt)("a",{parentName:"p",href:"https://pulsar.apache.org"},"https://pulsar.apache.org")," in your browsers to verify all the changes are alive. If the website build succeeds but the website is not updated, you can try to sync the git repository. Navigate to ",(0,r.kt)("a",{parentName:"p",href:"https://selfserve.apache.org/"},"https://selfserve.apache.org/"),' and click the "Synchronize Git Repositories" and then select apache/pulsar.')),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Publish the release on GitHub, and copy the same release notes: ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/pulsar/releases"},"https://github.com/apache/pulsar/releases"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Update the deploy version to the current release version in ",(0,r.kt)("inlineCode",{parentName:"p"},"deployment/terraform-ansible/deploy-pulsar.yaml"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Generate the doc set and sidebar file for the next major release ",(0,r.kt)("inlineCode",{parentName:"p"},"2.X.x")," based on the ",(0,r.kt)("inlineCode",{parentName:"p"},"site2/docs")," folder. You can follow steps 1, 2, and 3, and submit those files to the ",(0,r.kt)("inlineCode",{parentName:"p"},"apache/pulsar")," repository. This step is a preparation for the ",(0,r.kt)("inlineCode",{parentName:"p"},"2.X.x")," release."))),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"Starting from 2.8.0, you don't need to generate an independent doc set or update the Pulsar site for minor releases, such as 2.8.1, 2.8.2, and so on. Instead, the generic doc set 2.8.x is used.")),(0,r.kt)("h2",{id:"announce-the-release"},"Announce the release"),(0,r.kt)("p",null,"Once the release artifacts are available in the Apache Mirrors and the website is updated,\nwe need to announce the release."),(0,r.kt)("p",null,"Send an email to these lines:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"To: dev@pulsar.apache.org, users@pulsar.apache.org, announce@apache.org\nSubject: [ANNOUNCE] Apache Pulsar 2.X.0 released\n\nThe Apache Pulsar team is proud to announce Apache Pulsar version 2.X.0.\n\nPulsar is a highly scalable, low latency messaging platform running on\ncommodity hardware. It provides simple pub-sub semantics over topics,\nguaranteed at-least-once delivery of messages, automatic cursor management for\nsubscribers, and cross-datacenter replication.\n\nFor Pulsar release details and downloads, visit:\n\nhttps://pulsar.apache.org/download\n\nRelease Notes are at:\nhttps://pulsar.apache.org/release-notes\n\nWe would like to thank the contributors that made the release possible.\n\nRegards,\n\nThe Pulsar Team\n")),(0,r.kt)("p",null,"Send the email in plain text mode since the ",(0,r.kt)("a",{parentName:"p",href:"mailto:announce@apache.org"},"announce@apache.org")," mailing list will reject messages with text/html content.\nIn Gmail, there's an option to set ",(0,r.kt)("inlineCode",{parentName:"p"},"Plain text mode")," in the ",(0,r.kt)("inlineCode",{parentName:"p"},"\u22ee"),"/ ",(0,r.kt)("inlineCode",{parentName:"p"},"More options")," menu."),(0,r.kt)("h2",{id:"write-a-blog-post-for-the-release-optional"},"Write a blog post for the release (optional)"),(0,r.kt)("p",null,"It is encouraged to write a blog post to summarize the features introduced in this release,\nespecially for feature releases.\nYou can follow the example ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/pulsar/pull/2308"},"here")),(0,r.kt)("h2",{id:"remove-old-releases"},"Remove old releases"),(0,r.kt)("p",null,"Remove the old releases (if any). You only need the latest release there, and older releases are\navailable through the Apache archive:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"# Get the list of releases\nsvn ls https://dist.apache.org/repos/dist/release/pulsar\n\n# Delete each release (except for the last one)\nsvn rm https://dist.apache.org/repos/dist/release/pulsar/pulsar-2.Y.0\n")),(0,r.kt)("h2",{id:"move-release-branch-to-next-version"},"Move release branch to next version"),(0,r.kt)("p",null,"Run the following commands in the release branches."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"./src/set-project-version.sh 2.X.Y-SNAPSHOT\n\ngit commit -m 'Bumped version to 2.X.Y-SNAPSHOT' -a\ngit push origin branch-2.X\n")))}h.isMDXComponent=!0}}]);