"use strict";(self.webpackChunkwebsite_next=self.webpackChunkwebsite_next||[]).push([[31833],{91562:(e,s,t)=>{t.r(s),t.d(s,{assets:()=>l,contentTitle:()=>a,default:()=>d,frontMatter:()=>r,metadata:()=>n,toc:()=>c});var n=t(15322),i=t(74848),o=t(28453);const r={title:"What\u2019s New in Apache Pulsar 2.7.5",date:new Date("2022-09-09T00:00:00.000Z"),author:"Jason918, momo-jun"},a=void 0,l={authorsImageUrls:[void 0]},c=[{value:"Fixed the deadlock on metadata cache missing while checking replications. PR-16889",id:"fixed-the-deadlock-on-metadata-cache-missing-while-checking-replications-pr-16889",level:3},{value:"Issue",id:"issue",level:4},{value:"Resolution",id:"resolution",level:4},{value:"Fixed the deadlock when using the key_shared mode. PR-11965",id:"fixed-the-deadlock-when-using-the-key_shared-mode-pr-11965",level:3},{value:"Issue",id:"issue-1",level:4},{value:"Resolution",id:"resolution-1",level:4},{value:"Fixed the message loss issue due to ledger rollover. PR-14703",id:"fixed-the-message-loss-issue-due-to-ledger-rollover-pr-14703",level:3},{value:"Issue",id:"issue-2",level:4},{value:"Resolution",id:"resolution-2",level:4},{value:"Fixed the port exhaustion and connection issues in Pulsar Proxy. PR-14078",id:"fixed-the-port-exhaustion-and-connection-issues-in-pulsar-proxy-pr-14078",level:3},{value:"Issue",id:"issue-3",level:4},{value:"Resolution",id:"resolution-3",level:4},{value:"Fixed the compaction data loss due to missed compaction properties during cursor reset. PR-16404",id:"fixed-the-compaction-data-loss-due-to-missed-compaction-properties-during-cursor-reset-pr-16404",level:3},{value:"Issue",id:"issue-4",level:4},{value:"Resolution",id:"resolution-4",level:4}];function h(e){const s={a:"a",code:"code",h1:"h1",h3:"h3",h4:"h4",p:"p",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.p,{children:"The Apache Pulsar community releases version 2.7.5! 23 contributors provided improvements and bug fixes that delivered 89 commits. Thanks for all your contributions."}),"\n",(0,i.jsx)(s.p,{children:"The highlight of the 2.7.5 release is that it fixes some critical bugs on broker, proxy, and storage, including message/data loss, broker deadlock, and connection leak. Note that 2.7.5 is the last release of 2.7.x."}),"\n",(0,i.jsxs)(s.p,{children:["This blog walks through the most noteworthy changes. For the complete list, including all feature enhancements and bug fixes, check out the ",(0,i.jsx)(s.a,{href:"https://pulsar.apache.org/release-notes/versioned/pulsar-2.7.5/",children:"Pulsar 2.7.5 Release Notes"}),"."]}),"\n",(0,i.jsxs)(s.h3,{id:"fixed-the-deadlock-on-metadata-cache-missing-while-checking-replications-pr-16889",children:["Fixed the deadlock on metadata cache missing while checking replications. ",(0,i.jsx)(s.a,{href:"https://github.com/apache/pulsar/pull/16889",children:"PR-16889"})]}),"\n",(0,i.jsx)(s.h4,{id:"issue",children:"Issue"}),"\n",(0,i.jsxs)(s.p,{children:["After the changes in ",(0,i.jsx)(s.a,{href:"https://github.com/apache/pulsar/pull/12340",children:"#12340"}),", there are still a couple of places making blocking calls. These calls occupy all the ordered scheduler threads preventing the callbacks from completing until the 30 seconds timeout expires."]}),"\n",(0,i.jsx)(s.h4,{id:"resolution",children:"Resolution"}),"\n",(0,i.jsx)(s.p,{children:"Change the blocking calls to async mode on the metadata callback thread."}),"\n",(0,i.jsxs)(s.h3,{id:"fixed-the-deadlock-when-using-the-key_shared-mode-pr-11965",children:["Fixed the deadlock when using the key_shared mode. ",(0,i.jsx)(s.a,{href:"https://github.com/apache/pulsar/pull/11965",children:"PR-11965"})]}),"\n",(0,i.jsx)(s.h4,{id:"issue-1",children:"Issue"}),"\n",(0,i.jsxs)(s.p,{children:["When the key_shared mode is used in consumers, deadlock may happen in the broker due to some race conditions and result in a lot of ",(0,i.jsx)(s.code,{children:"CLOSE_WAIT"})," status connections."]}),"\n",(0,i.jsx)(s.h4,{id:"resolution-1",children:"Resolution"}),"\n",(0,i.jsxs)(s.p,{children:["Change unlock before the callback in the ",(0,i.jsx)(s.code,{children:"asyncDelete"})," function of ",(0,i.jsx)(s.code,{children:"ManagedCursorImpl"}),"."]}),"\n",(0,i.jsxs)(s.h3,{id:"fixed-the-message-loss-issue-due-to-ledger-rollover-pr-14703",children:["Fixed the message loss issue due to ledger rollover. ",(0,i.jsx)(s.a,{href:"https://github.com/apache/pulsar/pull/14703",children:"PR-14703"})]}),"\n",(0,i.jsx)(s.h4,{id:"issue-2",children:"Issue"}),"\n",(0,i.jsxs)(s.p,{children:["If users config ",(0,i.jsx)(s.code,{children:"managedLedgerMaxLedgerRolloverTimeMinutes > 0"}),", and the rollover happens when the ManagedLedger state is ",(0,i.jsx)(s.code,{children:"CreatingLedger"}),", the messages written during that time are lost."]}),"\n",(0,i.jsx)(s.h4,{id:"resolution-2",children:"Resolution"}),"\n",(0,i.jsxs)(s.p,{children:["Rollover only when the ledger state is ",(0,i.jsx)(s.code,{children:"LedgerOpened"}),"."]}),"\n",(0,i.jsxs)(s.h3,{id:"fixed-the-port-exhaustion-and-connection-issues-in-pulsar-proxy-pr-14078",children:["Fixed the port exhaustion and connection issues in Pulsar Proxy. ",(0,i.jsx)(s.a,{href:"https://github.com/apache/pulsar/pull/14078",children:"PR-14078"})]}),"\n",(0,i.jsx)(s.h4,{id:"issue-3",children:"Issue"}),"\n",(0,i.jsx)(s.p,{children:"Pulsar Proxy can get into a state where it stops proxying Broker connections while Admin API proxying keeps working."}),"\n",(0,i.jsx)(s.h4,{id:"resolution-3",children:"Resolution"}),"\n",(0,i.jsx)(s.p,{children:"Optimize the proxy connection to fail-fast when the target broker isn't active.\nFix the race conditions in Pulsar Proxy when establishing a connection, leading to invalid states and hanging connections.\nAdd connection timeout handling to proxy connections.\nAdd read timeout handling to incoming connections and proxied connections."}),"\n",(0,i.jsxs)(s.h3,{id:"fixed-the-compaction-data-loss-due-to-missed-compaction-properties-during-cursor-reset-pr-16404",children:["Fixed the compaction data loss due to missed compaction properties during cursor reset. ",(0,i.jsx)(s.a,{href:"https://github.com/apache/pulsar/pull/16404",children:"PR-16404"})]}),"\n",(0,i.jsx)(s.h4,{id:"issue-4",children:"Issue"}),"\n",(0,i.jsx)(s.p,{children:"The compaction reader seeks the earliest position to read data from the topic, but the compaction properties are missed during cursor reset, which leads to the initialized compaction subscribe without a compaction horizon, so the compaction reader skips the last compacted data. It only happens when initializing the compaction subscription and can be introduced by the load balance or topic unloading manually."}),"\n",(0,i.jsx)(s.h4,{id:"resolution-4",children:"Resolution"}),"\n",(0,i.jsx)(s.p,{children:"Keep the properties for resetting the cursor while the cursor is for data compaction.\nCopy the properties to the new mark delete entry while advancing the cursor, which is triggered by the managed ledger internal. It's not only for the compacted topic, and the internal task should not lose the properties when trimming the cursor."}),"\n",(0,i.jsx)(s.h1,{id:"whats-next",children:"What\u2019s Next?"}),"\n",(0,i.jsxs)(s.p,{children:["If you are interested in learning more about Pulsar 2.7.5, you can ",(0,i.jsx)(s.a,{href:"https://pulsar.apache.org/en/versions/",children:"download"})," and try it out now!"]}),"\n",(0,i.jsxs)(s.p,{children:["For more information about the Apache Pulsar project and current progress, visit the ",(0,i.jsx)(s.a,{href:"https://pulsar.apache.org",children:"Pulsar website"}),", follow the project on Twitter ",(0,i.jsx)(s.a,{href:"https://twitter.com/apache_pulsar",children:"@apache_pulsar"}),", and join ",(0,i.jsx)(s.a,{href:"https://apache-pulsar.herokuapp.com/",children:"Pulsar Slack"}),"!"]})]})}function d(e={}){const{wrapper:s}={...(0,o.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},28453:(e,s,t)=>{t.d(s,{R:()=>r,x:()=>a});var n=t(96540);const i={},o=n.createContext(i);function r(e){const s=n.useContext(o);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),n.createElement(o.Provider,{value:s},e.children)}},15322:e=>{e.exports=JSON.parse('{"permalink":"/blog/2022/09/09/Apache-Pulsar-2-7-5","editUrl":"https://github.com/apache/pulsar-site/edit/main/blog/2022-09-09-Apache-Pulsar-2-7-5.md","source":"@site/blog/2022-09-09-Apache-Pulsar-2-7-5.md","title":"What\u2019s New in Apache Pulsar 2.7.5","description":"The Apache Pulsar community releases version 2.7.5! 23 contributors provided improvements and bug fixes that delivered 89 commits. Thanks for all your contributions.","date":"2022-09-09T00:00:00.000Z","tags":[],"readingTime":2.555,"hasTruncateMarker":true,"authors":[{"name":"Jason918, momo-jun","key":null,"page":null}],"frontMatter":{"title":"What\u2019s New in Apache Pulsar 2.7.5","date":"2022-09-09T00:00:00.000Z","author":"Jason918, momo-jun"},"unlisted":false,"prevItem":{"title":"Announcing Conference Schedule for Pulsar Summit Asia 2022","permalink":"/blog/2022/11/04/pulsar-summit-asia-2022-schedule-announced"},"nextItem":{"title":"Pulsar Summit Asia 2022: CFP Is Open Now!","permalink":"/blog/2022/08/22/pulsar-summit-asia-2022-cfp"}}')}}]);