"use strict";(self.webpackChunkwebsite_next=self.webpackChunkwebsite_next||[]).push([[1748],{98054:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"client-libraries-go-use","title":"Use Pulsar Go client","description":"Learn how to use Go client in Pulsar.","source":"@site/versioned_docs/version-3.2.x/client-libraries-go-use.md","sourceDirName":".","slug":"/client-libraries-go-use","permalink":"/docs/3.2.x/client-libraries-go-use","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/pulsar-site/edit/main/versioned_docs/version-3.2.x/client-libraries-go-use.md","tags":[],"version":"3.2.x","frontMatter":{"id":"client-libraries-go-use","title":"Use Pulsar Go client","sidebar_label":"Use","description":"Learn how to use Go client in Pulsar."},"sidebar":"docsSidebar","previous":{"title":"Initialize","permalink":"/docs/3.2.x/client-libraries-go-initialize"},"next":{"title":"Python client","permalink":"/docs/3.2.x/client-libraries-python"}}');var t=r(74848),i=r(28453);const o={id:"client-libraries-go-use",title:"Use Pulsar Go client",sidebar_label:"Use",description:"Learn how to use Go client in Pulsar."},a=void 0,l={},c=[{value:"Create a producer",id:"create-a-producer",level:2},{value:"Monitor",id:"monitor",level:3},{value:"Create a consumer",id:"create-a-consumer",level:2},{value:"Create a single-topic consumer",id:"create-a-single-topic-consumer",level:3},{value:"Create a regex-topic consumer",id:"create-a-regex-topic-consumer",level:3},{value:"Monitor",id:"monitor-1",level:3},{value:"Create a reader",id:"create-a-reader",level:2}];function u(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"create-a-producer",children:"Create a producer"}),"\n",(0,t.jsxs)(n.p,{children:["You can ",(0,t.jsx)(n.a,{href:"#producer-configuration",children:"configure"})," Go producers using a ",(0,t.jsx)(n.code,{children:"ProducerOptions"})," object. Here's an example:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'producer, err := client.CreateProducer(pulsar.ProducerOptions{\n    Topic: "my-topic",\n})\n\nif err != nil {\n    log.Fatal(err)\n}\n\n_, err = producer.Send(context.Background(), &pulsar.ProducerMessage{\n    Payload: []byte("hello"),\n})\n\ndefer producer.Close()\n\nif err != nil {\n    fmt.Println("Failed to publish message", err)\n}\nfmt.Println("Published message")\n'})}),"\n",(0,t.jsxs)(n.p,{children:["For all available methods of ",(0,t.jsx)(n.code,{children:"Producer"})," interface, see ",(0,t.jsx)(n.a,{href:"https://pkg.go.dev/github.com/apache/pulsar-client-go/pulsar#Producer",children:"here"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"monitor",children:"Monitor"}),"\n",(0,t.jsx)(n.p,{children:"Pulsar Go client registers client metrics using Prometheus. This section demonstrates how to create a simple Pulsar producer application that exposes Prometheus metrics via HTTP."}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Write a simple producer application."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'// Create a Pulsar client\nclient, err := pulsar.NewClient(pulsar.ClientOptions{\n    URL: "pulsar://localhost:6650",\n})\nif err != nil {\n    log.Fatal(err)\n}\n\ndefer client.Close()\n\n// Start a separate goroutine for Prometheus metrics\n// In this case, Prometheus metrics can be accessed via http://localhost:2112/metrics\ngo func() {\n    prometheusPort := 2112\n    log.Printf("Starting Prometheus metrics at http://localhost:%v/metrics\\n", prometheusPort)\n    http.Handle("/metrics", promhttp.Handler())\n    err = http.ListenAndServe(":"+strconv.Itoa(prometheusPort), nil)\n    if err != nil {\n        log.Fatal(err)\n    }\n}()\n\n// Create a producer\nproducer, err := client.CreateProducer(pulsar.ProducerOptions{\n    Topic: "topic-1",\n})\nif err != nil {\n    log.Fatal(err)\n}\n\ndefer producer.Close()\n\nctx := context.Background()\n\n// Write your business logic here\n// In this case, you build a simple Web server. You can produce messages by requesting http://localhost:8082/produce\nwebPort := 8082\nhttp.HandleFunc("/produce", func(w http.ResponseWriter, r *http.Request) {\n    msgId, err := producer.Send(ctx, &pulsar.ProducerMessage{\n        Payload: []byte(fmt.Sprintf("hello world")),\n    })\n    if err != nil {\n        log.Fatal(err)\n    } else {\n        log.Printf("Published message: %v", msgId)\n        fmt.Fprintf(w, "Published message: %v", msgId)\n    }\n})\n\nerr = http.ListenAndServe(":"+strconv.Itoa(webPort), nil)\nif err != nil {\n    log.Fatal(err)\n}\n'})}),"\n",(0,t.jsxs)(n.ol,{start:"2",children:["\n",(0,t.jsxs)(n.li,{children:["To scrape metrics from applications, configure a local running Prometheus instance using a configuration file (",(0,t.jsx)(n.code,{children:"prometheus.yml"}),")."]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"scrape_configs:\n- job_name: pulsar-client-go-metrics\n  scrape_interval: 10s\n  static_configs:\n  - targets:\n  - localhost:2112\n"})}),"\n",(0,t.jsx)(n.h2,{id:"create-a-consumer",children:"Create a consumer"}),"\n",(0,t.jsxs)(n.p,{children:["Pulsar consumers subscribe to one or more Pulsar topics and listen for incoming messages produced on that topic/those topics. You can configure Go consumers using a ",(0,t.jsx)(n.code,{children:"ConsumerOptions"})," object."]}),"\n",(0,t.jsx)(n.p,{children:"Here's a basic example that uses channels:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'consumer, err := client.Subscribe(pulsar.ConsumerOptions{\n    Topic:            "topic-1",\n    SubscriptionName: "my-sub",\n    Type:             pulsar.Shared,\n})\nif err != nil {\n    log.Fatal(err)\n}\ndefer consumer.Close()\n\nfor i := 0; i < 10; i++ {\n    // may block here\n    msg, err := consumer.Receive(context.Background())\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Printf("Received message msgId: %#v -- content: \'%s\'\\n",\n        msg.ID(), string(msg.Payload()))\n\n    consumer.Ack(msg)\n}\n\nif err := consumer.Unsubscribe(); err != nil {\n    log.Fatal(err)\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["For all available methods of ",(0,t.jsx)(n.code,{children:"Consumer"})," interface, see ",(0,t.jsx)(n.a,{href:"https://pkg.go.dev/github.com/apache/pulsar-client-go/pulsar#Consumer",children:"here"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"create-a-single-topic-consumer",children:"Create a single-topic consumer"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'client, err := pulsar.NewClient(pulsar.ClientOptions{URL: "pulsar://localhost:6650"})\nif err != nil {\n    log.Fatal(err)\n}\n\ndefer client.Close()\n\nconsumer, err := client.Subscribe(pulsar.ConsumerOptions{\n    // fill `Topic` field will create a single-topic consumer\n    Topic:            "topic-1",\n    SubscriptionName: "my-sub",\n    Type:             pulsar.Shared,\n})\nif err != nil {\n    log.Fatal(err)\n}\ndefer consumer.Close()\n'})}),"\n",(0,t.jsx)(n.h3,{id:"create-a-regex-topic-consumer",children:"Create a regex-topic consumer"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'client, err := pulsar.NewClient(pulsar.ClientOptions{\n    URL: "pulsar://localhost:6650",\n})\ndefer client.Close()\n\ntopicsPattern := "persistent://public/default/topic.*"\nopts := pulsar.ConsumerOptions{\n    // fill `TopicsPattern` field will create a regex consumer\n    TopicsPattern:    topicsPattern,\n    SubscriptionName: "regex-sub",\n}\n\nconsumer, err := client.Subscribe(opts)\nif err != nil {\n    log.Fatal(err)\n}\ndefer consumer.Close()\n'})}),"\n",(0,t.jsx)(n.h3,{id:"monitor-1",children:"Monitor"}),"\n",(0,t.jsx)(n.p,{children:"In this guide, This section demonstrates how to create a simple Pulsar consumer application that exposes Prometheus metrics via HTTP."}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Write a simple consumer application."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'// Create a Pulsar client\nclient, err := pulsar.NewClient(pulsar.ClientOptions{\n    URL: "pulsar://localhost:6650",\n})\nif err != nil {\n    log.Fatal(err)\n}\n\ndefer client.Close()\n\n// Start a separate goroutine for Prometheus metrics\n// In this case, Prometheus metrics can be accessed via http://localhost:2112/metrics\ngo func() {\n    prometheusPort := 2112\n    log.Printf("Starting Prometheus metrics at http://localhost:%v/metrics\\n", prometheusPort)\n    http.Handle("/metrics", promhttp.Handler())\n    err = http.ListenAndServe(":"+strconv.Itoa(prometheusPort), nil)\n    if err != nil {\n        log.Fatal(err)\n    }\n}()\n\n// Create a consumer\nconsumer, err := client.Subscribe(pulsar.ConsumerOptions{\n    Topic:            "topic-1",\n    SubscriptionName: "sub-1",\n    Type:             pulsar.Shared,\n})\nif err != nil {\n    log.Fatal(err)\n}\n\ndefer consumer.Close()\n\nctx := context.Background()\n\n// Write your business logic here\n// In this case, you build a simple Web server. You can consume messages by requesting http://localhost:8083/consume\nwebPort := 8083\nhttp.HandleFunc("/consume", func(w http.ResponseWriter, r *http.Request) {\n    msg, err := consumer.Receive(ctx)\n    if err != nil {\n        log.Fatal(err)\n    } else {\n        log.Printf("Received message msgId: %v -- content: \'%s\'\\n", msg.ID(), string(msg.Payload()))\n        fmt.Fprintf(w, "Received message msgId: %v -- content: \'%s\'\\n", msg.ID(), string(msg.Payload()))\n        consumer.Ack(msg)\n    }\n})\n\nerr = http.ListenAndServe(":"+strconv.Itoa(webPort), nil)\nif err != nil {\n    log.Fatal(err)\n}\n'})}),"\n",(0,t.jsxs)(n.ol,{start:"2",children:["\n",(0,t.jsxs)(n.li,{children:["To scrape metrics from applications, configure a local running Prometheus instance using a configuration file (",(0,t.jsx)(n.code,{children:"prometheus.yml"}),")."]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"scrape_configs:\n- job_name: pulsar-client-go-metrics\n  scrape_interval: 10s\n  static_configs:\n  - targets:\n  - localhost: 2112\n"})}),"\n",(0,t.jsx)(n.h2,{id:"create-a-reader",children:"Create a reader"}),"\n",(0,t.jsxs)(n.p,{children:["Pulsar readers process messages from Pulsar topics. Readers are different from consumers because with readers you need to explicitly specify which message in the stream you want to begin with (consumers, on the other hand, automatically begin with the most recent unacked message). You can ",(0,t.jsx)(n.a,{href:"#reader-configuration",children:"configure"})," Go readers using a ",(0,t.jsx)(n.code,{children:"ReaderOptions"})," object. Here's an example:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'reader, err := client.CreateReader(pulsar.ReaderOptions{\n    Topic:          "topic-1",\n    StartMessageID: pulsar.EarliestMessageID(),\n})\nif err != nil {\n    log.Fatal(err)\n}\ndefer reader.Close()\n'})}),"\n",(0,t.jsxs)(n.p,{children:["For all available methods of the ",(0,t.jsx)(n.code,{children:"Reader"})," interface, see ",(0,t.jsx)(n.a,{href:"https://pkg.go.dev/github.com/apache/pulsar-client-go/pulsar#Reader",children:"here"}),"."]})]})}function d(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(u,{...e})}):u(e)}},28453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>a});var s=r(96540);const t={},i=s.createContext(t);function o(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);