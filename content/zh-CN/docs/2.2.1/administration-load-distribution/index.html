<!doctype html>
<html class="docs-version-2.2.1" lang="zh-CN" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="alternate" type="application/rss+xml" href="/zh-CN/blog/rss.xml" title="Apache Pulsar RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh-CN/blog/atom.xml" title="Apache Pulsar Atom Feed">
<script src="https://cdn.jsdelivr.net/npm/sine-waves@0.3.0/sine-waves.min.js" async></script><title data-react-helmet="true">Pulsar load distribution | Apache Pulsar</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://pulsar.apache.com/zh-CN/docs/2.2.1/administration-load-distribution"><meta data-react-helmet="true" name="docusaurus_locale" content="zh-CN"><meta data-react-helmet="true" name="docusaurus_version" content="2.2.1"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-2.2.1"><meta data-react-helmet="true" property="og:title" content="Pulsar load distribution | Apache Pulsar"><meta data-react-helmet="true" name="description" content="Load distribution across Pulsar brokers"><meta data-react-helmet="true" property="og:description" content="Load distribution across Pulsar brokers"><link data-react-helmet="true" rel="icon" href="/zh-CN/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://pulsar.apache.com/zh-CN/docs/2.2.1/administration-load-distribution"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.com/docs/2.2.1/administration-load-distribution" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.com/zh-CN/docs/2.2.1/administration-load-distribution" hreflang="zh-CN"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.com/zh-TW/docs/2.2.1/administration-load-distribution" hreflang="zh-TW"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.com/ja/docs/2.2.1/administration-load-distribution" hreflang="ja"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.com/fr/docs/2.2.1/administration-load-distribution" hreflang="fr"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.com/ko/docs/2.2.1/administration-load-distribution" hreflang="ko"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.com/docs/2.2.1/administration-load-distribution" hreflang="x-default"><link rel="stylesheet" href="/zh-CN/assets/css/styles.a6b2c038.css">
<link rel="preload" href="/zh-CN/assets/js/runtime~main.0e258294.js" as="script">
<link rel="preload" href="/zh-CN/assets/js/main.03a3894c.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="tailwind navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh-CN/"><div class="navbar__logo"><img src="/zh-CN/img/logo.svg" alt="pulasr logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/zh-CN/img/logo.svg" alt="pulasr logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title"></b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">Get Started</a><ul class="dropdown__menu"><li><a class="dropdown__link navbar__link--active" href="/zh-CN/docs/2.2.1/concepts-overview">Pulsar Concepts</a></li><li><a class="dropdown__link navbar__link--active" href="/zh-CN/docs/2.2.1/about">Quickstart</a></li><li><a class="dropdown__link" href="/zh-CN/ecosystem">Ecosystem</a></li></ul></div><a class="navbar__item navbar__link navbar__link--active" href="/zh-CN/docs/2.2.1/">Docs</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">REST APIs</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh-CN/admin-rest-api">Admin REST API</a></li><li><a class="dropdown__link" href="/zh-CN/functions-rest-api">Functions</a></li><li><a class="dropdown__link" href="/zh-CN/source-rest-api">Sources</a></li><li><a class="dropdown__link" href="/zh-CN/sink-rest-api">Sinks</a></li><li><a class="dropdown__link" href="/zh-CN/packages-rest-api">Packages</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">CLI</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh-CN/pulsar-admin-cli">Pulsar Admin</a></li><li><a class="dropdown__link" href="/zh-CN/pulsar-client-cli">Pulsar Client</a></li><li><a class="dropdown__link" href="/zh-CN/pulsar-perf-cli">Pulsar Perf</a></li><li><a class="dropdown__link" href="/zh-CN/pulsar-cli">Pulsar</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">Community</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh-CN/community#welcome">Welcome</a></li><li><a class="dropdown__link" href="/zh-CN/community#discussions">Discussions</a></li><li><a class="dropdown__link" href="/zh-CN/community#governance">Governance</a></li><li><a class="dropdown__link" href="/zh-CN/community#community">Meet the Community</a></li><li><a class="dropdown__link" href="/zh-CN/community#how-to-contribute">Contribute</a></li><li><a href="https://github.com/apache/pulsar/wiki" target="_blank" rel="noopener noreferrer" class="dropdown__link">Wiki</a></li><li><a href="https://github.com/apache/pulsar/issues" target="_blank" rel="noopener noreferrer" class="dropdown__link">Issue Tracking</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">Learn</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh-CN/blog">Blog</a></li><li><a class="dropdown__link" href="/zh-CN/case-studies">Case Studies</a></li><li><a class="dropdown__link" href="/zh-CN/resources">Resources</a></li><li><a class="dropdown__link" href="/zh-CN/events">Events</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" class="iconLanguage_zID8"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>‰∏≠ÊñáÔºà‰∏≠ÂõΩÔºâ</span></span></a><ul class="dropdown__menu"><li><a href="/docs/2.2.1/administration-load-distribution" target="_self" rel="noopener noreferrer" class="dropdown__link">English</a></li><li><a href="/zh-CN/docs/2.2.1/administration-load-distribution" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active">‰∏≠ÊñáÔºà‰∏≠ÂõΩÔºâ</a></li><li><a href="/zh-TW/docs/2.2.1/administration-load-distribution" target="_self" rel="noopener noreferrer" class="dropdown__link">‰∏≠ÊñáÔºàÂè∞ÁÅ£Ôºâ</a></li><li><a href="/ja/docs/2.2.1/administration-load-distribution" target="_self" rel="noopener noreferrer" class="dropdown__link">Êó•Êú¨Ë™û</a></li><li><a href="/fr/docs/2.2.1/administration-load-distribution" target="_self" rel="noopener noreferrer" class="dropdown__link">Fran√ßais</a></li><li><a href="/ko/docs/2.2.1/administration-load-distribution" target="_self" rel="noopener noreferrer" class="dropdown__link">ÌïúÍµ≠Ïñ¥</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link" href="/zh-CN/docs">Version</a><ul class="dropdown__menu"><li><a rel="noopener noreferrer" class="dropdown__link"><span>2.9.1</span></a></li><li><a rel="noopener noreferrer" class="dropdown__link"><span>2.9.0</span></a></li><li><a rel="noopener noreferrer" class="dropdown__link"><span>2.8.2</span></a></li><li><a rel="noopener noreferrer" class="dropdown__link"><span>2.8.1</span></a></li><li><a rel="noopener noreferrer" class="dropdown__link"><span>2.8.0</span></a></li><li><a rel="noopener noreferrer" class="dropdown__link"><span>2.7.3</span></a></li><li><a rel="noopener noreferrer" class="dropdown__link"><span>2.7.2</span></a></li><li><a rel="noopener noreferrer" class="dropdown__link"><span>2.7.1</span></a></li><li><a rel="noopener noreferrer" class="dropdown__link"><span>2.7.0</span></a></li><li><a rel="noopener noreferrer" class="dropdown__link"><span>2.6.4</span></a></li><li><a rel="noopener noreferrer" class="dropdown__link"><span>2.6.3</span></a></li><li><a rel="noopener noreferrer" class="dropdown__link"><span>2.6.2</span></a></li><li><a rel="noopener noreferrer" class="dropdown__link"><span>2.6.1</span></a></li><li><a rel="noopener noreferrer" class="dropdown__link"><span>2.6.0</span></a></li><li><a rel="noopener noreferrer" class="dropdown__link"><span>2.2.0</span></a></li></ul></div><div class="toggle_iYfV toggle_iQ2x toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">üåú</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">üåû</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh-CN/docs/2.2.1/about">About</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/zh-CN/docs/2.2.1/pulsar-2.0">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/zh-CN/docs/2.2.1/concepts-overview">Concepts and Architecture</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/zh-CN/docs/2.2.1/functions-overview">Pulsar Functions</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/zh-CN/docs/2.2.1/io-overview">Pulsar IO</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/zh-CN/docs/2.2.1/sql-overview">Pulsar SQL</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/zh-CN/docs/2.2.1/deploy-aws">Deployment</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" href="/zh-CN/docs/2.2.1/administration-zk-bk">Administration</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/2.2.1/administration-zk-bk">ZooKeeper and BookKeeper</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/2.2.1/administration-geo">Geo-replication</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/2.2.1/administration-dashboard">Dashboard</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/2.2.1/administration-stats">Pulsar statistics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zh-CN/docs/2.2.1/administration-load-distribution">Load distribution</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-CN/docs/2.2.1/administration-proxy">Pulsar proxy</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/zh-CN/docs/2.2.1/security-overview">Security</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/zh-CN/docs/2.2.1/client-libraries-java">Client Libraries</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/zh-CN/docs/2.2.1/admin-api-overview">Admin API</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/zh-CN/docs/2.2.1/adaptors-kafka">Adaptors</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/zh-CN/docs/2.2.1/cookbooks-tiered-storage">Cookbooks</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/zh-CN/docs/2.2.1/develop-tools">Development</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/zh-CN/docs/2.2.1/reference-terminology">Reference</a></div></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->Apache Pulsar<!-- --> <b>2.2.1</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/zh-CN/docs/">latest version</a></b> (<!-- -->2.9.1<!-- -->).</div></div><div class="docItemContainer_oiyr"><article><span class="theme-doc-version-badge badge badge--secondary">Version: <!-- -->2.2.1</span><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Pulsar load distribution</h1></header><h2 class="anchor anchorWithStickyNavbar_y2LR" id="load-distribution-across-pulsar-brokers">Load distribution across Pulsar brokers<a class="hash-link" href="#load-distribution-across-pulsar-brokers" title="Direct link to heading">‚Äã</a></h2><p>Pulsar is an horizontally scalable messaging system, so it is a core requirement that the traffic in a logical cluster must be spread across all the available Pulsar brokers, as evenly as possible.</p><p>In most cases, this is true out of the box and one shouldn&#x27;t worry about it. There are, though, multiple settings and tools to control the traffic distribution and they require a bit of context to understand how the traffic is managed in Pulsar.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="pulsar-load-manager-architecture">Pulsar load manager architecture<a class="hash-link" href="#pulsar-load-manager-architecture" title="Direct link to heading">‚Äã</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="dynamic-assignment-of-topics-to-brokers">Dynamic assignment of topics to brokers<a class="hash-link" href="#dynamic-assignment-of-topics-to-brokers" title="Direct link to heading">‚Äã</a></h3><p>Topics are dynamically assigned to brokers based on the load conditions of all brokers in the cluster.</p><p>When a clients starts using new topics that are not assigned to any broker, it will trigger a process that, given the load conditions, it will choose the best suited broker to acquire ownership of such topic.</p><p>In case of partitioned topics, different partitions might be assigned to different brokers. We talk about &quot;topic&quot; in this context to mean either a non-partitioned topic or one partition of a topic.</p><p>The assignment is &quot;dynamic&quot; because it can change very quickly. For example, if the broker owning the topic crashes, the topic will be reassigned immediately to another broker. Another scenario is that the broker owning the topic becomes overloaded. In this case too, the topic will be reassigned to a less loaded broker.</p><p>The dynamic assignment is made possible by the stateless nature of brokers. This also ensure that we can quickly expand or shrink the cluster based on usage.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="assignment-granularity">Assignment granularity<a class="hash-link" href="#assignment-granularity" title="Direct link to heading">‚Äã</a></h3><p>The assignment of topics/partitions to brokers is not done at the individual level. The reason for it is to amortize the amount of information that we need to keep track (eg. which topics are assigned to a particular broker, what&#x27;s the load on topics for a broker and similar).</p><p>Instead of individual topic/partition assignment, each broker takes ownership of a subset of the topics for a namespace. This subset is called a &quot;<em>bundle</em>&quot; and effectively it&#x27;s a sharding mechanism.</p><p>The namespace is the &quot;administrative&quot; unit: many config knobs or operations are done at the namespace level.</p><p>For assignment, a namespaces is sharded into a list of &quot;bundles&quot;, with each bundle comprising a portion of overall hash range of the namespace.</p><p>Topics are assigned to a particular bundle by taking the hash of the topic name and seeing in which bundle the hash falls into.</p><p>Each bundle is independent of the others and thus is independently assigned to different brokers.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="creating-namespaces-and-bundles">Creating namespaces and bundles<a class="hash-link" href="#creating-namespaces-and-bundles" title="Direct link to heading">‚Äã</a></h3><p>When creating a new namespace, it will set to use the default number of bundles. This is set in <code>conf/broker.conf</code>:</p><div class="codeBlockContainer_J+bg language-properties theme-code-block"><div class="codeBlockContent_csEI properties"><pre tabindex="0" class="prism-code language-properties codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># When a namespace is created without specifying the number of bundle, this</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># value will be used as the default</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">defaultNumberOfNamespaceBundles=4</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>One can either change the system default, or override it when creating a new namespace:</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ bin/pulsar-admin namespaces create my-tenant/my-namespace --clusters us-west --bundles </span><span class="token number">16</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>With this command, we&#x27;re creating a namespace with 16 initial bundles. Therefore the topics for this namespaces can immediately be spread across up to 16 brokers.</p><p>In general, if the expected traffic and number of topics is known in advance, it&#x27;s a good idea to start with a reasonable number of bundles instead of waiting for the system to auto-correct the distribution.</p><p>On a same note, it is normally beneficial to start with more bundles than number of brokers, primarily because of the hashing nature of the distribution of topics into bundles. For example, for a namespace with 1000 topics, using something like 64 bundles will achieve a good distribution of traffic across 16 brokers.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="unloading-topics-and-bundles">Unloading topics and bundles<a class="hash-link" href="#unloading-topics-and-bundles" title="Direct link to heading">‚Äã</a></h3><p>In Pulsar there is an admin operation of &quot;unloading&quot; a topic. Unloading means to close the topics, release ownership and reassign the topics to a new broker, based on current load.</p><p>When unload happens, the client will experience a small latency blip, typically in the order of tens of milliseconds, while the topic is reassigned.</p><p>Unloading is the mechanism used by the load-manager to perform the load shedding, but it can also be triggered manually, for example to correct the assignments and redistribute traffic even before having any broker overloaded.</p><p>Unloading a topic has no effect on the assignment, but it will just close and reopen the particular topic:</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">pulsar-admin topics unload persistent://tenant/namespace/topic</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>To unload all topics for a namespace and trigger reassignments:</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">pulsar-admin namespaces unload tenant/namespace</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="namespace-bundles-splitting">Namespace bundles splitting<a class="hash-link" href="#namespace-bundles-splitting" title="Direct link to heading">‚Äã</a></h3><p>Since the load for the topics in a bundle might change over time, or could just be hard to predict upfront, bundles can be split in 2 by brokers. The new smaller bundles can then be reassigned to different brokers.</p><p>The splitting happens based on some tunable thresholds. Any existing bundle that exceeds any of the threshold is a candidate to be split. By default the newly split bundles are also immediately offloaded to other brokers, to facilitate the traffic distribution.</p><div class="codeBlockContainer_J+bg language-properties theme-code-block"><div class="codeBlockContent_csEI properties"><pre tabindex="0" class="prism-code language-properties codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># enable/disable namespace bundle auto split</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">loadBalancerAutoBundleSplitEnabled=true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># enable/disable automatic unloading of split bundles</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">loadBalancerAutoUnloadSplitBundlesEnabled=true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># maximum topics in a bundle, otherwise bundle split will be triggered</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">loadBalancerNamespaceBundleMaxTopics=1000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># maximum sessions (producers + consumers) in a bundle, otherwise bundle split will be triggered</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">loadBalancerNamespaceBundleMaxSessions=1000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># maximum msgRate (in + out) in a bundle, otherwise bundle split will be triggered</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">loadBalancerNamespaceBundleMaxMsgRate=30000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># maximum bandwidth (in + out) in a bundle, otherwise bundle split will be triggered</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">loadBalancerNamespaceBundleMaxBandwidthMbytes=100</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># maximum number of bundles in a namespace (for auto-split)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">loadBalancerNamespaceMaximumBundles=128</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="automatic-load-shedding">Automatic load shedding<a class="hash-link" href="#automatic-load-shedding" title="Direct link to heading">‚Äã</a></h3><p>In Pulsar&#x27;s load manager there is support for automatic load shedding. This means that whenever the system recognized a particular broker is overloaded, it will force some traffic to be reassigned to less loaded brokers.</p><p>When a broker is identifies as overloaded, it will force to &quot;unload&quot; a subset of the bundles, the ones with higher traffic, that make up for the overload percentage.</p><p>For example, the default threshold is 85% and if a broker is over quota at 95% CPU usage, then it will unload the percent difference plus a 5% margin: <code>(95% - 85%) + 5% = 15%</code>.</p><p>Given the selection of bundles to offload is based on traffic (as a proxy measure for cpu, network and memory), broker will unload bundles for at least 15% of traffic.</p><p>The automatic load shedding is enabled by default and can be disabled with this setting:</p><div class="codeBlockContainer_J+bg language-properties theme-code-block"><div class="codeBlockContent_csEI properties"><pre tabindex="0" class="prism-code language-properties codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Enable/disable automatic bundle unloading for load-shedding</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">loadBalancerSheddingEnabled=true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>There are additional settings that apply to shedding:</p><div class="codeBlockContainer_J+bg language-properties theme-code-block"><div class="codeBlockContent_csEI properties"><pre tabindex="0" class="prism-code language-properties codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Load shedding interval. Broker periodically checks whether some traffic should be offload from</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># some over-loaded broker to other under-loaded brokers</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">loadBalancerSheddingIntervalMinutes=1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Prevent the same topics to be shed and moved to other brokers more that once within this timeframe</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">loadBalancerSheddingGracePeriodMinutes=30</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="broker-overload-thresholds">Broker overload thresholds<a class="hash-link" href="#broker-overload-thresholds" title="Direct link to heading">‚Äã</a></h4><p>The determinations of when a broker is overloaded is based on threshold of CPU, network and memory usage. Whenever either of those metrics reaches the threshold, it will trigger the shedding (if enabled).</p><p>By default, overload threshold is set at 85%:</p><div class="codeBlockContainer_J+bg language-properties theme-code-block"><div class="codeBlockContent_csEI properties"><pre tabindex="0" class="prism-code language-properties codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Usage threshold to determine a broker as over-loaded</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">loadBalancerBrokerOverloadedThresholdPercentage=85</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The usage stats are gathered by Pulsar from the system metrics.</p><p>In case of network utilization, in some cases the network interface speed reported by Linux is not correct and needs to be manually overridden. This is the case in AWS EC2 instances with 1Gbps NIC speed for which the OS report 10Gbps speed.</p><p>Because of the incorrect max speed, the Pulsar load manager might think the broker has not reached the NIC capacity, while in fact it&#x27;s already using all the bandwidth and the traffic is being slowed down.</p><p>There is a setting to correct the max NIC speed:</p><div class="codeBlockContainer_J+bg language-properties theme-code-block"><div class="codeBlockContent_csEI properties"><pre tabindex="0" class="prism-code language-properties codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Override the auto-detection of the network interfaces max speed.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># This option is useful in some environments (eg: EC2 VMs) where the max speed</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># reported by Linux is not reflecting the real bandwidth available to the broker.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Since the network usage is employed by the load manager to decide when a broker</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># is overloaded, it is important to make sure the info is correct or override it</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># with the right value here. The configured value can be a double (eg: 0.8) and that</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># can be used to trigger load-shedding even before hitting on NIC limits.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">loadBalancerOverrideBrokerNicSpeedGbps=</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>When the value is empty, Pulsar will use the value reported by the OS.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/apache/pulsar/edit/master/site2/website-next/versioned_docs/version-2.2.1/administration-load-distribution.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/zh-CN/docs/2.2.1/administration-stats"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Pulsar statistics</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/zh-CN/docs/2.2.1/administration-proxy"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Pulsar proxy</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#load-distribution-across-pulsar-brokers" class="table-of-contents__link toc-highlight">Load distribution across Pulsar brokers</a></li><li><a href="#pulsar-load-manager-architecture" class="table-of-contents__link toc-highlight">Pulsar load manager architecture</a><ul><li><a href="#dynamic-assignment-of-topics-to-brokers" class="table-of-contents__link toc-highlight">Dynamic assignment of topics to brokers</a></li><li><a href="#assignment-granularity" class="table-of-contents__link toc-highlight">Assignment granularity</a></li><li><a href="#creating-namespaces-and-bundles" class="table-of-contents__link toc-highlight">Creating namespaces and bundles</a></li><li><a href="#unloading-topics-and-bundles" class="table-of-contents__link toc-highlight">Unloading topics and bundles</a></li><li><a href="#namespace-bundles-splitting" class="table-of-contents__link toc-highlight">Namespace bundles splitting</a></li><li><a href="#automatic-load-shedding" class="table-of-contents__link toc-highlight">Automatic load shedding</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Apache Foundation.</div><ul class="footer__items"><li class="footer__item">
	              <img src="/img/Apache_Feather_Logo.svg" alt="" width="20">
	              </li><li class="footer__item"><a href="http://www.apache.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Foundation<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.apache.org/events/current-event.html" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Events<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>License<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.apache.org/foundation/thanks" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Thanks<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.apache.org/security" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Security<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.apache.org/foundation/sponsorship" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Sponsorship<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title"> </div><ul class="footer__items"><li class="footer__item">
	              <div><small><strong>Apache Pulsar is available under the <a href="/">Apache License, version 2.0.</a></strong></small></div>
                <div>Apache Pulsar is a distributed, open source pub-sub messaging and streaming platform for real-time workloads, managing hundreds of billions of events per day.</div>
	              </li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a class="footerLogoLink_SRtH" href="/zh-CN/"><img src="/zh-CN/img/pulsar-white.svg" alt="Pulsar Logo" class="themedImage_TMUO themedImage--light_4Vu1 footer__logo"><img src="/zh-CN/img/pulsar-white.svg" alt="Pulsar Logo" class="themedImage_TMUO themedImage--dark_uzRr footer__logo"></a></div><div class="footer__copyright"><p>Apache Pulsar is available under the Apache License, version 2.0.</p>
      <p>Inc.Copyright ¬© 2022 The Apache Software Foundation. All Rights Reserved. Apache, Apache Pulsar and the Apache feather logo are trademarks of The Apache Software Foundation.</p></div></div></div></footer></div>
<script src="/zh-CN/assets/js/runtime~main.0e258294.js"></script>
<script src="/zh-CN/assets/js/main.03a3894c.js"></script>
</body>
</html>