<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-4.1.x docs-doc-page docs-doc-id-administration-load-balance" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Load balance across brokers | Apache Pulsar</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://pulsar.apache.org/img/pulsar-social-media-card.png"><meta data-rh="true" name="twitter:image" content="https://pulsar.apache.org/img/pulsar-social-media-card.png"><meta data-rh="true" property="og:url" content="https://pulsar.apache.org/docs/4.1.x/administration-load-balance/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="4.1.x"><meta data-rh="true" name="docusaurus_tag" content="docs-default-4.1.x"><meta data-rh="true" name="docsearch:version" content="4.1.x"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-4.1.x"><meta data-rh="true" property="og:title" content="Load balance across brokers | Apache Pulsar"><meta data-rh="true" name="description" content="Pulsar is a horizontally scalable messaging system, so the traffic in a logical cluster must be balanced across all the available Pulsar brokers as evenly as possible, which is a core requirement."><meta data-rh="true" property="og:description" content="Pulsar is a horizontally scalable messaging system, so the traffic in a logical cluster must be balanced across all the available Pulsar brokers as evenly as possible, which is a core requirement."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://pulsar.apache.org/docs/4.1.x/administration-load-balance/"><link data-rh="true" rel="alternate" href="https://pulsar.apache.org/docs/4.1.x/administration-load-balance/" hreflang="en"><link data-rh="true" rel="alternate" href="https://pulsar.apache.org/docs/4.1.x/administration-load-balance/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://WK2YL0SALL-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache Pulsar RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache Pulsar Atom Feed">




<link rel="search" type="application/opensearchdescription+xml" title="Apache Pulsar" href="/opensearch.xml">







<link rel="stylesheet" href="/css/katex-0.13.24.min.css" media="print" onload="this.media=&#39;all&#39;">
<script src="/js/sine-waves.min.js" async></script>
<script src="/js/matomo-agent.js"></script>
<script src="/js/custom-script.js"></script>
<script async src="https://widget.kapa.ai/kapa-widget.bundle.js" data-website-id="7da3a42b-98f7-4af5-85e9-771d51c21796" data-modal-title="Apache Pulsar AI Assistant" data-project-name="Apache Pulsar" data-project-logo="https://pbs.twimg.com/profile_images/875130220474359809/wFcLUbwd_400x400.jpg" data-project-color="#FFFFFF" data-modal-open-by-default="false" data-bot-protection-mechanism="hcaptcha" data-modal-override-open-id="ask-ai-input" data-modal-override-open-class="search-input" data-user-analytics-fingerprint-enabled="true" data-button-text-color="#136EC4" data-modal-example-questions-title="Try asking me..." data-modal-example-questions="How to create a topic?,How does message retention work?,What is a Pulsar broker?,How does geo-replication work?" data-modal-disclaimer="This is a custom LLM with access to all Pulsar documentation." data-consent-required data-consent-screen-disclaimer="By clicking &amp;quot;I agree, let&#39;s chat&amp;quot;, you consent to the use of the AI assistant in accordance with kapa.ai&#39;s Privacy Policy. This service uses reCAPTCHA, which requires your consent to Google Privacy Policy and Terms of Service."></script><link rel="stylesheet" href="/assets/css/styles.8505adb1.css">
<script src="/assets/js/runtime~main.89c55c69.js" defer="defer"></script>
<script src="/assets/js/main.69bb9079.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="theme-announcement-bar announcementBar_mb4j" style="background-color:#282826;color:#fff" role="banner"><div class="content_knG7 announcementBarContent_xLdY">
    <a class="announcement-bar" href="/blog/2025/09/09/announcing-apache-pulsar-4-1/" target="_blank">
      <div class="announcement-bar__content">
        <!-- <svg class="announcement-bar__icon">
          
<svg viewBox="0 0 33 32" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M6.5 19.6001H16.1L15.3 29.2001L26.5 12.4H17.06L18.1 2.80005L6.5 19.6001Z" stroke="#F7F7F7" stroke-width="1.5" stroke-linejoin="round"/>
</svg>

        </svg> -->

        <span>
          ✨ Apache Pulsar 4.1 is here! ✨
        </span>

        <svg class="announcement-bar__icon">
          
<svg viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect width="20" height="20" transform="translate(6 6)" fill="white" fill-opacity="0.01"/>
<path d="M17.6667 10.1667L23.5 16.0001M23.5 16.0001L17.6667 21.8334M23.5 16.0001L8.5 16.0001" stroke="white" stroke-linecap="round" stroke-linejoin="round"/>
<rect x="0.5" y="0.5" width="31" height="31" rx="15.5" stroke="white"/>
</svg>

        </svg>
      </div>
    </a>
  </div></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo-black.svg" alt="Apache Pulsar logo" class="themedComponent_mlkZ themedComponent--light_NVdE" height="25" width="127"><img src="/img/logo-black.svg" alt="Apache Pulsar logo" class="themedComponent_mlkZ themedComponent--dark_xIcU" height="25" width="127"></div><b class="navbar__title text--truncate"></b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Get Started</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/4.1.x/concepts-overview/">Concepts</a></li><li><a class="dropdown__link" href="/docs/4.1.x/">Quickstart</a></li><li><a class="dropdown__link" href="/ecosystem/">Ecosystem</a></li></ul></div><a class="navbar__item navbar__link" href="/docs/4.1.x/">Docs</a><a class="navbar__item navbar__link" href="/features/">Features</a><a class="navbar__item navbar__link" href="/use-cases/">Use Cases</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link community-dropdown">Community</a><ul class="dropdown__menu"><li><a class="dropdown__link scroll-link scroll-welcome" id="scroll-welcome" href="/community/">Welcome</a></li><li><a class="dropdown__link scroll-link scroll-discussions" id="scroll-discussions" href="/community/#section-discussions">Discussions</a></li><li><a class="dropdown__link scroll-link" id="scroll-governance" href="/community/#section-governance">Governance</a></li><li><a class="dropdown__link scroll-link" id="scroll-community" href="/community/#section-community">Meet the Community</a></li><li><a class="dropdown__link scroll-link" id="scroll-contribute" href="/community/#section-contribute">Contribute</a></li><li><a class="dropdown__link" href="/contribute/">Contribution Guide</a></li><li><a href="https://github.com/apache/pulsar/wiki" target="_blank" rel="noopener noreferrer" class="dropdown__link">Wiki</a></li><li><a href="https://github.com/apache/pulsar/issues" target="_blank" rel="noopener noreferrer" class="dropdown__link">Issue Tracking</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Learn</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/blog/">Blog</a></li><li><a class="dropdown__link" href="/books/">Books</a></li><li><a class="dropdown__link" href="/case-studies/">Case Studies</a></li><li><a class="dropdown__link" href="/articles/">Articles</a></li><li><a class="dropdown__link" href="/presentations/">Presentations</a></li><li><a class="dropdown__link" href="/events/">Events</a></li></ul></div></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a class="navbar__item navbar__link navbar_download_button" href="/download/">Download</a><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><main class="docMainContainer_TBSr docMainContainerEnhanced_lQrH"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><span class="theme-doc-version-badge badge badge--secondary">Version: 4.1.x</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Load balance across brokers</h1></header><p>Pulsar is a horizontally scalable messaging system, so the traffic in a logical cluster must be balanced across all the available Pulsar brokers as evenly as possible, which is a core requirement.</p>
<p>You can use multiple settings and tools to control the traffic distribution which requires a bit of context to understand how the traffic is managed in Pulsar. Though in most cases, the core requirement mentioned above is true out of the box and you should not worry about it.</p>
<p>The following sections introduce how load-balanced assignments work across Pulsar brokers and how you can leverage the framework to adjust.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="dynamic-assignments">Dynamic assignments<a href="#dynamic-assignments" class="hash-link" aria-label="Direct link to Dynamic assignments" title="Direct link to Dynamic assignments">​</a></h2>
<p>Topics are dynamically assigned to brokers based on the load conditions of all brokers in the cluster. The assignment of topics to brokers is not done at the topic level but the <strong>bundle</strong> level (a higher level). Instead of individual topic assignments, each broker takes ownership of a subset of the topics for a namespace. This subset is called a bundle and effectively this subset is a sharding mechanism.</p>
<p>In other words, each namespace is an &quot;administrative&quot; unit and sharded into a list of bundles, with each bundle comprising a portion of the overall hash range of the namespace. Topics are assigned to a particular bundle by taking the hash of the topic name and checking in which bundle the hash falls. Each bundle is independent of the others and thus is independently assigned to different brokers.</p>
<p>The benefit of the assignment granularity is to amortize the amount of information that you need to keep track of. Based on CPU, memory, traffic load, and other indexes, topics are assigned to a particular broker dynamically. For example:</p>
<ul>
<li>When a client starts using new topics that are not assigned to any broker, a process is triggered to choose the best-suited broker to acquire ownership of these topics according to the load conditions.</li>
<li>If the broker owning a topic becomes overloaded, the topic is reassigned to a less-loaded broker.</li>
<li>If the broker owning a topic crashes, the topic is reassigned to another active broker.</li>
</ul>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>For partitioned topics, different partitions are assigned to different brokers. Here &quot;topic&quot; means either a non-partitioned topic or one partition of a topic.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="create-namespaces-with-assigned-bundles">Create namespaces with assigned bundles<a href="#create-namespaces-with-assigned-bundles" class="hash-link" aria-label="Direct link to Create namespaces with assigned bundles" title="Direct link to Create namespaces with assigned bundles">​</a></h2>
<p>When you create a new namespace, a number of bundles are assigned to the namespace. You can set this number in the <code>conf/broker.conf</code> file:</p>
<div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># When a namespace is created without specifying the number of bundles, this</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># value will be used as the default</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">defaultNumberOfNamespaceBundles=4</span><br></span></code></pre></div></div>
<p>Alternatively, you can override the value when you create a new namespace using <a href="/reference/#/4.1.x/pulsar-admin/" target="_blank" rel="noopener noreferrer">Pulsar admin</a>:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">bin/pulsar-admin namespaces create my-tenant/my-namespace </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--clusters</span><span class="token plain"> us-west </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--bundles</span><span class="token plain"> </span><span class="token number">16</span><br></span></code></pre></div></div>
<p>With the above command, you create a namespace with 16 initial bundles. Therefore the topics for this namespace can immediately be spread across up to 16 brokers.</p>
<p>In general, if you know the expected traffic and number of topics in advance, you had better start with a reasonable number of bundles instead of waiting for the system to auto-correct the distribution.</p>
<p>On the same note, it is beneficial to start with more bundles than the number of brokers, due to the hashing nature of the distribution of topics into bundles. For example, for a namespace with 1000 topics, using something like 64 bundles achieves a good distribution of traffic across 16 brokers.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="split-namespace-bundles">Split namespace bundles<a href="#split-namespace-bundles" class="hash-link" aria-label="Direct link to Split namespace bundles" title="Direct link to Split namespace bundles">​</a></h2>
<p>Since the load for the topics in a bundle might change over time and predicting the load might be hard, bundle split is designed to resolve these challenges. The broker splits a bundle into two and the new smaller bundles can be reassigned to different brokers.</p>
<p>Pulsar supports the following two bundle split algorithms:</p>
<ul>
<li><code>range_equally_divide</code>: split the bundle into two parts with the same hash range size.</li>
<li><code>topic_count_equally_divide</code>: split the bundle into two parts with the same number of topics.</li>
<li><code>specified_positions_divide</code>: split the bundle into several parts by the specified positions.</li>
</ul>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><ul>
<li>The <code>specified_positions_divide</code> algorithms only support use by admin API and do not support set into <code>defaultNamespaceBundleSplitAlgorithm</code>.</li>
</ul></div></div>
<p>To enable bundle split, you need to configure the following settings in the <code>broker.conf</code> file, and set <code>defaultNamespaceBundleSplitAlgorithm</code> based on your needs.</p>
<div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">loadBalancerAutoBundleSplitEnabled=true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">loadBalancerAutoUnloadSplitBundlesEnabled=true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">defaultNamespaceBundleSplitAlgorithm=range_equally_divide</span><br></span></code></pre></div></div>
<p>You can configure more parameters for splitting thresholds. Any existing bundle that exceeds any of the thresholds is a candidate to be split. By default, the newly split bundles are immediately reassigned to other brokers, to facilitate the traffic distribution.</p>
<div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># maximum topics in a bundle, otherwise bundle split will be triggered</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">loadBalancerNamespaceBundleMaxTopics=1000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># maximum sessions (producers + consumers) in a bundle, otherwise bundle split will be triggered</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">loadBalancerNamespaceBundleMaxSessions=1000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># maximum msgRate (in + out) in a bundle, otherwise bundle split will be triggered</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">loadBalancerNamespaceBundleMaxMsgRate=30000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># maximum bandwidth (in + out) in a bundle, otherwise bundle split will be triggered</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">loadBalancerNamespaceBundleMaxBandwidthMbytes=100</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># maximum number of bundles in a namespace (for auto-split)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">loadBalancerNamespaceMaximumBundles=128</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="shed-load-automatically">Shed load automatically<a href="#shed-load-automatically" class="hash-link" aria-label="Direct link to Shed load automatically" title="Direct link to Shed load automatically">​</a></h2>
<p>The support for automatic load shedding is available in the load manager of Pulsar. This means that whenever the system recognizes a particular broker is overloaded, the system forces some traffic to be reassigned to less-loaded brokers.</p>
<p>When a broker is identified as overloaded, the broker forces to &quot;unload&quot; a subset of the bundles, the ones with higher traffic, that make up for the overload percentage.</p>
<p>For example, the default threshold is 85% and if a broker is over quota at 95% CPU usage, then the broker unloads the percent difference plus a 5% margin: <code>(95% - 85%) + 5% = 15%</code>. Given the selection of bundles to unload is based on traffic (as a proxy measure for CPU, network, and memory), the broker unloads bundles for at least 15% of traffic.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><ul>
<li>The automatic load shedding is enabled by default. To disable it, you can set <code>loadBalancerSheddingEnabled</code> to <code>false</code>.</li>
<li>Besides the automatic load shedding, you can <a href="#unload-topics-and-bundles">manually unload bundles</a>.</li>
</ul></div></div>
<p>Additional settings that apply to shedding:</p>
<div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Load shedding interval. Broker periodically checks whether some traffic should be offload from</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># some over-loaded broker to other under-loaded brokers</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">loadBalancerSheddingIntervalMinutes=1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Prevent the same topics to be shed and moved to other brokers more than once within this timeframe</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">loadBalancerSheddingGracePeriodMinutes=30</span><br></span></code></pre></div></div>
<p>Pulsar supports the following types of automatic load shedding strategies.</p>
<ul>
<li><a href="#thresholdshedder">ThresholdShedder</a></li>
<li><a href="#overloadshedder">OverloadShedder</a></li>
<li><a href="#uniformloadshedder">UniformLoadShedder</a></li>
</ul>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><ul>
<li>From Pulsar 2.10, the <strong>default</strong> shedding strategy is <code>ThresholdShedder</code>.</li>
<li>You need to restart brokers if the shedding strategy is <a href="/docs/4.1.x/admin-api-brokers/#dynamic-broker-configuration">dynamically updated</a>.</li>
</ul></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="thresholdshedder">ThresholdShedder<a href="#thresholdshedder" class="hash-link" aria-label="Direct link to ThresholdShedder" title="Direct link to ThresholdShedder">​</a></h3>
<p>This strategy sheds bundles from brokers whose resource usage exceeds the average resource usage of brokers in the cluster by a specified threshold.</p>
<p>Current usage for a broker is defined as the maximum usage among CPU, direct memory, throughput in and throughput out values. This value is exponentially smoothed out with historical observations to yield the computed resource usage for broker load balancing purposes.</p>
<p>A broker is considered overloaded if its resource usage exceeds the average resource usage of all brokers in the cluster by at least threshold value <code>loadBalancerBrokerThresholdShedderPercentage</code>. Bundles from overloaded brokers are transferred until the expected throughput of the broker is 5% below the cluster average. Furthermore, a broker must have a total current throughput (in + out) sufficiently high in order to be eligible for bundle unloading. If the expected throughput reduction on the broker does not exceed absolute value <code>loadBalancerBundleUnloadMinThroughputThreshold</code>, it will not be unloaded.</p>
<p>Note that recently unloaded bundles are not unloaded again.</p>
<p><img decoding="async" loading="lazy" alt="Shedding strategy - ThresholdShedder" src="/assets/images/shedding-strategy-thresholdshedder-69bc0835a1752056e0cc058d6c7c72f1.svg" width="1776" height="683" class="img_ev3q"></p>
<p>For example, assume you have three brokers, the average broker usage of broker1 is 40%, the average broker usage of broker2 and broker3 is 10%, then the cluster average usage is 20% ((40% + 10% + 10%) / 3). If you set <code>loadBalancerBrokerThresholdShedderPercentage</code> to <code>10</code>, then only broker1&#x27;s certain bundles get unloaded, because the average usage of broker1 is greater than the sum of the cluster average usage (20%) plus <code>loadBalancerBrokerThresholdShedderPercentage</code>(10%).</p>
<p>However, in some special cases, the above default strategy cannot leverage the resources of low-load or idle machines.</p>
<p>For example:</p>
<p>There are 11 brokers, of which 10 are loaded at 80% and 1 is loaded at 0%.
The average load is 80% * 10 / 11 = 72.73%, and the threshold to unload is 72.73% + 10% = 82.73%.
Since 80% &lt; 82.73%, unload will not be triggered, and there is one idle Broker with load of 0%.</p>
<p>To leverage the resources of low-load or idle machines, you can configure the <code>lowerBoundarySheddingEnabled</code> parameter on top of <code>ThresholdShedder</code>.
When <code>lowerBoundarySheddingEnabled</code> is set to <code>true</code>, a leader decides the lower boundary of the load.
If <code>current usage</code> is less than <code>average usage - lower boundary load</code>, e.g., 0% &lt; (82.73% - 10%), the broker with the highest load will be triggered to unload.</p>
<p>To use the <code>ThresholdShedder</code> strategy, configure brokers with this value.
<code>loadBalancerLoadSheddingStrategy=org.apache.pulsar.broker.loadbalance.impl.ThresholdShedder</code></p>
<p>You can configure the weights for each resource per broker in the <code>conf/broker.conf</code> file.</p>
<div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># The BandWithIn usage weight when calculating new resource usage. The range is between 0 and 1.0.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">loadBalancerBandwithInResourceWeight=1.0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># The BandWithOut usage weight when calculating new resource usage. The range is between 0 and 1.0.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">loadBalancerBandwithOutResourceWeight=1.0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># The CPU usage weight when calculating new resource usage. The range is between 0 and 1.0.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">loadBalancerCPUResourceWeight=1.0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># The heap memory usage weight when calculating new resource usage. The range is between 0 and 1.0.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">loadBalancerMemoryResourceWeight=1.0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># The direct memory usage weight when calculating new resource usage. The range is between 0 and 1.0.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">loadBalancerDirectMemoryResourceWeight=1.0</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="overloadshedder">OverloadShedder<a href="#overloadshedder" class="hash-link" aria-label="Direct link to OverloadShedder" title="Direct link to OverloadShedder">​</a></h3>
<p>This strategy attempts to shed exactly one bundle on brokers which are overloaded, that is, whose maximum system resource usage exceeds <a href="#broker-overload-thresholds"><code>loadBalancerBrokerOverloadedThresholdPercentage</code></a>. To see which resources are considered when determining the maximum system resource. A bundle is recommended for unloading off that broker if and only if the following conditions hold: The broker has at least two bundles assigned and the broker has at least one bundle that has not been unloaded recently according to <code>LoadBalancerSheddingGracePeriodMinutes</code>. The unloaded bundle will be the most expensive bundle in terms of message rate that has not been recently unloaded. Note that this strategy does not take into account &quot;underloaded&quot; brokers when determining which bundles to unload. If you are looking for a strategy that spreads load evenly across all brokers, see <a href="#thresholdshedder">ThresholdShedder</a>.</p>
<p><img decoding="async" loading="lazy" alt="Shedding strategy - OverloadShedder" src="/assets/images/shedding-strategy-overloadshedder-82646099fbc5728e78d7d4d3eb151e18.svg" width="1790" height="625" class="img_ev3q"></p>
<p>To use the <code>OverloadShedder</code> strategy, configure brokers with this value.
<code>loadBalancerLoadSheddingStrategy=org.apache.pulsar.broker.loadbalance.impl.OverloadShedder</code></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="broker-overload-thresholds">Broker overload thresholds<a href="#broker-overload-thresholds" class="hash-link" aria-label="Direct link to Broker overload thresholds" title="Direct link to Broker overload thresholds">​</a></h4>
<p>The determination of when a broker is overloaded is based on the threshold of CPU, network, and memory usage. Whenever either of those metrics reaches the threshold, the system triggers the shedding (if enabled).</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>The overload threshold <code>loadBalancerBrokerOverloadedThresholdPercentage</code> only applies to the <a href="#overloadshedder"><code>OverloadShedder</code></a> shedding strategy. By default, it is set to 85%.</p></div></div>
<p>Pulsar gathers the CPU, network, and memory usage stats from the system metrics. In some cases of network utilization, the network interface speed that Linux reports is not correct and needs to be manually overridden. This is the case in AWS EC2 instances with 1Gbps NIC speed for which the OS reports 10Gbps speed.</p>
<p>Because of the incorrect max speed, the load manager might think the broker has not reached the NIC capacity, while in fact the broker already uses all the bandwidth and the traffic is slowed down.</p>
<p>You can set <code>loadBalancerOverrideBrokerNicSpeedGbps</code> in the <code>conf/broker.conf</code> file to correct the max NIC speed. When the value is empty, Pulsar uses the value that the OS reports.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="uniformloadshedder">UniformLoadShedder<a href="#uniformloadshedder" class="hash-link" aria-label="Direct link to UniformLoadShedder" title="Direct link to UniformLoadShedder">​</a></h3>
<p>This strategy tends to distribute load uniformly across all brokers. This strategy checks the load difference between the broker with the highest load and the broker with the lowest load. If the difference is higher than configured thresholds <code>loadBalancerMsgRateDifferenceShedderThreshold</code> and <code>loadBalancerMsgThroughputMultiplierDifferenceShedderThreshold</code> then it finds out bundles that can be unloaded to distribute traffic evenly across all brokers.</p>
<p><img decoding="async" loading="lazy" alt="Shedding strategy - UniformLoadShedder" src="/assets/images/shedding-strategy-uniformLoadshedder-a521b90620882e7ce650d4ee6d0561bc.svg" width="1786" height="635" class="img_ev3q"></p>
<p>To use the <code>UniformLoadShedder</code> strategy, configure brokers with this value.
<code>loadBalancerLoadSheddingStrategy=org.apache.pulsar.broker.loadbalance.impl.UniformLoadShedder</code></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="unload-topics-and-bundles">Unload topics and bundles<a href="#unload-topics-and-bundles" class="hash-link" aria-label="Direct link to Unload topics and bundles" title="Direct link to Unload topics and bundles">​</a></h2>
<p>You can &quot;unload&quot; a topic in Pulsar manual admin operations. Unloading means closing topics, releasing ownership, and reassigning topics to a new broker, based on the current load.</p>
<p>When unloading happens, the client experiences a small latency blip, typically in the order of tens of milliseconds, while the topic is reassigned.</p>
<p>Unloading is the mechanism that the load manager uses to perform the load shedding, but you can also trigger the unloading manually, for example, to correct the assignments and redistribute traffic even before having any broker overloaded.</p>
<p>Unloading a topic has no effect on the assignment, but just closes and reopens the particular topic:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">pulsar-admin topics unload persistent://tenant/namespace/topic</span><br></span></code></pre></div></div>
<p>To unload all topics for a namespace and trigger reassignments:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">pulsar-admin namespaces unload tenant/namespace</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="distribute-anti-affinity-namespaces-across-failure-domains">Distribute anti-affinity namespaces across failure domains<a href="#distribute-anti-affinity-namespaces-across-failure-domains" class="hash-link" aria-label="Direct link to Distribute anti-affinity namespaces across failure domains" title="Direct link to Distribute anti-affinity namespaces across failure domains">​</a></h2>
<p>When your application has multiple namespaces and you want one of them available all the time to avoid any downtime, you can group these namespaces and distribute them across different <a href="/docs/4.1.x/reference-terminology/#failure-domain">failure domains</a> and different brokers. Thus, if one of the failure domains is down (due to release rollout or brokers restart), it only disrupts namespaces owned by that specific failure domain and the rest of the namespaces owned by other domains remain available without any impact.</p>
<p>Such a group of namespaces has anti-affinity to each other, that is, all the namespaces in this group are <a href="/docs/4.1.x/reference-terminology/#anti-affinity-namespaces">anti-affinity namespaces</a> and are distributed to different failure domains in a load-balanced manner.</p>
<p>As illustrated in the following figure, Pulsar has 2 failure domains (Domain1 and Domain2) and each domain has 2 brokers in it. You can create an anti-affinity namespace group that has 4 namespaces in it, and all the 4 namespaces have anti-affinity to each other. The load manager tries to distribute namespaces evenly across all the brokers in the same domain. Since each domain has 2 brokers, every broker owns one namespace from this anti-affinity namespace group, and you can see each domain owns 2 namespaces, and each broker owns 1 namespace.</p>
<p><img decoding="async" loading="lazy" alt="Distribute anti-affinity namespaces across failure domains" src="/assets/images/anti-affinity-namespaces-across-failure-domains-49c34611c66243659ac8382597e04281.svg" width="1546" height="741" class="img_ev3q"></p>
<p>The load manager follows an even distribution policy across failure domains to assign anti-affinity namespaces. The following table outlines the even-distributed assignment sequence illustrated in the above figure.</p>
<table><thead><tr><th style="text-align:left">Assignment sequence</th><th style="text-align:left">Namespace</th><th style="text-align:left">Failure domain candidates</th><th style="text-align:left">Broker candidates</th><th style="text-align:left">Selected broker</th></tr></thead><tbody><tr><td style="text-align:left">1</td><td style="text-align:left">Namespace1</td><td style="text-align:left">Domain1, Domain2</td><td style="text-align:left">Broker1, Broker2, Broker3, Broker4</td><td style="text-align:left">Domain1<!-- -->:Broker1</td></tr><tr><td style="text-align:left">2</td><td style="text-align:left">Namespace2</td><td style="text-align:left">Domain2</td><td style="text-align:left">Broker3, Broker4</td><td style="text-align:left">Domain2<!-- -->:Broker3</td></tr><tr><td style="text-align:left">3</td><td style="text-align:left">Namespace3</td><td style="text-align:left">Domain1, Domain2</td><td style="text-align:left">Broker2, Broker4</td><td style="text-align:left">Domain1<!-- -->:Broker2</td></tr><tr><td style="text-align:left">4</td><td style="text-align:left">Namespace4</td><td style="text-align:left">Domain2</td><td style="text-align:left">Broker4</td><td style="text-align:left">Domain2<!-- -->:Broker4</td></tr></tbody></table>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><ul>
<li>
<p>Each namespace belongs to only one anti-affinity group. If a namespace with an existing anti-affinity assignment is assigned to another anti-affinity group, the original assignment is dropped.</p>
</li>
<li>
<p>If there are more anti-affinity namespaces than failure domains, the load manager distributes namespaces evenly across all the domains, and also every domain distributes namespaces evenly across all the brokers under that domain.</p>
</li>
</ul></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-a-failure-domain-and-register-brokers">Create a failure domain and register brokers<a href="#create-a-failure-domain-and-register-brokers" class="hash-link" aria-label="Direct link to Create a failure domain and register brokers" title="Direct link to Create a failure domain and register brokers">​</a></h3>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>One broker can only be registered to a single failure domain.</p></div></div>
<p>To create a domain under a specific cluster and register brokers, run the following command:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">pulsar-admin clusters create-failure-domain </span><span class="token operator">&lt;</span><span class="token plain">cluster-name</span><span class="token operator">&gt;</span><span class="token plain"> --domain-name </span><span class="token operator">&lt;</span><span class="token plain">domain-name</span><span class="token operator">&gt;</span><span class="token plain"> --broker-list </span><span class="token operator">&lt;</span><span class="token plain">broker-list-comma-separated</span><span class="token operator">&gt;</span><br></span></code></pre></div></div>
<p>You can also view, update, and delete domains under a specific cluster. For more information, refer to <a href="/reference/#/4.1.x/pulsar-admin/" target="_blank" rel="noopener noreferrer">Pulsar admin docs</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-an-anti-affinity-namespace-group">Create an anti-affinity namespace group<a href="#create-an-anti-affinity-namespace-group" class="hash-link" aria-label="Direct link to Create an anti-affinity namespace group" title="Direct link to Create an anti-affinity namespace group">​</a></h3>
<p>An anti-affinity group is created automatically when the first namespace is assigned to the group. To assign a namespace to an anti-affinity group, run the following command. It sets an anti-affinity group name for a namespace.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">pulsar-admin namespaces set-anti-affinity-group </span><span class="token operator">&lt;</span><span class="token plain">namespace</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--group</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">group-name</span><span class="token operator">&gt;</span><br></span></code></pre></div></div>
<p>For more information about <code>anti-affinity-group</code> related commands, refer to <a href="/reference/#/4.1.x/pulsar-admin/" target="_blank" rel="noopener noreferrer">Pulsar admin docs</a>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/apache/pulsar-site/edit/main/versioned_docs/version-4.1.x/administration-load-balance.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"></nav></div></div><div class="col col--3"><div class="tableOfContents_jeP5 thin-scrollbar theme-doc-toc-desktop"><div class="border"><div style="color:var(--ifm-toc-link-color)">Was this helpful?</div><div style="border-width:1px;padding:3px;display:flex"><div style="justify-content:center;display:flex;border-radius:99999px;width:2.5rem;height:2.5rem;cursor:pointer"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="24" fill="none" style="width:initial;height:initial" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M10.086 1.594A1 1 0 0 1 11 1a4 4 0 0 1 4 4v3h4.655a3 3 0 0 1 2.994 3.45l-1.38 9A3 3 0 0 1 18.275 23H4a3 3 0 0 1-3-3v-7a3 3 0 0 1 3-3h2.35zM8 11.212l3.608-8.117A2 2 0 0 1 13 5v4a1 1 0 0 0 1 1h5.671a1 1 0 0 1 1 1.15l-1.38 9a1 1 0 0 1-1 .85H8zM6 21v-9H4a1 1 0 0 0-1 1v7a1 1 0 0 0 1 1z" clip-rule="evenodd"></path></svg></div><div style="justify-content:center;display:flex;border-radius:99999px;width:2.5rem;height:2.5rem;cursor:pointer"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="24" fill="none" style="width:initial;height:initial" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M20.563 3.316A1.3 1.3 0 0 0 19.687 3h-1.688v9h1.688a1.31 1.31 0 0 0 1.312-1.077V4.077a1.3 1.3 0 0 0-.436-.761M16 12.788l-3.608 8.118A2 2 0 0 1 11 19v-4a1 1 0 0 0-1-1H4.328a1.002 1.002 0 0 1-1-1.15l1.38-9a1 1 0 0 1 1-.85h10.291zM19.661 1a3.31 3.31 0 0 1 3.329 2.866Q23 3.933 23 4v7q0 .068-.01.134A3.31 3.31 0 0 1 19.661 14h-2.012l-3.736 8.406a1 1 0 0 1-.914.594 4 4 0 0 1-4-4v-3H4.344a3 3 0 0 1-2.994-3.45l1.38-9A3 3 0 0 1 5.724 1z" clip-rule="evenodd"></path></svg></div></div><div class="Actions_uugI"><a target="_blank" class="Action_iBHd" href="https://github.com/apache/pulsar-site/issues/new">💡 Suggest changes</a><a target="_blank" class="Action_iBHd" href="https://github.com/apache/pulsar/discussions/new?category=q-a">🛟 Get support</a></div></div><ul class="table-of-contents table-of-contents__left-border"><li><a href="#dynamic-assignments" class="table-of-contents__link toc-highlight">Dynamic assignments</a></li><li><a href="#create-namespaces-with-assigned-bundles" class="table-of-contents__link toc-highlight">Create namespaces with assigned bundles</a></li><li><a href="#split-namespace-bundles" class="table-of-contents__link toc-highlight">Split namespace bundles</a></li><li><a href="#shed-load-automatically" class="table-of-contents__link toc-highlight">Shed load automatically</a><ul><li><a href="#thresholdshedder" class="table-of-contents__link toc-highlight">ThresholdShedder</a></li><li><a href="#overloadshedder" class="table-of-contents__link toc-highlight">OverloadShedder</a></li><li><a href="#uniformloadshedder" class="table-of-contents__link toc-highlight">UniformLoadShedder</a></li></ul></li><li><a href="#unload-topics-and-bundles" class="table-of-contents__link toc-highlight">Unload topics and bundles</a></li><li><a href="#distribute-anti-affinity-namespaces-across-failure-domains" class="table-of-contents__link toc-highlight">Distribute anti-affinity namespaces across failure domains</a><ul><li><a href="#create-a-failure-domain-and-register-brokers" class="table-of-contents__link toc-highlight">Create a failure domain and register brokers</a></li><li><a href="#create-an-anti-affinity-namespace-group" class="table-of-contents__link toc-highlight">Create an anti-affinity namespace group</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Foundation<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.apache.org/events/current-event.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Events<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="footer__link-item">License<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.apache.org/foundation/thanks" target="_blank" rel="noopener noreferrer" class="footer__link-item">Thanks<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.apache.org/foundation/sponsorship" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sponsorship<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/security/">Security</a></li><li class="footer__item"><a href="https://www.apache.org/foundation/policies/privacy.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/contact/">Contact</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item">
                <div class="social-icons">
                  <a target="_blank" href="https://communityinviter.com/apps/apache-pulsar/apache-pulsar" aria-label="Join the Apache Pulsar Slack workspace">
                    <img alt="Slack logo" src="/img/slack-white.svg" width="26">
                  </a>
                  <a target="_blank" href="https://github.com/apache/pulsar/" aria-label="View the Apache Pulsar project on GitHub">
                    <img alt="GitHub logo" src="/img/github-white.svg" width="26">
                  </a>
                </div>
              </li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a class="footerLogoLink_BH7S" href="/"><img src="/img/pulsar-white.svg" alt="Pulsar Logo" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/pulsar-white.svg" alt="Pulsar Logo" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU"></a></div><div class="footer__copyright">
        <div>
          <img class="footer-apache-logo" src="/img/feather-logo-white.svg" alt="" width="20">
          The Apache Software Foundation
        </div>
        <p>Apache Pulsar is available under the Apache License, version 2.0. Apache Pulsar is an open-source, distributed messaging and streaming platform built for the cloud.</p>
        <p>Copyright © 2026 The Apache Software Foundation. All Rights Reserved. Apache, Pulsar, Apache Pulsar, and the Apache feather logo are trademarks or registered trademarks of The Apache Software Foundation.</p>
      </div></div></div></footer></div>
</body>
</html>