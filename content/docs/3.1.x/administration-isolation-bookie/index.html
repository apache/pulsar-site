<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-3.1.x docs-doc-page docs-doc-id-administration-isolation-bookie" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.6.3">
<title data-rh="true">Isolate bookies | Apache Pulsar</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://pulsar.apache.org/img/pulsar-social-media-card.png"><meta data-rh="true" name="twitter:image" content="https://pulsar.apache.org/img/pulsar-social-media-card.png"><meta data-rh="true" property="og:url" content="https://pulsar.apache.org/docs/3.1.x/administration-isolation-bookie/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="3.1.x"><meta data-rh="true" name="docusaurus_tag" content="docs-default-3.1.x"><meta data-rh="true" name="docsearch:version" content="3.1.x"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-3.1.x"><meta data-rh="true" property="og:title" content="Isolate bookies | Apache Pulsar"><meta data-rh="true" name="description" content="Isolating bookies equals isolating message storage, which is a data storage mechanism that provides isolation and safety for specific topics."><meta data-rh="true" property="og:description" content="Isolating bookies equals isolating message storage, which is a data storage mechanism that provides isolation and safety for specific topics."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://pulsar.apache.org/docs/3.1.x/administration-isolation-bookie/"><link data-rh="true" rel="alternate" href="https://pulsar.apache.org/docs/3.1.x/administration-isolation-bookie/" hreflang="en"><link data-rh="true" rel="alternate" href="https://pulsar.apache.org/docs/3.1.x/administration-isolation-bookie/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://WK2YL0SALL-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache Pulsar RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache Pulsar Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Apache Pulsar" href="/opensearch.xml">







<link rel="stylesheet" href="/css/katex-0.13.24.min.css" media="print" onload="this.media=&#39;all&#39;">
<script src="/js/sine-waves.min.js" async></script>
<script src="/js/matomo-agent.js"></script><link rel="stylesheet" href="/assets/css/styles.ba6e50a9.css">
<script src="/assets/js/runtime~main.28c6cd69.js" defer="defer"></script>
<script src="/assets/js/main.3e7679f2.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#282826;color:#fff" role="banner"><div class="content_knG7 announcementBarContent_xLdY">
    <a class="announcement-bar" href="/blog/2024/10/24/announcing-apache-pulsar-4-0/" target="_blank">
      <div class="announcement-bar__content">
        <!-- <svg class="announcement-bar__icon">
          
<svg viewBox="0 0 33 32" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M6.5 19.6001H16.1L15.3 29.2001L26.5 12.4H17.06L18.1 2.80005L6.5 19.6001Z" stroke="#F7F7F7" stroke-width="1.5" stroke-linejoin="round"/>
</svg>

        </svg> -->

        <span>
          ✨ Apache Pulsar 4.0 LTS is here! ✨
        </span>

        <svg class="announcement-bar__icon">
          
<svg viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect width="20" height="20" transform="translate(6 6)" fill="white" fill-opacity="0.01"/>
<path d="M17.6667 10.1667L23.5 16.0001M23.5 16.0001L17.6667 21.8334M23.5 16.0001L8.5 16.0001" stroke="white" stroke-linecap="round" stroke-linejoin="round"/>
<rect x="0.5" y="0.5" width="31" height="31" rx="15.5" stroke="white"/>
</svg>

        </svg>
      </div>
    </a>
  </div></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo-black.svg" alt="Apache Pulsar logo" class="themedComponent_mlkZ themedComponent--light_NVdE" height="25" width="127"><img src="/img/logo-black.svg" alt="Apache Pulsar logo" class="themedComponent_mlkZ themedComponent--dark_xIcU" height="25" width="127"></div><b class="navbar__title text--truncate"></b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Get Started</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/4.0.x/concepts-overview/">Concepts</a></li><li><a class="dropdown__link" href="/docs/4.0.x/">Quickstart</a></li><li><a class="dropdown__link" href="/ecosystem/">Ecosystem</a></li></ul></div><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/3.1.x/">Docs</a><a class="navbar__item navbar__link" href="/features/">Features</a><a class="navbar__item navbar__link" href="/use-cases/">Use Cases</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link community-dropdown">Community</a><ul class="dropdown__menu"><li><a class="dropdown__link scroll-link scroll-welcome" id="scroll-welcome" href="/community/">Welcome</a></li><li><a class="dropdown__link scroll-link scroll-discussions" id="scroll-discussions" href="/community/#section-discussions">Discussions</a></li><li><a class="dropdown__link scroll-link" id="scroll-governance" href="/community/#section-governance">Governance</a></li><li><a class="dropdown__link scroll-link" id="scroll-community" href="/community/#section-community">Meet the Community</a></li><li><a class="dropdown__link scroll-link" id="scroll-contribute" href="/community/#section-contribute">Contribute</a></li><li><a class="dropdown__link" href="/contribute/">Contribution Guide</a></li><li><a href="https://github.com/apache/pulsar/wiki" target="_blank" rel="noopener noreferrer" class="dropdown__link">Wiki</a></li><li><a href="https://github.com/apache/pulsar/issues" target="_blank" rel="noopener noreferrer" class="dropdown__link">Issue Tracking</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Learn</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/blog/">Blog</a></li><li><a class="dropdown__link" href="/books/">Books</a></li><li><a class="dropdown__link" href="/case-studies/">Case Studies</a></li><li><a class="dropdown__link" href="/articles/">Articles</a></li><li><a class="dropdown__link" href="/presentations/">Presentations</a></li><li><a class="dropdown__link" href="/events/">Events</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link navbar_download_button" href="/download/">Download</a><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_mhZE"><div class="sidebarVersionSwitch_EHpo">Version:<div class="navbar__item dropdown dropdown--hoverable"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/3.1.x/">3.1.x</a><ul class="dropdown__menu"><li><a class="dropdown__link">Next</a></li><li><a class="dropdown__link">4.0.x LTS</a></li><li><a class="dropdown__link">3.3.x</a></li><li><a class="dropdown__link">3.0.x LTS</a></li><li><a class="dropdown__link">Others</a></li></ul></div></div><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/3.1.x/">About</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/3.1.x/getting-started-home/">Get Started</a><button aria-label="Expand sidebar category &#x27;Get Started&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/3.1.x/concepts-overview/">Concepts and Architecture</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/3.1.x/schema-overview/">Pulsar Schema</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/3.1.x/functions-overview/">Pulsar Functions</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/3.1.x/io-overview/">Pulsar IO</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/3.1.x/sql-overview/">Pulsar SQL</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/3.1.x/tiered-storage-overview/">Tiered Storage</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/3.1.x/txn-why/">Transactions</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/3.1.x/install-deploy-upgrade-landing/">Deployment</a><button aria-label="Expand sidebar category &#x27;Deployment&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/3.1.x/administration-zk-bk/">Administration</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/3.1.x/administration-zk-bk/">ZooKeeper and BookKeeper</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/3.1.x/administration-metadata-store/">Configure metadata store</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/3.1.x/administration-geo/">Geo-replication</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/3.1.x/administration-pulsar-manager/">Pulsar Manager</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/3.1.x/administration-pulsar-shell/">Pulsar Shell</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/3.1.x/administration-load-balance/">Load balance</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/3.1.x/administration-proxy/">Pulsar proxy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/3.1.x/administration-upgrade/">Upgrade</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/3.1.x/administration-isolation/">Pulsar isolation</a><button aria-label="Collapse sidebar category &#x27;Pulsar isolation&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/3.1.x/administration-isolation-broker/">Isolate brokers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/3.1.x/administration-isolation-bookie/">Isolate bookies</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/3.1.x/administration-stats/">Observability</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/3.1.x/security-overview/">Security</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/3.1.x/performance-pulsar-perf/">Performance</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/3.1.x/client-libraries/">Client Libraries</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/3.1.x/admin-api-overview/">Admin API</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/3.1.x/adaptors-kafka/">Adaptors</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/3.1.x/how-to-landing/">Tutorials</a><button aria-label="Expand sidebar category &#x27;Tutorials&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/3.1.x/developers-landing/">Development</a><button aria-label="Expand sidebar category &#x27;Development&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/3.1.x/reference-landing/">Reference</a><button aria-label="Expand sidebar category &#x27;Reference&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Administration</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/3.1.x/administration-isolation/"><span itemprop="name">Pulsar isolation</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Isolate bookies</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Isolate bookies</h1></header><p>Isolating bookies equals isolating message storage, which is a data storage mechanism that provides isolation and safety for specific topics.</p>
<p>Bookie isolation is controlled by BookKeeper clients. For Pulsar, there are two kinds of BookKeeper clients to read and write data.</p>
<ul>
<li>BookKeeper clients on the broker side: Pulsar brokers use these BookKeeper clients to read and write topic messages.</li>
<li>BookKeeper clients on the bookie auto-recovery side:<!-- -->
<ul>
<li>The bookie auditor checks whether ledger replicas fulfill the configured isolation policy;</li>
<li>The bookie replication worker writes ledger replicas to target bookies according to the configured isolation policy.</li>
</ul>
</li>
</ul>
<p>To isolate bookies, you need to complete the following tasks.</p>
<ol>
<li>Select a <a href="#understand-bookie-data-isolation-policy">data isolation policy</a> based on your requirements.</li>
<li><a href="#enable-bookie-data-placement-policy">Enable the policy on BookKeeper clients</a>.</li>
<li><a href="#configure-data-placement-policy-on-bookie-instances">Configure the policy on bookie instances</a>.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="understand-bookie-data-isolation-policy">Understand bookie data isolation policy<a href="#understand-bookie-data-isolation-policy" class="hash-link" aria-label="Direct link to Understand bookie data isolation policy" title="Direct link to Understand bookie data isolation policy">​</a></h2>
<p>Bookie data isolation policy is built on top of the existing BookKeeper rack-aware placement policy. The &quot;rack&quot; concept can be anything, for example, racks, regions, availability zones. It writes the configured isolation policy into the metadata store. Both BookKeeper clients on the broker and bookie auto-recovery side read the configured isolation policy from the metadata store and apply it when choosing bookies to store messages.</p>
<p>BookKeeper provides three kinds of data isolation policies for disaster tolerance.</p>
<ul>
<li>Rack-aware placement policy (default)</li>
<li>Region-aware placement policy</li>
<li>Zone-aware placement policy</li>
</ul>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><ul>
<li>
<p>Both <a href="#rack-aware-placement-policy">rack-aware placement policy</a> and <a href="#region-aware-placement-policy">region-aware placement policy</a> can be used in all kinds of deployments where racks are a subset of a region. The major difference between the two policies is:</p>
<ul>
<li>With <code>RackawareEnsemblePlacementPolicy</code> configured, the BookKeeper client chooses bookies from different <strong>racks</strong> to reduce the single point of failure. If there is only one rack available, the policy falls back on choosing a random bookie across available ones.</li>
<li>With <code>RegionAwareEnsemblePlacementPolicy</code> configured, the BookKeeper client chooses bookies from different <strong>regions</strong>; for the selected region, it chooses bookies from different racks if more than one ensemble falls into the same region.</li>
</ul>
</li>
<li>
<p>Zone-aware placement policy (<code>ZoneAwareEnsemblePlacementPolicy</code>) can be used in a public cloud infrastructure where Availability Zones (AZs) are isolated locations within the data center regions that public cloud services originate from and operate in.</p>
</li>
</ul></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="rack-aware-placement-policy">Rack-aware placement policy<a href="#rack-aware-placement-policy" class="hash-link" aria-label="Direct link to Rack-aware placement policy" title="Direct link to Rack-aware placement policy">​</a></h3>
<p>Rack-aware placement policy enforces different data replicas to be placed in different racks to guarantee the rack-level disaster tolerance for your production environment. A data center usually has a lot of racks, and each rack has many storage nodes. You can use <code>RackAwareEnsemblePlacementPolicy</code> to configure the rack information for each bookie.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="qualified-rack-size-of-bookies">Qualified rack size of bookies<a href="#qualified-rack-size-of-bookies" class="hash-link" aria-label="Direct link to Qualified rack size of bookies" title="Direct link to Qualified rack size of bookies">​</a></h4>
<p>When the available rack size of bookies can meet the requirements configured on a topic, the rack-aware placement policy can work well and you don&#x27;t need any extra configurations.</p>
<p>For example, the BookKeeper cluster has 4 racks and 13 bookie instances as shown in the following diagram. When a topic is configured with <code>EnsembleSize=3, WriteQuorum=3, AckQuorum=2</code>, the BookKeeper client chooses one bookie instance from three different racks to write data to, such as Bookie2, Bookie8, and Bookie12.</p>
<p><img decoding="async" loading="lazy" alt="Rack-aware placement policy" src="/assets/images/rack-aware-placement-policy-1-4f24b2896f0259416ecaac0abf7421cb.svg" width="1578" height="278" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="enforced-minimum-rack-size-of-bookies">Enforced minimum rack size of bookies<a href="#enforced-minimum-rack-size-of-bookies" class="hash-link" aria-label="Direct link to Enforced minimum rack size of bookies" title="Direct link to Enforced minimum rack size of bookies">​</a></h4>
<p>When the available rack size of bookies cannot meet the requirements configured on a topic, the strategy that the BookKeeper client chooses bookies to recover old ledgers and create new ledgers depends on whether the enforced minimum rack size of bookies is configured.</p>
<p>In this case, if you want to make the rack-aware placement policy work as usual, you need to configure an enforced minimum rack size of bookies (<code>MinNumRacksPerWriteQuorum</code>).</p>
<p>For example, you have the same BookKeeper cluster with the same topic requirements <code>EnsembleSize=3, WriteQuorum=3, AckQuorum=2</code> as shown in the above diagram. When all the bookie instances in Rack3 and Rack4 fail, you only have 2 available racks and there are the following three possibilities.</p>
<ul>
<li>
<p>If you have configured <code>EnforceMinNumRacksPerWriteQuorum=true</code> and <code>MinNumRacksPerWriteQuorum=3</code>, the BookKeeper client fails to choose bookies, which means new ledgers cannot be created and old ledgers cannot be recovered. Because the requirement of <code>MinNumRacksPerWriteQuorum=3</code> cannot be fulfilled.</p>
</li>
<li>
<p>If you have configured <code>EnforceMinNumRacksPerWriteQuorum=true</code> and <code>MinNumRacksPerWriteQuorum=2</code>, the BookKeeper client chooses one bookie from Rack1 and Rack2 to recover old ledgers, such as bookie1 and bookie5, to place 2 replicas for Bookie8 and Bookie12. For new ledger creation, it chooses one bookie from Rack1 and Rack2, such as Bookie4 and Bookie7, and a random bookie from either Rack1 or Rack2 to place the last replica.</p>
</li>
</ul>
<p><img decoding="async" loading="lazy" alt="Rack-aware placement policy with an enforced minimum rack size of bookies" src="/assets/images/rack-aware-placement-policy-2-3864fb206aa793fa87a6556b71642968.svg" width="1578" height="461" class="img_ev3q"></p>
<ul>
<li>If you have configured <code>EnforceMinNumRacksPerWriteQuorum=false</code>, the BookKeeper client tries its best effort to apply the placement policy depending on the available number of racks and bookies. It may still work as the above diagram or the following diagram.</li>
</ul>
<p><img decoding="async" loading="lazy" alt="Rack-aware placement policy without an enforced minimum rack size of bookies" src="/assets/images/rack-aware-placement-policy-3-d9ba58be554e438afc505386acf1d94b.svg" width="1578" height="525" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="region-aware-placement-policy">Region-aware placement policy<a href="#region-aware-placement-policy" class="hash-link" aria-label="Direct link to Region-aware placement policy" title="Direct link to Region-aware placement policy">​</a></h3>
<p>Region-aware placement policy enforces different data replicas to be placed in different regions and racks to guarantee region-level disaster tolerance. To achieve datacenter level disaster tolerance, you need to write data replicas into different data centers. You can use <code>RegionAwareEnsemblePlacementPolicy</code> to configure region and rack information for each bookie node to ensure region-level disaster tolerance.</p>
<p>For example, the BookKeeper cluster has 4 regions, and each region has several racks with their bookie instances, as shown in the following diagram. If a topic is configured with <code>EnsembleSize=3, WriteQuorum=3, and AckQuorum=2</code>, the BookKeeper client chooses three different regions, such as Region A, Region C and Region D. For each region, it chooses one bookie on a single rack, such as Bookie5 on Rack2, Bookie17 on Rack6, and Bookie21 on Rack8.</p>
<p><img decoding="async" loading="lazy" alt="Region-aware placement policy" src="/assets/images/region-aware-placement-policy-1-e507d707cb5e369fa91616c45db6421b.svg" width="1656" height="809" class="img_ev3q"></p>
<p>When two regions fail, such as Region B and Region C, as shown in the following diagram, the BookKeeper client chooses one bookie from Region A or Region D to replace the failed Bookie17 for recovering old ledgers. And it also chooses Region A and Region D to write replicas for creating new ledgers. In Region A, it falls back to rack-aware placement policy and chooses one bookie from Rack1 and Rack2, such as Bookie4 and Bookie7. For Region D, it has to choose one bookie from Rack8, such as Bookie22.</p>
<p><img decoding="async" loading="lazy" alt="Region-aware placement policy for disaster tolerance" src="/assets/images/region-aware-placement-policy-2-d85209e840449079d2a46f7ad82df678.svg" width="1734" height="928" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="enable-bookie-data-placement-policy">Enable bookie data placement policy<a href="#enable-bookie-data-placement-policy" class="hash-link" aria-label="Direct link to Enable bookie data placement policy" title="Direct link to Enable bookie data placement policy">​</a></h2>
<p>By default, the rack-aware placement policy is enabled on both broker and bookie sides. If you want to switch to the region-aware placement policy, you need to enable the region-aware placement policy on both broker and bookie sides.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="enable-region-aware-placement-policy-on-broker">Enable region-aware placement policy on broker<a href="#enable-region-aware-placement-policy-on-broker" class="hash-link" aria-label="Direct link to Enable region-aware placement policy on broker" title="Direct link to Enable region-aware placement policy on broker">​</a></h3>
<p>Configure the following field in the <code>conf/broker.conf</code> file.</p>
<div class="language-properties codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-properties codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token key attr-name" style="color:rgb(241, 250, 140)">bookkeeperClientRegionawarePolicyEnabled</span><span class="token punctuation" style="color:rgb(248, 248, 242)">=</span><span class="token value attr-value">true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To enforce the minimum rack size of bookies, configure the following fields:</p>
<div class="language-properties codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-properties codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token key attr-name" style="color:rgb(241, 250, 140)">bookkeeperClientEnforceMinNumRacksPerWriteQuorum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">=</span><span class="token value attr-value">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key attr-name" style="color:rgb(241, 250, 140)">bookkeeperClientMinNumRacksPerWriteQuorum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">=</span><span class="token value attr-value">2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To balance the ledger disk usage of different bookies, you can enable the disk weight placement by configuring the following field:</p>
<div class="language-properties codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-properties codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token key attr-name" style="color:rgb(241, 250, 140)">bookkeeperDiskWeightBasedPlacementEnabled</span><span class="token punctuation" style="color:rgb(248, 248, 242)">=</span><span class="token value attr-value">true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="enable-region-aware-placement-policy-on-the-auto-recovery-instances-pods">Enable region-aware placement policy on the auto-recovery instances (pods)<a href="#enable-region-aware-placement-policy-on-the-auto-recovery-instances-pods" class="hash-link" aria-label="Direct link to Enable region-aware placement policy on the auto-recovery instances (pods)" title="Direct link to Enable region-aware placement policy on the auto-recovery instances (pods)">​</a></h3>
<p>Configure the following fields in the <code>conf/bookkeeper.conf</code> file.</p>
<div class="language-properties codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-properties codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token key attr-name" style="color:rgb(241, 250, 140)">ensemblePlacementPolicy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">=</span><span class="token value attr-value">org.apache.bookkeeper.client.RegionAwareEnsemblePlacementPolicy</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key attr-name" style="color:rgb(241, 250, 140)">reppDnsResolverClass</span><span class="token punctuation" style="color:rgb(248, 248, 242)">=</span><span class="token value attr-value">org.apache.pulsar.zookeeper.ZkBookieRackAffinityMapping</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To enforce the minimum rack size of bookies, configure the following fields:</p>
<div class="language-properties codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-properties codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token key attr-name" style="color:rgb(241, 250, 140)">enforceMinNumRacksPerWriteQuorum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">=</span><span class="token value attr-value">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key attr-name" style="color:rgb(241, 250, 140)">minNumRacksPerWriteQuorum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">=</span><span class="token value attr-value">2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To balance the ledger disk usage of different bookies, you can enable the disk weight placement by configuring the following field:</p>
<div class="language-properties codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-properties codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token key attr-name" style="color:rgb(241, 250, 140)">diskWeightBasedPlacementEnabled</span><span class="token punctuation" style="color:rgb(248, 248, 242)">=</span><span class="token value attr-value">true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="configure-data-placement-policy-on-bookie-instances">Configure data placement policy on bookie instances<a href="#configure-data-placement-policy-on-bookie-instances" class="hash-link" aria-label="Direct link to Configure data placement policy on bookie instances" title="Direct link to Configure data placement policy on bookie instances">​</a></h2>
<p>To configure a data placement policy on bookie instances, you can use one of the following methods.</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Pulsar-admin CLI</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">REST API</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><p>Specify the rack name to represent which region or rack this bookie belongs to.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">bin/pulsar-admin bookies set-bookie-rack</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">The following options are required: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">-b </span><span class="token operator">|</span><span class="token plain"> --bookie</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">, </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">-r </span><span class="token operator">|</span><span class="token plain"> --rack</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Then we need to update the rack placement information </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> a specific bookie </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> the cluster. Note that the bookie address </span><span class="token function" style="color:rgb(80, 250, 123)">format</span><span class="token plain"> is </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">address:port</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Usage: set-bookie-rack </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">options</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Options:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  * -b, </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--bookie</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Bookie address </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">format: </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">address:port</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    -g, </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--group</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Bookie group name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Default: default</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--hostname</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Bookie </span><span class="token function" style="color:rgb(80, 250, 123)">host</span><span class="token plain"> name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  * -r, </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--rack</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Bookie rack name</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>In addition, you can also group bookies across racks or regions to serve broker-level isolation by specifying a group name for each bookie and assigning the group name to a specific namespace. See <a href="#configure-bookie-affinity-groups">configure bookie affinity groups</a> for more details.</p></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p><a href="https://pulsar.apache.org/admin-rest-api?version=3.1.3&amp;apiversion=v2#operation/updateBookieRackInfo" target="_blank" rel="noopener noreferrer">POST /admin/v2/bookies/racks-info/<!-- -->:bookie<!-- -->/updateBookieRackInfo</a></p></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="example-of-configuring-rack-aware-placement-policy">Example of configuring rack-aware placement policy<a href="#example-of-configuring-rack-aware-placement-policy" class="hash-link" aria-label="Direct link to Example of configuring rack-aware placement policy" title="Direct link to Example of configuring rack-aware placement policy">​</a></h4>
<p>The following is an example of how to configure bookie instances with their rack properties.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">bin/pulsar-admin bookies set-bookie-rack </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--bookie</span><span class="token plain"> bookie1:3181 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--hostname</span><span class="token plain"> bookie1.pulsar.com:3181 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--group</span><span class="token plain"> group1 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--rack</span><span class="token plain"> rack1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">bin/pulsar-admin bookies set-bookie-rack </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--bookie</span><span class="token plain"> bookie2:3181 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--hostname</span><span class="token plain"> bookie2.pulsar.com:3181 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--group</span><span class="token plain"> group1 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--rack</span><span class="token plain"> rack1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">bin/pulsar-admin bookies set-bookie-rack </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--bookie</span><span class="token plain"> bookie3:3181 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--hostname</span><span class="token plain"> bookie3.pulsar.com:3181 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--group</span><span class="token plain"> group1 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--rack</span><span class="token plain"> rack1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">bin/pulsar-admin bookies set-bookie-rack </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--bookie</span><span class="token plain"> bookie4:3181 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--hostname</span><span class="token plain"> bookie4.pulsar.com:3181 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--group</span><span class="token plain"> group1 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--rack</span><span class="token plain"> rack1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">bin/pulsar-admin bookies set-bookie-rack </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--bookie</span><span class="token plain"> bookie5:3181 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--hostname</span><span class="token plain"> bookie5.pulsar.com:3181 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--group</span><span class="token plain"> group1 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--rack</span><span class="token plain"> rack2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="example-of-configuring-region-aware-placement-policy">Example of configuring region-aware placement policy<a href="#example-of-configuring-region-aware-placement-policy" class="hash-link" aria-label="Direct link to Example of configuring region-aware placement policy" title="Direct link to Example of configuring region-aware placement policy">​</a></h4>
<p>The following is an example of how to configure bookie instances with their region/rack properties.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">bin/pulsar-admin bookies set-bookie-rack </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--bookie</span><span class="token plain"> bookie1:3181 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--hostname</span><span class="token plain"> bookie1.pulsar.com:3181 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--group</span><span class="token plain"> group1 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--rack</span><span class="token plain"> RegionA/rack1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">bin/pulsar-admin bookies set-bookie-rack </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--bookie</span><span class="token plain"> bookie2:3181 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--hostname</span><span class="token plain"> bookie2.pulsar.com:3181 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--group</span><span class="token plain"> group1 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--rack</span><span class="token plain"> RegionA/rack1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">bin/pulsar-admin bookies set-bookie-rack </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--bookie</span><span class="token plain"> bookie3:3181 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--hostname</span><span class="token plain"> bookie3.pulsar.com:3181 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--group</span><span class="token plain"> group1 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--rack</span><span class="token plain"> RegionA/rack1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">bin/pulsar-admin bookies set-bookie-rack </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--bookie</span><span class="token plain"> bookie4:3181 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--hostname</span><span class="token plain"> bookie4.pulsar.com:3181 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--group</span><span class="token plain"> group1 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--rack</span><span class="token plain"> RegionA/rack1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">bin/pulsar-admin bookies set-bookie-rack </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--bookie</span><span class="token plain"> bookie5:3181 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--hostname</span><span class="token plain"> bookie5.pulsar.com:3181 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--group</span><span class="token plain"> group1 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--rack</span><span class="token plain"> RegionA/rack2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">bin/pulsar-admin bookies set-bookie-rack </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--bookie</span><span class="token plain"> bookie6:3181 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--hostname</span><span class="token plain"> bookie6.pulsar.com:3181 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--group</span><span class="token plain"> group1 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--rack</span><span class="token plain"> RegionA/rack2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">bin/pulsar-admin bookies set-bookie-rack </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--bookie</span><span class="token plain"> bookie7:3181 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--hostname</span><span class="token plain"> bookie7.pulsar.com:3181 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--group</span><span class="token plain"> group1 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--rack</span><span class="token plain"> RegionA/rack2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">bin/pulsar-admin bookies set-bookie-rack </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--bookie</span><span class="token plain"> bookie8:3181 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--hostname</span><span class="token plain"> bookie8.pulsar.com:3181 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--group</span><span class="token plain"> group1 </span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--rack</span><span class="token plain"> RegionB/rack3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="configure-bookie-affinity-groups">Configure bookie affinity groups<a href="#configure-bookie-affinity-groups" class="hash-link" aria-label="Direct link to Configure bookie affinity groups" title="Direct link to Configure bookie affinity groups">​</a></h2>
<p>The data of a namespace can be isolated into user-defined groups of bookies, as known as bookie affinity groups, which guarantee all the data that belongs to the namespace is stored in desired bookies.</p>
<p><strong>Prerequisites:</strong> Before configuring bookie affinity groups, you need to group bookies first. See <a href="#configure-data-placement-policy-on-bookie-instances">configure data placement policy on bookie instances</a> for more details.</p>
<p>To configure bookie affinity groups, you can use one of the following methods.</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Pulsar-admin CLI</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">REST API</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Java admin API</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">pulsar-admin namespaces set-bookie-affinity-group options</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>For more information about the command <code>pulsar-admin namespaces set-bookie-affinity-group options</code>, see <a href="/reference/#/3.1.x/pulsar-admin/" target="_blank" rel="noopener noreferrer">Pulsar admin docs</a>.</p><p><strong>Example</strong></p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">bin/pulsar-admin bookies set-bookie-rack </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--bookie</span><span class="token plain"> </span><span class="token number">127.0</span><span class="token plain">.0.1:3181 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--hostname</span><span class="token plain"> </span><span class="token number">127.0</span><span class="token plain">.0.1:3181 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--group</span><span class="token plain"> group-bookie1 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token parameter variable" style="color:rgb(189, 147, 249);font-style:italic">--rack</span><span class="token plain"> rack1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">bin/pulsar-admin namespaces set-bookie-affinity-group public/default </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--primary-group group-bookie1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><ul>
<li>Do not set a bookie rack name to slash (<code>/</code>) or an empty string (<code>&quot;&quot;</code>) if you use Pulsar earlier than 2.7.5, 2.8.3, and 2.9.2. If you use Pulsar 2.7.5, 2.8.3, 2.9.2 or later versions, it falls back to <code>/default-rack</code> or <code>/default-region/default-rack</code>.</li>
<li>When <code>RackawareEnsemblePlacementPolicy</code> is enabled, the rack name is not allowed to contain one slash (<code>/</code>) except for the beginning and end of the rack name string. For example, a rack name like <code>/rack0</code> is allowed, but <code>/rack/0</code> is invalid.</li>
<li>When <code>RegionAwareEnsemblePlacementPolicy</code> is enabled, the rack name can only contain one slash (<code>/</code>) except for the beginning and end of the rack name string. For example, rack name like <code>/region0/rack0</code> is allowed, but <code>/region0rack0</code> and <code>/region0/rack/0</code> are invalid.
For the bookie rack name restrictions, see <a href="/reference/#/3.1.x/pulsar-admin/bookies?id=set-bookie-rack" target="_blank" rel="noopener noreferrer">pulsar-admin bookies set-bookie-rack</a>.</li>
</ul></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p><a href="https://pulsar.apache.org/admin-rest-api?version=3.1.3&amp;apiversion=v2#operation/setBookieAffinityGroup" target="_blank" rel="noopener noreferrer">POST /admin/v2/namespaces/<!-- -->:tenant<!-- -->/<!-- -->:namespace<!-- -->/persistence/bookieAffinity/setBookieAffinityGroup</a></p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>For how to set bookie affinity group for a namespace using Java admin API, see <a href="https://github.com/apache/pulsar/blob/master/pulsar-client-admin/src/main/java/org/apache/pulsar/client/admin/internal/NamespacesImpl.java#L1164" target="_blank" rel="noopener noreferrer">code</a>.</p></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/apache/pulsar-site/edit/main/versioned_docs/version-3.1.x/administration-isolation-bookie.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/3.1.x/administration-isolation-broker/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Isolate brokers</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/3.1.x/administration-stats/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Statistics</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_jeP5 thin-scrollbar theme-doc-toc-desktop"><div class="border"><div style="color:var(--ifm-toc-link-color)">Was this helpful?</div><div style="border-width:1px;padding:3px;display:flex"><div style="justify-content:center;display:flex;border-radius:99999px;width:2.5rem;height:2.5rem;cursor:pointer"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="24" fill="none" style="width:initial;height:initial" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M10.086 1.594A1 1 0 0 1 11 1a4 4 0 0 1 4 4v3h4.655a3 3 0 0 1 2.994 3.45l-1.38 9A3 3 0 0 1 18.275 23H4a3 3 0 0 1-3-3v-7a3 3 0 0 1 3-3h2.35zM8 11.212l3.608-8.117A2 2 0 0 1 13 5v4a1 1 0 0 0 1 1h5.671a1 1 0 0 1 1 1.15l-1.38 9a1 1 0 0 1-1 .85H8zM6 21v-9H4a1 1 0 0 0-1 1v7a1 1 0 0 0 1 1z" clip-rule="evenodd"></path></svg></div><div style="justify-content:center;display:flex;border-radius:99999px;width:2.5rem;height:2.5rem;cursor:pointer"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="24" fill="none" style="width:initial;height:initial" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M20.563 3.316A1.3 1.3 0 0 0 19.687 3h-1.688v9h1.688a1.31 1.31 0 0 0 1.312-1.077V4.077a1.3 1.3 0 0 0-.436-.761M16 12.788l-3.608 8.118A2 2 0 0 1 11 19v-4a1 1 0 0 0-1-1H4.328a1.002 1.002 0 0 1-1-1.15l1.38-9a1 1 0 0 1 1-.85h10.291zM19.661 1a3.31 3.31 0 0 1 3.329 2.866Q23 3.933 23 4v7q0 .068-.01.134A3.31 3.31 0 0 1 19.661 14h-2.012l-3.736 8.406a1 1 0 0 1-.914.594 4 4 0 0 1-4-4v-3H4.344a3 3 0 0 1-2.994-3.45l1.38-9A3 3 0 0 1 5.724 1z" clip-rule="evenodd"></path></svg></div></div><div class="Actions_uugI"><a target="_blank" class="Action_iBHd" href="https://github.com/apache/pulsar/issues/new?assignees=&amp;labels=doc-required&amp;projects=&amp;template=doc.yml&amp;title=%5BDoc%5D+">💡 Suggest changes</a><a target="_blank" class="Action_iBHd" href="https://github.com/apache/pulsar/discussions/new?category=q-a">🛟 Get support</a></div></div><ul class="table-of-contents table-of-contents__left-border"><li><a href="#understand-bookie-data-isolation-policy" class="table-of-contents__link toc-highlight">Understand bookie data isolation policy</a><ul><li><a href="#rack-aware-placement-policy" class="table-of-contents__link toc-highlight">Rack-aware placement policy</a></li><li><a href="#region-aware-placement-policy" class="table-of-contents__link toc-highlight">Region-aware placement policy</a></li></ul></li><li><a href="#enable-bookie-data-placement-policy" class="table-of-contents__link toc-highlight">Enable bookie data placement policy</a><ul><li><a href="#enable-region-aware-placement-policy-on-broker" class="table-of-contents__link toc-highlight">Enable region-aware placement policy on broker</a></li><li><a href="#enable-region-aware-placement-policy-on-the-auto-recovery-instances-pods" class="table-of-contents__link toc-highlight">Enable region-aware placement policy on the auto-recovery instances (pods)</a></li></ul></li><li><a href="#configure-data-placement-policy-on-bookie-instances" class="table-of-contents__link toc-highlight">Configure data placement policy on bookie instances</a></li><li><a href="#configure-bookie-affinity-groups" class="table-of-contents__link toc-highlight">Configure bookie affinity groups</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Foundation<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.apache.org/events/current-event.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Events<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="footer__link-item">License<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.apache.org/foundation/thanks" target="_blank" rel="noopener noreferrer" class="footer__link-item">Thanks<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.apache.org/foundation/sponsorship" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sponsorship<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/security/">Security</a></li><li class="footer__item"><a href="https://www.apache.org/foundation/policies/privacy.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/contact/">Contact</a></li></ul></div><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item">
                <div class="social-icons">
                  <a target="_blank" href="https://communityinviter.com/apps/apache-pulsar/apache-pulsar" aria-label="Join the Apache Pulsar Slack workspace">
                    <img alt="Slack logo" src="/img/slack-white.svg" width="26">
                  </a>
                  <a target="_blank" href="https://github.com/apache/pulsar/" aria-label="View the Apache Pulsar project on GitHub">
                    <img alt="GitHub logo" src="/img/github-white.svg" width="26">
                  </a>
                </div>
              </li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a class="footerLogoLink_BH7S" href="/"><img src="/img/pulsar-white.svg" alt="Pulsar Logo" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/pulsar-white.svg" alt="Pulsar Logo" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU"></a></div><div class="footer__copyright">
        <div>
          <img class="footer-apache-logo" src="/img/feather-logo-white.svg" alt="" width="20">
          The Apache Software Foundation
        </div>
        <p>Apache Pulsar is available under the Apache License, version 2.0. Apache Pulsar is an open-source, distributed messaging and streaming platform built for the cloud.</p>
        <p>Copyright © 2025 The Apache Software Foundation. All Rights Reserved. Apache, Pulsar, Apache Pulsar, and the Apache feather logo are trademarks or registered trademarks of The Apache Software Foundation.</p>
      </div></div></div></footer></div>
</body>
</html>