<!doctype html>
<html class="docs-version-2.2.1" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache Pulsar RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache Pulsar Atom Feed">
<script src="https://cdn.jsdelivr.net/npm/sine-waves@0.3.0/sine-waves.min.js" async></script><title data-react-helmet="true">Pulsar Encryption | Apache Pulsar</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://pulsar.apache.com/docs/2.2.1/security-encryption"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="2.2.1"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-2.2.1"><meta data-react-helmet="true" property="og:title" content="Pulsar Encryption | Apache Pulsar"><meta data-react-helmet="true" name="description" content="Applications can use Pulsar encryption to encrypt messages at the producer side and decrypt messages at the consumer side. You can use the public and private key pair that the application configures to perform encryption. Only the consumers with a valid key can decrypt the encrypted messages."><meta data-react-helmet="true" property="og:description" content="Applications can use Pulsar encryption to encrypt messages at the producer side and decrypt messages at the consumer side. You can use the public and private key pair that the application configures to perform encryption. Only the consumers with a valid key can decrypt the encrypted messages."><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://pulsar.apache.com/docs/2.2.1/security-encryption"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.com/docs/2.2.1/security-encryption" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.com/docs/2.2.1/security-encryption" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.3955ee91.css">
<link rel="preload" href="/assets/js/runtime~main.a7637c0d.js" as="script">
<link rel="preload" href="/assets/js/main.6c72d4d6.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="tailwind navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="pulasr logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/logo.svg" alt="pulasr logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title"></b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">Get Started</a><ul class="dropdown__menu"><li><a class="dropdown__link navbar__link--active" href="/docs/2.2.1/concepts-overview">Pulsar Concepts</a></li><li><a class="dropdown__link navbar__link--active" href="/docs/2.2.1/about">Quickstart</a></li><li><a class="dropdown__link" href="/ecosystem">Ecosystem</a></li></ul></div><a class="navbar__item navbar__link navbar__link--active" href="/docs/2.2.1/">Docs</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">REST APIs</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/admin-rest-api">Admin REST API</a></li><li><a class="dropdown__link" href="/functions-rest-api">Functions</a></li><li><a class="dropdown__link" href="/source-rest-api">Sources</a></li><li><a class="dropdown__link" href="/sink-rest-api">Sinks</a></li><li><a class="dropdown__link" href="/packages-rest-api">Packages</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">CLI</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/pulsar-admin-cli">Pulsar Admin</a></li><li><a class="dropdown__link" href="/pulsar-client-cli">Pulsar Client</a></li><li><a class="dropdown__link" href="/pulsar-perf-cli">Pulsar Perf</a></li><li><a class="dropdown__link" href="/pulsar-cli">Pulsar</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">Community</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/community#welcome">Welcome</a></li><li><a class="dropdown__link" href="/community#discussions">Discussions</a></li><li><a class="dropdown__link" href="/community#governance">Governance</a></li><li><a class="dropdown__link" href="/community#community">Meet the Community</a></li><li><a class="dropdown__link" href="/community#how-to-contribute">Contribute</a></li><li><a href="https://github.com/apache/pulsar/wiki" target="_blank" rel="noopener noreferrer" class="dropdown__link">Wiki</a></li><li><a href="https://github.com/apache/pulsar/issues" target="_blank" rel="noopener noreferrer" class="dropdown__link">Issue Tracking</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">Learn</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/blog">Blog</a></li><li><a class="dropdown__link" href="/case-studies">Case Studies</a></li><li><a class="dropdown__link" href="/resources">Resources</a></li><li><a class="dropdown__link" href="/events">Events</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link" href="/docs">Version</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/">2.9.1</a></li><li><a class="dropdown__link" href="/docs/2.9.0/">2.9.0</a></li><li><a class="dropdown__link" href="/docs/2.8.2/">2.8.2</a></li><li><a class="dropdown__link" href="/docs/2.8.1/">2.8.1</a></li><li><a class="dropdown__link" href="/docs/2.8.0/">2.8.0</a></li><li><a class="dropdown__link" href="/docs/2.7.3/">2.7.3</a></li><li><a class="dropdown__link" href="/docs/2.7.2/">2.7.2</a></li><li><a class="dropdown__link" href="/docs/2.7.1/">2.7.1</a></li><li><a class="dropdown__link" href="/docs/2.7.0/">2.7.0</a></li><li><a class="dropdown__link" href="/docs/2.6.4/">2.6.4</a></li><li><a class="dropdown__link" href="/docs/2.6.3/">2.6.3</a></li><li><a class="dropdown__link" href="/docs/2.6.2/">2.6.2</a></li><li><a class="dropdown__link" href="/docs/2.6.1/">2.6.1</a></li><li><a class="dropdown__link" href="/docs/2.6.0/">2.6.0</a></li><li><a class="dropdown__link" href="/docs/2.2.0/">2.2.0</a></li></ul></div><div class="toggle_iYfV toggle_iQ2x toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">üåú</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">üåû</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/2.2.1/about">About</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/2.2.1/pulsar-2.0">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/2.2.1/concepts-overview">Concepts and Architecture</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/2.2.1/functions-overview">Pulsar Functions</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/2.2.1/io-overview">Pulsar IO</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/2.2.1/sql-overview">Pulsar SQL</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/2.2.1/deploy-aws">Deployment</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/2.2.1/administration-zk-bk">Administration</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" href="/docs/2.2.1/security-overview">Security</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.2.1/security-overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.2.1/security-tls-transport">Transport Encryption using TLS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.2.1/security-tls-authentication">Authentication using TLS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.2.1/security-athenz">Authentication using Athenz</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.2.1/security-authorization">Authorization and ACLs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/2.2.1/security-encryption">End-to-End Encryption</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.2.1/security-extending">Extending</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/2.2.1/client-libraries-java">Client Libraries</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/2.2.1/admin-api-overview">Admin API</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/2.2.1/adaptors-kafka">Adaptors</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/2.2.1/cookbooks-tiered-storage">Cookbooks</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/2.2.1/develop-tools">Development</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/2.2.1/reference-terminology">Reference</a></div></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->Apache Pulsar<!-- --> <b>2.2.1</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/docs/security-encryption">latest version</a></b> (<!-- -->2.9.1<!-- -->).</div></div><div class="docItemContainer_oiyr"><article><span class="theme-doc-version-badge badge badge--secondary">Version: <!-- -->2.2.1</span><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Pulsar Encryption</h1></header><p>Applications can use Pulsar encryption to encrypt messages at the producer side and decrypt messages at the consumer side. You can use the public and private key pair that the application configures to perform encryption. Only the consumers with a valid key can decrypt the encrypted messages.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="asymmetric-and-symmetric-encryption">Asymmetric and symmetric encryption<a class="hash-link" href="#asymmetric-and-symmetric-encryption" title="Direct link to heading">‚Äã</a></h2><p>Pulsar uses dynamically generated symmetric AES key to encrypt messages(data). You can use the application provided ECDSA/RSA key pair to encrypt the AES key(data key), so you do not have to share the secret with everyone.</p><p>Key is a public and private key pair used for encryption or decryption. The producer key is the public key of the key pair, and the consumer key is the private key of the key pair.</p><p>The application configures the producer with the public key. You can use this key to encrypt the AES data key. The encrypted data key is sent as part of message header. Only entities with the private key (in this case the consumer) are able to decrypt the data key which is used to decrypt the message.</p><p>You can encrypt a message with more than one key. Any one of the keys used for encrypting the message is sufficient to decrypt the message.</p><p>Pulsar does not store the encryption key anywhere in the Pulsar service. If you lose or delete the private key, your message is irretrievably lost, and is unrecoverable.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="producer">Producer<a class="hash-link" href="#producer" title="Direct link to heading">‚Äã</a></h2><p><img alt="alt text" src="/assets/images/pulsar-encryption-producer-1d7f4562a5c743e0442a0ec472ca8ef6.jpg" title="Pulsar Encryption Producer"></p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="consumer">Consumer<a class="hash-link" href="#consumer" title="Direct link to heading">‚Äã</a></h2><p><img alt="alt text" src="/assets/images/pulsar-encryption-consumer-2831a122b5b79a1619d00af823b2506c.jpg" title="Pulsar Encryption Consumer"></p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="get-started">Get started<a class="hash-link" href="#get-started" title="Direct link to heading">‚Äã</a></h2><ol><li>Enter the commands below to create your ECDSA or RSA public and private key pair.</li></ol><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">openssl ecparam -name secp521r1 -genkey -param_enc explicit -out test_ecdsa_privkey.pem</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">openssl ec -in test_ecdsa_privkey.pem -pubout -outform pem -out test_ecdsa_pubkey.pem</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ol start="2"><li><p>Add the public and private key to the key management and configure your producers to retrieve public keys and consumers clients to retrieve private keys.</p></li><li><p>Implement the CryptoKeyReader interface, specifically CryptoKeyReader.getPublicKey() for producer and CryptoKeyReader.getPrivateKey() for consumer, which Pulsar client invokes to load the key.</p></li><li><p>Add encryption key name to producer builder: PulsarClient.newProducer().addEncryptionKey(&quot;myapp.key&quot;).</p></li><li><p>Configure a <code>CryptoKeyReader</code> to a producer, consumer or reader. </p></li></ol><div class="tabs-container"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_vU9c tabs__item--active">Java</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_vU9c">C++</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_vU9c">Python</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_vU9c">Node.JS</li></ul><div class="margin-vert--md"><div role="tabpanel"><div class="codeBlockContainer_J+bg language-java theme-code-block"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PulsarClient pulsarClient = PulsarClient.builder().serviceUrl(&quot;pulsar://localhost:6650&quot;).build();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">String topic = &quot;persistent://my-tenant/my-ns/my-topic&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// RawFileKeyReader is just an example implementation that&#x27;s not provided by Pulsar</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CryptoKeyReader keyReader = new RawFileKeyReader(&quot;test_ecdsa_pubkey.pem&quot;, &quot;test_ecdsa_privkey.pem&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Producer&lt;byte[]&gt; producer = pulsarClient.newProducer()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .topic(topic)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .cryptoKeyReader(keyReader)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .addEncryptionKey(‚Äúmyappkey‚Äù)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .create();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Consumer&lt;byte[]&gt; consumer = pulsarClient.newConsumer()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .topic(topic)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .subscriptionName(&quot;my-subscriber-name&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .cryptoKeyReader(keyReader)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .subscribe();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Reader&lt;byte[]&gt; reader = pulsarClient.newReader()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .topic(topic)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .startMessageId(MessageId.earliest)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .cryptoKeyReader(keyReader)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .create();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></div><div role="tabpanel" hidden=""><div class="codeBlockContainer_J+bg language-c++ theme-code-block"><div class="codeBlockContent_csEI c++"><pre tabindex="0" class="prism-code language-c++ codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Client client(&quot;pulsar://localhost:6650&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">std::string topic = &quot;persistent://my-tenant/my-ns/my-topic&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// DefaultCryptoKeyReader is a built-in implementation that reads public key and private key from files</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">auto keyReader = std::make_shared&lt;DefaultCryptoKeyReader&gt;(&quot;test_ecdsa_pubkey.pem&quot;, &quot;test_ecdsa_privkey.pem&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Producer producer;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ProducerConfiguration producerConf;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">producerConf.setCryptoKeyReader(keyReader);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">producerConf.addEncryptionKey(&quot;myappkey&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">client.createProducer(topic, producerConf, producer);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Consumer consumer;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ConsumerConfiguration consumerConf;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">consumerConf.setCryptoKeyReader(keyReader);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">client.subscribe(topic, &quot;my-subscriber-name&quot;, consumerConf, consumer);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Reader reader;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ReaderConfiguration readerConf;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">readerConf.setCryptoKeyReader(keyReader);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">client.createReader(topic, MessageId::earliest(), readerConf, reader);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></div><div role="tabpanel" hidden=""><div class="codeBlockContainer_J+bg language-python theme-code-block"><div class="codeBlockContent_csEI python"><pre tabindex="0" class="prism-code language-python codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> pulsar </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> Client</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> CryptoKeyReader</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">client </span><span class="token operator">=</span><span class="token plain"> Client</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;pulsar://localhost:6650&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">topic </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;persistent://my-tenant/my-ns/my-topic&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># CryptoKeyReader is a built-in implementation that reads public key and private key from files</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">key_reader </span><span class="token operator">=</span><span class="token plain"> CryptoKeyReader</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;test_ecdsa_pubkey.pem&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;test_ecdsa_privkey.pem&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">producer </span><span class="token operator">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">create_producer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    topic</span><span class="token operator">=</span><span class="token plain">topic</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    encryption_key</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;myappkey&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    crypto_key_reader</span><span class="token operator">=</span><span class="token plain">key_reader</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">consumer </span><span class="token operator">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">subscribe</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    topic</span><span class="token operator">=</span><span class="token plain">topic</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    subscription_name</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;my-subscriber-name&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    crypto_key_reader</span><span class="token operator">=</span><span class="token plain">key_reader</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">reader </span><span class="token operator">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">create_reader</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    topic</span><span class="token operator">=</span><span class="token plain">topic</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    start_message_id</span><span class="token operator">=</span><span class="token plain">MessageId</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">earliest</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    crypto_key_reader</span><span class="token operator">=</span><span class="token plain">key_reader</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">client</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">close</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></div><div role="tabpanel" hidden=""><div class="codeBlockContainer_J+bg language-nodejs theme-code-block"><div class="codeBlockContent_csEI nodejs"><pre tabindex="0" class="prism-code language-nodejs codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">const Pulsar = require(&#x27;pulsar-client&#x27;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">(async () =&gt; {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// Create a client</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">const client = new Pulsar.Client({</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    serviceUrl: &#x27;pulsar://localhost:6650&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    operationTimeoutSeconds: 30,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">});</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// Create a producer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">const producer = await client.createProducer({</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    topic: &#x27;persistent://public/default/my-topic&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    sendTimeoutMs: 30000,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    batchingEnabled: true,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    publicKeyPath: &quot;public-key.client-rsa.pem&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    encryptionKey: &quot;encryption-key&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">});</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// Create a consumer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">const consumer = await client.subscribe({</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    topic: &#x27;persistent://public/default/my-topic&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    subscription: &#x27;sub1&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    subscriptionType: &#x27;Shared&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ackTimeoutMs: 10000,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    privateKeyPath: &quot;private-key.client-rsa.pem&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">});</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// Send messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">for (let i = 0; i &lt; 10; i += 1) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    const msg = `my-message-${i}`;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    producer.send({</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    data: Buffer.from(msg),</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    console.log(`Sent message: ${msg}`);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">await producer.flush();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// Receive messages</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">for (let i = 0; i &lt; 10; i += 1) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    const msg = await consumer.receive();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    console.log(msg.getData().toString());</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    consumer.acknowledge(msg);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">await consumer.close();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">await producer.close();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">await client.close();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">})();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></div></div></div><ol start="6"><li>Below is an example of a <strong>customized</strong> <code>CryptoKeyReader</code> implementation.</li></ol><div class="tabs-container"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_vU9c tabs__item--active">Java</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_vU9c">C++</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_vU9c">Python</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_vU9c">Node.JS</li></ul><div class="margin-vert--md"><div role="tabpanel"><div class="codeBlockContainer_J+bg language-java theme-code-block"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">class RawFileKeyReader implements CryptoKeyReader {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    String publicKeyFile = &quot;&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    String privateKeyFile = &quot;&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    RawFileKeyReader(String pubKeyFile, String privKeyFile) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        publicKeyFile = pubKeyFile;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        privateKeyFile = privKeyFile;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public EncryptionKeyInfo getPublicKey(String keyName, Map&lt;String, String&gt; keyMeta) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        EncryptionKeyInfo keyInfo = new EncryptionKeyInfo();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            keyInfo.setKey(Files.readAllBytes(Paths.get(publicKeyFile)));</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        } catch (IOException e) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            System.out.println(&quot;ERROR: Failed to read public key from file &quot; + publicKeyFile);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            e.printStackTrace();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        return keyInfo;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public EncryptionKeyInfo getPrivateKey(String keyName, Map&lt;String, String&gt; keyMeta) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        EncryptionKeyInfo keyInfo = new EncryptionKeyInfo();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            keyInfo.setKey(Files.readAllBytes(Paths.get(privateKeyFile)));</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        } catch (IOException e) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            System.out.println(&quot;ERROR: Failed to read private key from file &quot; + privateKeyFile);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            e.printStackTrace();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        return keyInfo;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></div><div role="tabpanel" hidden=""><div class="codeBlockContainer_J+bg language-c++ theme-code-block"><div class="codeBlockContent_csEI c++"><pre tabindex="0" class="prism-code language-c++ codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">class CustomCryptoKeyReader : public CryptoKeyReader {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Result getPublicKey(const std::string&amp; keyName, std::map&lt;std::string, std::string&gt;&amp; metadata,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        EncryptionKeyInfo&amp; encKeyInfo) const override {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // TODO:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        return ResultOk;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Result getPrivateKey(const std::string&amp; keyName, std::map&lt;std::string, std::string&gt;&amp; metadata,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        EncryptionKeyInfo&amp; encKeyInfo) const override {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        // TODO:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        return ResultOk;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">};</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">auto keyReader = std::make_shared&lt;CustomCryptoKeyReader&gt;(/* ... */);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// TODO: create producer, consumer or reader based on keyReader here</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Besides, you can use the <strong>default</strong> implementation of <code>CryptoKeyReader</code> by specifying the paths of <code>private key</code> and <code>public key</code>.</p></div><div role="tabpanel" hidden=""><p>Currently, <strong>customized</strong> <code>CryptoKeyReader</code> implementation is not supported in Python. However, you can use the <strong>default</strong> implementation by specifying the path of <code>private key</code> and <code>public key</code>.</p></div><div role="tabpanel" hidden=""><p>Currently, <strong>customized</strong> <code>CryptoKeyReader</code> implementation is not supported in Node.JS. However, you can use the <strong>default</strong> implementation by specifying the path of <code>private key</code> and <code>public key</code>.</p></div></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="key-rotation">Key rotation<a class="hash-link" href="#key-rotation" title="Direct link to heading">‚Äã</a></h2><p>Pulsar generates a new AES data key every 4 hours or after publishing a certain number of messages. A producer fetches the asymmetric public key every 4 hours by calling CryptoKeyReader.getPublicKey() to retrieve the latest version.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="enable-encryption-at-the-producer-application">Enable encryption at the producer application<a class="hash-link" href="#enable-encryption-at-the-producer-application" title="Direct link to heading">‚Äã</a></h2><p>If you produce messages that are consumed across application boundaries, you need to ensure that consumers in other applications have access to one of the private keys that can decrypt the messages. You can do this in two ways:</p><ol><li>The consumer application provides you access to their public key, which you add to your producer keys.</li><li>You grant access to one of the private keys from the pairs that producer uses. </li></ol><p>When producers want to encrypt the messages with multiple keys, producers add all such keys to the config. Consumer can decrypt the message as long as the consumer has access to at least one of the keys.</p><p>If you need to encrypt the messages using 2 keys (myapp.messagekey1 and myapp.messagekey2), refer to the following example.</p><div class="codeBlockContainer_J+bg language-java theme-code-block"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PulsarClient.newProducer().addEncryptionKey(&quot;myapp.messagekey1&quot;).addEncryptionKey(&quot;myapp.messagekey2&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="decrypt-encrypted-messages-at-the-consumer-application">Decrypt encrypted messages at the consumer application<a class="hash-link" href="#decrypt-encrypted-messages-at-the-consumer-application" title="Direct link to heading">‚Äã</a></h2><p>Consumers require access one of the private keys to decrypt messages that the producer produces. If you want to receive encrypted messages, create a public or private key and give your public key to the producer application to encrypt messages using your public key.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="handle-failures">Handle failures<a class="hash-link" href="#handle-failures" title="Direct link to heading">‚Äã</a></h2><ul><li>Producer/ Consumer loses access to the key<ul><li>Producer action fails indicating the cause of the failure. Application has the option to proceed with sending unencrypted message in such cases. Call PulsarClient.newProducer().cryptoFailureAction(ProducerCryptoFailureAction) to control the producer behavior. The default behavior is to fail the request.</li><li>If consumption fails due to decryption failure or missing keys in consumer, application has the option to consume the encrypted message or discard it. Call PulsarClient.newConsumer().cryptoFailureAction(ConsumerCryptoFailureAction) to control the consumer behavior. The default behavior is to fail the request. Application is never able to decrypt the messages if the private key is permanently lost.</li></ul></li><li>Batch messaging<ul><li>If decryption fails and the message contains batch messages, client is not able to retrieve individual messages in the batch, hence message consumption fails even if cryptoFailureAction() is set to ConsumerCryptoFailureAction.CONSUME.</li></ul></li><li>If decryption fails, the message consumption stops and application notices backlog growth in addition to decryption failure messages in the client log. If application does not have access to the private key to decrypt the message, the only option is to skip or discard backlogged messages.</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/apache/pulsar/edit/master/site2/website-next/versioned_docs/version-2.2.1/security-encryption.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/2.2.1/security-authorization"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Authorization and ACLs</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/2.2.1/security-extending"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Extending</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#asymmetric-and-symmetric-encryption" class="table-of-contents__link toc-highlight">Asymmetric and symmetric encryption</a></li><li><a href="#producer" class="table-of-contents__link toc-highlight">Producer</a></li><li><a href="#consumer" class="table-of-contents__link toc-highlight">Consumer</a></li><li><a href="#get-started" class="table-of-contents__link toc-highlight">Get started</a></li><li><a href="#key-rotation" class="table-of-contents__link toc-highlight">Key rotation</a></li><li><a href="#enable-encryption-at-the-producer-application" class="table-of-contents__link toc-highlight">Enable encryption at the producer application</a></li><li><a href="#decrypt-encrypted-messages-at-the-consumer-application" class="table-of-contents__link toc-highlight">Decrypt encrypted messages at the consumer application</a></li><li><a href="#handle-failures" class="table-of-contents__link toc-highlight">Handle failures</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Apache Foundation.</div><ul class="footer__items"><li class="footer__item">
	              <img src="/img/Apache_Feather_Logo.svg" alt="" width="20">
	              </li><li class="footer__item"><a href="http://www.apache.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Foundation<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.apache.org/events/current-event.html" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Events<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>License<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.apache.org/foundation/thanks" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Thanks<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.apache.org/security" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Security<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.apache.org/foundation/sponsorship" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Sponsorship<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title"> </div><ul class="footer__items"><li class="footer__item">
	              <div><small><strong>Apache Pulsar is available under the <a href="/">Apache License, version 2.0.</a></strong></small></div>
                <div>Apache Pulsar is a distributed, open source pub-sub messaging and streaming platform for real-time workloads, managing hundreds of billions of events per day.</div>
	              </li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a class="footerLogoLink_SRtH" href="/"><img src="/img/pulsar-white.svg" alt="Pulsar Logo" class="themedImage_TMUO themedImage--light_4Vu1 footer__logo"><img src="/img/pulsar-white.svg" alt="Pulsar Logo" class="themedImage_TMUO themedImage--dark_uzRr footer__logo"></a></div><div class="footer__copyright"><p>Apache Pulsar is available under the Apache License, version 2.0.</p>
      <p>Inc.Copyright ¬© 2022 The Apache Software Foundation. All Rights Reserved. Apache, Apache Pulsar and the Apache feather logo are trademarks of The Apache Software Foundation.</p></div></div></div></footer></div>
<script src="/assets/js/runtime~main.a7637c0d.js"></script>
<script src="/assets/js/main.6c72d4d6.js"></script>
</body>
</html>