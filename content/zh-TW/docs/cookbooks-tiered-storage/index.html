<!doctype html>
<html class="docs-version-2.9.1" lang="zh-TW" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="alternate" type="application/rss+xml" href="/zh-TW/blog/rss.xml" title="Apache Pulsar RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh-TW/blog/atom.xml" title="Apache Pulsar Atom Feed">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Red+Hat+Display:wght@300;400;600&display=swap">
<script src="https://cdn.jsdelivr.net/npm/sine-waves@0.3.0/sine-waves.min.js" async></script><title data-react-helmet="true">Tiered Storage | Apache Pulsar</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://pulsar.apache.com/zh-TW/docs/cookbooks-tiered-storage"><meta data-react-helmet="true" name="docusaurus_locale" content="zh-TW"><meta data-react-helmet="true" name="docusaurus_version" content="2.9.1"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-2.9.1"><meta data-react-helmet="true" property="og:title" content="Tiered Storage | Apache Pulsar"><meta data-react-helmet="true" name="description" content="Pulsar&#x27;s Tiered Storage feature allows older backlog data to be offloaded to long term storage, thereby freeing up space in BookKeeper and reducing storage costs. This cookbook walks you through using tiered storage in your Pulsar cluster."><meta data-react-helmet="true" property="og:description" content="Pulsar&#x27;s Tiered Storage feature allows older backlog data to be offloaded to long term storage, thereby freeing up space in BookKeeper and reducing storage costs. This cookbook walks you through using tiered storage in your Pulsar cluster."><link data-react-helmet="true" rel="icon" href="/zh-TW/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://pulsar.apache.com/zh-TW/docs/cookbooks-tiered-storage"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.com/docs/cookbooks-tiered-storage" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.com/zh-CN/docs/cookbooks-tiered-storage" hreflang="zh-CN"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.com/zh-TW/docs/cookbooks-tiered-storage" hreflang="zh-TW"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.com/ja/docs/cookbooks-tiered-storage" hreflang="ja"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.com/fr/docs/cookbooks-tiered-storage" hreflang="fr"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.com/ko/docs/cookbooks-tiered-storage" hreflang="ko"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.com/docs/cookbooks-tiered-storage" hreflang="x-default"><link rel="stylesheet" href="/zh-TW/assets/css/styles.bc244745.css">
<link rel="preload" href="/zh-TW/assets/js/runtime~main.2fff5998.js" as="script">
<link rel="preload" href="/zh-TW/assets/js/main.f93a8a06.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="tailwind navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh-TW/"><div class="navbar__logo"><img src="/zh-TW/img/logo.svg" alt="pulasr logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/zh-TW/img/logo.svg" alt="pulasr logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title"></b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">Get Started</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh-TW/docs/concepts-overview">Pulsar Concepts</a></li><li><a class="dropdown__link" href="/zh-TW/docs/about">Quickstart</a></li><li><a class="dropdown__link" href="/zh-TW/ecosystem">Ecosystem</a></li></ul></div><a class="navbar__item navbar__link" href="/zh-TW/docs/about">Docs</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">REST APIs</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh-TW/admin-rest-api">Admin REST API</a></li><li><a class="dropdown__link" href="/zh-TW/functions-rest-api">Functions</a></li><li><a class="dropdown__link" href="/zh-TW/source-rest-api">Sources</a></li><li><a class="dropdown__link" href="/zh-TW/sink-rest-api">Sinks</a></li><li><a class="dropdown__link" href="/zh-TW/packages-rest-api">Packages</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">CLI</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh-TW/pulsar-admin-cli">Pulsar Admin</a></li><li><a class="dropdown__link" href="/zh-TW/pulsar-client-cli">Pulsar Client</a></li><li><a class="dropdown__link" href="/zh-TW/pulsar-perf-cli">Pulsar Perf</a></li><li><a class="dropdown__link" href="/zh-TW/pulsar-cli">Pulsar</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">Community</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh-TW/community#welcome">Welcome</a></li><li><a class="dropdown__link" href="/zh-TW/community#discussions">Discussions</a></li><li><a class="dropdown__link" href="/zh-TW/community#governance">Governance</a></li><li><a class="dropdown__link" href="/zh-TW/community#community">Meet the Community</a></li><li><a class="dropdown__link" href="/zh-TW/community#how-to-contribute">Contribute</a></li><li><a href="https://github.com/apache/pulsar/wiki" target="_blank" rel="noopener noreferrer" class="dropdown__link">Wiki</a></li><li><a href="https://github.com/apache/pulsar/issues" target="_blank" rel="noopener noreferrer" class="dropdown__link">Issue Tracking</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">Learn</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh-TW/blog">Blog</a></li><li><a class="dropdown__link" href="/zh-TW/case-studies">Case Studies</a></li><li><a class="dropdown__link" href="/zh-TW/resources">Resources</a></li><li><a class="dropdown__link" href="/zh-TW/events">Events</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" class="iconLanguage_zID8"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>‰∏≠ÊñáÔºàÂè∞ÁÅ£Ôºâ</span></span></a><ul class="dropdown__menu"><li><a href="/docs/cookbooks-tiered-storage" target="_self" rel="noopener noreferrer" class="dropdown__link">English</a></li><li><a href="/zh-CN/docs/cookbooks-tiered-storage" target="_self" rel="noopener noreferrer" class="dropdown__link">‰∏≠ÊñáÔºà‰∏≠ÂõΩÔºâ</a></li><li><a href="/zh-TW/docs/cookbooks-tiered-storage" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active">‰∏≠ÊñáÔºàÂè∞ÁÅ£Ôºâ</a></li><li><a href="/ja/docs/cookbooks-tiered-storage" target="_self" rel="noopener noreferrer" class="dropdown__link">Êó•Êú¨Ë™û</a></li><li><a href="/fr/docs/cookbooks-tiered-storage" target="_self" rel="noopener noreferrer" class="dropdown__link">Fran√ßais</a></li><li><a href="/ko/docs/cookbooks-tiered-storage" target="_self" rel="noopener noreferrer" class="dropdown__link">ÌïúÍµ≠Ïñ¥</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link" href="/zh-TW/docs">Version</a><ul class="dropdown__menu"><li><a rel="noopener noreferrer" class="dropdown__link"><span>2.9.0</span></a></li><li><a rel="noopener noreferrer" class="dropdown__link"><span>2.8.0</span></a></li><li><a rel="noopener noreferrer" class="dropdown__link"><span>2.7.0</span></a></li><li><a rel="noopener noreferrer" class="dropdown__link"><span>2.6.0</span></a></li></ul></div><div class="toggle_iYfV toggle_iQ2x toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">üåú</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">üåû</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><main class="docMainContainer_r8cw docMainContainerEnhanced_SOUu"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><span class="theme-doc-version-badge badge badge--secondary">Version: <!-- -->2.9.1</span><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Tiered Storage</h1></header><p>Pulsar&#x27;s <strong>Tiered Storage</strong> feature allows older backlog data to be offloaded to long term storage, thereby freeing up space in BookKeeper and reducing storage costs. This cookbook walks you through using tiered storage in your Pulsar cluster.</p><ul><li><p>Tiered storage uses <a href="https://jclouds.apache.org" target="_blank" rel="noopener noreferrer">Apache jclouds</a> to support <a href="https://aws.amazon.com/s3/" target="_blank" rel="noopener noreferrer">Amazon S3</a> and <a href="https://cloud.google.com/storage/" target="_blank" rel="noopener noreferrer">Google Cloud Storage</a>(GCS for short) for long term storage. With Jclouds, it is easy to add support for more <a href="https://jclouds.apache.org/reference/providers/#blobstore-providers" target="_blank" rel="noopener noreferrer">cloud storage providers</a> in the future.</p></li><li><p>Tiered storage uses <a href="http://hadoop.apache.org/" target="_blank" rel="noopener noreferrer">Apache Hadoop</a> to support filesystem for long term storage. With Hadoop, it is easy to add support for more filesystem in the future.</p></li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="when-should-i-use-tiered-storage">When should I use Tiered Storage?<a class="hash-link" href="#when-should-i-use-tiered-storage" title="Direct link to heading">‚Äã</a></h2><p>Tiered storage should be used when you have a topic for which you want to keep a very long backlog for a long time. For example, if you have a topic containing user actions which you use to train your recommendation systems, you may want to keep that data for a long time, so that if you change your recommendation algorithm you can rerun it against your full user history.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="the-offloading-mechanism">The offloading mechanism<a class="hash-link" href="#the-offloading-mechanism" title="Direct link to heading">‚Äã</a></h2><p>A topic in Pulsar is backed by a log, known as a managed ledger. This log is composed of an ordered list of segments. Pulsar only every writes to the final segment of the log. All previous segments are sealed. The data within the segment is immutable. This is known as a segment oriented architecture.</p><p><img alt="Tiered storage" src="/zh-TW/assets/images/pulsar-tiered-storage-72d8b53762992cfeaa58ae3b48dd2522.png" title="Tiered Storage"></p><p>The Tiered Storage offloading mechanism takes advantage of this segment oriented architecture. When offloading is requested, the segments of the log are copied, one-by-one, to tiered storage. All segments of the log, apart from the segment currently being written to can be offloaded.</p><p>On the broker, the administrator must configure the bucket and credentials for the cloud storage service. The configured bucket must exist before attempting to offload. If it does not exist, the offload operation will fail.</p><p>Pulsar uses multi-part objects to upload the segment data. It is possible that a broker could crash while uploading the data. We recommend you add a life cycle rule your bucket to expire incomplete multi-part upload after a day or two to avoid getting charged for incomplete uploads.</p><p>When ledgers are offloaded to long term storage, you can still query data in the offloaded ledgers with Pulsar SQL.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="configuring-the-offload-driver">Configuring the offload driver<a class="hash-link" href="#configuring-the-offload-driver" title="Direct link to heading">‚Äã</a></h2><p>Offloading is configured in <code>broker.conf</code>.</p><p>At a minimum, the administrator must configure the driver, the bucket and the authenticating credentials. There is also some other knobs to configure, like the bucket region, the max block size in backed storage, etc.</p><p>Currently we support driver of types:</p><ul><li><code>aws-s3</code>: <a href="https://aws.amazon.com/s3/" target="_blank" rel="noopener noreferrer">Simple Cloud Storage Service</a></li><li><code>google-cloud-storage</code>: <a href="https://cloud.google.com/storage/" target="_blank" rel="noopener noreferrer">Google Cloud Storage</a></li><li><code>filesystem</code>: <a href="http://hadoop.apache.org/" target="_blank" rel="noopener noreferrer">Filesystem Storage</a></li></ul><blockquote><p>Driver names are case-insensitive for driver&#x27;s name. There is a third driver type, <code>s3</code>, which is identical to <code>aws-s3</code>, though it requires that you specify an endpoint url using <code>s3ManagedLedgerOffloadServiceEndpoint</code>. This is useful if using a S3 compatible data store, other than AWS.</p></blockquote><div class="codeBlockContainer_J+bg language-conf theme-code-block"><div class="codeBlockContent_csEI conf"><pre tabindex="0" class="prism-code language-conf codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">managedLedgerOffloadDriver=aws-s3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="aws-s3-driver-configuration">&quot;aws-s3&quot; Driver configuration<a class="hash-link" href="#aws-s3-driver-configuration" title="Direct link to heading">‚Äã</a></h3><h4 class="anchor anchorWithStickyNavbar_y2LR" id="bucket-and-region">Bucket and Region<a class="hash-link" href="#bucket-and-region" title="Direct link to heading">‚Äã</a></h4><p>Buckets are the basic containers that hold your data. Everything that you store in Cloud Storage must be contained in a bucket. You can use buckets to organize your data and control access to your data, but unlike directories and folders, you cannot nest buckets.</p><div class="codeBlockContainer_J+bg language-conf theme-code-block"><div class="codeBlockContent_csEI conf"><pre tabindex="0" class="prism-code language-conf codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">s3ManagedLedgerOffloadBucket=pulsar-topic-offload</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Bucket Region is the region where bucket located. Bucket Region is not a required but a recommended configuration. If it is not configured, It will use the default region.</p><p>With AWS S3, the default region is <code>US East (N. Virginia)</code>. Page <a href="https://docs.aws.amazon.com/general/latest/gr/rande.html" target="_blank" rel="noopener noreferrer">AWS Regions and Endpoints</a> contains more information.</p><div class="codeBlockContainer_J+bg language-conf theme-code-block"><div class="codeBlockContent_csEI conf"><pre tabindex="0" class="prism-code language-conf codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">s3ManagedLedgerOffloadRegion=eu-west-3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="authentication-with-aws">Authentication with AWS<a class="hash-link" href="#authentication-with-aws" title="Direct link to heading">‚Äã</a></h4><p>To be able to access AWS S3, you need to authenticate with AWS S3. Pulsar does not provide any direct means of configuring authentication for AWS S3, but relies on the mechanisms supported by the <a href="https://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/auth/DefaultAWSCredentialsProviderChain.html" target="_blank" rel="noopener noreferrer">DefaultAWSCredentialsProviderChain</a>.</p><p>Once you have created a set of credentials in the AWS IAM console, they can be configured in a number of ways.</p><ol><li>Using ec2 instance metadata credentials</li></ol><p>If you are on AWS instance with an instance profile that provides credentials, Pulsar will use these credentials if no other mechanism is provided</p><ol start="2"><li>Set the environment variables <strong>AWS_ACCESS_KEY_ID</strong> and <strong>AWS_SECRET_ACCESS_KEY</strong> in <code>conf/pulsar_env.sh</code>.</li></ol><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">AWS_ACCESS_KEY_ID</span><span class="token operator">=</span><span class="token plain">ABC123456789</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">AWS_SECRET_ACCESS_KEY</span><span class="token operator">=</span><span class="token plain">ded7db27a4558e2ea8bbf0bf37ae0e8521618f366c</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><blockquote><p>\&quot;export\&quot; is important so that the variables are made available in the environment of spawned processes.</p></blockquote><ol start="3"><li>Add the Java system properties <em>aws.accessKeyId</em> and <em>aws.secretKey</em> to <strong>PULSAR_EXTRA_OPTS</strong> in <code>conf/pulsar_env.sh</code>.</li></ol><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">PULSAR_EXTRA_OPTS</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">${PULSAR_EXTRA_OPTS}</span><span class="token string" style="color:rgb(255, 121, 198)"> </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">${PULSAR_MEM}</span><span class="token string" style="color:rgb(255, 121, 198)"> </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">${PULSAR_GC}</span><span class="token string" style="color:rgb(255, 121, 198)"> -Daws.accessKeyId=ABC123456789 -Daws.secretKey=ded7db27a4558e2ea8bbf0bf37ae0e8521618f366c -Dio.netty.leakDetectionLevel=disabled -Dio.netty.recycler.maxCapacity.default=1000 -Dio.netty.recycler.linkCapacity=1024&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ol start="4"><li>Set the access credentials in <code>~/.aws/credentials</code>.</li></ol><div class="codeBlockContainer_J+bg language-conf theme-code-block"><div class="codeBlockContent_csEI conf"><pre tabindex="0" class="prism-code language-conf codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[default]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">aws_access_key_id=ABC123456789</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">aws_secret_access_key=ded7db27a4558e2ea8bbf0bf37ae0e8521618f366c</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ol start="5"><li>Assuming an IAM role</li></ol><p>If you want to assume an IAM role, this can be done via specifying the following:</p><div class="codeBlockContainer_J+bg language-conf theme-code-block"><div class="codeBlockContent_csEI conf"><pre tabindex="0" class="prism-code language-conf codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">s3ManagedLedgerOffloadRole=&lt;aws role arn&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">s3ManagedLedgerOffloadRoleSessionName=pulsar-s3-offload</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>This will use the <code>DefaultAWSCredentialsProviderChain</code> for assuming this role.</p><blockquote><p>The broker must be rebooted for credentials specified in pulsar_env to take effect.</p></blockquote><h4 class="anchor anchorWithStickyNavbar_y2LR" id="configuring-the-size-of-block-readwrite">Configuring the size of block read/write<a class="hash-link" href="#configuring-the-size-of-block-readwrite" title="Direct link to heading">‚Äã</a></h4><p>Pulsar also provides some knobs to configure the size of requests sent to AWS S3.</p><ul><li><code>s3ManagedLedgerOffloadMaxBlockSizeInBytes</code>  configures the maximum size of a &quot;part&quot; sent during a multipart upload. This cannot be smaller than 5MB. Default is 64MB.</li><li><code>s3ManagedLedgerOffloadReadBufferSizeInBytes</code> configures the block size for each individual read when reading back data from AWS S3. Default is 1MB.</li></ul><p>In both cases, these should not be touched unless you know what you are doing.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="google-cloud-storage-driver-configuration">&quot;google-cloud-storage&quot; Driver configuration<a class="hash-link" href="#google-cloud-storage-driver-configuration" title="Direct link to heading">‚Äã</a></h3><p>Buckets are the basic containers that hold your data. Everything that you store in Cloud Storage must be contained in a bucket. You can use buckets to organize your data and control access to your data, but unlike directories and folders, you cannot nest buckets.</p><div class="codeBlockContainer_J+bg language-conf theme-code-block"><div class="codeBlockContent_csEI conf"><pre tabindex="0" class="prism-code language-conf codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gcsManagedLedgerOffloadBucket=pulsar-topic-offload</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Bucket Region is the region where bucket located. Bucket Region is not a required but a recommended configuration. If it is not configured, It will use the default region.</p><p>Regarding GCS, buckets are default created in the <code>us multi-regional location</code>, page <a href="https://cloud.google.com/storage/docs/bucket-locations" target="_blank" rel="noopener noreferrer">Bucket Locations</a> contains more information.</p><div class="codeBlockContainer_J+bg language-conf theme-code-block"><div class="codeBlockContent_csEI conf"><pre tabindex="0" class="prism-code language-conf codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gcsManagedLedgerOffloadRegion=europe-west3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="authentication-with-gcs">Authentication with GCS<a class="hash-link" href="#authentication-with-gcs" title="Direct link to heading">‚Äã</a></h4><p>The administrator needs to configure <code>gcsManagedLedgerOffloadServiceAccountKeyFile</code> in <code>broker.conf</code> for the broker to be able to access the GCS service. <code>gcsManagedLedgerOffloadServiceAccountKeyFile</code> is a Json file, containing the GCS credentials of a service account. <a href="https://support.google.com/googleapi/answer/6158849" target="_blank" rel="noopener noreferrer">Service Accounts section of this page</a> contains more information of how to create this key file for authentication. More information about google cloud IAM is available <a href="https://cloud.google.com/storage/docs/access-control/iam" target="_blank" rel="noopener noreferrer">here</a>.</p><p>To generate service account credentials or view the public credentials that you&#x27;ve already generated, follow the following steps:</p><ol><li>Open the <a href="https://console.developers.google.com/iam-admin/serviceaccounts" target="_blank" rel="noopener noreferrer">Service accounts page</a>.</li><li>Select a project or create a new one.</li><li>Click <strong>Create service account</strong>.</li><li>In the <strong>Create service account</strong> window, type a name for the service account, and select <strong>Furnish a new private key</strong>. If you want to <a href="https://developers.google.com/identity/protocols/OAuth2ServiceAccount#delegatingauthority" target="_blank" rel="noopener noreferrer">grant G Suite domain-wide authority</a> to the service account, also select <strong>Enable G Suite Domain-wide Delegation</strong>.</li><li>Click <strong>Create</strong>.</li></ol><blockquote><p>Notes: Make ensure that the service account you create has permission to operate GCS, you need to assign <strong>Storage Admin</strong> permission to your service account in <a href="https://cloud.google.com/storage/docs/access-control/iam" target="_blank" rel="noopener noreferrer">here</a>.</p></blockquote><div class="codeBlockContainer_J+bg language-conf theme-code-block"><div class="codeBlockContent_csEI conf"><pre tabindex="0" class="prism-code language-conf codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gcsManagedLedgerOffloadServiceAccountKeyFile=&quot;/Users/hello/Downloads/project-804d5e6a6f33.json&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="configuring-the-size-of-block-readwrite-1">Configuring the size of block read/write<a class="hash-link" href="#configuring-the-size-of-block-readwrite-1" title="Direct link to heading">‚Äã</a></h4><p>Pulsar also provides some knobs to configure the size of requests sent to GCS.</p><ul><li><code>gcsManagedLedgerOffloadMaxBlockSizeInBytes</code> configures the maximum size of a &quot;part&quot; sent during a multipart upload. This cannot be smaller than 5MB. Default is 64MB.</li><li><code>gcsManagedLedgerOffloadReadBufferSizeInBytes</code> configures the block size for each individual read when reading back data from GCS. Default is 1MB.</li></ul><p>In both cases, these should not be touched unless you know what you are doing.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="filesystem-driver-configuration">&quot;filesystem&quot; Driver configuration<a class="hash-link" href="#filesystem-driver-configuration" title="Direct link to heading">‚Äã</a></h3><h4 class="anchor anchorWithStickyNavbar_y2LR" id="configure-connection-address">Configure connection address<a class="hash-link" href="#configure-connection-address" title="Direct link to heading">‚Äã</a></h4><p>You can configure the connection address in the <code>broker.conf</code> file.</p><div class="codeBlockContainer_J+bg language-conf theme-code-block"><div class="codeBlockContent_csEI conf"><pre tabindex="0" class="prism-code language-conf codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">fileSystemURI=&quot;hdfs://127.0.0.1:9000&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="configure-hadoop-profile-path">Configure Hadoop profile path<a class="hash-link" href="#configure-hadoop-profile-path" title="Direct link to heading">‚Äã</a></h4><p>The configuration file is stored in the Hadoop profile path. It contains various settings, such as base path, authentication, and so on.</p><div class="codeBlockContainer_J+bg language-conf theme-code-block"><div class="codeBlockContent_csEI conf"><pre tabindex="0" class="prism-code language-conf codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">fileSystemProfilePath=&quot;../conf/filesystem_offload_core_site.xml&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The model for storing topic data uses <code>org.apache.hadoop.io.MapFile</code>. You can use all of the configurations in <code>org.apache.hadoop.io.MapFile</code> for Hadoop.</p><p><strong>Example</strong></p><div class="codeBlockContainer_J+bg language-conf theme-code-block"><div class="codeBlockContent_csEI conf"><pre tabindex="0" class="prism-code language-conf codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;property&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &lt;name&gt;fs.defaultFS&lt;/name&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &lt;value&gt;&lt;/value&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;/property&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;property&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &lt;name&gt;hadoop.tmp.dir&lt;/name&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &lt;value&gt;pulsar&lt;/value&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;/property&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;property&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &lt;name&gt;io.file.buffer.size&lt;/name&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &lt;value&gt;4096&lt;/value&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;/property&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;property&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &lt;name&gt;io.seqfile.compress.blocksize&lt;/name&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &lt;value&gt;1000000&lt;/value&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;/property&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;property&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &lt;name&gt;io.seqfile.compression.type&lt;/name&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &lt;value&gt;BLOCK&lt;/value&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;/property&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;property&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &lt;name&gt;io.map.index.interval&lt;/name&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &lt;value&gt;128&lt;/value&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;/property&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>For more information about the configurations in <code>org.apache.hadoop.io.MapFile</code>, see <a href="http://hadoop.apache.org/" target="_blank" rel="noopener noreferrer">Filesystem Storage</a>.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="configuring-offload-to-run-automatically">Configuring offload to run automatically<a class="hash-link" href="#configuring-offload-to-run-automatically" title="Direct link to heading">‚Äã</a></h2><p>Namespace policies can be configured to offload data automatically once a threshold is reached. The threshold is based on the size of data that the topic has stored on the pulsar cluster. Once the topic reaches the threshold, an offload operation will be triggered. Setting a negative value to the threshold will disable automatic offloading. Setting the threshold to 0 will cause the broker to offload data as soon as it possiby can.</p><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ bin/pulsar-admin namespaces set-offload-threshold --size 10M my-tenant/my-namespace</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><blockquote><p>Automatic offload runs when a new segment is added to a topic log. If you set the threshold on a namespace, but few messages are being produced to the topic, offload will not until the current segment is full.</p></blockquote><h2 class="anchor anchorWithStickyNavbar_y2LR" id="configuring-read-priority-for-offloaded-messages">Configuring read priority for offloaded messages<a class="hash-link" href="#configuring-read-priority-for-offloaded-messages" title="Direct link to heading">‚Äã</a></h2><p>By default, once messages were offloaded to long term storage, brokers will read them from long term storage, but messages still exists in bookkeeper for a period depends on the administrator&#x27;s configuration. For messages exists in both bookkeeper and long term storage, if they are preferred to read from bookkeeper, you can use command to change this configuration.</p><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># default value for -orp is tiered-storage-first</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ bin/pulsar-admin namespaces set-offload-policies my-tenant/my-namespace -orp bookkeeper-first</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ bin/pulsar-admin topics set-offload-policies my-tenant/my-namespace/topic1 -orp bookkeeper-first</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="triggering-offload-manually">Triggering offload manually<a class="hash-link" href="#triggering-offload-manually" title="Direct link to heading">‚Äã</a></h2><p>Offloading can manually triggered through a REST endpoint on the Pulsar broker. We provide a CLI which will call this rest endpoint for you.</p><p>When triggering offload, you must specify the maximum size, in bytes, of backlog which will be retained locally on the bookkeeper. The offload mechanism will offload segments from the start of the topic backlog until this condition is met.</p><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ bin/pulsar-admin topics offload --size-threshold 10M my-tenant/my-namespace/topic1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Offload triggered </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> persistent://my-tenant/my-namespace/topic1 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> messages before </span><span class="token number">2</span><span class="token plain">:0:-1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The command to triggers an offload will not wait until the offload operation has completed. To check the status of the offload, use offload-status.</p><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ bin/pulsar-admin topics offload-status my-tenant/my-namespace/topic1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Offload is currently running</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>To wait for offload to complete, add the -w flag.</p><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ bin/pulsar-admin topics offload-status -w my-tenant/my-namespace/topic1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Offload was a success</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>If there is an error offloading, the error will be propagated to the offload-status command.</p><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ bin/pulsar-admin topics offload-status persistent://public/default/topic1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Error </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> offload</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">null</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Reason: Error offloading: org.apache.bookkeeper.mledger.ManagedLedgerException: java.util.concurrent.CompletionException: com.amazonaws.services.s3.model.AmazonS3Exception: Anonymous </span><span class="token function" style="color:rgb(80, 250, 123)">users</span><span class="token plain"> cannot initiate multipart uploads.  Please authenticate. </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">Service: Amazon S3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> Status Code: </span><span class="token number">403</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> Error Code: AccessDenied</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> Request ID: 798758DE3F1776DF</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> S3 Extended Request ID: dhBFz/lZm1oiG/oBEepeNlhrtsDlzoOhocuYMpKihQGXe6EG8puRGOkK6UwqzVrMXTWBxxHcS+g</span><span class="token operator">=</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">, S3 Extended Request ID: dhBFz/lZm1oiG/oBEepeNlhrtsDlzoOhocuYMpKihQGXe6EG8puRGOkK6UwqzVrMXTWBxxHcS+g</span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>`</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/apache/pulsar/edit/master/site2/website-next/versioned_docs/version-2.9.1/cookbooks-tiered-storage.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#when-should-i-use-tiered-storage" class="table-of-contents__link toc-highlight">When should I use Tiered Storage?</a></li><li><a href="#the-offloading-mechanism" class="table-of-contents__link toc-highlight">The offloading mechanism</a></li><li><a href="#configuring-the-offload-driver" class="table-of-contents__link toc-highlight">Configuring the offload driver</a><ul><li><a href="#aws-s3-driver-configuration" class="table-of-contents__link toc-highlight">&quot;aws-s3&quot; Driver configuration</a></li><li><a href="#google-cloud-storage-driver-configuration" class="table-of-contents__link toc-highlight">&quot;google-cloud-storage&quot; Driver configuration</a></li><li><a href="#filesystem-driver-configuration" class="table-of-contents__link toc-highlight">&quot;filesystem&quot; Driver configuration</a></li></ul></li><li><a href="#configuring-offload-to-run-automatically" class="table-of-contents__link toc-highlight">Configuring offload to run automatically</a></li><li><a href="#configuring-read-priority-for-offloaded-messages" class="table-of-contents__link toc-highlight">Configuring read priority for offloaded messages</a></li><li><a href="#triggering-offload-manually" class="table-of-contents__link toc-highlight">Triggering offload manually</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Apache Foundation.</div><ul class="footer__items"><li class="footer__item">
	              <img src="/img/Apache_Feather_Logo.svg" alt="" width="20">
	              </li><li class="footer__item"><a href="http://www.apache.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Foundation<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.apache.org/events/current-event.html" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Events<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>License<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.apache.org/foundation/thanks" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Thanks<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.apache.org/security" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Security<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.apache.org/foundation/sponsorship" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Sponsorship<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title"> </div><ul class="footer__items"><li class="footer__item">
	              <div><small><strong>Apache Pulsar is available under the <a href="/">Apache License, version 2.0.</a></strong></small></div>
                <div>Apache Pulsar is a distributed, open source pub-sub messaging and streaming platform for real-time workloads, managing hundreds of billions of events per day.</div>
	              </li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a class="footerLogoLink_SRtH" href="/zh-TW/"><img src="/zh-TW/img/pulsar-white.svg" alt="Pulsar Logo" class="themedImage_TMUO themedImage--light_4Vu1 footer__logo"><img src="/zh-TW/img/pulsar-white.svg" alt="Pulsar Logo" class="themedImage_TMUO themedImage--dark_uzRr footer__logo"></a></div><div class="footer__copyright"><p>Apache Pulsar is available under the Apache License, version 2.0.</p>
      <p>Inc.Copyright ¬© 2022 The Apache Software Foundation. All Rights Reserved. Apache, Apache Pulsar and the Apache feather logo are trademarks of The Apache Software Foundation.</p></div></div></div></footer></div>
<script src="/zh-TW/assets/js/runtime~main.2fff5998.js"></script>
<script src="/zh-TW/assets/js/main.f93a8a06.js"></script>
</body>
</html>